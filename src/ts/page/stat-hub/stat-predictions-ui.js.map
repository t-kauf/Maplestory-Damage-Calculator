{
  "version": 3,
  "sources": ["stat-predictions-ui.ts"],
  "sourcesContent": ["/**\n * Stat Predictions UI\n * HTML generation and event handling for stat predictions table\n */\n\nimport { formatNumber } from '@ts/utils/formatters';\nimport { calculateAllStatWeights } from './stat-predictions';\nimport { PERCENTAGE_STATS, MULTIPLICATIVE_STATS, DEFAULT_STAT_INCREASES } from './stat-predictions';\nimport type { StatWeightResult } from '@ts/types/page/stat-hub/stat-hub.types';\nimport { loadoutStore } from '@ts/store/loadout.store';\nimport { debounce } from '@ts/utils/event-emitter';\nimport { resetCachedCharts } from '@ts/utils/stat-chart';\n\n/**\n * Format a stat increase value with appropriate units\n */\nfunction formatStatValue(value: number, statKey?: string): string {\n    if (statKey === 'damageAmp') {\n        return `+${value.toFixed(1)}x`;\n    }\n    return `+${formatNumber(value)}`;\n}\n\n/**\n * Generate tooltip text for a stat cell\n */\nfunction generateStatTooltip(\n    statKey: string,\n    increase: number,\n    oldValue: number,\n    newValue: number,\n    gainPercentage: number,\n    effectiveIncrease?: number\n): string {\n    if (statKey === 'attack') {\n        return `+${formatNumber(increase)} Attack\\nOld: ${formatNumber(oldValue)}, New: ${formatNumber(newValue)}\\nEffective: +${formatNumber(effectiveIncrease || 0)}\\nGain: ${gainPercentage.toFixed(2)}%`;\n    } else if (statKey === 'mainStat') {\n        const actualMainStatGain = effectiveIncrease || increase;\n        return `+${formatNumber(actualMainStatGain)} Main Stat\\n+${formatNumber(actualMainStatGain)} Attack\\n+${(actualMainStatGain / 100).toFixed(2)}% Stat Damage\\nGain: ${gainPercentage.toFixed(2)}%`;\n    } else if (statKey === 'statDamage') {\n        const statDamageIncrease = (newValue - oldValue).toFixed(2);\n        return `+${increase}% Main Stat\\nStat Damage: +${statDamageIncrease}%\\nGain: ${gainPercentage.toFixed(2)}%`;\n    } else {\n        return `+${increase}%\\nOld: ${formatNumber(oldValue)}, New: ${formatNumber(newValue)}\\nGain: ${gainPercentage.toFixed(2)}%`;\n    }\n}\n\n/**\n * Generate a table cell with gain percentage\n */\nfunction generateGainCell(\n    statKey: string,\n    increase: number,\n    oldValue: number,\n    newValue: number,\n    gainPercentage: number,\n    effectiveIncrease?: number\n): string {\n    const tooltip = generateStatTooltip(statKey, increase, oldValue, newValue, gainPercentage, effectiveIncrease);\n    return `<td title=\"${tooltip}\"><span style=\"color: var(--text-primary);\">+${gainPercentage.toFixed(2)}%</span></td>`;\n}\n\n/**\n * Generate a stat row with chart toggle button\n */\nfunction generateStatRow(\n    statKey: string,\n    statLabel: string,\n    isFlat: boolean,\n    weights: StatWeightResult[],\n    increaseLabel: string\n): string {\n    let labelContent = statLabel;\n\n    // Add special indicators for certain stat types\n    if (MULTIPLICATIVE_STATS[statKey]) {\n        labelContent += ` <span style=\"font-size: 0.7em; opacity: 0.5;\" title=\"Multiplicative\">\u26A1</span>`;\n    }\n\n    // Generate the row header with chart toggle button\n    let html = `<tr><td><button onclick=\"toggleStatChart('${statKey}', '${statLabel}', ${isFlat})\" title=\"Toggle graph\" onmouseover=\"this.style.opacity='1'\" onmouseout=\"this.style.opacity='0.7'\">\uD83D\uDCCA</button>${labelContent}</td>`;\n\n    // Generate cells for each increase value\n    weights.forEach(weight => {\n        html += generateGainCell(\n            statKey,\n            weight.increase,\n            weight.oldValue ?? 0,\n            weight.newValue ?? 0,\n            weight.gainPercentage,\n            weight.effectiveIncrease\n        );\n    });\n\n    html += '</tr>';\n\n    // Add chart row\n    const colspan = weights.length + 1;\n    html += `<tr id=\"chart-row-${statKey}\" class=\"chart-row\" style=\"display: none;\"><td colspan=\"${colspan}\" style=\"padding: 16px; background: var(--background); border-top: 1px solid var(--table-glass-border);\"><canvas id=\"chart-${statKey}\"></canvas></td></tr>`;\n\n    return html;\n}\n\n/**\n * Generate the header row for a predictions table\n */\nfunction generateTableHeader(increases: number[], isPercentage: boolean): string {\n    let html = '<thead><tr><th>Stat</th>';\n\n    increases.forEach((inc, idx) => {\n        if (isPercentage) {\n            html += `<th onclick=\"sortStatPredictions('percentage', ${idx + 1}, this)\" onmouseover=\"this.style.background='var(--table-surface-subtle)'\" onmouseout=\"this.style.background='transparent'\">+${inc}% <span class=\"sort-indicator\" style=\"opacity: 0.3; font-size: 0.8em; margin-left: 4px;\">\u21C5</span></th>`;\n        } else {\n            html += `<th>+${formatNumber(inc)} </th>`;\n        }\n    });\n\n    html += '</tr></thead>';\n    return html;\n}\n\n/**\n * Generate HTML for flat stats section\n */\nfunction generateFlatStatsSection(weights: ReturnType<typeof calculateAllStatWeights>): string {\n    let html = '<div class=\"stat-predictions-section\">';\n    html += '<h3 style=\"margin: 0 0 12px 0; font-size: 0.9375rem; font-weight: 700; color: var(--text-primary); letter-spacing: -0.02em;\">Flat Stats</h3>';\n    html += '<div class=\"table-wrapper\">';\n    html += `<table class=\"table\" id=\"stat-pred-table-flat\">`;\n\n    // Attack table\n    html += generateTableHeader(DEFAULT_STAT_INCREASES.flat, false);\n    html += '<tbody>';\n    html += generateStatRow('attack', 'Attack', true, weights.attackWeights, 'Attack');\n    html += '</tbody>';\n\n    // Main stat table\n    html += generateTableHeader(DEFAULT_STAT_INCREASES.mainStat, false);\n    html += '<tbody>';\n    html += generateStatRow('mainStat', 'Main Stat', true, weights.mainStatWeights, 'Main Stat');\n    html += '</tbody>';\n\n    html += '</table>';\n    html += '</div>';\n    html += '</div>';\n\n    return html;\n}\n\n/**\n * Generate HTML for percentage stats section\n */\nfunction generatePercentageStatsSection(weights: ReturnType<typeof calculateAllStatWeights>): string {\n    let html = '<div class=\"stat-predictions-section\" style=\"margin-top: 24px;\">';\n    html += '<h3 style=\"margin: 0 0 12px 0; font-size: 0.9375rem; font-weight: 700; color: var(--text-primary); letter-spacing: -0.02em;\">Percentage Stats</h3>';\n    html += '<div class=\"table-wrapper\">';\n    html += `<table class=\"table\" id=\"stat-pred-table-percentage\">`;\n\n    html += '<thead><tr><th style=\"padding: 8px 10px; font-size: 0.75rem;\">Stat</th>';\n    DEFAULT_STAT_INCREASES.percentage.forEach((inc, idx) => {\n        html += `<th onclick=\"sortStatPredictions('percentage', ${idx + 1}, this)\" onmouseover=\"this.style.background='var(--table-surface-subtle)'\" onmouseout=\"this.style.background='transparent'\">+${inc}% <span class=\"sort-indicator\" style=\"opacity: 0.3; font-size: 0.8em; margin-left: 4px;\">\u21C5</span></th>`;\n    });\n    html += '</tr></thead><tbody>';\n\n    // Generate rows for each percentage stat\n    PERCENTAGE_STATS.forEach(stat => {\n        const statWeights = weights.percentageWeights[stat.key];\n        html += generateStatRow(stat.key, stat.label, false, statWeights, `${stat.key}%`);\n    });\n\n    html += '</tbody></table>';\n    html += '</div>';\n    html += '</div>';\n\n    return html;\n}\n\n/**\n * Generate complete HTML for stat predictions table\n */\nexport function generateStatPredictionsHTML(): string {\n    const stats = loadoutStore.getBaseStats();\n    const weights = calculateAllStatWeights(stats);\n\n    let html = '';\n    html += generateFlatStatsSection(weights);\n    html += generatePercentageStatsSection(weights);\n\n    return html;\n}\n\n/**\n * Update the stat predictions table with new calculations\n */\nexport function updateStatPredictions(): void {\n    const container = document.getElementById(`stat-weights`);\n    if (!container) {\n        console.warn(`Stat predictions container not found`);\n        return;\n    }\n\n    container.innerHTML = generateStatPredictionsHTML();\n\n    loadoutStore.on('stat:changed', debounce((_) => {\n        resetCachedCharts();\n        container.innerHTML = generateStatPredictionsHTML();\n    }, 700));\n}\n\n// Column sorting for stat predictions tables\nwindow.sortStatPredictions = function(tableType: string, colIndex: number, th: HTMLElement): void {\n    const tableId = `stat-pred-table-${tableType}`;\n    const table = document.getElementById(tableId);\n    if (!table) return;\n\n    const tbody = table.querySelector('tbody');\n    if (!tbody) return;\n\n    // Get all data rows (exclude chart rows)\n    const rows = Array.from(tbody.querySelectorAll('tr')).filter(row => !row.classList.contains('chart-row'));\n\n    // Parse numeric values from the clicked column and create row data\n    const rowData = rows.map(row => {\n        const cell = row.querySelector(`td:nth-child(${colIndex + 1})`);\n        if (!cell) return { row, value: -Infinity };\n\n        const span = cell.querySelector('span');\n        const text = span ? span.textContent : cell.textContent;\n        // Extract numeric value (handles \"+1.23%\" format)\n        const value = parseFloat(text.replace(/[+%]/g, ''));\n        return { row, value };\n    });\n\n    // Determine sort direction\n    const currentSort = th.dataset.sort || 'none';\n    let newDirection = 'asc';\n\n    if (currentSort === 'asc') {\n        newDirection = 'desc';\n    } else if (currentSort === 'desc') {\n        newDirection = 'asc'; // Toggle back to asc\n    }\n\n    // Sort rows based on values\n    rowData.sort((a, b) => {\n        if (newDirection === 'asc') {\n            return a.value - b.value;\n        } else {\n            return b.value - a.value;\n        }\n    });\n\n    // Reorder rows in DOM (keeping chart rows with their data rows)\n    rowData.forEach((item, index) => {\n        const dataRow = item.row;\n        const chartRow = dataRow.nextElementSibling;\n        tbody.appendChild(dataRow);\n        if (chartRow && chartRow.classList.contains('chart-row')) {\n            tbody.appendChild(chartRow);\n        }\n    });\n\n    // Update sort indicators\n    const tableHeaders = table.querySelectorAll('th .sort-indicator');\n    tableHeaders.forEach((indicator: HTMLElement) => {\n        indicator.textContent = '\u21C5';\n        indicator.style.opacity = '0.3';\n    });\n\n    const clickedIndicator: HTMLElement = th.querySelector('.sort-indicator');\n    if (clickedIndicator) {\n        clickedIndicator.textContent = newDirection === 'asc' ? '\u25B2' : '\u25BC';\n        clickedIndicator.style.opacity = '1';\n    }\n\n    // Store sort state\n    th.dataset.sort = newDirection;\n};\n"],
  "mappings": "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",
  "names": []
}
