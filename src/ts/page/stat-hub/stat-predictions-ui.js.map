{
  "version": 3,
  "sources": ["stat-predictions-ui.ts"],
  "sourcesContent": ["/**\r\n * Stat Predictions UI\r\n * HTML generation and event handling for stat predictions table\r\n */\r\n\r\nimport { formatNumber } from '@ts/utils/formatters';\r\nimport { calculateAllStatWeights } from './stat-predictions';\r\nimport { PERCENTAGE_STATS, MULTIPLICATIVE_STATS, DEFAULT_STAT_INCREASES } from './stat-predictions';\r\nimport type { StatWeightResult } from '@ts/types/page/stat-hub/stat-hub.types';\r\nimport { loadoutStore } from '@ts/store/loadout.store';\r\nimport { debounce } from '@ts/utils/event-emitter';\r\nimport { resetCachedCharts } from '@ts/utils/stat-chart';\r\n\r\n/**\r\n * Format a stat increase value with appropriate units\r\n */\r\nfunction formatStatValue(value: number, statKey?: string): string {\r\n    if (statKey === 'damageAmp') {\r\n        return `+${value.toFixed(1)}x`;\r\n    }\r\n    return `+${formatNumber(value)}`;\r\n}\r\n\r\n/**\r\n * Generate tooltip text for a stat cell\r\n */\r\nfunction generateStatTooltip(\r\n    statKey: string,\r\n    increase: number,\r\n    oldValue: number,\r\n    newValue: number,\r\n    gainPercentage: number,\r\n    effectiveIncrease?: number\r\n): string {\r\n    if (statKey === 'attack') {\r\n        return `+${formatNumber(increase)} Attack\\nOld: ${formatNumber(oldValue)}, New: ${formatNumber(newValue)}\\nEffective: +${formatNumber(effectiveIncrease || 0)}\\nGain: ${gainPercentage.toFixed(2)}%`;\r\n    } else if (statKey === 'mainStat') {\r\n        const actualMainStatGain = effectiveIncrease || increase;\r\n        return `+${formatNumber(actualMainStatGain)} Main Stat\\n+${formatNumber(actualMainStatGain)} Attack\\n+${(actualMainStatGain / 100).toFixed(2)}% Stat Damage\\nGain: ${gainPercentage.toFixed(2)}%`;\r\n    } else if (statKey === 'statDamage') {\r\n        const statDamageIncrease = (newValue - oldValue).toFixed(2);\r\n        return `+${increase}% Main Stat\\nStat Damage: +${statDamageIncrease}%\\nGain: ${gainPercentage.toFixed(2)}%`;\r\n    } else {\r\n        return `+${increase}%\\nOld: ${formatNumber(oldValue)}, New: ${formatNumber(newValue)}\\nGain: ${gainPercentage.toFixed(2)}%`;\r\n    }\r\n}\r\n\r\n/**\r\n * Generate a table cell with gain percentage\r\n */\r\nfunction generateGainCell(\r\n    statKey: string,\r\n    increase: number,\r\n    oldValue: number,\r\n    newValue: number,\r\n    gainPercentage: number,\r\n    effectiveIncrease?: number\r\n): string {\r\n    const tooltip = generateStatTooltip(statKey, increase, oldValue, newValue, gainPercentage, effectiveIncrease);\r\n    return `<td title=\"${tooltip}\"><span style=\"color: var(--text-primary);\">+${gainPercentage.toFixed(2)}%</span></td>`;\r\n}\r\n\r\n/**\r\n * Generate a stat row with chart toggle button\r\n */\r\nfunction generateStatRow(\r\n    statKey: string,\r\n    statLabel: string,\r\n    isFlat: boolean,\r\n    weights: StatWeightResult[],\r\n    increaseLabel: string\r\n): string {\r\n    let labelContent = statLabel;\r\n\r\n    // Add special indicators for certain stat types\r\n    if (MULTIPLICATIVE_STATS[statKey]) {\r\n        labelContent += ` <span style=\"font-size: 0.7em; opacity: 0.5;\" title=\"Multiplicative\">\u26A1</span>`;\r\n    }\r\n\r\n    // Generate the row header with chart toggle button\r\n    let html = `<tr><td><button onclick=\"toggleStatChart('${statKey}', '${statLabel}', ${isFlat})\" title=\"Toggle graph\" onmouseover=\"this.style.opacity='1'\" onmouseout=\"this.style.opacity='0.7'\">\uD83D\uDCCA</button>${labelContent}</td>`;\r\n\r\n    // Generate cells for each increase value\r\n    weights.forEach(weight => {\r\n        html += generateGainCell(\r\n            statKey,\r\n            weight.increase,\r\n            weight.oldValue ?? 0,\r\n            weight.newValue ?? 0,\r\n            weight.gainPercentage,\r\n            weight.effectiveIncrease\r\n        );\r\n    });\r\n\r\n    html += '</tr>';\r\n\r\n    // Add chart row\r\n    const colspan = weights.length + 1;\r\n    html += `<tr id=\"chart-row-${statKey}\" class=\"chart-row\" style=\"display: none;\"><td colspan=\"${colspan}\" style=\"padding: 16px; background: var(--background); border-top: 1px solid var(--table-glass-border);\"><canvas id=\"chart-${statKey}\"></canvas></td></tr>`;\r\n\r\n    return html;\r\n}\r\n\r\n/**\r\n * Generate the header row for a predictions table\r\n */\r\nfunction generateTableHeader(increases: number[], isPercentage: boolean): string {\r\n    let html = '<thead><tr><th>Stat</th>';\r\n\r\n    increases.forEach((inc, idx) => {\r\n        if (isPercentage) {\r\n            html += `<th onclick=\"sortStatPredictions('percentage', ${idx + 1}, this)\" onmouseover=\"this.style.background='var(--table-surface-subtle)'\" onmouseout=\"this.style.background='transparent'\">+${inc}% <span class=\"sort-indicator\" style=\"opacity: 0.3; font-size: 0.8em; margin-left: 4px;\">\u21C5</span></th>`;\r\n        } else {\r\n            html += `<th>+${formatNumber(inc)} </th>`;\r\n        }\r\n    });\r\n\r\n    html += '</tr></thead>';\r\n    return html;\r\n}\r\n\r\n/**\r\n * Generate HTML for flat stats section\r\n */\r\nfunction generateFlatStatsSection(weights: ReturnType<typeof calculateAllStatWeights>): string {\r\n    let html = '<div class=\"stat-predictions-section\">';\r\n    html += '<h3 style=\"margin: 0 0 12px 0; font-size: 0.9375rem; font-weight: 700; color: var(--text-primary); letter-spacing: -0.02em;\">Flat Stats</h3>';\r\n    html += '<div class=\"\">';\r\n    html += `<table class=\"table\" id=\"stat-pred-table-flat\">`;\r\n\r\n    // Attack table\r\n    html += generateTableHeader(DEFAULT_STAT_INCREASES.flat, false);\r\n    html += '<tbody>';\r\n    html += generateStatRow('attack', 'Attack', true, weights.attackWeights, 'Attack');\r\n    html += '</tbody>';\r\n\r\n    // Main stat table\r\n    html += generateTableHeader(DEFAULT_STAT_INCREASES.mainStat, false);\r\n    html += '<tbody>';\r\n    html += generateStatRow('mainStat', 'Main Stat', true, weights.mainStatWeights, 'Main Stat');\r\n    html += '</tbody>';\r\n\r\n    html += '</table>';\r\n    html += '</div>';\r\n    html += '</div>';\r\n\r\n    return html;\r\n}\r\n\r\n/**\r\n * Generate HTML for percentage stats section\r\n */\r\nfunction generatePercentageStatsSection(weights: ReturnType<typeof calculateAllStatWeights>): string {\r\n    let html = '<div class=\"stat-predictions-section\" style=\"margin-top: 24px;\">';\r\n    html += '<h3 style=\"margin: 0 0 12px 0; font-size: 0.9375rem; font-weight: 700; color: var(--text-primary); letter-spacing: -0.02em;\">Percentage Stats</h3>';\r\n    html += '<div class=\"\">';\r\n    html += `<table class=\"table\" id=\"stat-pred-table-percentage\">`;\r\n\r\n    html += '<thead><tr><th style=\"padding: 8px 10px; font-size: 0.75rem;\">Stat</th>';\r\n    DEFAULT_STAT_INCREASES.percentage.forEach((inc, idx) => {\r\n        html += `<th onclick=\"sortStatPredictions('percentage', ${idx + 1}, this)\" onmouseover=\"this.style.background='var(--table-surface-subtle)'\" onmouseout=\"this.style.background='transparent'\">+${inc}% <span class=\"sort-indicator\" style=\"opacity: 0.3; font-size: 0.8em; margin-left: 4px;\">\u21C5</span></th>`;\r\n    });\r\n    html += '</tr></thead><tbody>';\r\n\r\n    // Generate rows for each percentage stat\r\n    PERCENTAGE_STATS.forEach(stat => {\r\n        const statWeights = weights.percentageWeights[stat.key];\r\n        html += generateStatRow(stat.key, stat.label, false, statWeights, `${stat.key}%`);\r\n    });\r\n\r\n    html += '</tbody></table>';\r\n    html += '</div>';\r\n    html += '</div>';\r\n\r\n    return html;\r\n}\r\n\r\n/**\r\n * Generate complete HTML for stat predictions table\r\n */\r\nexport function generateStatPredictionsHTML(): string {\r\n    const stats = loadoutStore.getBaseStats();\r\n    const weights = calculateAllStatWeights(stats);\r\n\r\n    let html = '';\r\n    html += generateFlatStatsSection(weights);\r\n    html += generatePercentageStatsSection(weights);\r\n\r\n    return html;\r\n}\r\n\r\n/**\r\n * Update the stat predictions table with new calculations\r\n */\r\nexport function updateStatPredictions(): void {\r\n    const container = document.getElementById(`stat-weights`);\r\n    if (!container) {\r\n        console.warn(`Stat predictions container not found`);\r\n        return;\r\n    }\r\n\r\n    container.innerHTML = generateStatPredictionsHTML();\r\n\r\n    loadoutStore.on('stat:changed', debounce((_) => {\r\n        resetCachedCharts();\r\n        container.innerHTML = generateStatPredictionsHTML();\r\n    }, 700));\r\n}\r\n\r\n// Column sorting for stat predictions tables\r\nwindow.sortStatPredictions = function(tableType: string, colIndex: number, th: HTMLElement): void {\r\n    const tableId = `stat-pred-table-${tableType}`;\r\n    const table = document.getElementById(tableId);\r\n    if (!table) return;\r\n\r\n    const tbody = table.querySelector('tbody');\r\n    if (!tbody) return;\r\n\r\n    // Get all data rows (exclude chart rows)\r\n    const rows = Array.from(tbody.querySelectorAll('tr')).filter(row => !row.classList.contains('chart-row'));\r\n\r\n    // Parse numeric values from the clicked column and create row data\r\n    const rowData = rows.map(row => {\r\n        const cell = row.querySelector(`td:nth-child(${colIndex + 1})`);\r\n        if (!cell) return { row, value: -Infinity };\r\n\r\n        const span = cell.querySelector('span');\r\n        const text = span ? span.textContent : cell.textContent;\r\n        // Extract numeric value (handles \"+1.23%\" format)\r\n        const value = parseFloat(text.replace(/[+%]/g, ''));\r\n        return { row, value };\r\n    });\r\n\r\n    // Determine sort direction\r\n    const currentSort = th.dataset.sort || 'none';\r\n    let newDirection = 'asc';\r\n\r\n    if (currentSort === 'asc') {\r\n        newDirection = 'desc';\r\n    } else if (currentSort === 'desc') {\r\n        newDirection = 'asc'; // Toggle back to asc\r\n    }\r\n\r\n    // Sort rows based on values\r\n    rowData.sort((a, b) => {\r\n        if (newDirection === 'asc') {\r\n            return a.value - b.value;\r\n        } else {\r\n            return b.value - a.value;\r\n        }\r\n    });\r\n\r\n    // Reorder rows in DOM (keeping chart rows with their data rows)\r\n    rowData.forEach((item, index) => {\r\n        const dataRow = item.row;\r\n        const chartRow = dataRow.nextElementSibling;\r\n        tbody.appendChild(dataRow);\r\n        if (chartRow && chartRow.classList.contains('chart-row')) {\r\n            tbody.appendChild(chartRow);\r\n        }\r\n    });\r\n\r\n    // Update sort indicators\r\n    const tableHeaders = table.querySelectorAll('th .sort-indicator');\r\n    tableHeaders.forEach((indicator: HTMLElement) => {\r\n        indicator.textContent = '\u21C5';\r\n        indicator.style.opacity = '0.3';\r\n    });\r\n\r\n    const clickedIndicator: HTMLElement = th.querySelector('.sort-indicator');\r\n    if (clickedIndicator) {\r\n        clickedIndicator.textContent = newDirection === 'asc' ? '\u25B2' : '\u25BC';\r\n        clickedIndicator.style.opacity = '1';\r\n    }\r\n\r\n    // Store sort state\r\n    th.dataset.sort = newDirection;\r\n};\r\n"],
  "mappings": "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",
  "names": []
}
