{
  "version": 3,
  "sources": ["stat-predictions.ts"],
  "sourcesContent": ["/**\r\n * Stat Predictions Logic\r\n * Business logic for calculating stat damage predictions\r\n * Separated from UI concerns\r\n */\r\n\r\nimport { StatCalculationService } from '@ts/services/stat-calculation-service';\r\nimport { BaseStats } from '@ts/types';\r\nimport { MONSTER_TYPE, STAT, type StatKey } from '@ts/types/constants';\r\nimport type { StatWeightResult, StatIncrease } from '@ts/types/page/stat-hub/stat-hub.types';\r\n\r\n/**\r\n * Convert lowercase stat ID to StatKey (uppercase)\r\n * Maps 'attack' -> 'ATTACK', 'critRate' -> 'CRIT_RATE', etc.\r\n */\r\nfunction idToStatKey(id: string): StatKey {\r\n    for (const key of Object.keys(STAT) as StatKey[]) {\r\n        if (STAT[key].id === id) {\r\n            return key;\r\n        }\r\n    }\r\n    throw new Error(`Unknown stat ID: ${id}`);\r\n}\r\n\r\n// Default stat increase values\r\nexport const DEFAULT_STAT_INCREASES: StatIncrease = {\r\n    flat: [500, 1000, 2500, 5000, 10000, 15000],\r\n    mainStat: [100, 500, 1000, 2500, 5000, 7500],\r\n    percentage: [1, 5, 10, 25, 50, 75]\r\n};\r\n\r\n// Percentage stat configuration\r\nexport const PERCENTAGE_STATS = [\r\n    { key: STAT.SKILL_COEFFICIENT.id, label: 'Skill Coeff' },\r\n    { key: STAT.MASTERY.id, label: 'Skill Mastery' },\r\n    { key: STAT.DAMAGE.id, label: 'Damage' },\r\n    { key: STAT.FINAL_DAMAGE.id, label: 'Final Dmg' },\r\n    { key: STAT.BOSS_DAMAGE.id, label: 'Boss Dmg' },\r\n    { key: STAT.NORMAL_DAMAGE.id, label: 'Mob Dmg' },\r\n    { key: STAT.STAT_DAMAGE.id, label: 'Main Stat %' },\r\n    { key: STAT.DAMAGE_AMP.id, label: 'Dmg Amp' },\r\n    { key: STAT.MIN_DAMAGE.id, label: 'Min Dmg' },\r\n    { key: STAT.MAX_DAMAGE.id, label: 'Max Dmg' },\r\n    { key: STAT.CRIT_RATE.id, label: 'Crit Rate' },\r\n    { key: STAT.CRIT_DAMAGE.id, label: 'Crit Dmg' },\r\n    { key: STAT.ATTACK_SPEED.id, label: 'Atk Speed' },\r\n    { key: STAT.DEF_PEN.id, label: 'Def Pen' }\r\n];\r\n\r\n// Multiplicative stats (applied multiplicatively)\r\nexport const MULTIPLICATIVE_STATS: Record<string, boolean> = {\r\n    [STAT.FINAL_DAMAGE.id]: true\r\n};\r\n\r\n// Diminishing return stats with their denominator values\r\nexport const DIMINISHING_RETURN_STATS: Record<string, { denominator: number }> = {\r\n    [STAT.ATTACK_SPEED.id]: { denominator: 150 },\r\n    [STAT.DEF_PEN.id]: { denominator: 100 }\r\n};\r\n\r\n/**\r\n * Calculate attack stat weights\r\n * Returns array of weight results for each increase value\r\n */\r\nexport function calculateAttackWeights(\r\n    stats: BaseStats,\r\n    baseBossDPS: number,\r\n    increases: number[]\r\n): StatWeightResult[] {\r\n    const results: StatWeightResult[] = [];\r\n\r\n    increases.forEach(increase => {\r\n        const service = new StatCalculationService(stats);\r\n        const oldValue = stats.ATTACK;\r\n        const effectiveIncrease = increase * (1 + service.weaponAttackBonus / 100);\r\n\r\n        const newDPS = service.add('attack', increase).computeDPS(MONSTER_TYPE.BOSS);\r\n        const newValue = service.getStats().ATTACK;\r\n        const gainPercentage = (newDPS - baseBossDPS) / baseBossDPS * 100;\r\n\r\n        results.push({\r\n            statLabel: 'Attack',\r\n            increase,\r\n            oldDPS: baseBossDPS,\r\n            newDPS,\r\n            gainPercentage,\r\n            effectiveIncrease,\r\n            oldValue,\r\n            newValue\r\n        });\r\n    });\r\n\r\n    return results;\r\n}\r\n\r\n/**\r\n * Calculate main stat weights\r\n * Returns array of weight results for each increase value\r\n */\r\nexport function calculateMainStatWeights(\r\n    stats: BaseStats,\r\n    baseBossDPS: number,\r\n    increases: number[]\r\n): StatWeightResult[] {\r\n    const results: StatWeightResult[] = [];\r\n\r\n    increases.forEach(increase => {\r\n        const service = new StatCalculationService(stats);\r\n        const actualMainStatGain = service.calculateMainStatIncreaseWithPct(increase);\r\n\r\n        const newDPS = service.add('mainStat', increase).computeDPS(MONSTER_TYPE.BOSS);\r\n        const gainPercentage = (newDPS - baseBossDPS) / baseBossDPS * 100;\r\n\r\n        results.push({\r\n            statLabel: 'Main Stat',\r\n            increase: actualMainStatGain,\r\n            oldDPS: baseBossDPS,\r\n            newDPS,\r\n            gainPercentage,\r\n            effectiveIncrease: actualMainStatGain\r\n        });\r\n    });\r\n\r\n    return results;\r\n}\r\n\r\n/**\r\n * Calculate percentage stat weights for a specific stat\r\n * Returns array of weight results for each increase value\r\n */\r\nexport function calculatePercentageStatWeight(\r\n    stats: BaseStats,\r\n    baseBossDPS: number,\r\n    baseNormalDPS: number,\r\n    statKey: string,\r\n    increases: number[]\r\n): StatWeightResult[] {\r\n    const results: StatWeightResult[] = [];\r\n    const isNormalDamage = statKey === STAT.NORMAL_DAMAGE.id;\r\n    const baseDPS = isNormalDamage ? baseNormalDPS : baseBossDPS;\r\n\r\n    increases.forEach(increase => {\r\n        const service = new StatCalculationService(stats);\r\n\r\n        // Apply the stat increase using the unified add() API\r\n        service.add(statKey, increase);\r\n\r\n        const monsterType = isNormalDamage ? MONSTER_TYPE.NORMAL : MONSTER_TYPE.BOSS;\r\n        const newDPS = service.computeDPS(monsterType);\r\n        const gainPercentage = (newDPS - baseDPS) / baseDPS * 100;\r\n\r\n        const actualStatKey = idToStatKey(statKey);\r\n        const newValue = service.getStats()[actualStatKey];\r\n        const oldValue = stats[actualStatKey];\r\n\r\n        results.push({\r\n            statLabel: statKey,\r\n            increase,\r\n            oldDPS: baseDPS,\r\n            newDPS,\r\n            gainPercentage,\r\n            oldValue,\r\n            newValue\r\n        });\r\n    });\r\n\r\n    return results;\r\n}\r\n\r\n/**\r\n * Calculate all stat weights for predictions table\r\n * Returns structured data for both flat and percentage stats\r\n */\r\nexport function calculateAllStatWeights(\r\n    stats: BaseStats\r\n): {\r\n    baseBossDPS: number;\r\n    baseNormalDPS: number;\r\n    attackWeights: StatWeightResult[];\r\n    mainStatWeights: StatWeightResult[];\r\n    percentageWeights: Record<string, StatWeightResult[]>;\r\n} {\r\n    const baseService = new StatCalculationService(stats);\r\n    const baseBossDPS = baseService.baseBossDPS;\r\n    const baseNormalDPS = baseService.baseNormalDPS;\r\n\r\n    const attackWeights = calculateAttackWeights(stats, baseBossDPS, DEFAULT_STAT_INCREASES.flat);\r\n    const mainStatWeights = calculateMainStatWeights(stats, baseBossDPS, DEFAULT_STAT_INCREASES.mainStat);\r\n\r\n    // Calculate weights for all percentage stats\r\n    const percentageWeights: Record<string, StatWeightResult[]> = {};\r\n    PERCENTAGE_STATS.forEach(stat => {\r\n        percentageWeights[stat.key] = calculatePercentageStatWeight(\r\n            stats,\r\n            baseBossDPS,\r\n            baseNormalDPS,\r\n            stat.key,\r\n            DEFAULT_STAT_INCREASES.percentage\r\n        );\r\n    });\r\n\r\n    return {\r\n        baseBossDPS,\r\n        baseNormalDPS,\r\n        attackWeights,\r\n        mainStatWeights,\r\n        percentageWeights\r\n    };\r\n}\r\n"],
  "mappings": "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",
  "names": []
}
