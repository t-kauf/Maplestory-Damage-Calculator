{
  "version": 3,
  "sources": ["stat-predictions.ts"],
  "sourcesContent": ["/**\n * Stat Predictions Logic\n * Business logic for calculating stat damage predictions\n * Separated from UI concerns\n */\n\nimport { StatCalculationService } from '@ts/services/stat-calculation-service';\nimport { BaseStats } from '@ts/types';\nimport { MONSTER_TYPE, STAT, type StatKey } from '@ts/types/constants';\nimport type { StatWeightResult, StatIncrease } from '@ts/types/page/stat-hub/stat-hub.types';\n\n/**\n * Convert lowercase stat ID to StatKey (uppercase)\n * Maps 'attack' -> 'ATTACK', 'critRate' -> 'CRIT_RATE', etc.\n */\nfunction idToStatKey(id: string): StatKey {\n    for (const key of Object.keys(STAT) as StatKey[]) {\n        if (STAT[key].id === id) {\n            return key;\n        }\n    }\n    throw new Error(`Unknown stat ID: ${id}`);\n}\n\n// Default stat increase values\nexport const DEFAULT_STAT_INCREASES: StatIncrease = {\n    flat: [500, 1000, 2500, 5000, 10000, 15000],\n    mainStat: [100, 500, 1000, 2500, 5000, 7500],\n    percentage: [1, 5, 10, 25, 50, 75]\n};\n\n// Percentage stat configuration\nexport const PERCENTAGE_STATS = [\n    { key: STAT.SKILL_COEFFICIENT.id, label: 'Skill Coeff' },\n    { key: STAT.MASTERY.id, label: 'Skill Mastery' },\n    { key: STAT.DAMAGE.id, label: 'Damage' },\n    { key: STAT.FINAL_DAMAGE.id, label: 'Final Dmg' },\n    { key: STAT.BOSS_DAMAGE.id, label: 'Boss Dmg' },\n    { key: STAT.NORMAL_DAMAGE.id, label: 'Mob Dmg' },\n    { key: STAT.STAT_DAMAGE.id, label: 'Main Stat %' },\n    { key: STAT.DAMAGE_AMP.id, label: 'Dmg Amp' },\n    { key: STAT.MIN_DAMAGE.id, label: 'Min Dmg' },\n    { key: STAT.MAX_DAMAGE.id, label: 'Max Dmg' },\n    { key: STAT.CRIT_RATE.id, label: 'Crit Rate' },\n    { key: STAT.CRIT_DAMAGE.id, label: 'Crit Dmg' },\n    { key: STAT.ATTACK_SPEED.id, label: 'Atk Speed' },\n    { key: STAT.DEF_PEN.id, label: 'Def Pen' }\n];\n\n// Multiplicative stats (applied multiplicatively)\nexport const MULTIPLICATIVE_STATS: Record<string, boolean> = {\n    [STAT.FINAL_DAMAGE.id]: true\n};\n\n// Diminishing return stats with their denominator values\nexport const DIMINISHING_RETURN_STATS: Record<string, { denominator: number }> = {\n    [STAT.ATTACK_SPEED.id]: { denominator: 150 },\n    [STAT.DEF_PEN.id]: { denominator: 100 }\n};\n\n/**\n * Calculate attack stat weights\n * Returns array of weight results for each increase value\n */\nexport function calculateAttackWeights(\n    stats: BaseStats,\n    baseBossDPS: number,\n    increases: number[]\n): StatWeightResult[] {\n    const results: StatWeightResult[] = [];\n\n    increases.forEach(increase => {\n        const service = new StatCalculationService(stats);\n        const oldValue = stats.ATTACK;\n        const effectiveIncrease = increase * (1 + service.weaponAttackBonus / 100);\n\n        const newDPS = service.add('attack', increase).computeDPS(MONSTER_TYPE.BOSS);\n        const newValue = service.getStats().ATTACK;\n        const gainPercentage = (newDPS - baseBossDPS) / baseBossDPS * 100;\n\n        results.push({\n            statLabel: 'Attack',\n            increase,\n            oldDPS: baseBossDPS,\n            newDPS,\n            gainPercentage,\n            effectiveIncrease,\n            oldValue,\n            newValue\n        });\n    });\n\n    return results;\n}\n\n/**\n * Calculate main stat weights\n * Returns array of weight results for each increase value\n */\nexport function calculateMainStatWeights(\n    stats: BaseStats,\n    baseBossDPS: number,\n    increases: number[]\n): StatWeightResult[] {\n    const results: StatWeightResult[] = [];\n\n    increases.forEach(increase => {\n        const service = new StatCalculationService(stats);\n        const actualMainStatGain = service.calculateMainStatIncreaseWithPct(increase);\n\n        const newDPS = service.add('mainStat', increase).computeDPS(MONSTER_TYPE.BOSS);\n        const gainPercentage = (newDPS - baseBossDPS) / baseBossDPS * 100;\n\n        results.push({\n            statLabel: 'Main Stat',\n            increase: actualMainStatGain,\n            oldDPS: baseBossDPS,\n            newDPS,\n            gainPercentage,\n            effectiveIncrease: actualMainStatGain\n        });\n    });\n\n    return results;\n}\n\n/**\n * Calculate percentage stat weights for a specific stat\n * Returns array of weight results for each increase value\n */\nexport function calculatePercentageStatWeight(\n    stats: BaseStats,\n    baseBossDPS: number,\n    baseNormalDPS: number,\n    statKey: string,\n    increases: number[]\n): StatWeightResult[] {\n    const results: StatWeightResult[] = [];\n    const isNormalDamage = statKey === STAT.NORMAL_DAMAGE.id;\n    const baseDPS = isNormalDamage ? baseNormalDPS : baseBossDPS;\n\n    increases.forEach(increase => {\n        const service = new StatCalculationService(stats);\n\n        // Apply the stat increase using the unified add() API\n        service.add(statKey, increase);\n\n        const monsterType = isNormalDamage ? MONSTER_TYPE.NORMAL : MONSTER_TYPE.BOSS;\n        const newDPS = service.computeDPS(monsterType);\n        const gainPercentage = (newDPS - baseDPS) / baseDPS * 100;\n\n        const actualStatKey = idToStatKey(statKey);\n        const newValue = service.getStats()[actualStatKey];\n        const oldValue = stats[actualStatKey];\n\n        results.push({\n            statLabel: statKey,\n            increase,\n            oldDPS: baseDPS,\n            newDPS,\n            gainPercentage,\n            oldValue,\n            newValue\n        });\n    });\n\n    return results;\n}\n\n/**\n * Calculate all stat weights for predictions table\n * Returns structured data for both flat and percentage stats\n */\nexport function calculateAllStatWeights(\n    stats: BaseStats\n): {\n    baseBossDPS: number;\n    baseNormalDPS: number;\n    attackWeights: StatWeightResult[];\n    mainStatWeights: StatWeightResult[];\n    percentageWeights: Record<string, StatWeightResult[]>;\n} {\n    const baseService = new StatCalculationService(stats);\n    const baseBossDPS = baseService.baseBossDPS;\n    const baseNormalDPS = baseService.baseNormalDPS;\n\n    const attackWeights = calculateAttackWeights(stats, baseBossDPS, DEFAULT_STAT_INCREASES.flat);\n    const mainStatWeights = calculateMainStatWeights(stats, baseBossDPS, DEFAULT_STAT_INCREASES.mainStat);\n\n    // Calculate weights for all percentage stats\n    const percentageWeights: Record<string, StatWeightResult[]> = {};\n    PERCENTAGE_STATS.forEach(stat => {\n        percentageWeights[stat.key] = calculatePercentageStatWeight(\n            stats,\n            baseBossDPS,\n            baseNormalDPS,\n            stat.key,\n            DEFAULT_STAT_INCREASES.percentage\n        );\n    });\n\n    return {\n        baseBossDPS,\n        baseNormalDPS,\n        attackWeights,\n        mainStatWeights,\n        percentageWeights\n    };\n}\n"],
  "mappings": "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",
  "names": []
}
