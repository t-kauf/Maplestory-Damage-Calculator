{
  "version": 3,
  "sources": ["artifact-potential.ts"],
  "sourcesContent": ["/**\r\n * Artifact Potential Core Logic\r\n *\r\n * Pure calculation functions for artifact potential stat mapping\r\n * and DPS gain rankings.\r\n */\r\n\r\nimport { artifactPotentialData } from '@ts/data/artifact-potential-data.js';\r\nimport { StatCalculationService } from '@ts/services/stat-calculation-service.js';\r\nimport { loadoutStore } from '@ts/store/loadout.store.js';\r\nimport type { BaseStats } from '@ts/types/loadout.js';\r\nimport type {\r\n    ArtifactRankingResult,\r\n    ArtifactStatName,\r\n    ArtifactRarity\r\n} from '@ts/types/page/artifact-potential/artifact-potential.types.js';\r\nimport { IGNORED_ARTIFACT_STATS } from '@ts/types/page/artifact-potential/artifact-potential.types.js';\r\n\r\n// ============================================================================\r\n// STAT MAPPING\r\n// ============================================================================\r\n\r\n/**\r\n * Map an artifact potential stat to base stats using StatCalculationService\r\n * @param statName - Name of the stat (e.g., \"Main Stat %\", \"Boss Monster Damage %\")\r\n * @param value - Value of the stat\r\n * @param baseStats - Base stats to modify\r\n * @returns Modified base stats\r\n */\r\nexport function mapArtifactStat(statName: string, value: number, baseStats: BaseStats): BaseStats {\r\n    // Remove \"(prime)\" suffix if present for mapping\r\n    const cleanStatName = statName.replace(' (prime)', '');\r\n\r\n    // Use StatCalculationService for consistent stat manipulation\r\n    const service = new StatCalculationService(baseStats);\r\n\r\n    switch (cleanStatName) {\r\n        case 'Main Stat %':\r\n            // StatCalculationService handles complex main stat % calculations including Dark Knight\r\n            service.addMainStatPct(value);\r\n            break;\r\n        case 'Critical Rate %':\r\n            service.addPercentageStat('critRate', value);\r\n            break;\r\n        case 'Min Damage Multiplier %':\r\n            service.addPercentageStat('minDamage', value);\r\n            break;\r\n        case 'Max Damage Multiplier %':\r\n            service.addPercentageStat('maxDamage', value);\r\n            break;\r\n        case 'Boss Monster Damage %':\r\n            service.addPercentageStat('bossDamage', value);\r\n            break;\r\n        case 'Normal Monster Damage %':\r\n            service.addPercentageStat('normalDamage', value);\r\n            break;\r\n        case 'Damage %':\r\n            service.addPercentageStat('damage', value);\r\n            break;\r\n        case 'Defense Penetration %':\r\n            // Defense Penetration uses diminishing returns with factor 100\r\n            service.addDiminishingReturnStat('defPen', value, 100);\r\n            break;\r\n        // Ignored stats: Damage Taken Decrease %, Defense %, Accuracy, Status Effect Damage %\r\n        default:\r\n            // No effect on damage\r\n            break;\r\n    }\r\n\r\n    return service.getStats();\r\n}\r\n\r\n// ============================================================================\r\n// RANKING CALCULATIONS\r\n// ============================================================================\r\n\r\n/**\r\n * Calculate baseline stats from loadout store\r\n * @returns Base stats\r\n */\r\nexport function getBaselineStats(): BaseStats {\r\n    return loadoutStore.getBaseStats();\r\n}\r\n\r\n/**\r\n * Calculate all possible artifact potential rolls and rank them\r\n * @returns Array of ranking results sorted by average DPS gain\r\n */\r\nexport function calculateArtifactPotentialRankings(): ArtifactRankingResult[] {\r\n    const baseStats = getBaselineStats();\r\n\r\n    // Calculate baseline damage using StatCalculationService\r\n    const baselineService = new StatCalculationService(baseStats);\r\n    const baselineBossDamage = baselineService.compute('boss');\r\n    const baselineNormalDamage = baselineService.compute('normal');\r\n\r\n    const results: ArtifactRankingResult[] = [];\r\n\r\n    // Process each rarity tier\r\n    Object.entries(artifactPotentialData).forEach(([rarity, stats]) => {\r\n        Object.entries(stats).forEach(([statName, value]) => {\r\n            // Skip stats that don't affect damage\r\n            if (IGNORED_ARTIFACT_STATS.includes(statName as ArtifactStatName)) {\r\n                return;\r\n            }\r\n\r\n            // Apply this stat and calculate DPS gains\r\n            const modifiedStats = mapArtifactStat(statName, value as number, baseStats);\r\n            const testService = new StatCalculationService(modifiedStats);\r\n            const bossDamage = testService.compute('boss');\r\n            const normalDamage = testService.compute('normal');\r\n\r\n            const bossDPSGain = bossDamage.dps - baselineBossDamage.dps;\r\n            const normalDPSGain = normalDamage.dps - baselineNormalDamage.dps;\r\n            const avgDPSGain = (bossDPSGain + normalDPSGain) / 2;\r\n\r\n            const bossDPSPercentChange = baselineBossDamage.dps > 0 ? (bossDPSGain / baselineBossDamage.dps) * 100 : 0;\r\n            const normalDPSPercentChange = baselineNormalDamage.dps > 0 ? (normalDPSGain / baselineNormalDamage.dps) * 100 : 0;\r\n            const avgDPSPercentChange = (bossDPSPercentChange + normalDPSPercentChange) / 2;\r\n\r\n            // Only include stats that give positive DPS gain\r\n            if (avgDPSGain > 0) {\r\n                // Format the display name\r\n                let displayName = statName;\r\n                if (statName.includes('(prime)')) {\r\n                    displayName = statName.replace(' (prime)', ' (Prime)');\r\n                }\r\n\r\n                results.push({\r\n                    rarity: rarity as ArtifactRarity,\r\n                    stat: displayName,\r\n                    value: `${value}%`,\r\n                    bossDPSGain,\r\n                    normalDPSGain,\r\n                    avgDPSGain,\r\n                    bossDPSPercentChange,\r\n                    normalDPSPercentChange,\r\n                    avgDPSPercentChange\r\n                });\r\n            }\r\n        });\r\n    });\r\n\r\n    // Sort by average DPS gain (descending)\r\n    results.sort((a, b) => b.avgDPSGain - a.avgDPSGain);\r\n\r\n    return results;\r\n}\r\n\r\n// ============================================================================\r\n// SORTING STATE\r\n// ============================================================================\r\n\r\nlet artifactSortColumn = 5;\r\nlet artifactSortAsc = false;\r\n\r\n/**\r\n * Get current sort column\r\n */\r\nexport function getArtifactSortColumn(): number {\r\n    return artifactSortColumn;\r\n}\r\n\r\n/**\r\n * Set sort column\r\n */\r\nexport function setArtifactSortColumn(column: number): void {\r\n    artifactSortColumn = column;\r\n}\r\n\r\n/**\r\n * Get sort direction\r\n */\r\nexport function getArtifactSortAsc(): boolean {\r\n    return artifactSortAsc;\r\n}\r\n\r\n/**\r\n * Toggle sort direction\r\n */\r\nexport function toggleArtifactSortAsc(): void {\r\n    artifactSortAsc = !artifactSortAsc;\r\n}\r\n\r\n/**\r\n * Sort artifact potential table by column\r\n * @param column - Column index to sort by\r\n */\r\nexport function sortArtifactTable(column: number): void {\r\n    if (artifactSortColumn === column) {\r\n        toggleArtifactSortAsc();\r\n    } else {\r\n        setArtifactSortColumn(column);\r\n        artifactSortAsc = false;\r\n    }\r\n    // Note: Actual re-rendering is handled by the UI module\r\n}\r\n\r\n// ============================================================================\r\n// WINDOW EXPORTS\r\n// ============================================================================\r\n\r\n// Export functions to window for HTML onclick attributes\r\nif (typeof window !== 'undefined') {\r\n    (window as any).sortArtifactTable = sortArtifactTable;\r\n}\r\n"],
  "mappings": "AAOA,SAAS,6BAA6B;AACtC,SAAS,8BAA8B;AACvC,SAAS,oBAAoB;AAO7B,SAAS,8BAA8B;AAahC,SAAS,gBAAgB,UAAkB,OAAe,WAAiC;AAE9F,QAAM,gBAAgB,SAAS,QAAQ,YAAY,EAAE;AAGrD,QAAM,UAAU,IAAI,uBAAuB,SAAS;AAEpD,UAAQ,eAAe;AAAA,IACnB,KAAK;AAED,cAAQ,eAAe,KAAK;AAC5B;AAAA,IACJ,KAAK;AACD,cAAQ,kBAAkB,YAAY,KAAK;AAC3C;AAAA,IACJ,KAAK;AACD,cAAQ,kBAAkB,aAAa,KAAK;AAC5C;AAAA,IACJ,KAAK;AACD,cAAQ,kBAAkB,aAAa,KAAK;AAC5C;AAAA,IACJ,KAAK;AACD,cAAQ,kBAAkB,cAAc,KAAK;AAC7C;AAAA,IACJ,KAAK;AACD,cAAQ,kBAAkB,gBAAgB,KAAK;AAC/C;AAAA,IACJ,KAAK;AACD,cAAQ,kBAAkB,UAAU,KAAK;AACzC;AAAA,IACJ,KAAK;AAED,cAAQ,yBAAyB,UAAU,OAAO,GAAG;AACrD;AAAA;AAAA,IAEJ;AAEI;AAAA,EACR;AAEA,SAAO,QAAQ,SAAS;AAC5B;AAUO,SAAS,mBAA8B;AAC1C,SAAO,aAAa,aAAa;AACrC;AAMO,SAAS,qCAA8D;AAC1E,QAAM,YAAY,iBAAiB;AAGnC,QAAM,kBAAkB,IAAI,uBAAuB,SAAS;AAC5D,QAAM,qBAAqB,gBAAgB,QAAQ,MAAM;AACzD,QAAM,uBAAuB,gBAAgB,QAAQ,QAAQ;AAE7D,QAAM,UAAmC,CAAC;AAG1C,SAAO,QAAQ,qBAAqB,EAAE,QAAQ,CAAC,CAAC,QAAQ,KAAK,MAAM;AAC/D,WAAO,QAAQ,KAAK,EAAE,QAAQ,CAAC,CAAC,UAAU,KAAK,MAAM;AAEjD,UAAI,uBAAuB,SAAS,QAA4B,GAAG;AAC/D;AAAA,MACJ;AAGA,YAAM,gBAAgB,gBAAgB,UAAU,OAAiB,SAAS;AAC1E,YAAM,cAAc,IAAI,uBAAuB,aAAa;AAC5D,YAAM,aAAa,YAAY,QAAQ,MAAM;AAC7C,YAAM,eAAe,YAAY,QAAQ,QAAQ;AAEjD,YAAM,cAAc,WAAW,MAAM,mBAAmB;AACxD,YAAM,gBAAgB,aAAa,MAAM,qBAAqB;AAC9D,YAAM,cAAc,cAAc,iBAAiB;AAEnD,YAAM,uBAAuB,mBAAmB,MAAM,IAAK,cAAc,mBAAmB,MAAO,MAAM;AACzG,YAAM,yBAAyB,qBAAqB,MAAM,IAAK,gBAAgB,qBAAqB,MAAO,MAAM;AACjH,YAAM,uBAAuB,uBAAuB,0BAA0B;AAG9E,UAAI,aAAa,GAAG;AAEhB,YAAI,cAAc;AAClB,YAAI,SAAS,SAAS,SAAS,GAAG;AAC9B,wBAAc,SAAS,QAAQ,YAAY,UAAU;AAAA,QACzD;AAEA,gBAAQ,KAAK;AAAA,UACT;AAAA,UACA,MAAM;AAAA,UACN,OAAO,GAAG,KAAK;AAAA,UACf;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,QACJ,CAAC;AAAA,MACL;AAAA,IACJ,CAAC;AAAA,EACL,CAAC;AAGD,UAAQ,KAAK,CAAC,GAAG,MAAM,EAAE,aAAa,EAAE,UAAU;AAElD,SAAO;AACX;AAMA,IAAI,qBAAqB;AACzB,IAAI,kBAAkB;AAKf,SAAS,wBAAgC;AAC5C,SAAO;AACX;AAKO,SAAS,sBAAsB,QAAsB;AACxD,uBAAqB;AACzB;AAKO,SAAS,qBAA8B;AAC1C,SAAO;AACX;AAKO,SAAS,wBAA8B;AAC1C,oBAAkB,CAAC;AACvB;AAMO,SAAS,kBAAkB,QAAsB;AACpD,MAAI,uBAAuB,QAAQ;AAC/B,0BAAsB;AAAA,EAC1B,OAAO;AACH,0BAAsB,MAAM;AAC5B,sBAAkB;AAAA,EACtB;AAEJ;AAOA,IAAI,OAAO,WAAW,aAAa;AAC/B,EAAC,OAAe,oBAAoB;AACxC;",
  "names": []
}
