{
  "version": 3,
  "sources": ["mastery-bonus-ui.ts"],
  "sourcesContent": ["/**\n * Mastery Bonus UI - HTML Generation and Event Handlers\n * This file handles all HTML generation and UI event handling for mastery bonuses\n */\n\nimport { selectMasteryTab } from './class-select-ui';\nimport { updateMasteryBonuses, calculateMasteryTotals } from './mastery-bonus';\nimport { MASTERY_3RD, MASTERY_4TH } from './mastery-constants';\nimport type { MasteryData } from '@ts/types/page/base-stats/base-stats.types';\nimport type { JobTier } from '@ts/types/index';\nimport { loadoutStore } from '@ts/store/loadout.store';\nimport { JOB_TIER, MASTERY_TYPE, MASTERY_LEVELS, STAT } from '@ts/types/constants';\nimport type { MasteryTypeValue } from '@ts/types/constants';\n\n// ============================================================================\n// HTML GENERATION\n// ============================================================================\n\n/**\n * Generate HTML for mastery table rows\n */\nfunction generateMasteryTableRows(tier: JobTier, type: MasteryTypeValue): string {\n    const masteryData = tier === JOB_TIER.THIRD ? MASTERY_3RD : MASTERY_4TH;\n    const items = masteryData[type];\n\n    let rows = '';\n    const allLevels = new Set<number>();\n    const bossLevels = new Set<number>();\n\n    // Collect all levels from both types\n    masteryData.all.forEach(item => allLevels.add(item.level));\n    masteryData.boss.forEach(item => bossLevels.add(item.level));\n\n    // Sort all unique levels\n    const sortedLevels = Array.from(allLevels).sort((a, b) => a - b);\n\n    // Add boss-only levels that aren't in all\n    bossLevels.forEach(level => {\n        if (!allLevels.has(level)) {\n            sortedLevels.push(level);\n        }\n    });\n    sortedLevels.sort((a, b) => a - b);\n\n    sortedLevels.forEach(level => {\n        const allItem = masteryData.all.find(item => item.level === level);\n        const bossItem = masteryData.boss.find(item => item.level === level);\n\n        const allCell = allItem\n            ? `<label class=\"bgstats-checkbox-label\">\n                <input type=\"checkbox\" id=\"mastery-${tier}-all-${level}\" class=\"bgstats-checkbox\">\n                <span class=\"bgstats-checkbox-text\">${allItem.bonus}%</span>\n               </label>`\n            : '\u2014';\n\n        const bossCell = bossItem\n            ? `<label class=\"bgstats-checkbox-label\">\n                <input type=\"checkbox\" id=\"mastery-${tier}-boss-${level}\" class=\"bgstats-checkbox\">\n                <span class=\"bgstats-checkbox-text\">${bossItem.bonus}%</span>\n               </label>`\n            : '\u2014';\n\n        rows += `\n            <tr class=\"bgstats-table-row\">\n                <td class=\"bgstats-table-td level-cell\">${level}</td>\n                <td class=\"bgstats-table-td\">${allCell}</td>\n                <td class=\"bgstats-table-td ${!bossItem ? 'empty-cell' : ''}\">${bossCell}</td>\n            </tr>\n        `;\n    });\n\n    return rows;\n}\n\n/**\n * Generate HTML for mastery table\n */\nfunction generateMasteryTableHTML(tier: JobTier): string {\n    return `\n        <div id=\"mastery-table-${tier}\" class=\"bgstats-mastery-table\" ${tier === JOB_TIER.FOURTH ? 'style=\"display: none;\"' : ''}>\n            <table class=\"bgstats-table\">\n                <thead>\n                    <tr>\n                        <th class=\"bgstats-table-th\">Level</th>\n                        <th class=\"bgstats-table-th\">All Monsters</th>\n                        <th class=\"bgstats-table-th\">Boss Only</th>\n                    </tr>\n                </thead>\n                <tbody>\n                    ${generateMasteryTableRows(tier, MASTERY_TYPE.ALL)}\n                </tbody>\n            </table>\n        </div>\n    `;\n}\n\n/**\n * Generate the complete HTML for the mastery bonus section\n */\nexport function generateMasterySectionHTML(): string {\n    return `\n        <!-- Skill Mastery Section - Premium redesign -->\n        <div class=\"bgstats-mastery-section\">\n            <label class=\"bgstats-mastery-title\">Skill Mastery Bonus <span class=\"bgstats-info-inline\" role=\"img\" aria-label=\"Info\" onclick=\"openHelpSidebar('skill-mastery')\">?</span></label>\n\n            <!-- Mastery Job Tabs - Unified control -->\n            <div class=\"bgstats-mastery-tabs\">\n                <button id=\"mastery-tab-3rd\" class=\"bgstats-mastery-tab active\">3rd Job</button>\n                <button id=\"mastery-tab-4th\" class=\"bgstats-mastery-tab\">4th Job</button>\n            </div>\n\n            ${generateMasteryTableHTML(JOB_TIER.THIRD)}\n            ${generateMasteryTableHTML(JOB_TIER.FOURTH)}\n        </div>\n    `;\n}\n\n/**\n * Generate HTML for hidden mastery inputs\n */\nexport function generateMasteryHiddenInputs(): string {\n    return `\n        <input type=\"hidden\" id=\"mastery\" value=\"21\">\n        <input type=\"hidden\" id=\"bossMastery\" value=\"0\">\n    `;\n}\n\n// ============================================================================\n// INITIALIZATION\n// ============================================================================\n\n/**\n * Load mastery bonuses UI from saved checkbox states\n */\nexport function loadMasteryBonusesUI(): void {\n    const currentTier = loadoutStore.getSelectedJobTier() as JobTier;\n\n    // Load checkbox states from store\n    loadMasteryCheckboxesFromStore(currentTier);\n\n    // Calculate totals and update display\n    const { allTotal, bossTotal } = calculateMasteryTotals(currentTier);\n    updateMasteryDisplay(currentTier, allTotal, bossTotal);\n}\n\n/**\n * Load mastery checkbox states from the loadout store\n */\nfunction loadMasteryCheckboxesFromStore(tier: JobTier): void {\n    const mastery = loadoutStore.getMastery();\n\n    // Load 3rd Job \"All Monsters\" checkboxes\n    MASTERY_LEVELS.THIRD.ALL.forEach(level => {\n        const checkbox = document.getElementById(`mastery-${JOB_TIER.THIRD}-all-${level}`) as HTMLInputElement;\n        if (checkbox) {\n            checkbox.checked = mastery[JOB_TIER.THIRD].all[level.toString()] ?? false;\n        }\n    });\n\n    // Load 3rd Job \"Boss Only\" checkboxes\n    MASTERY_LEVELS.THIRD.BOSS.forEach(level => {\n        const checkbox = document.getElementById(`mastery-${JOB_TIER.THIRD}-boss-${level}`) as HTMLInputElement;\n        if (checkbox) {\n            checkbox.checked = mastery[JOB_TIER.THIRD].boss[level.toString()] ?? false;\n        }\n    });\n\n    // Load 4th Job \"All Monsters\" checkboxes\n    MASTERY_LEVELS.FOURTH.ALL.forEach(level => {\n        const checkbox = document.getElementById(`mastery-${JOB_TIER.FOURTH}-all-${level}`) as HTMLInputElement;\n        if (checkbox) {\n            checkbox.checked = mastery[JOB_TIER.FOURTH].all[level.toString()] ?? false;\n        }\n    });\n\n    // Load 4th Job \"Boss Only\" checkboxes\n    MASTERY_LEVELS.FOURTH.BOSS.forEach(level => {\n        const checkbox = document.getElementById(`mastery-${JOB_TIER.FOURTH}-boss-${level}`) as HTMLInputElement;\n        if (checkbox) {\n            checkbox.checked = mastery[JOB_TIER.FOURTH].boss[level.toString()] ?? false;\n        }\n    });\n}\n\n/**\n * Update the UI display elements with mastery bonus totals\n */\nexport function updateMasteryDisplay(tier: JobTier, allTotal: number, bossTotal: number): void {\n    // Update display totals for the current tier\n    const allTotalDisplay = document.getElementById(`mastery-${tier}-all-total`);\n    const bossTotalDisplay = document.getElementById(`mastery-${tier}-boss-total`);\n\n    if (allTotalDisplay) {\n        allTotalDisplay.textContent = `${allTotal}%`;\n    }\n    if (bossTotalDisplay) {\n        bossTotalDisplay.textContent = `${bossTotal}%`;\n    }\n\n    // Update hidden inputs that are used by the calculation engine\n    const skillMasteryInput = document.getElementById('mastery') as HTMLInputElement;\n    const skillMasteryBossInput = document.getElementById('bossMastery') as HTMLInputElement;\n\n    if (skillMasteryInput) {\n        skillMasteryInput.value = allTotal.toString();\n        loadoutStore.updateBaseStat(STAT.MASTERY.id, allTotal);\n    }\n    if (skillMasteryBossInput) {\n        skillMasteryBossInput.value = bossTotal.toString();\n        loadoutStore.updateBaseStat(STAT.BOSS_MASTERY.id, bossTotal);\n    }\n}\n\n// ============================================================================\n// EVENT LISTENERS\n// ============================================================================\n\n/**\n * Attach event listeners to mastery tab buttons\n */\nexport function attachMasteryTabListeners(): void {\n    const tab3rd = document.getElementById('mastery-tab-3rd');\n    const tab4th = document.getElementById('mastery-tab-4th');\n\n    if (tab3rd) {\n        tab3rd.addEventListener('click', () => selectMasteryTab(JOB_TIER.THIRD));\n    }\n    if (tab4th) {\n        tab4th.addEventListener('click', () => selectMasteryTab(JOB_TIER.FOURTH));\n    }\n}\n\n/**\n * Attach event listeners to mastery checkboxes\n */\nexport function attachMasteryCheckboxListeners(): void {\n    ([JOB_TIER.THIRD, JOB_TIER.FOURTH] as const).forEach(tier => {\n        const masteryData = tier === JOB_TIER.THIRD ? MASTERY_3RD : MASTERY_4TH;\n\n        masteryData.all.forEach(item => {\n            const checkbox = document.getElementById(`mastery-${tier}-all-${item.level}`);\n            if (checkbox) {\n                checkbox.addEventListener('change', () => updateMasteryBonuses());\n            }\n        });\n\n        masteryData.boss.forEach(item => {\n            const checkbox = document.getElementById(`mastery-${tier}-boss-${item.level}`);\n            if (checkbox) {\n                checkbox.addEventListener('change', () => updateMasteryBonuses());\n            }\n        });\n    });\n}\n\n/**\n * Attach all event listeners for mastery UI\n */\nexport function attachMasteryEventListeners(): void {\n    attachMasteryTabListeners();\n    attachMasteryCheckboxListeners();\n}\n"],
  "mappings": "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",
  "names": []
}
