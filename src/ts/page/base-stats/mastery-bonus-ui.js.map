{
  "version": 3,
  "sources": ["mastery-bonus-ui.ts"],
  "sourcesContent": ["/**\r\n * Mastery Bonus UI - HTML Generation and Event Handlers\r\n * This file handles all HTML generation and UI event handling for mastery bonuses\r\n */\r\n\r\nimport { selectMasteryTab } from './class-select-ui';\r\nimport { updateMasteryBonuses, calculateMasteryTotals } from './mastery-bonus';\r\nimport { MASTERY_3RD, MASTERY_4TH } from './mastery-constants';\r\nimport type { MasteryData } from '@ts/types/page/base-stats/base-stats.types';\r\nimport type { JobTier } from '@ts/types/index';\r\nimport { loadoutStore } from '@ts/store/loadout.store';\r\nimport { JOB_TIER, MASTERY_TYPE, MASTERY_LEVELS } from '@ts/types/constants';\r\nimport type { MasteryTypeValue } from '@ts/types/constants';\r\n\r\n// ============================================================================\r\n// HTML GENERATION\r\n// ============================================================================\r\n\r\n/**\r\n * Generate HTML for mastery table rows\r\n */\r\nfunction generateMasteryTableRows(tier: JobTier, type: MasteryTypeValue): string {\r\n    const masteryData = tier === JOB_TIER.THIRD ? MASTERY_3RD : MASTERY_4TH;\r\n    const items = masteryData[type];\r\n\r\n    let rows = '';\r\n    const allLevels = new Set<number>();\r\n    const bossLevels = new Set<number>();\r\n\r\n    // Collect all levels from both types\r\n    masteryData.all.forEach(item => allLevels.add(item.level));\r\n    masteryData.boss.forEach(item => bossLevels.add(item.level));\r\n\r\n    // Sort all unique levels\r\n    const sortedLevels = Array.from(allLevels).sort((a, b) => a - b);\r\n\r\n    // Add boss-only levels that aren't in all\r\n    bossLevels.forEach(level => {\r\n        if (!allLevels.has(level)) {\r\n            sortedLevels.push(level);\r\n        }\r\n    });\r\n    sortedLevels.sort((a, b) => a - b);\r\n\r\n    sortedLevels.forEach(level => {\r\n        const allItem = masteryData.all.find(item => item.level === level);\r\n        const bossItem = masteryData.boss.find(item => item.level === level);\r\n\r\n        const allCell = allItem\r\n            ? `<label class=\"bgstats-checkbox-label\">\r\n                <input type=\"checkbox\" id=\"mastery-${tier}-all-${level}\" class=\"bgstats-checkbox\">\r\n                <span class=\"bgstats-checkbox-text\">${allItem.bonus}%</span>\r\n               </label>`\r\n            : '\u2014';\r\n\r\n        const bossCell = bossItem\r\n            ? `<label class=\"bgstats-checkbox-label\">\r\n                <input type=\"checkbox\" id=\"mastery-${tier}-boss-${level}\" class=\"bgstats-checkbox\">\r\n                <span class=\"bgstats-checkbox-text\">${bossItem.bonus}%</span>\r\n               </label>`\r\n            : '\u2014';\r\n\r\n        rows += `\r\n            <tr class=\"bgstats-table-row\">\r\n                <td class=\"bgstats-table-td level-cell\">${level}</td>\r\n                <td class=\"bgstats-table-td\">${allCell}</td>\r\n                <td class=\"bgstats-table-td ${!bossItem ? 'empty-cell' : ''}\">${bossCell}</td>\r\n            </tr>\r\n        `;\r\n    });\r\n\r\n    return rows;\r\n}\r\n\r\n/**\r\n * Generate HTML for mastery table\r\n */\r\nfunction generateMasteryTableHTML(tier: JobTier): string {\r\n    return `\r\n        <div id=\"mastery-table-${tier}\" class=\"bgstats-mastery-table\" ${tier === JOB_TIER.FOURTH ? 'style=\"display: none;\"' : ''}>\r\n            <table class=\"bgstats-table\">\r\n                <thead>\r\n                    <tr>\r\n                        <th class=\"bgstats-table-th\">Level</th>\r\n                        <th class=\"bgstats-table-th\">All Monsters</th>\r\n                        <th class=\"bgstats-table-th\">Boss Only</th>\r\n                    </tr>\r\n                </thead>\r\n                <tbody>\r\n                    ${generateMasteryTableRows(tier, MASTERY_TYPE.ALL)}\r\n                </tbody>\r\n            </table>\r\n        </div>\r\n    `;\r\n}\r\n\r\n/**\r\n * Generate the complete HTML for the mastery bonus section\r\n */\r\nexport function generateMasterySectionHTML(): string {\r\n    return `\r\n        <!-- Skill Mastery Section - Premium redesign -->\r\n        <div class=\"bgstats-mastery-section\">\r\n            <label class=\"bgstats-mastery-title\">Skill Mastery Bonus <span class=\"bgstats-info-inline\" role=\"img\" aria-label=\"Info\" onclick=\"openHelpSidebar('skill-mastery')\">?</span></label>\r\n\r\n            <!-- Mastery Job Tabs - Unified control -->\r\n            <div class=\"bgstats-mastery-tabs\">\r\n                <button id=\"mastery-tab-3rd\" class=\"bgstats-mastery-tab active\">3rd Job</button>\r\n                <button id=\"mastery-tab-4th\" class=\"bgstats-mastery-tab\">4th Job</button>\r\n            </div>\r\n\r\n            ${generateMasteryTableHTML(JOB_TIER.THIRD)}\r\n            ${generateMasteryTableHTML(JOB_TIER.FOURTH)}\r\n        </div>\r\n    `;\r\n}\r\n\r\n/**\r\n * Generate HTML for hidden mastery inputs\r\n */\r\nexport function generateMasteryHiddenInputs(): string {\r\n    return `\r\n        <input type=\"hidden\" id=\"skillMastery\" value=\"21\">\r\n        <input type=\"hidden\" id=\"skillMasteryBoss\" value=\"0\">\r\n    `;\r\n}\r\n\r\n// ============================================================================\r\n// INITIALIZATION\r\n// ============================================================================\r\n\r\n/**\r\n * Load mastery bonuses UI from saved checkbox states\r\n */\r\nexport function loadMasteryBonusesUI(): void {\r\n    const currentTier = loadoutStore.getSelectedJobTier() as JobTier;\r\n\r\n    // Load checkbox states from store\r\n    loadMasteryCheckboxesFromStore(currentTier);\r\n\r\n    // Calculate totals and update display\r\n    const { allTotal, bossTotal } = calculateMasteryTotals(currentTier);\r\n    updateMasteryDisplay(currentTier, allTotal, bossTotal);\r\n}\r\n\r\n/**\r\n * Load mastery checkbox states from the loadout store\r\n */\r\nfunction loadMasteryCheckboxesFromStore(tier: JobTier): void {\r\n    const mastery = loadoutStore.getMastery();\r\n\r\n    // Load 3rd Job \"All Monsters\" checkboxes\r\n    MASTERY_LEVELS.THIRD.ALL.forEach(level => {\r\n        const checkbox = document.getElementById(`mastery-${JOB_TIER.THIRD}-all-${level}`) as HTMLInputElement;\r\n        if (checkbox) {\r\n            checkbox.checked = mastery[JOB_TIER.THIRD].all[level.toString()] ?? false;\r\n        }\r\n    });\r\n\r\n    // Load 3rd Job \"Boss Only\" checkboxes\r\n    MASTERY_LEVELS.THIRD.BOSS.forEach(level => {\r\n        const checkbox = document.getElementById(`mastery-${JOB_TIER.THIRD}-boss-${level}`) as HTMLInputElement;\r\n        if (checkbox) {\r\n            checkbox.checked = mastery[JOB_TIER.THIRD].boss[level.toString()] ?? false;\r\n        }\r\n    });\r\n\r\n    // Load 4th Job \"All Monsters\" checkboxes\r\n    MASTERY_LEVELS.FOURTH.ALL.forEach(level => {\r\n        const checkbox = document.getElementById(`mastery-${JOB_TIER.FOURTH}-all-${level}`) as HTMLInputElement;\r\n        if (checkbox) {\r\n            checkbox.checked = mastery[JOB_TIER.FOURTH].all[level.toString()] ?? false;\r\n        }\r\n    });\r\n\r\n    // Load 4th Job \"Boss Only\" checkboxes\r\n    MASTERY_LEVELS.FOURTH.BOSS.forEach(level => {\r\n        const checkbox = document.getElementById(`mastery-${JOB_TIER.FOURTH}-boss-${level}`) as HTMLInputElement;\r\n        if (checkbox) {\r\n            checkbox.checked = mastery[JOB_TIER.FOURTH].boss[level.toString()] ?? false;\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * Update the UI display elements with mastery bonus totals\r\n */\r\nexport function updateMasteryDisplay(tier: JobTier, allTotal: number, bossTotal: number): void {\r\n    // Update display totals for the current tier\r\n    const allTotalDisplay = document.getElementById(`mastery-${tier}-all-total`);\r\n    const bossTotalDisplay = document.getElementById(`mastery-${tier}-boss-total`);\r\n\r\n    if (allTotalDisplay) {\r\n        allTotalDisplay.textContent = `${allTotal}%`;\r\n    }\r\n    if (bossTotalDisplay) {\r\n        bossTotalDisplay.textContent = `${bossTotal}%`;\r\n    }\r\n\r\n    // Update hidden inputs that are used by the calculation engine\r\n    const skillMasteryInput = document.getElementById('skillMastery') as HTMLInputElement;\r\n    const skillMasteryBossInput = document.getElementById('skillMasteryBoss') as HTMLInputElement;\r\n\r\n    if (skillMasteryInput) {\r\n        skillMasteryInput.value = allTotal.toString();\r\n    }\r\n    if (skillMasteryBossInput) {\r\n        skillMasteryBossInput.value = bossTotal.toString();\r\n    }\r\n}\r\n\r\n// ============================================================================\r\n// EVENT LISTENERS\r\n// ============================================================================\r\n\r\n/**\r\n * Attach event listeners to mastery tab buttons\r\n */\r\nexport function attachMasteryTabListeners(): void {\r\n    const tab3rd = document.getElementById('mastery-tab-3rd');\r\n    const tab4th = document.getElementById('mastery-tab-4th');\r\n\r\n    if (tab3rd) {\r\n        tab3rd.addEventListener('click', () => selectMasteryTab(JOB_TIER.THIRD));\r\n    }\r\n    if (tab4th) {\r\n        tab4th.addEventListener('click', () => selectMasteryTab(JOB_TIER.FOURTH));\r\n    }\r\n}\r\n\r\n/**\r\n * Attach event listeners to mastery checkboxes\r\n */\r\nexport function attachMasteryCheckboxListeners(): void {\r\n    ([JOB_TIER.THIRD, JOB_TIER.FOURTH] as const).forEach(tier => {\r\n        const masteryData = tier === JOB_TIER.THIRD ? MASTERY_3RD : MASTERY_4TH;\r\n\r\n        masteryData.all.forEach(item => {\r\n            const checkbox = document.getElementById(`mastery-${tier}-all-${item.level}`);\r\n            if (checkbox) {\r\n                checkbox.addEventListener('change', () => updateMasteryBonuses());\r\n            }\r\n        });\r\n\r\n        masteryData.boss.forEach(item => {\r\n            const checkbox = document.getElementById(`mastery-${tier}-boss-${item.level}`);\r\n            if (checkbox) {\r\n                checkbox.addEventListener('change', () => updateMasteryBonuses());\r\n            }\r\n        });\r\n    });\r\n}\r\n\r\n/**\r\n * Attach all event listeners for mastery UI\r\n */\r\nexport function attachMasteryEventListeners(): void {\r\n    attachMasteryTabListeners();\r\n    attachMasteryCheckboxListeners();\r\n}\r\n"],
  "mappings": "AAKA,SAAS,wBAAwB;AACjC,SAAS,sBAAsB,8BAA8B;AAC7D,SAAS,aAAa,mBAAmB;AAGzC,SAAS,oBAAoB;AAC7B,SAAS,UAAU,cAAc,sBAAsB;AAUvD,SAAS,yBAAyB,MAAe,MAAgC;AAC7E,QAAM,cAAc,SAAS,SAAS,QAAQ,cAAc;AAC5D,QAAM,QAAQ,YAAY,IAAI;AAE9B,MAAI,OAAO;AACX,QAAM,YAAY,oBAAI,IAAY;AAClC,QAAM,aAAa,oBAAI,IAAY;AAGnC,cAAY,IAAI,QAAQ,UAAQ,UAAU,IAAI,KAAK,KAAK,CAAC;AACzD,cAAY,KAAK,QAAQ,UAAQ,WAAW,IAAI,KAAK,KAAK,CAAC;AAG3D,QAAM,eAAe,MAAM,KAAK,SAAS,EAAE,KAAK,CAAC,GAAG,MAAM,IAAI,CAAC;AAG/D,aAAW,QAAQ,WAAS;AACxB,QAAI,CAAC,UAAU,IAAI,KAAK,GAAG;AACvB,mBAAa,KAAK,KAAK;AAAA,IAC3B;AAAA,EACJ,CAAC;AACD,eAAa,KAAK,CAAC,GAAG,MAAM,IAAI,CAAC;AAEjC,eAAa,QAAQ,WAAS;AAC1B,UAAM,UAAU,YAAY,IAAI,KAAK,UAAQ,KAAK,UAAU,KAAK;AACjE,UAAM,WAAW,YAAY,KAAK,KAAK,UAAQ,KAAK,UAAU,KAAK;AAEnE,UAAM,UAAU,UACV;AAAA,qDACuC,IAAI,QAAQ,KAAK;AAAA,sDAChB,QAAQ,KAAK;AAAA,2BAErD;AAEN,UAAM,WAAW,WACX;AAAA,qDACuC,IAAI,SAAS,KAAK;AAAA,sDACjB,SAAS,KAAK;AAAA,2BAEtD;AAEN,YAAQ;AAAA;AAAA,0DAE0C,KAAK;AAAA,+CAChB,OAAO;AAAA,8CACR,CAAC,WAAW,eAAe,EAAE,KAAK,QAAQ;AAAA;AAAA;AAAA,EAGpF,CAAC;AAED,SAAO;AACX;AAKA,SAAS,yBAAyB,MAAuB;AACrD,SAAO;AAAA,iCACsB,IAAI,mCAAmC,SAAS,SAAS,SAAS,2BAA2B,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAU1G,yBAAyB,MAAM,aAAa,GAAG,CAAC;AAAA;AAAA;AAAA;AAAA;AAKtE;AAKO,SAAS,6BAAqC;AACjD,SAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAWG,yBAAyB,SAAS,KAAK,CAAC;AAAA,cACxC,yBAAyB,SAAS,MAAM,CAAC;AAAA;AAAA;AAGvD;AAKO,SAAS,8BAAsC;AAClD,SAAO;AAAA;AAAA;AAAA;AAIX;AASO,SAAS,uBAA6B;AACzC,QAAM,cAAc,aAAa,mBAAmB;AAGpD,iCAA+B,WAAW;AAG1C,QAAM,EAAE,UAAU,UAAU,IAAI,uBAAuB,WAAW;AAClE,uBAAqB,aAAa,UAAU,SAAS;AACzD;AAKA,SAAS,+BAA+B,MAAqB;AACzD,QAAM,UAAU,aAAa,WAAW;AAGxC,iBAAe,MAAM,IAAI,QAAQ,WAAS;AACtC,UAAM,WAAW,SAAS,eAAe,WAAW,SAAS,KAAK,QAAQ,KAAK,EAAE;AACjF,QAAI,UAAU;AACV,eAAS,UAAU,QAAQ,SAAS,KAAK,EAAE,IAAI,MAAM,SAAS,CAAC,KAAK;AAAA,IACxE;AAAA,EACJ,CAAC;AAGD,iBAAe,MAAM,KAAK,QAAQ,WAAS;AACvC,UAAM,WAAW,SAAS,eAAe,WAAW,SAAS,KAAK,SAAS,KAAK,EAAE;AAClF,QAAI,UAAU;AACV,eAAS,UAAU,QAAQ,SAAS,KAAK,EAAE,KAAK,MAAM,SAAS,CAAC,KAAK;AAAA,IACzE;AAAA,EACJ,CAAC;AAGD,iBAAe,OAAO,IAAI,QAAQ,WAAS;AACvC,UAAM,WAAW,SAAS,eAAe,WAAW,SAAS,MAAM,QAAQ,KAAK,EAAE;AAClF,QAAI,UAAU;AACV,eAAS,UAAU,QAAQ,SAAS,MAAM,EAAE,IAAI,MAAM,SAAS,CAAC,KAAK;AAAA,IACzE;AAAA,EACJ,CAAC;AAGD,iBAAe,OAAO,KAAK,QAAQ,WAAS;AACxC,UAAM,WAAW,SAAS,eAAe,WAAW,SAAS,MAAM,SAAS,KAAK,EAAE;AACnF,QAAI,UAAU;AACV,eAAS,UAAU,QAAQ,SAAS,MAAM,EAAE,KAAK,MAAM,SAAS,CAAC,KAAK;AAAA,IAC1E;AAAA,EACJ,CAAC;AACL;AAKO,SAAS,qBAAqB,MAAe,UAAkB,WAAyB;AAE3F,QAAM,kBAAkB,SAAS,eAAe,WAAW,IAAI,YAAY;AAC3E,QAAM,mBAAmB,SAAS,eAAe,WAAW,IAAI,aAAa;AAE7E,MAAI,iBAAiB;AACjB,oBAAgB,cAAc,GAAG,QAAQ;AAAA,EAC7C;AACA,MAAI,kBAAkB;AAClB,qBAAiB,cAAc,GAAG,SAAS;AAAA,EAC/C;AAGA,QAAM,oBAAoB,SAAS,eAAe,cAAc;AAChE,QAAM,wBAAwB,SAAS,eAAe,kBAAkB;AAExE,MAAI,mBAAmB;AACnB,sBAAkB,QAAQ,SAAS,SAAS;AAAA,EAChD;AACA,MAAI,uBAAuB;AACvB,0BAAsB,QAAQ,UAAU,SAAS;AAAA,EACrD;AACJ;AASO,SAAS,4BAAkC;AAC9C,QAAM,SAAS,SAAS,eAAe,iBAAiB;AACxD,QAAM,SAAS,SAAS,eAAe,iBAAiB;AAExD,MAAI,QAAQ;AACR,WAAO,iBAAiB,SAAS,MAAM,iBAAiB,SAAS,KAAK,CAAC;AAAA,EAC3E;AACA,MAAI,QAAQ;AACR,WAAO,iBAAiB,SAAS,MAAM,iBAAiB,SAAS,MAAM,CAAC;AAAA,EAC5E;AACJ;AAKO,SAAS,iCAAuC;AACnD,EAAC,CAAC,SAAS,OAAO,SAAS,MAAM,EAAY,QAAQ,UAAQ;AACzD,UAAM,cAAc,SAAS,SAAS,QAAQ,cAAc;AAE5D,gBAAY,IAAI,QAAQ,UAAQ;AAC5B,YAAM,WAAW,SAAS,eAAe,WAAW,IAAI,QAAQ,KAAK,KAAK,EAAE;AAC5E,UAAI,UAAU;AACV,iBAAS,iBAAiB,UAAU,MAAM,qBAAqB,CAAC;AAAA,MACpE;AAAA,IACJ,CAAC;AAED,gBAAY,KAAK,QAAQ,UAAQ;AAC7B,YAAM,WAAW,SAAS,eAAe,WAAW,IAAI,SAAS,KAAK,KAAK,EAAE;AAC7E,UAAI,UAAU;AACV,iBAAS,iBAAiB,UAAU,MAAM,qBAAqB,CAAC;AAAA,MACpE;AAAA,IACJ,CAAC;AAAA,EACL,CAAC;AACL;AAKO,SAAS,8BAAoC;AAChD,4BAA0B;AAC1B,iCAA+B;AACnC;",
  "names": []
}
