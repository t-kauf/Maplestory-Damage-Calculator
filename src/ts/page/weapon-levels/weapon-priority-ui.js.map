{
  "version": 3,
  "sources": ["weapon-priority-ui.ts"],
  "sourcesContent": ["/**\r\n * Weapon Upgrade Priority UI - DOM manipulation for upgrade priority features\r\n * Handles the Upgrade Priority sub-tab and currency calculator\r\n */\r\n\r\nimport {\r\n    calculateWeaponAttacks,\r\n    getMaxLevelForStars,\r\n    calculateUpgradePriorityChain,\r\n    calculateUpgradeGain,\r\n    getUpgradeCost\r\n} from './weapons';\r\nimport type {\r\n    WeaponRarity,\r\n    WeaponTier,\r\n    StarRating,\r\n    UpgradePriorityItem,\r\n    WeaponState,\r\n    CurrencyUpgradeResult,\r\n    WeaponLevel,\r\n    WeaponKey\r\n} from '@ts/types';\r\nimport { rarities, tiers } from '@ts/types';\r\nimport { MONSTER_TYPE, WEAPON_RARITY, WEAPON_TIER, EFFICIENCY_THRESHOLD } from '@ts/types/constants';\r\nimport { loadoutStore } from '@ts/store/loadout.store';\r\nimport { StatCalculationService } from '@ts/services/stat-calculation-service';\r\n\r\n// Type for the updateWeaponBonuses callback function\r\ntype UpdateWeaponBonusesFn = (calculateDamage?: boolean) => void;\r\n\r\n// Extend Window interface to include functions exported from weapon-ui.ts\r\ndeclare global {\r\n    interface Window {\r\n        updateWeaponBonuses: UpdateWeaponBonusesFn;\r\n    }\r\n}\r\n\r\n// Override calculateCurrencyUpgrades - use Object.defineProperty to bypass type checking\r\nObject.defineProperty(window, 'calculateCurrencyUpgrades', {\r\n    value: async () => {\r\n        await calculateCurrencyUpgradesUI(window.updateWeaponBonuses);\r\n    },\r\n    writable: true,\r\n    enumerable: true,\r\n    configurable: true\r\n});\r\n\r\n// =======================\r\n// Upgrade Priority UI HTML Generation\r\n// =======================\r\n\r\n/**\r\n * Generate the HTML for the upgrade priority sub-tab\r\n */\r\nfunction generateUpgradePriorityHTML(): string {\r\n    return `\r\n        <!-- Upgrade Priority Chain -->\r\n        <div id=\"upgrade-priority-container\" class=\"wl-priority-container\">\r\n            <div class=\"wl-priority-header\">\r\n                Next 100 Upgrades Priority (Best Inventory Attack Gain)\r\n            </div>\r\n            <div id=\"upgrade-priority-chain\" class=\"wl-priority-chain\">\r\n                <!-- Priority chain will be generated by JavaScript -->\r\n            </div>\r\n\r\n            <!-- Currency Calculator -->\r\n            <div class=\"wl-currency-section\">\r\n                <div class=\"wl-currency-header\">\r\n                    Enter your current upgrade currency to see your optimal target weapon levels\r\n                </div>\r\n                <div class=\"wl-currency-input-group\">\r\n                    <label class=\"wl-currency-label\" for=\"upgrade-currency-input\">Upgrade Currency</label>\r\n                    <input type=\"number\" id=\"upgrade-currency-input\" class=\"wl-currency-input\"\r\n                           placeholder=\"Enter amount\" oninput=\"calculateCurrencyUpgrades()\">\r\n                </div>\r\n                <div id=\"currency-upgrade-results\" class=\"wl-currency-results\">\r\n                    <div class=\"wl-currency-metrics\">\r\n                        <div class=\"wl-currency-metric\">\r\n                            <span class=\"wl-currency-metric-label\">Total Attack % Gain</span>\r\n                            <div class=\"wl-currency-metric-value\" id=\"currency-attack-gain\">0%</div>\r\n                        </div>\r\n                        <div class=\"wl-currency-metric\">\r\n                            <span class=\"wl-currency-metric-label\">DPS Gain %</span>\r\n                            <div class=\"wl-currency-metric-value\" id=\"currency-dps-gain\">0%</div>\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"wl-currency-metric-label\" style=\"text-align: center; margin-bottom: 8px;\">Upgrade Path:</div>\r\n                    <div id=\"currency-upgrade-path\" class=\"wl-currency-path\">\r\n                        <!-- Path will be generated -->\r\n                    </div>\r\n                    <button id=\"apply-upgrade-path-btn\" class=\"wl-apply-button\">\r\n                        Apply Upgrade Path\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    `;\r\n}\r\n\r\n/**\r\n * Initialize the weapon priority UI - generates HTML and attaches event listeners\r\n * This should be called after the DOM is fully populated\r\n */\r\nexport function initializeWeaponPriorityUI(): void {\r\n    const container = document.getElementById('weapon-levels-upgrade-priority');\r\n    if (!container) return;\r\n\r\n    // Generate and populate the upgrade priority HTML\r\n    container.innerHTML = generateUpgradePriorityHTML();\r\n    // Priority UI is mostly event-driven via oninput handlers in HTML\r\n    // Initial priority chain will be updated when weapons are loaded\r\n}\r\n\r\n// =======================\r\n// Upgrade Priority Chain\r\n// =======================\r\n\r\n/**\r\n * Update the upgrade priority chain display\r\n */\r\nexport function updateUpgradePriorityChain(): void {\r\n    const priorityChain = document.getElementById('upgrade-priority-chain');\r\n    if (!priorityChain) return;\r\n\r\n    // Collect current weapon states\r\n    const weaponStates: Array<WeaponState> = [];\r\n\r\n    rarities.forEach(rarity => {\r\n        tiers.forEach(tier => {\r\n            const levelInput = document.getElementById(`level-${rarity}-${tier}`) as HTMLInputElement;\r\n            const starsInput = document.getElementById(`stars-${rarity}-${tier}`) as HTMLInputElement;\r\n            if (levelInput) {\r\n                const level = parseInt(levelInput.value) || 0;\r\n                const stars: StarRating = (starsInput?.value !== undefined && starsInput?.value !== ''\r\n                    ? parseInt(starsInput.value)\r\n                    : 5) as StarRating;\r\n                const maxLevel = getMaxLevelForStars(stars);\r\n\r\n                // Only include weapons that can be upgraded (level > 0 and not at max)\r\n                if (level > 0 && level <= maxLevel) {\r\n                    // Check if this weapon is equipped\r\n                    const equippedDisplay = document.getElementById(`equipped-display-${rarity}-${tier}`);\r\n                    const isEquipped = equippedDisplay && equippedDisplay.style.display !== 'none';\r\n\r\n                    weaponStates.push({\r\n                        rarity,\r\n                        tier,\r\n                        level,\r\n                        stars,\r\n                        maxLevel,\r\n                        isEquipped\r\n                    });\r\n                }\r\n            }\r\n        });\r\n    });\r\n\r\n    if (weaponStates.length === 0) {\r\n        priorityChain.innerHTML = '<span style=\"color: var(--text-secondary);\">No weapons available to upgrade</span>';\r\n        return;\r\n    }\r\n\r\n    // Calculate priority chain using logic function\r\n    const result = calculateUpgradePriorityChain(weaponStates, 100);\r\n\r\n    // Build HTML for display\r\n    let html = '';\r\n    result.groupedUpgrades.forEach((group, index) => {\r\n        const tierUpper = group.tier.toUpperCase();\r\n        const rarityFirstLetter = group.rarity.charAt(0).toUpperCase();\r\n\r\n        html += `<span class=\"wl-priority-item\" data-rarity=\"${group.rarity}\">${tierUpper} ${rarityFirstLetter} x${group.count}</span>`;\r\n\r\n        if (index < result.groupedUpgrades.length - 1) {\r\n            html += ' <span class=\"wl-priority-divider\">\u2192</span> ';\r\n        }\r\n    });\r\n\r\n    priorityChain.innerHTML = html;\r\n}\r\n\r\n/**\r\n * Update upgrade color indicators based on efficiency\r\n */\r\nexport function updateWeaponUpgradeColors(): void {\r\n    // Collect all gainPer1k values\r\n    const gainValues: number[] = [];\r\n    rarities.forEach(rarity => {\r\n        tiers.forEach(tier => {\r\n            const upgradeGainDisplay = document.getElementById(`upgrade-gain-${rarity}-${tier}`);\r\n            if (upgradeGainDisplay && upgradeGainDisplay.dataset.gainPer1k) {\r\n                const gainPer1k = parseFloat(upgradeGainDisplay.dataset.gainPer1k);\r\n                if (!isNaN(gainPer1k) && gainPer1k > 0) {\r\n                    gainValues.push(gainPer1k);\r\n                }\r\n            }\r\n        });\r\n    });\r\n\r\n    if (gainValues.length === 0) return;\r\n\r\n    // Find min and max\r\n    const minGain = Math.min(...gainValues);\r\n    const maxGain = Math.max(...gainValues);\r\n\r\n    // Apply CSS classes to each upgrade display\r\n    rarities.forEach(rarity => {\r\n        tiers.forEach(tier => {\r\n            const upgradeGainDisplay = document.getElementById(`upgrade-gain-${rarity}-${tier}`);\r\n            if (upgradeGainDisplay && upgradeGainDisplay.dataset.gainPer1k) {\r\n                const gainPer1k = parseFloat(upgradeGainDisplay.dataset.gainPer1k);\r\n                if (!isNaN(gainPer1k) && gainPer1k > 0) {\r\n                    // Normalize value between 0 (min) and 1 (max)\r\n                    const normalized = maxGain === minGain ? 1 : (gainPer1k - minGain) / (maxGain - minGain);\r\n\r\n                    // Apply CSS class based on efficiency tier\r\n                    upgradeGainDisplay.classList.remove('high', 'medium', 'low');\r\n                    if (normalized > EFFICIENCY_THRESHOLD.HIGH) {\r\n                        upgradeGainDisplay.classList.add('high');\r\n                    } else if (normalized > EFFICIENCY_THRESHOLD.MEDIUM) {\r\n                        upgradeGainDisplay.classList.add('medium');\r\n                    } else {\r\n                        upgradeGainDisplay.classList.add('low');\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    });\r\n}\r\n\r\n// =======================\r\n// Currency Upgrade Calculator\r\n// =======================\r\n\r\n/**\r\n * Calculate and display currency upgrade options\r\n * This is the UI layer wrapper that calls the pure logic function\r\n */\r\nexport async function calculateCurrencyUpgradesUI(updateWeaponBonuses: UpdateWeaponBonusesFn): Promise<void> {\r\n    const currencyInput = document.getElementById('upgrade-currency-input') as HTMLInputElement;\r\n    const resultsDiv = document.getElementById('currency-upgrade-results');\r\n    const attackGainDisplay = document.getElementById('currency-attack-gain');\r\n    const dpsGainDisplay = document.getElementById('currency-dps-gain');\r\n    const pathDisplay = document.getElementById('currency-upgrade-path');\r\n\r\n    if (!currencyInput || !resultsDiv) return;\r\n\r\n    const currency = parseFloat(currencyInput.value) || 0;\r\n\r\n    if (currency <= 0) {\r\n        resultsDiv.classList.remove('visible');\r\n        return;\r\n    }\r\n\r\n    // Collect current weapon states\r\n    const weaponStates: Array<WeaponState> = [];\r\n\r\n    rarities.forEach(rarity => {\r\n        tiers.forEach(tier => {\r\n            const levelInput = document.getElementById(`level-${rarity}-${tier}`) as HTMLInputElement;\r\n            const starsInput = document.getElementById(`stars-${rarity}-${tier}`) as HTMLInputElement;\r\n            if (levelInput) {\r\n                const level = parseInt(levelInput.value) || 0;\r\n                const stars: StarRating = (starsInput?.value !== undefined && starsInput?.value !== ''\r\n                    ? parseInt(starsInput.value)\r\n                    : 5) as StarRating;\r\n                const maxLevel = getMaxLevelForStars(stars);\r\n\r\n                if (level > 0 && level <= maxLevel) {\r\n                    // Check if this weapon is equipped\r\n                    const equippedDisplay = document.getElementById(`equipped-display-${rarity}-${tier}`);\r\n                    const isEquipped = equippedDisplay && equippedDisplay.style.display !== 'none';\r\n\r\n                    weaponStates.push({\r\n                        rarity,\r\n                        tier,\r\n                        level,\r\n                        stars,\r\n                        maxLevel,\r\n                        isEquipped\r\n                    });\r\n                }\r\n            }\r\n        });\r\n    });\r\n\r\n    if (weaponStates.length === 0) {\r\n        resultsDiv.classList.remove('visible');\r\n        return;\r\n    }\r\n\r\n    // Calculate initial DPS using StatCalculationService\r\n    const baseStats = loadoutStore.getBaseStats();\r\n    const initialStatService = new StatCalculationService(baseStats);\r\n    const initialDPS = initialStatService.computeDPS(MONSTER_TYPE.BOSS);\r\n\r\n    // Call the pure logic function (dynamic import to avoid circular type inference)\r\n    const { calculateCurrencyUpgrades: calculateCurrencyUpgradesPure } = await import('./weapons.js');\r\n    const result = calculateCurrencyUpgradesPure(weaponStates, currency);\r\n\r\n    if (!result) {\r\n        // If no upgrades could be bought with the entered currency, show a friendly message\r\n        resultsDiv.classList.add('visible');\r\n        if (attackGainDisplay) attackGainDisplay.textContent = `+0.00%`;\r\n        if (dpsGainDisplay) dpsGainDisplay.textContent = `+0.00%`;\r\n        if (pathDisplay) pathDisplay.innerHTML = `<span class=\"wl-currency-path-divider\">Most impactful upgrade can't be afforded \u2014 save up!</span>`;\r\n        // Hide the apply button since there is no path to apply\r\n        const applyUpgradesBtn = document.getElementById('apply-upgrade-path-btn');\r\n        if (applyUpgradesBtn) applyUpgradesBtn.style.display = 'none';\r\n        return;\r\n    }\r\n\r\n    // Calculate weapon attack bonus with simulated upgraded levels\r\n    const newWeaponAttackBonus = calculateTotalWeaponAttackBonusFromLevels(result.weaponLevels);\r\n\r\n    // Apply the weapon attack bonus difference to attack\r\n    const baseAttackWithoutWeaponBonus = baseStats.ATTACK / (1 + initialStatService.weaponAttackBonus / 100);\r\n    const newStats = { ...baseStats, attack: baseAttackWithoutWeaponBonus * (1 + newWeaponAttackBonus / 100) };\r\n\r\n    // Pass 0 for weaponAttackBonus since we've manually applied it to the attack stat\r\n    const newStatService = new StatCalculationService(newStats, newWeaponAttackBonus);\r\n    const newDPS = newStatService.computeDPS(MONSTER_TYPE.BOSS);\r\n    const dpsGainPct = ((newDPS - initialDPS) / initialDPS * 100);\r\n    result.dpsGainPct = dpsGainPct;\r\n\r\n    // Collate all upgrades by weapon type (not just consecutive)\r\n    const upgradeCounts: Record<string, UpgradePriorityItem & { count: number }> = {};\r\n\r\n    result.upgradeSequence.forEach(upgrade => {\r\n        const key = `${upgrade.rarity}-${upgrade.tier}`;\r\n        if (!upgradeCounts[key]) {\r\n            upgradeCounts[key] = {\r\n                ...upgrade,\r\n                count: 0\r\n            };\r\n        }\r\n        upgradeCounts[key].count++;\r\n    });\r\n\r\n    // Convert to array and sort by count (descending) then by rarity/tier\r\n    const collatedUpgrades = Object.values(upgradeCounts).sort((a, b) => {\r\n        if (b.count !== a.count) return b.count - a.count;\r\n        // Secondary sort: by rarity index then tier\r\n        const rarityOrder: Record<string, number> = {\r\n            [WEAPON_RARITY.NORMAL]: 0,\r\n            [WEAPON_RARITY.RARE]: 1,\r\n            [WEAPON_RARITY.EPIC]: 2,\r\n            [WEAPON_RARITY.UNIQUE]: 3,\r\n            [WEAPON_RARITY.LEGENDARY]: 4,\r\n            [WEAPON_RARITY.MYSTIC]: 5,\r\n            [WEAPON_RARITY.ANCIENT]: 6\r\n        };\r\n        if (rarityOrder[a.rarity] !== rarityOrder[b.rarity]) {\r\n            return rarityOrder[a.rarity] - rarityOrder[b.rarity];\r\n        }\r\n        const tierOrder: Record<string, number> = {\r\n            [WEAPON_TIER.T4]: 0,\r\n            [WEAPON_TIER.T3]: 1,\r\n            [WEAPON_TIER.T2]: 2,\r\n            [WEAPON_TIER.T1]: 3\r\n        };\r\n        return tierOrder[a.tier] - tierOrder[b.tier];\r\n    });\r\n\r\n    // Build path HTML (horizontal list)\r\n    let pathHTML = '';\r\n    collatedUpgrades.forEach((group, index) => {\r\n        const tierUpper = group.tier.toUpperCase();\r\n        const rarityFirstLetter = group.rarity.charAt(0).toUpperCase();\r\n        const weaponKey = `${group.rarity}-${group.tier}`;\r\n        pathHTML += `<span class=\"wl-currency-path-item\" data-rarity=\"${group.rarity}\">${tierUpper} ${rarityFirstLetter} x${group.count} (${result.weaponLevels[weaponKey]})</span>`;\r\n\r\n        if (index < collatedUpgrades.length - 1) {\r\n            pathHTML += ' <span class=\"wl-currency-path-divider\">,</span> ';\r\n        }\r\n    });\r\n\r\n    // Display results\r\n    if (attackGainDisplay) attackGainDisplay.textContent = `+${result.totalAttackGain.toFixed(2)}%`;\r\n    if (dpsGainDisplay) dpsGainDisplay.textContent = `+${result.dpsGainPct.toFixed(2)}%`;\r\n    if (pathDisplay) pathDisplay.innerHTML = pathHTML;\r\n    resultsDiv.classList.add('visible');\r\n\r\n    const applyUpgradesBtn = document.getElementById('apply-upgrade-path-btn');\r\n\r\n    // Ensure the apply button is visible when there is a valid path\r\n    if (applyUpgradesBtn) {\r\n        applyUpgradesBtn.style.display = '';\r\n\r\n        // Update weapon levels after user has leveled weapons accordingly\r\n        applyUpgradesBtn.onclick = () => {\r\n            for (const key in result.weaponLevels) {\r\n                const levelInput = document.getElementById(`level-${key}`) as HTMLInputElement;\r\n                if (levelInput) {\r\n                    levelInput.value = result.weaponLevels[key].toString();\r\n                }\r\n            }\r\n\r\n            // Reset currency input\r\n            if (currencyInput) currencyInput.value = '0';\r\n\r\n            // Update/save stats\r\n            calculateCurrencyUpgradesUI(updateWeaponBonuses);\r\n            // Save all weapon levels via store\r\n            for (const key in result.weaponLevels) {\r\n                const level = result.weaponLevels[key];\r\n                const [rarity, tier] = key.split('-') as [WeaponRarity, WeaponTier];\r\n                loadoutStore.updateWeapon(key, { level });\r\n            }\r\n            updateWeaponBonuses();\r\n        };\r\n    }\r\n}\r\n\r\n/**\r\n * Calculate currency upgrade optimization\r\n * Simulates spending a given amount of currency on the most efficient upgrades\r\n * @param weaponStates - Array of current weapon states\r\n * @param currency - Available currency (shards)\r\n * @returns Currency upgrade calculation result\r\n */\r\nexport function calculateCurrencyUpgrades(\r\n    weaponStates: WeaponState[],\r\n    currency: number\r\n): CurrencyUpgradeResult | null {\r\n    if (!weaponStates.length || currency <= 0) {\r\n        return null;\r\n    }\r\n\r\n    const upgradeSequence: UpgradePriorityItem[] = [];\r\n    const weaponLevels: Record<string, WeaponLevel> = {};\r\n    const weaponMaxLevels: Record<string, WeaponLevel> = {};\r\n    const weaponEquippedStates: Record<string, boolean> = {};\r\n    let remainingCurrency = currency;\r\n\r\n    // Initialize current levels, max levels, and equipped states\r\n    weaponStates.forEach(ws => {\r\n        const key = `${ws.rarity}-${ws.tier}`;\r\n        weaponLevels[key] = ws.level;\r\n        weaponMaxLevels[key] = ws.maxLevel;\r\n        weaponEquippedStates[key] = ws.isEquipped ?? false;\r\n    });\r\n\r\n    // Keep upgrading until we run out of currency\r\n    while (remainingCurrency > 0) {\r\n        let bestWeapon: UpgradePriorityItem | null = null;\r\n        let bestEfficiency = 0;\r\n\r\n        // Find the most efficient upgrade based on 1k shard potential\r\n        weaponStates.forEach(ws => {\r\n            const key = `${ws.rarity}-${ws.tier}` as WeaponKey;\r\n            const currentLevel = weaponLevels[key];\r\n            const maxLevel = weaponMaxLevels[key];\r\n            const isEquipped = weaponEquippedStates[key];\r\n\r\n            if (currentLevel >= maxLevel) return;\r\n\r\n            // Calculate multi-level efficiency (what 1k shards gets you from current level)\r\n            const upgradeGain = calculateUpgradeGain(\r\n                ws.rarity,\r\n                ws.tier,\r\n                currentLevel,\r\n                ws.stars,\r\n                1000,\r\n                isEquipped\r\n            );\r\n\r\n            let efficiency: number;\r\n            if (upgradeGain.isUnaffordable) {\r\n                // Normalize to per 1k when single level costs more than 1k\r\n                const inventoryEfficiency = (upgradeGain.attackGain / upgradeGain.singleLevelCost) * 1000;\r\n                const equippedEfficiency = (upgradeGain.equippedAttackGain / upgradeGain.singleLevelCost) * 1000;\r\n                efficiency = inventoryEfficiency + equippedEfficiency;\r\n            } else {\r\n                efficiency = upgradeGain.attackGain + upgradeGain.equippedAttackGain; // Already per 1k\r\n            }\r\n\r\n            if (efficiency > bestEfficiency) {\r\n                bestEfficiency = efficiency;\r\n                bestWeapon = {\r\n                    rarity: ws.rarity,\r\n                    tier: ws.tier,\r\n                    key,\r\n                    cost: getUpgradeCost(ws.rarity, ws.tier, currentLevel)\r\n                };\r\n            }\r\n        });\r\n\r\n        // If no weapon can be upgraded, stop\r\n        if (!bestWeapon) break;\r\n\r\n        // Check if we can afford this upgrade\r\n        if (bestWeapon.cost > remainingCurrency) break;\r\n\r\n        // Apply this upgrade (1 level at a time)\r\n        upgradeSequence.push(bestWeapon);\r\n        weaponLevels[bestWeapon.key]++;\r\n        remainingCurrency -= bestWeapon.cost;\r\n    }\r\n\r\n    if (upgradeSequence.length === 0) {\r\n        return null;\r\n    }\r\n\r\n    // Calculate total attack gain\r\n    let totalAttackGain = 0;\r\n    upgradeSequence.forEach(upgrade => {\r\n        const prevLevel = weaponLevels[upgrade.key] - 1;\r\n        const currentAttack = calculateWeaponAttacks(upgrade.rarity, upgrade.tier, prevLevel).inventoryAttack;\r\n        const nextAttack = calculateWeaponAttacks(upgrade.rarity, upgrade.tier, weaponLevels[upgrade.key]).inventoryAttack;\r\n        totalAttackGain += nextAttack - currentAttack;\r\n    });\r\n\r\n    return {\r\n        totalAttackGain,\r\n        dpsGainPct: 0, // To be calculated by UI layer\r\n        upgradeSequence,\r\n        weaponLevels,\r\n        remainingCurrency\r\n    };\r\n}\r\n\r\n/**\r\n * Helper function to calculate weapon attack bonus from weapon levels\r\n * @param weaponLevels - Object mapping rarity-tier keys to levels\r\n * @returns Total weapon attack bonus\r\n */\r\nfunction calculateTotalWeaponAttackBonusFromLevels(weaponLevels: Record<string, number>): number {\r\n    let totalBonus = 0;\r\n    let equippedBonus = 0;\r\n\r\n    rarities.forEach(rarity => {\r\n        tiers.forEach(tier => {\r\n            const key = `${rarity}-${tier}`;\r\n            const level = weaponLevels[key] || 0;\r\n\r\n            if (level === 0) return;\r\n\r\n            const { inventoryAttack, equippedAttack } = calculateWeaponAttacks(rarity, tier, level);\r\n            totalBonus += inventoryAttack;\r\n\r\n            // Check if this weapon is equipped\r\n            const equippedDisplay = document.getElementById(`equipped-label-${rarity}-${tier}`);\r\n            if (equippedDisplay && (equippedDisplay as HTMLElement).style.display !== 'none') {\r\n                equippedBonus = equippedAttack;\r\n            }\r\n        });\r\n    });\r\n\r\n    return totalBonus + equippedBonus;\r\n}"],
  "mappings": "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",
  "names": ["applyUpgradesBtn"]
}
