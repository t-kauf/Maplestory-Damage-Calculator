{
  "version": 3,
  "sources": ["cube-potential-ui.ts"],
  "sourcesContent": ["/**\n * Cube Potential UI\n * HTML generation and event handlers for the cube potential tab\n */\n\nimport {\n    currentCubeSlot,\n    currentPotentialType,\n    rankingsCache,\n    rankingsInProgress,\n    switchPotentialType,\n    selectCubeSlot,\n    clearCubeRankingsCache,\n    getRarityColor,\n    calculateComparison,\n    getPercentileForGain,\n    initializeCubePotential\n} from '@ts/page/cube-potential/cube-potential.js';\nimport { gearLabStore } from '@ts/store/gear-lab-store.js';\nimport { Chart } from 'chart.js/auto';\nimport {\n    SLOT_NAMES,\n    SLOT_SPECIFIC_POTENTIALS,\n    EQUIPMENT_POTENTIAL_DATA,\n    RANKINGS_PER_PAGE\n} from '@ts/page/cube-potential/cube-potential-data.js';\nimport { calculateRankingsForRarity, runCubeSimulation } from '@ts/page/cube-potential/cube-simulation.js';\nimport type {\n    CubeSlotId,\n    PotentialType,\n    Rarity,\n    PotentialLineEntry\n} from '@ts/types/page/gear-lab/gear-lab.types';\nimport { calculateSlotSetGain } from '@ts/page/cube-potential/cube-potential.js';\nimport { loadoutStore } from '@ts/store/loadout.store';\nimport { debounce } from '@ts/utils/event-emitter';\n\n// ============================================================================\n// STATE\n// ============================================================================\n\n/**\n * Current page for rankings pagination\n */\nlet currentRankingsPage = 1;\n\n/**\n * Summary sort column and direction\n */\nlet summarySortColumn: 'regular' | 'bonus' = 'regular';\nlet summarySortDescending = true;\n\n// ============================================================================\n// HTML GENERATION\n// ============================================================================\n\n/**\n * Generate the complete HTML for the cube potential tab\n */\nexport function generateCubePotentialHTML(): string {\n    return `\n        <!-- Class Warning Banner -->\n        <div id=\"cube-class-warning\" class=\"optimization-info-banner optimization-info-banner--warning\" style=\"display: none;\">\n            <span class=\"optimization-info-banner-icon\">\u26A0\uFE0F</span>\n            <div>\n                <div style=\"font-weight: 700; font-size: 1em; margin-bottom: 4px;\">No Class Selected</div>\n                <div style=\"color: var(--text-secondary); font-size: 0.9em;\">Please select your class in the Hero Power section above to use the Cube Potential calculator. Class selection is needed to properly calculate stat damage gains.</div>\n            </div>\n        </div>\n\n        <!-- Flattened Main Tab Navigation -->\n        <div id=\"tab-container-main\" class=\"cube-main-tabs\">\n            <button id=\"cube-main-tab-comparison\" class=\"tab-button active\" data-tab=\"comparison\">\n                <span class=\"cube-tab-label\">Comparison</span>\n            </button>\n            <button id=\"cube-main-tab-rankings\" class=\"tab-button\" data-tab=\"rankings\">\n                <span class=\"cube-tab-label\">Best Potentials</span>\n            </button>\n            <button id=\"cube-main-tab-summary\" class=\"tab-button\" data-tab=\"summary\">\n                <span class=\"cube-tab-label\">All Slots Summary</span>\n            </button>\n            <button id=\"cube-main-tab-simulation\" class=\"tab-button\" data-tab=\"simulation\">\n                <span class=\"cube-tab-label\">Simulation</span>\n            </button>\n            <button id=\"cube-main-tab-optimal\" class=\"tab-button\" style=\"display:none;\" data-tab=\"optimal\">\n                <span class=\"cube-tab-label\">Optimal Strategy</span>\n            </button>\n        </div>\n\n        <!-- Comparison Tab Content -->\n        <div id=\"cube-comparison-content\" class=\"cube-tab-content active\">\n            ${generateComparisonTabHTML()}\n        </div>\n\n        <!-- Best Potentials Tab Content -->\n        <div id=\"cube-rankings-content\" class=\"cube-tab-content\">\n            ${generateRankingsTabHTML()}\n        </div>\n\n        <!-- All Slots Summary Tab Content -->\n        <div id=\"cube-summary-content\" class=\"cube-tab-content\">\n            ${generateSummaryTabHTML()}\n        </div>\n\n        <!-- Simulation Tab Content -->\n        <div id=\"cube-simulation-content\" class=\"cube-tab-content\">\n            ${generateSimulationTabHTML()}\n        </div>\n\n        <!-- Optimal Strategy Tab Content -->\n        <div id=\"cube-optimal-content\" class=\"cube-tab-content\">\n            ${generateOptimalTabHTML()}\n        </div>\n    `;\n}\n\n/**\n * Generate HTML for the Comparison tab\n */\nfunction generateComparisonTabHTML(): string {\n    return `\n        <!-- Equipment Slot Selector -->\n        <div class=\"cube-slot-selector-wrapper\">\n            <label for=\"cube-slot-selector\" class=\"cube-slot-label\">Equipment Slot</label>\n            <div id=\"cube-slot-selector\" class=\"cube-slot-buttons-container\"></div>\n        </div>\n\n        <!-- Context Controls for Comparison Tab (Potential Type & Rarity) -->\n        <div id=\"cube-comparison-controls\" class=\"cube-context-controls\" style=\"display: block;\">\n            <div class=\"cube-controls-grid\">\n                <!-- Potential Type Toggle -->\n                <div class=\"cube-control-group\">\n                    <label class=\"cube-control-label\">Potential Type</label>\n                    <div class=\"cube-potential-type-buttons\">\n                        <button id=\"cube-regular-potential-btn\" class=\"cube-potential-type-btn active\">\n                            <span class=\"cube-type-icon\">\u2726</span>\n                            <span>Regular</span>\n                        </button>\n                        <button id=\"cube-bonus-potential-btn\" class=\"cube-potential-type-btn\">\n                            <span class=\"cube-type-icon\">\u2727</span>\n                            <span>Bonus</span>\n                        </button>\n                    </div>\n                </div>\n\n                <!-- Rarity Selector -->\n                <div class=\"cube-rarity-row\">\n                    <div class=\"cube-control-group\">\n                        <label for=\"cube-rarity-selector\" class=\"cube-control-label\">Slot Rarity</label>\n                        <select id=\"cube-rarity-selector\" class=\"cube-rarity-select\">\n                            <option value=\"normal\">Normal</option>\n                            <option value=\"rare\">Rare</option>\n                            <option value=\"epic\">Epic</option>\n                            <option value=\"unique\">Unique</option>\n                            <option value=\"legendary\">Legendary</option>\n                            <option value=\"mystic\">Mystic</option>\n                        </select>\n                    </div>\n\n                    <div class=\"cube-roll-count-container\">\n                        <label for=\"cube-roll-count\" style=\"font-size: 0.85em; color: var(--text-secondary);\">\n                            Rolls at current rarity\n                        </label>\n                        <input type=\"number\" id=\"cube-roll-count\" min=\"0\" max=\"999\" value=\"0\"\n                               style=\"width: 80px; padding: 8px 12px; border-radius: 8px;\n                                      border: 1px solid var(--border-color); background: var(--bg-secondary);\n                                      color: var(--text-primary); font-size: 0.95em;\">\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <div class=\"cube-comparison-grid\">\n            <!-- Set A (Current) Card -->\n            <div class=\"cube-set-card cube-set-card--a\">\n                <div class=\"cube-set-card-header\">\n                    <h3 class=\"cube-set-card-title\">Set A (Current)</h3>\n                    <span class=\"cube-set-card-subtitle\">Your configured potential</span>\n                </div>\n\n                <div class=\"cube-set-card-body\">\n                    <div class=\"cube-line-input-group\">\n                        <label class=\"cube-line-label\" for=\"cube-setA-line1-stat\">Line 1</label>\n                        <select id=\"cube-setA-line1-stat\" class=\"cube-line-select\"></select>\n                    </div>\n\n                    <div class=\"cube-line-input-group\">\n                        <label class=\"cube-line-label\" for=\"cube-setA-line2-stat\">Line 2</label>\n                        <select id=\"cube-setA-line2-stat\" class=\"cube-line-select\"></select>\n                    </div>\n\n                    <div class=\"cube-line-input-group\">\n                        <label class=\"cube-line-label\" for=\"cube-setA-line3-stat\">Line 3</label>\n                        <select id=\"cube-setA-line3-stat\" class=\"cube-line-select\"></select>\n                    </div>\n                </div>\n            </div>\n\n            <!-- Set B (Comparison) Card -->\n            <div class=\"cube-set-card cube-set-card--b\">\n                <div class=\"cube-set-card-header\">\n                    <h3 class=\"cube-set-card-title\">Set B (Comparison)</h3>\n                    <span class=\"cube-set-card-subtitle\">Test alternative potential</span>\n                </div>\n\n                <div class=\"cube-set-card-body\">\n                    <div class=\"cube-line-input-group\">\n                        <label class=\"cube-line-label\" for=\"cube-setB-line1-stat\">Line 1</label>\n                        <select id=\"cube-setB-line1-stat\" class=\"cube-line-select\"></select>\n                    </div>\n\n                    <div class=\"cube-line-input-group\">\n                        <label class=\"cube-line-label\" for=\"cube-setB-line2-stat\">Line 2</label>\n                        <select id=\"cube-setB-line2-stat\" class=\"cube-line-select\"></select>\n                    </div>\n\n                    <div class=\"cube-line-input-group\">\n                        <label class=\"cube-line-label\" for=\"cube-setB-line3-stat\">Line 3</label>\n                        <select id=\"cube-setB-line3-stat\" class=\"cube-line-select\"></select>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <!-- Comparison Results -->\n        <div id=\"cube-comparison-results\" class=\"cube-results-section\"></div>\n    `;\n}\n\n/**\n * Generate HTML for the Rankings tab\n */\nfunction generateRankingsTabHTML(): string {\n    return `\n        <!-- Controls for Rankings (Independent slot & rarity selectors) -->\n        <div id=\"cube-rankings-controls\" class=\"cube-context-controls\" style=\"display: block;\">\n            <div class=\"cube-controls-grid\">\n                <!-- Slot Selector -->\n                <div class=\"cube-control-group\">\n                    <label for=\"cube-rankings-slot-selector\" class=\"cube-control-label\">Equipment Slot</label>\n                    <select id=\"cube-rankings-slot-selector\" class=\"cube-rarity-select\">\n                        <!-- Populated by JavaScript -->\n                    </select>\n                    <p style=\"font-size: 0.85em; color: var(--text-secondary); margin-top: var(--cube-space-sm);\">\n                        Some slots have unique potential lines available only to them\n                    </p>\n                </div>\n\n                <!-- Rarity Selector -->\n                <div class=\"cube-control-group\">\n                    <label for=\"cube-rankings-rarity-selector\" class=\"cube-control-label\">Rarity Tier</label>\n                    <select id=\"cube-rankings-rarity-selector\" class=\"cube-rarity-select\">\n                        <option value=\"normal\">Normal</option>\n                        <option value=\"rare\">Rare</option>\n                        <option value=\"epic\" selected>Epic</option>\n                        <option value=\"unique\">Unique</option>\n                        <option value=\"legendary\">Legendary</option>\n                        <option value=\"mystic\">Mystic</option>\n                    </select>\n                    <p style=\"font-size: 0.85em; color: var(--text-secondary); margin-top: var(--cube-space-sm);\">\n                        View best combinations for this rarity (independent of saved config)\n                    </p>\n                </div>\n            </div>\n        </div>\n\n        <!-- Progress Bar -->\n        <div id=\"cube-rankings-progress\" class=\"cube-progress-bar\" style=\"display: none;\">\n            <div class=\"cube-progress-track\">\n                <div id=\"cube-rankings-progress-fill\" class=\"cube-progress-fill\"></div>\n            </div>\n            <p id=\"cube-rankings-progress-text\" class=\"cube-progress-text\">Calculating best combinations...</p>\n        </div>\n\n        <!-- Rankings Results -->\n        <div id=\"cube-rankings-results\" class=\"cube-rankings-results\"></div>\n    `;\n}\n\n/**\n * Generate HTML for the Summary tab\n */\nfunction generateSummaryTabHTML(): string {\n    return `\n        <div class=\"cube-summary-header\">\n            <h3 class=\"cube-summary-title\">All Slots Potential Summary</h3>\n            <p class=\"cube-summary-description\">Overview of Set A DPS gains for all equipment slots (Regular and Bonus Potential)</p>\n        </div>\n\n        <!-- Loading Progress -->\n        <div id=\"cube-summary-progress\" class=\"cube-progress-bar\" style=\"display: none;\">\n            <div class=\"cube-progress-track\">\n                <div id=\"cube-summary-progress-fill\" class=\"cube-progress-fill\"></div>\n            </div>\n            <p id=\"cube-summary-progress-text\" class=\"cube-progress-text\">Loading rankings across all slots...</p>\n        </div>\n\n        <div id=\"cube-summary-results\" class=\"cube-summary-results\"></div>\n    `;\n}\n\n/**\n * Generate HTML for the Simulation tab\n */\nfunction generateSimulationTabHTML(): string {\n    return `\n        <div class=\"cube-simulation-header\">\n            <h3 class=\"cube-simulation-title\">Cube Potential Optimization Simulator</h3>\n            <p class=\"cube-simulation-description\">Simulates different cubing strategies to find the most efficient approach for maximizing damage across all equipment slots. Uses fictional slots that are all set to normal with 0 tries attempted. This does not account for your current slots or their rarities!</p>\n        </div>\n\n        <!-- Simulation Controls -->\n        <div class=\"cube-simulation-controls\">\n            <!-- Simulation Configuration -->\n            <div class=\"sim-config-row\" style=\"display: flex; gap: 20px; margin-bottom: 15px; align-items: center; flex-wrap: wrap;\">\n                <div class=\"sim-potential-type\" style=\"display: flex; align-items: center; gap: 10px;\">\n                    <label style=\"color: var(--text-secondary);\">Potential Type:</label>\n                    <label style=\"display: flex; align-items: center; gap: 6px; cursor: pointer;\">\n                        <input type=\"radio\" name=\"sim-potential-type\" value=\"regular\" checked>\n                        <span>Regular</span>\n                    </label>\n                    <label style=\"display: flex; align-items: center; gap: 6px; cursor: pointer; margin-left: 10px;\">\n                        <input type=\"radio\" name=\"sim-potential-type\" value=\"bonus\">\n                        <span>Bonus</span>\n                    </label>\n                </div>\n                <div class=\"sim-use-data\" style=\"display: flex; align-items: center; gap: 6px;\">\n                    <label style=\"display: flex; align-items: center; gap: 6px; cursor: pointer;\">\n                        <input type=\"checkbox\" id=\"sim-use-my-data\">\n                        <span style=\"color: var(--text-secondary);\">Use my current equipment data</span>\n                    </label>\n                </div>\n            </div>\n\n            <div class=\"cube-simulation-inputs\">\n                <div class=\"cube-sim-input-group\">\n                    <label for=\"simulation-cube-budget\" class=\"cube-sim-label\">Cube Budget</label>\n                    <input type=\"number\" id=\"simulation-cube-budget\" value=\"1000\" min=\"100\" max=\"50000\" step=\"100\" class=\"cube-sim-input\">\n                </div>\n                <div class=\"cube-sim-input-group\">\n                    <label for=\"simulation-count\" class=\"cube-sim-label\">Number of Simulations</label>\n                    <input type=\"number\" id=\"simulation-count\" value=\"10\" min=\"100\" max=\"10000\" step=\"100\" class=\"cube-sim-input\">\n                </div>\n            </div>\n            <button class=\"cube-sim-run-btn\" id=\"cube-simulation-run-btn\">\n                <span class=\"cube-sim-btn-icon\">\u25B6</span>\n                <span>Run Simulation</span>\n            </button>\n        </div>\n\n        <!-- Progress Bar -->\n        <div id=\"cube-simulation-progress\" class=\"cube-progress-bar\" style=\"display: none;\">\n            <div class=\"cube-progress-track\">\n                <div id=\"cube-simulation-progress-fill\" class=\"cube-progress-fill\"></div>\n            </div>\n            <p id=\"cube-simulation-progress-text\" class=\"cube-progress-text\">Running simulations...</p>\n        </div>\n\n        <!-- Results -->\n        <div id=\"cube-simulation-results\" class=\"cube-simulation-results\"></div>\n    `;\n}\n\n/**\n * Generate HTML for the Optimal Strategy tab\n */\nfunction generateOptimalTabHTML(): string {\n    return `\n        <div class=\"optimal-config\" style=\"display: flex; gap: 20px; margin-bottom: 20px; align-items: center;\">\n            <div>\n                <label style=\"color: var(--text-secondary);\">Potential Type:</label>\n                <select id=\"optimal-potential-type\" style=\"margin-left: 8px; padding: 6px 12px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--bg-secondary); color: var(--text-primary);\">\n                    <option value=\"regular\">Regular</option>\n                    <option value=\"bonus\">Bonus</option>\n                </select>\n            </div>\n            <div>\n                <label style=\"color: var(--text-secondary);\">Cube Budget:</label>\n                <input type=\"number\" id=\"optimal-cube-budget\" min=\"1\" max=\"9999\" value=\"100\" style=\"margin-left: 8px; width: 100px; padding: 6px 12px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--bg-secondary); color: var(--text-primary);\">\n            </div>\n        </div>\n\n        <div id=\"optimal-recommendation\" class=\"optimal-recommendation-panel\">\n            <!-- Populated dynamically -->\n        </div>\n\n        <div id=\"optimal-sequence\" class=\"optimal-sequence-table\">\n            <!-- Full optimal sequence table -->\n        </div>\n    `;\n}\n\n// ============================================================================\n// INITIALIZATION\n// ============================================================================\n\n/**\n * Initialize the cube potential UI\n */\nexport async function initializeCubePotentialUI(): Promise<void> {\n    const container = document.getElementById('optimization-cube-potential');\n    if (!container) {\n        console.error('Cube potential container not found');\n        return;\n    }\n\n    // Generate HTML\n    container.innerHTML = generateCubePotentialHTML();\n\n    // Initialize core system\n    await initializeCubePotential();\n\n    // Setup UI components\n    setupSlotSelector();\n    setupPotentialTypeButtons();\n    setupRaritySelector();\n    setupRollCountInput();\n    setupPotentialLineDropdowns();\n    setupTabNavigation();\n    setupRankingsControls();\n    setupSimulationButton();\n\n    // Load data from store\n    loadCubeDataFromStore();\n\n    // Initial UI update\n    updateSlotButtonColors();\n    updateCubePotentialUI();\n    updateClassWarning();\n\n    // Expose global functions\n    exposeGlobalFunctions();\n\n    loadoutStore.on('stat:changed', debounce((_) => {\n           clearCubeRankingsCache();\n           calculateComparisonAndDisplay();\n           const button = document.getElementById(\"cube-main-tab-comparison\");\n           button?.click();\n    }, 1500));\n}\n\n/**\n * Load cube data from store and update UI\n */\nfunction loadCubeDataFromStore(): void {\n    const cubeData = gearLabStore.getCubeSlotData();\n    if (!cubeData) return;\n\n    // Update rarity selector\n    const raritySelector = document.getElementById('cube-rarity-selector') as HTMLSelectElement;\n    if (raritySelector) {\n        raritySelector.value = cubeData[currentCubeSlot][currentPotentialType].rarity;\n    }\n\n    // Update roll count input\n    const rollCountInput = document.getElementById('cube-roll-count') as HTMLInputElement;\n    if (rollCountInput) {\n        rollCountInput.value = cubeData[currentCubeSlot][currentPotentialType].rollCount.toString();\n    }\n}\n\n// ============================================================================\n// UI SETUP FUNCTIONS\n// ============================================================================\n\n/**\n * Setup equipment slot selector buttons\n */\nfunction setupSlotSelector(): void {\n    const slotSelector = document.getElementById('cube-slot-selector');\n    if (!slotSelector) return;\n\n    const cubeData = gearLabStore.getCubeSlotData();\n    if (!cubeData) return;\n\n    slotSelector.innerHTML = '';\n\n    SLOT_NAMES.forEach(slot => {\n        const slotBtn = document.createElement('button');\n        slotBtn.className = 'cube-slot-btn';\n        slotBtn.textContent = slot.name;\n        slotBtn.dataset.slot = slot.id;\n\n        // Apply rarity color to border\n        const slotRarity = cubeData[slot.id]?.[currentPotentialType]?.rarity || 'normal';\n        const rarityColor = getRarityColor(slotRarity);\n        slotBtn.style.borderColor = rarityColor;\n\n        // Apply active state\n        const isActive = slot.id === currentCubeSlot;\n        if (isActive) {\n            slotBtn.classList.add('active');\n            slotBtn.style.boxShadow = `0 4px 16px ${rarityColor}60, 0 0 0 2px ${rarityColor}`;\n        } else {\n            slotBtn.style.boxShadow = `0 2px 8px ${rarityColor}40`;\n        }\n\n        slotBtn.addEventListener('click', () => {\n            selectCubeSlot(slot.id);\n            updateSlotButtonColors();\n            loadCubeDataFromStore();\n            updateCubePotentialUI();\n            calculateComparisonAndDisplay();\n        });\n\n        slotSelector.appendChild(slotBtn);\n    });\n}\n\n/**\n * Setup potential type toggle buttons\n */\nfunction setupPotentialTypeButtons(): void {\n    const regularBtn = document.getElementById('cube-regular-potential-btn');\n    const bonusBtn = document.getElementById('cube-bonus-potential-btn');\n\n    if (regularBtn && bonusBtn) {\n        regularBtn.addEventListener('click', () => {\n            switchPotentialType('regular');\n            updatePotentialTypeButtons();\n            loadCubeDataFromStore();\n            updateSlotButtonColors();\n            updateCubePotentialUI();\n            calculateComparisonAndDisplay();\n        });\n\n        bonusBtn.addEventListener('click', () => {\n            switchPotentialType('bonus');\n            updatePotentialTypeButtons();\n            loadCubeDataFromStore();\n            updateSlotButtonColors();\n            updateCubePotentialUI();\n            calculateComparisonAndDisplay();\n        });\n    }\n}\n\n/**\n * Setup rarity selector\n */\nfunction setupRaritySelector(): void {\n    const raritySelector = document.getElementById('cube-rarity-selector') as HTMLSelectElement;\n    if (!raritySelector) return;\n\n    raritySelector.addEventListener('change', (e) => {\n        const target = e.target as HTMLSelectElement;\n        const newRarity = target.value as Rarity;\n        gearLabStore.updateCubeRarity(currentCubeSlot, currentPotentialType, newRarity);\n\n        updateSlotButtonColors();\n        updateCubePotentialUI();\n        calculateComparisonAndDisplay();\n    });\n}\n\n/**\n * Setup roll count input\n */\nfunction setupRollCountInput(): void {\n    const rollCountInput = document.getElementById('cube-roll-count') as HTMLInputElement;\n    if (!rollCountInput) return;\n\n    rollCountInput.addEventListener('change', (e) => {\n        const target = e.target as HTMLInputElement;\n        const value = parseInt(target.value) || 0;\n        gearLabStore.updateCubeRollCount(currentCubeSlot, currentPotentialType, value);\n    });\n}\n\n/**\n * Setup potential line dropdowns\n */\nfunction setupPotentialLineDropdowns(): void {\n    const cubeData = gearLabStore.getCubeSlotData();\n    if (!cubeData) return;\n\n    const rarity = cubeData[currentCubeSlot][currentPotentialType].rarity;\n\n    // Setup Set A dropdowns\n    updatePotentialLineDropdowns('setA', rarity);\n\n    // Setup Set B dropdowns\n    updatePotentialLineDropdowns('setB', rarity);\n}\n\n/**\n * Setup tab navigation\n */\nfunction setupTabNavigation(): void {\n    const tabs = document.querySelectorAll('.cube-main-tabs .tab-button');\n    const contents = document.querySelectorAll('.cube-tab-content');\n\n    tabs.forEach(tab => {\n        tab.addEventListener('click', () => {\n            const tabName = tab.getAttribute('data-tab');\n            if (!tabName) return;\n\n            // Update active states\n            tabs.forEach(t => t.classList.remove('active'));\n            contents.forEach(c => c.classList.remove('active'));\n\n            tab.classList.add('active');\n            const targetContent = document.getElementById(`cube-${tabName}-content`);\n            if (targetContent) {\n                targetContent.classList.add('active');\n            }\n\n            // Handle tab-specific initialization\n            if (tabName === 'summary') {\n                displayAllSlotsSummary();\n                loadAllRankingsForSummary();\n            } else if (tabName === 'rankings') {\n                // Ensure selectors are initialized before accessing them\n                setupRankingsControls();\n                const raritySelector = document.getElementById('cube-rankings-rarity-selector') as HTMLSelectElement;\n                if (raritySelector) {\n                    const rarity = raritySelector.value as Rarity;\n                    displayOrCalculateRankingsForRarity(rarity);\n                }\n            }\n        });\n    });\n}\n\n/**\n * Setup rankings controls\n */\nfunction setupRankingsControls(): void {\n    const slotSelector = document.getElementById('cube-rankings-slot-selector') as HTMLSelectElement;\n    const raritySelector = document.getElementById('cube-rankings-rarity-selector') as HTMLSelectElement;\n\n    if (!slotSelector) {\n        console.error('Rankings slot selector (cube-rankings-slot-selector) not found in DOM');\n        return;\n    }\n    if (!raritySelector) {\n        console.error('Rankings rarity selector (cube-rankings-rarity-selector) not found in DOM');\n        return;\n    }\n\n    // Only populate if not already populated (check if empty)\n    if (slotSelector.options.length === 0) {\n        // Populate slot selector\n        SLOT_NAMES.forEach(slot => {\n            const option = document.createElement('option');\n            option.value = slot.id;\n            option.textContent = slot.name;\n            slotSelector.appendChild(option);\n        });\n\n        // Set default to current slot\n        slotSelector.value = currentCubeSlot;\n\n        // Verify the value was set successfully, fallback to first slot if not\n        if (!slotSelector.value && SLOT_NAMES.length > 0) {\n            slotSelector.value = SLOT_NAMES[0].id;\n            console.warn(`currentCubeSlot \"${currentCubeSlot}\" not found in options, defaulting to \"${SLOT_NAMES[0].id}\"`);\n        }\n    }\n\n    // Add event listeners if not already attached (using defensive element lookup)\n    if (!slotSelector.hasAttribute('data-listener-attached')) {\n        slotSelector.addEventListener('change', () => {\n            currentRankingsPage = 1;\n            // Defensively get current references to selectors\n            const currentRaritySelector = document.getElementById('cube-rankings-rarity-selector') as HTMLSelectElement;\n            const currentSlotSelector = document.getElementById('cube-rankings-slot-selector') as HTMLSelectElement;\n            if (currentRaritySelector && currentSlotSelector) {\n                const rarity = currentRaritySelector.value as Rarity;\n                const slotId = currentSlotSelector.value as CubeSlotId;\n                // Trigger calculation for the new slot\n                displayOrCalculateRankingsForSlotAndRarity(slotId, rarity);\n            }\n        });\n        slotSelector.setAttribute('data-listener-attached', 'true');\n    }\n\n    if (!raritySelector.hasAttribute('data-listener-attached')) {\n        raritySelector.addEventListener('change', () => {\n            currentRankingsPage = 1;\n            // Defensively get current references to selectors\n            const currentRaritySelector = document.getElementById('cube-rankings-rarity-selector') as HTMLSelectElement;\n            const currentSlotSelector = document.getElementById('cube-rankings-slot-selector') as HTMLSelectElement;\n            if (currentRaritySelector && currentSlotSelector) {\n                const rarity = currentRaritySelector.value as Rarity;\n                const slotId = currentSlotSelector.value as CubeSlotId;\n                // Trigger calculation for the new rarity\n                displayOrCalculateRankingsForSlotAndRarity(slotId, rarity);\n            }\n        });\n        raritySelector.setAttribute('data-listener-attached', 'true');\n    }\n}\n\n// Store simulation parameters for display\nlet cubeBudget = 1000;\nlet simulationCount = 1000;\n\n/**\n * Handle run simulation button click\n */\nasync function handleRunSimulation(): Promise<void> {\n    const budgetInput = document.getElementById('simulation-cube-budget') as HTMLInputElement;\n    const countInput = document.getElementById('simulation-count') as HTMLInputElement;\n    const potentialTypeInputs = document.querySelectorAll('input[name=\"sim-potential-type\"]');\n    const useUserDataCheckbox = document.getElementById('sim-use-my-data') as HTMLInputElement;\n\n    if (!budgetInput || !countInput || !potentialTypeInputs.length) {\n        console.error('Simulation inputs not found');\n        return;\n    }\n\n    cubeBudget = parseInt(budgetInput.value) || 1000;\n    simulationCount = parseInt(countInput.value) || 1000;\n\n    let potentialType: 'regular' | 'bonus' = 'regular';\n    for (const input of potentialTypeInputs) {\n        if ((input as HTMLInputElement).checked) {\n            potentialType = (input as HTMLInputElement).value as 'regular' | 'bonus';\n            break;\n        }\n    }\n\n    const useUserData = useUserDataCheckbox?.checked || false;\n\n    const cubeSlotData = gearLabStore.getCubeSlotData();\n    if (!cubeSlotData) {\n        console.error('Cube slot data not found');\n        return;\n    }\n\n    // Include base stats which is required by runCubeSimulation\n    const baseStats = loadoutStore.getBaseStats();\n    const cubeSlotDataWithStats = {\n        ...cubeSlotData,\n        baseStats\n    };\n\n    const results = await runCubeSimulation(\n        cubeBudget,\n        simulationCount,\n        potentialType,\n        useUserData,\n        cubeSlotDataWithStats\n    );\n\n    // Display results (includes chart creation)\n    displaySimulationResults(results);\n}\n\n/**\n * Display simulation results with full breakdown\n */\nfunction displaySimulationResults(results: Record<string, any>): void {\n    const resultsDiv = document.getElementById('cube-simulation-results');\n    if (!resultsDiv) return;\n\n    // Find best strategy\n    let bestStrategy = Object.keys(results)[0];\n    let bestAvg = results[bestStrategy]?.avgGain || 0;\n\n    for (const strategy of Object.keys(results)) {\n        if ((results[strategy]?.avgGain || 0) > bestAvg) {\n            bestStrategy = strategy;\n            bestAvg = results[strategy]?.avgGain || 0;\n        }\n    }\n\n    const formatStrategy = (strategyKey: string, name: string, data: any, isBest: boolean): string => {\n        const gains = [...(data.totalGains || [])].sort((a: number, b: number) => a - b);\n        if (gains.length === 0) return '';\n\n        const min = gains[0];\n        const max = gains[gains.length - 1];\n        const median = gains[Math.floor(gains.length / 2)];\n        const p25 = gains[Math.floor(gains.length * 0.25)];\n        const p75 = gains[Math.floor(gains.length * 0.75)];\n\n        // Find simulations for each percentile\n        const simulations = data.simulations || [];\n        const minSimIdx = simulations.findIndex((s: any) => Math.abs(s.totalGain - min) < 0.01);\n        const p25SimIdx = simulations.findIndex((s: any) => Math.abs(s.totalGain - p25) < 0.01);\n        const medianSimIdx = simulations.findIndex((s: any) => Math.abs(s.totalGain - median) < 0.01);\n        const p75SimIdx = simulations.findIndex((s: any) => Math.abs(s.totalGain - p75) < 0.01);\n        const maxSimIdx = simulations.findIndex((s: any) => Math.abs(s.totalGain - max) < 0.01);\n\n        const detailsId = `sim-details-${strategyKey}`;\n        const chartCanvasId = `sim-chart-${strategyKey}`;\n\n        return `\n            <details style=\"background: linear-gradient(135deg, ${isBest ? 'rgba(52, 199, 89, 0.1), rgba(0, 122, 255, 0.05)' : 'rgba(59, 130, 246, 0.1), rgba(147, 51, 234, 0.05)'}); border: 2px solid ${isBest ? 'var(--accent-success)' : 'rgba(59, 130, 246, 0.3)'}; border-radius: 12px; margin-bottom: 12px; transition: all 0.3s;\">\n                <summary style=\"cursor: pointer; padding: 16px 20px; user-select: none; list-style: none; display: flex; align-items: center; justify-content: space-between; gap: 15px;\">\n                    <div style=\"display: flex; align-items: center; gap: 10px; flex: 1; min-width: 0;\">\n                        <span style=\"color: ${isBest ? 'var(--accent-success)' : 'var(--accent-primary)'}; font-size: 1.05em; font-weight: 700;\">\n                            ${isBest ? '\u2B50 ' : ''}${name}\n                        </span>\n                    </div>\n                    <div style=\"display: flex; align-items: center; gap: 20px; font-size: 0.95em; flex-shrink: 0;\">\n                        <div style=\"text-align: right;\">\n                            <span style=\"color: var(--text-secondary); font-size: 0.85em;\">Avg:</span>\n                            <span style=\"color: ${isBest ? 'var(--accent-success)' : 'var(--accent-primary)'}; font-weight: 700; margin-left: 6px;\">+${data.avgGain.toFixed(2)}%</span>\n                        </div>\n                        <div style=\"text-align: right;\">\n                            <span style=\"color: var(--text-secondary); font-size: 0.85em;\">Range:</span>\n                            <span style=\"color: var(--text-primary); font-weight: 600; margin-left: 6px;\">+${min.toFixed(2)}% - +${max.toFixed(2)}%</span>\n                        </div>\n                    </div>\n                </summary>\n\n                <div style=\"padding: 0 20px 20px 20px; border-top: 1px solid rgba(0, 0, 0, 0.1); margin-top: -5px; padding-top: 20px;\">\n                    <!-- Stats Grid -->\n                    <div style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px; margin-bottom: 15px;\">\n                        <div class=\"sim-stat-card\">\n                            <div class=\"sim-stat-card-label\">Average Gain</div>\n                            <div class=\"sim-stat-card-value\">+${data.avgGain.toFixed(2)}%</div>\n                        </div>\n                        <div class=\"sim-stat-card\">\n                            <div class=\"sim-stat-card-label\">Median</div>\n                            <div class=\"sim-stat-card-value sim-stat-card-value--secondary\">+${median.toFixed(2)}%</div>\n                        </div>\n                        <div class=\"sim-stat-card\">\n                            <div class=\"sim-stat-card-label\">Min / Max</div>\n                            <div class=\"sim-stat-card-value sim-stat-card-value--secondary\">+${min.toFixed(2)}% / +${max.toFixed(2)}%</div>\n                        </div>\n                        <div class=\"sim-stat-card\">\n                            <div class=\"sim-stat-card-label\">P25 / P75</div>\n                            <div class=\"sim-stat-card-value sim-stat-card-value--secondary\">+${p25.toFixed(2)}% / +${p75.toFixed(2)}%</div>\n                        </div>\n                    </div>\n\n                    <!-- Detailed Results Dropdown -->\n                    <details class=\"sim-detail-results\" data-strategy=\"${strategyKey}\" style=\"background: rgba(0, 0, 0, 0.05); border-radius: 8px; padding: 10px; margin-top: 10px;\">\n                        <summary style=\"cursor: pointer; font-weight: 600; color: var(--accent-primary); user-select: none; font-size: 0.95em;\">\n                            View Detailed Results (Slot Stats & Distribution)\n                        </summary>\n                        <div id=\"${detailsId}\" style=\"margin-top: 15px;\">\n                            <!-- Sub-tabs -->\n                            <div style=\"display: flex; gap: 10px; margin-bottom: 15px; border-bottom: 2px solid rgba(0, 0, 0, 0.1); padding-bottom: 0; overflow-x: auto;\">\n                                <button class=\"sim-detail-tab active\" data-strategy=\"${strategyKey}\" data-tab=\"distribution\" onclick=\"window.switchSimDetailTab('${strategyKey}', 'distribution')\" style=\"padding: 8px 16px; background: none; border: none; border-bottom: 3px solid var(--accent-primary); cursor: pointer; font-weight: 600; color: var(--text-primary); transition: all 0.3s; white-space: nowrap;\">Distribution</button>\n                                <button class=\"sim-detail-tab\" data-strategy=\"${strategyKey}\" data-tab=\"min\" onclick=\"window.switchSimDetailTab('${strategyKey}', 'min')\" style=\"padding: 8px 16px; background: none; border: none; border-bottom: 3px solid transparent; cursor: pointer; font-weight: 600; color: var(--text-primary); transition: all 0.3s; white-space: nowrap;\">Min (+${min.toFixed(2)}%)</button>\n                                <button class=\"sim-detail-tab\" data-strategy=\"${strategyKey}\" data-tab=\"p25\" onclick=\"window.switchSimDetailTab('${strategyKey}', 'p25')\" style=\"padding: 8px 16px; background: none; border: none; border-bottom: 3px solid transparent; cursor: pointer; font-weight: 600; color: var(--text-primary); transition: all 0.3s; white-space: nowrap;\">P25 (+${p25.toFixed(2)}%)</button>\n                                <button class=\"sim-detail-tab\" data-strategy=\"${strategyKey}\" data-tab=\"median\" onclick=\"window.switchSimDetailTab('${strategyKey}', 'median')\" style=\"padding: 8px 16px; background: none; border: none; border-bottom: 3px solid transparent; cursor: pointer; font-weight: 600; color: var(--text-primary); transition: all 0.3s; white-space: nowrap;\">Median (+${median.toFixed(2)}%)</button>\n                                <button class=\"sim-detail-tab\" data-strategy=\"${strategyKey}\" data-tab=\"p75\" onclick=\"window.switchSimDetailTab('${strategyKey}', 'p75')\" style=\"padding: 8px 16px; background: none; border: none; border-bottom: 3px solid transparent; cursor: pointer; font-weight: 600; color: var(--text-primary); transition: all 0.3s; white-space: nowrap;\">P75 (+${p75.toFixed(2)}%)</button>\n                                <button class=\"sim-detail-tab\" data-strategy=\"${strategyKey}\" data-tab=\"max\" onclick=\"window.switchSimDetailTab('${strategyKey}', 'max')\" style=\"padding: 8px 16px; background: none; border: none; border-bottom: 3px solid transparent; cursor: pointer; font-weight: 600; color: var(--text-primary); transition: all 0.3s; white-space: nowrap;\">Max (+${max.toFixed(2)}%)</button>\n                            </div>\n\n                            <!-- Distribution Tab -->\n                            <div class=\"sim-detail-content\" data-strategy=\"${strategyKey}\" data-tab=\"distribution\" style=\"display: block;\">\n                                <canvas id=\"${chartCanvasId}\" style=\"max-height: 300px;\"></canvas>\n                            </div>\n\n                            <!-- Min Tab -->\n                            <div class=\"sim-detail-content\" data-strategy=\"${strategyKey}\" data-tab=\"min\" style=\"display: none;\">\n                                <div style=\"display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px;\">\n                                    ${minSimIdx >= 0 ? formatSlotDetails(simulations[minSimIdx].slots) : 'No data'}\n                                </div>\n                            </div>\n\n                            <!-- P25 Tab -->\n                            <div class=\"sim-detail-content\" data-strategy=\"${strategyKey}\" data-tab=\"p25\" style=\"display: none;\">\n                                <div style=\"display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px;\">\n                                    ${p25SimIdx >= 0 ? formatSlotDetails(simulations[p25SimIdx].slots) : 'No data'}\n                                </div>\n                            </div>\n\n                            <!-- Median Tab -->\n                            <div class=\"sim-detail-content\" data-strategy=\"${strategyKey}\" data-tab=\"median\" style=\"display: none;\">\n                                <div style=\"display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px;\">\n                                    ${medianSimIdx >= 0 ? formatSlotDetails(simulations[medianSimIdx].slots) : 'No data'}\n                                </div>\n                            </div>\n\n                            <!-- P75 Tab -->\n                            <div class=\"sim-detail-content\" data-strategy=\"${strategyKey}\" data-tab=\"p75\" style=\"display: none;\">\n                                <div style=\"display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px;\">\n                                    ${p75SimIdx >= 0 ? formatSlotDetails(simulations[p75SimIdx].slots) : 'No data'}\n                                </div>\n                            </div>\n\n                            <!-- Max Tab -->\n                            <div class=\"sim-detail-content\" data-strategy=\"${strategyKey}\" data-tab=\"max\" style=\"display: none;\">\n                                <div style=\"display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px;\">\n                                    ${maxSimIdx >= 0 ? formatSlotDetails(simulations[maxSimIdx].slots) : 'No data'}\n                                </div>\n                            </div>\n                        </div>\n                    </details>\n                </div>\n            </details>\n        `;\n    };\n\n    // Strategy names and descriptions\n    const strategyInfo: Record<string, { name: string; desc: string }> = {\n        worstFirst: { name: 'Worst First', desc: 'Always upgrades the slot currently providing the least DPS gain with a single cube at a time.' },\n        balancedThreshold: { name: 'Balanced Threshold', desc: 'Keeps all slots within a certain DPS gain range of each other, preventing over-investment in terrible slots.' },\n        hybridFastRarity: { name: 'Hybrid: Fast Rarity + Worst First', desc: 'First rushes all slots to Epic rarity, then switches to Worst First strategy for remaining cubes.' },\n        rarityWeightedWorstFirst: { name: 'Rarity-Weighted Worst First', desc: 'Like Worst First but factors in how close a slot is to its next rarity upgrade, prioritizing slots near upgrade thresholds.' },\n        dpOptimal: { name: 'DP Optimal', desc: 'Mathematically optimal strategy that cubes the slot with highest expected marginal DPS gain, accounting for tier-up probability and future rarity potential.' }\n    };\n\n    // Sort strategies by average gain (best first), filtering out dpOptimal\n    const sortedStrategies = Object.keys(results)\n        .filter(key => key !== 'dpOptimal')\n        .sort((a, b) => (results[b]?.avgGain || 0) - (results[a]?.avgGain || 0));\n\n    resultsDiv.innerHTML = `\n        <div style=\"margin-bottom: 20px;\">\n            <h3 style=\"color: var(--accent-primary); margin-bottom: 10px; font-size: 1.2em; font-weight: 600;\">\n                Simulation Results\n            </h3>\n            <p style=\"color: var(--text-secondary); font-size: 0.9em;\">\n                Cube Budget: ${cubeBudget} | Simulations: ${simulationCount}\n            </p>\n        </div>\n\n        ${sortedStrategies.map(strategyKey => {\n            const info = strategyInfo[strategyKey];\n            return formatStrategy(strategyKey, info.name, results[strategyKey], strategyKey === bestStrategy);\n        }).join('')}\n\n        <div style=\"background: linear-gradient(135deg, rgba(138, 43, 226, 0.1), rgba(75, 0, 130, 0.05)); border: 2px solid rgba(138, 43, 226, 0.3); border-radius: 12px; padding: 20px; margin-top: 20px;\">\n            <h4 style=\"color: var(--accent-primary); margin-bottom: 10px;\">Strategy Descriptions</h4>\n            <div style=\"color: var(--text-secondary); font-size: 0.9em; line-height: 1.6;\">\n                ${Object.keys(strategyInfo).filter(key => key !== 'dpOptimal').map(key => `\n                    <p style=\"margin-top: 8px;\"><strong>${strategyInfo[key].name}:</strong> ${strategyInfo[key].desc}</p>\n                `).join('')}\n            </div>\n        </div>\n    `;\n\n    // Store for chart creation (charts are created on-demand when tabs are shown)\n    (window as any).simulationResultsForCharts = { results, sortedStrategies, strategyInfo };\n\n    // Add event listeners to initialize charts when details are opened\n    resultsDiv.querySelectorAll('.sim-detail-results').forEach((details) => {\n        const detailsElement = details as HTMLDetailsElement;\n        detailsElement.addEventListener('toggle', () => {\n            if (detailsElement.open) {\n                const strategy = detailsElement.dataset.strategy;\n                if (!strategy) return;\n\n                // Initialize chart when details are opened (if not already created)\n                const canvas = detailsElement.querySelector('canvas') as HTMLCanvasElement;\n                if (canvas && !(canvas as any).chart) {\n                    const storedData = (window as any).simulationResultsForCharts;\n                    if (storedData && storedData.results && storedData.results[strategy]) {\n                        const strategyInfo = storedData.strategyInfo[strategy];\n                        const gains = storedData.results[strategy].totalGains;\n                        // Small delay to ensure the element is visible\n                        setTimeout(() => {\n                            createSimulationDistributionChart(canvas.id, gains, strategyInfo.name);\n                        }, 50);\n                    }\n                }\n\n                // Ensure Distribution tab button has active styling\n                const distributionTab = detailsElement.querySelector('.sim-detail-tab[data-tab=\"distribution\"]') as HTMLElement;\n                if (distributionTab) {\n                    distributionTab.classList.add('active');\n                    distributionTab.style.borderBottomColor = 'var(--accent-primary)';\n                }\n            }\n        });\n    });\n}\n\n/**\n * Create simulation distribution histogram chart\n */\nfunction createSimulationDistributionChart(canvasId: string, gains: number[], label: string): void {\n    const canvas = document.getElementById(canvasId) as HTMLCanvasElement;\n    if (!canvas) {\n        setTimeout(() => createSimulationDistributionChart(canvasId, gains, label), 50);\n        return;\n    }\n\n    // Create histogram\n    const sorted = [...gains].sort((a, b) => a - b);\n    const min = sorted[0];\n    const max = sorted[sorted.length - 1];\n    const bucketCount = 30;\n\n    // Handle case where all gains are the same (avoid division by zero)\n    let bucketSize = (max - min) / bucketCount;\n    if (bucketSize === 0) {\n        // All values are the same, create a single bucket\n        bucketSize = 1;\n    }\n\n    const buckets = new Array(bucketCount).fill(0);\n    const bucketLabels: string[] = [];\n\n    for (let i = 0; i < bucketCount; i++) {\n        const bucketStart = min + (i * bucketSize);\n        bucketLabels.push(bucketStart.toFixed(2));\n    }\n\n    sorted.forEach(gain => {\n        const bucketIndex = Math.min(\n            Math.floor((gain - min) / bucketSize),\n            bucketCount - 1\n        );\n        buckets[bucketIndex]++;\n    });\n\n    // Get theme colors\n    const isDark = document.documentElement.classList.contains('dark');\n    const textColor = isDark ? '#e5e7eb' : '#1f2937';\n    const gridColor = isDark ? 'rgba(55, 65, 81, 0.5)' : 'rgba(209, 213, 219, 0.5)';\n\n    // Destroy existing chart if any\n    const existingChart = (canvas as any).chart;\n    if (existingChart) {\n        existingChart.destroy();\n    }\n\n    // Create new chart\n    (canvas as any).chart = new Chart(canvas, {\n        type: 'bar',\n        data: {\n            labels: bucketLabels,\n            datasets: [{\n                label: 'Simulations',\n                data: buckets,\n                backgroundColor: 'rgba(59, 130, 246, 0.6)',\n                borderColor: 'rgba(59, 130, 246, 1)',\n                borderWidth: 1\n            }]\n        },\n        options: {\n            responsive: true,\n            maintainAspectRatio: true,\n            aspectRatio: 2.5,\n            plugins: {\n                legend: { display: false },\n                title: {\n                    display: true,\n                    text: `${label} - DPS Gain Distribution`,\n                    color: textColor,\n                    font: { size: 14, weight: 'bold' }\n                },\n                tooltip: {\n                    callbacks: {\n                        title: function(context: any) {\n                            const idx = context[0].dataIndex;\n                            const start = parseFloat(bucketLabels[idx]);\n                            const end = start + bucketSize;\n                            return `${start.toFixed(2)}% - ${end.toFixed(2)}%`;\n                        },\n                        label: function(context: any) {\n                            const count = buckets[context.dataIndex];\n                            const total = buckets.reduce((a: number, b: number) => a + b, 0);\n                            const percentage = ((count / total) * 100).toFixed(1);\n                            return `${count} simulations (${percentage}%)`;\n                        }\n                    }\n                }\n            },\n            scales: {\n                x: {\n                    display: false,\n                    grid: { display: false }\n                },\n                y: {\n                    display: true,\n                    grid: { color: gridColor },\n                    ticks: { color: textColor }\n                }\n            }\n        }\n    });\n}\n\n/**\n * Setup simulation button\n */\nfunction setupSimulationButton(): void {\n    const simulationButton = document.getElementById('cube-simulation-run-btn');\n    if (!simulationButton) return;\n\n    simulationButton.addEventListener('click', () => {\n        handleRunSimulation().catch(err => {\n            console.error('Simulation failed:', err);\n        });\n    });\n}\n\n// ============================================================================\n// UI UPDATE FUNCTIONS\n// ============================================================================\n\n/**\n * Update slot button colors based on rarity\n */\nexport function updateSlotButtonColors(): void {\n    const cubeData = gearLabStore.getCubeSlotData();\n    if (!cubeData) return;\n\n    SLOT_NAMES.forEach(slot => {\n        const slotBtn = document.querySelector(`.cube-slot-btn[data-slot=\"${slot.id}\"]`) as HTMLElement;\n        if (!slotBtn) return;\n\n        const slotRarity = cubeData[slot.id]?.[currentPotentialType]?.rarity || 'normal';\n        const rarityColor = getRarityColor(slotRarity);\n        slotBtn.style.borderColor = rarityColor;\n\n        const isActive = slot.id === currentCubeSlot;\n        if (isActive) {\n            slotBtn.style.boxShadow = `0 4px 16px ${rarityColor}60, 0 0 0 2px ${rarityColor}`;\n        } else {\n            slotBtn.style.boxShadow = `0 2px 8px ${rarityColor}40`;\n        }\n    });\n}\n\n/**\n * Update potential type button states\n */\nfunction updatePotentialTypeButtons(): void {\n    const regularBtn = document.getElementById('cube-regular-potential-btn');\n    const bonusBtn = document.getElementById('cube-bonus-potential-btn');\n\n    if (regularBtn && bonusBtn) {\n        regularBtn.classList.toggle('active', currentPotentialType === 'regular');\n        bonusBtn.classList.toggle('active', currentPotentialType === 'bonus');\n    }\n}\n\n/**\n * Update potential line dropdowns for a set\n */\nfunction updatePotentialLineDropdowns(setName: 'setA' | 'setB', rarity: Rarity): void {\n    const potentialData = EQUIPMENT_POTENTIAL_DATA[rarity];\n    if (!potentialData) return;\n\n    for (let lineNum = 1; lineNum <= 3; lineNum++) {\n        const statSelect = document.getElementById(`cube-${setName}-line${lineNum}-stat`) as HTMLSelectElement;\n        if (!statSelect) continue;\n\n        // Clear existing options\n        statSelect.innerHTML = '<option value=\"\">-- Select Stat --</option>';\n\n        // Get available stats for this line\n        const lineKey = `line${lineNum}` as 'line1' | 'line2' | 'line3';\n        let lineData: PotentialLineEntry[] = [...(potentialData[lineKey] || [])];\n\n        // Add slot-specific lines if available\n        if (SLOT_SPECIFIC_POTENTIALS[currentCubeSlot] && SLOT_SPECIFIC_POTENTIALS[currentCubeSlot][rarity]) {\n            const slotSpecificLines = SLOT_SPECIFIC_POTENTIALS[currentCubeSlot][rarity][lineKey as keyof typeof SLOT_SPECIFIC_POTENTIALS[CubeSlotId][Rarity]];\n            if (slotSpecificLines) {\n                lineData = [...slotSpecificLines, ...lineData];\n            }\n        }\n\n        if (!lineData || lineData.length === 0) continue;\n\n        // Build unique stat list with values\n        const statOptions = new Map<string, { text: string; stat: string; value: number; prime: boolean }>();\n\n        lineData.forEach(entry => {\n            const isPercentStat = entry.stat.includes('%');\n            const valueSuffix = isPercentStat ? '%' : '';\n            const displayText = entry.prime\n                ? `${entry.stat} - ${entry.value}${valueSuffix} (Prime)`\n                : `${entry.stat} - ${entry.value}${valueSuffix}`;\n\n            const key = `${entry.stat}|${entry.value}|${entry.prime}`;\n            statOptions.set(key, {\n                text: displayText,\n                stat: entry.stat,\n                value: entry.value,\n                prime: entry.prime\n            });\n        });\n\n        // Add options to dropdown\n        statOptions.forEach((opt, key) => {\n            const option = document.createElement('option');\n            option.value = key;\n            option.textContent = opt.text;\n            option.dataset.stat = opt.stat;\n            option.dataset.value = opt.value.toString();\n            option.dataset.prime = opt.prime.toString();\n            statSelect.appendChild(option);\n        });\n\n        // Add change listener\n        statSelect.addEventListener('change', (e) => {\n            const selectedOption = statSelect.selectedOptions[0];\n            if (selectedOption && selectedOption.dataset.value) {\n                const [stat, value, prime] = (e.target as HTMLSelectElement).value.split('|');\n                gearLabStore.updateCubeLine(\n                    currentCubeSlot,\n                    currentPotentialType,\n                    setName,\n                    lineNum as 1 | 2 | 3,\n                    { stat, value: parseFloat(value), prime: prime === 'true' }\n                );\n            } else {\n                gearLabStore.updateCubeLine(\n                    currentCubeSlot,\n                    currentPotentialType,\n                    setName,\n                    lineNum as 1 | 2 | 3,\n                    { stat: '', value: 0, prime: false }\n                );\n            }\n\n            calculateComparisonAndDisplay();\n        });\n    }\n\n    // Restore saved values\n    restorePotentialLineValues(setName);\n}\n\n/**\n * Restore saved values to potential line dropdowns\n */\nfunction restorePotentialLineValues(setName: 'setA' | 'setB'): void {\n    const cubeData = gearLabStore.getCubeSlotData();\n    if (!cubeData) return;\n\n    const setData = cubeData[currentCubeSlot][currentPotentialType][setName];\n\n    for (let lineNum = 1; lineNum <= 3; lineNum++) {\n        const lineKey = `line${lineNum}` as 'line1' | 'line2' | 'line3';\n        const line = setData[lineKey];\n        const statSelect = document.getElementById(`cube-${setName}-line${lineNum}-stat`) as HTMLSelectElement;\n\n        if (!statSelect) continue;\n\n        if (!line || !line.stat) {\n            statSelect.value = '';\n            continue;\n        }\n\n        // Find matching option\n        const key = `${line.stat}|${line.value}|${line.prime}`;\n        const option = Array.from(statSelect.options).find(opt => opt.value === key);\n\n        if (option) {\n            statSelect.value = key;\n        } else {\n            statSelect.value = '';\n        }\n    }\n}\n\n/**\n * Update cube potential UI\n */\nexport function updateCubePotentialUI(): void {\n    const cubeData = gearLabStore.getCubeSlotData();\n    if (!cubeData) return;\n\n    const rarity = cubeData[currentCubeSlot][currentPotentialType].rarity;\n\n    // Update dropdowns for Set A and Set B\n    updatePotentialLineDropdowns('setA', rarity);\n    updatePotentialLineDropdowns('setB', rarity);\n\n    // Calculate and display comparison\n    calculateComparisonAndDisplay();\n}\n\n/**\n * Update class warning banner\n */\nexport function updateClassWarning(): void {\n    const warningBanner = document.getElementById('cube-class-warning');\n    if (!warningBanner) return;\n\n    if (!loadoutStore.getSelectedClass()) {\n        warningBanner.style.display = 'block';\n    } else {\n        warningBanner.style.display = 'none';\n    }\n}\n\n// ============================================================================\n// COMPARISON DISPLAY\n// ============================================================================\n\n/**\n * Calculate comparison and display results\n */\nfunction calculateComparisonAndDisplay(): void {\n    if (!loadoutStore.getSelectedClass()) {\n        updateClassWarning();\n        return;\n    }\n\n    const cubeData = gearLabStore.getCubeSlotData();\n    if (!cubeData) return;\n\n    const result = calculateComparison(cubeData, currentCubeSlot, currentPotentialType);\n    if (!result) return;\n\n    displayComparisonResults(result);\n}\n\n/**\n * Display comparison results\n */\nfunction displayComparisonResults(result: {\n    setAGain: number;\n    setBGain: number;\n    setBAbsoluteGain: number;\n    deltaGain: number;\n    setAStats: any;\n    setBStats: any;\n}): void {\n    const resultsDiv = document.getElementById('cube-comparison-results');\n    if (!resultsDiv) return;\n\n    const { setAGain, setBGain, setBAbsoluteGain } = result;\n\n    resultsDiv.innerHTML = `\n        <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;\">\n            <div style=\"background: linear-gradient(135deg, rgba(52, 199, 89, 0.1), rgba(0, 122, 255, 0.05)); border: 2px solid var(--accent-success); border-radius: 12px; padding: 20px; box-shadow: 0 4px 16px var(--shadow); text-align: center;\">\n                <div style=\"font-size: 0.9em; color: var(--text-secondary); margin-bottom: 8px;\">Set A Gain<br><span style=\"font-size: 0.85em;\">(vs Baseline)</span></div>\n                <div style=\"font-size: 1.8em; font-weight: 700; color: ${setAGain >= 0 ? '#4ade80' : '#f87171'};\">\n                    ${setAGain >= 0 ? '+' : ''}${setAGain.toFixed(2)}%\n                </div>\n            </div>\n            <div style=\"background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(147, 51, 234, 0.05)); border: 2px solid #3b82f6; border-radius: 12px; padding: 20px; box-shadow: 0 4px 16px var(--shadow); text-align: center;\">\n                <div style=\"font-size: 0.9em; color: var(--text-secondary); margin-bottom: 8px;\">Set B Gain<br><span style=\"font-size: 0.85em;\">(vs Set A)</span></div>\n                <div style=\"font-size: 1.8em; font-weight: 700; color: ${setBGain >= 0 ? '#4ade80' : '#f87171'};\">\n                    ${setBGain >= 0 ? '+' : ''}${setBGain.toFixed(2)}%\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n// ============================================================================\n// RANKINGS DISPLAY\n// ============================================================================\n\n/**\n * Ranking entry interface\n */\ninterface RankingEntry {\n    line1: PotentialLineEntry;\n    line2: PotentialLineEntry;\n    line3: PotentialLineEntry;\n    dpsGain: number;\n}\n\n/**\n * Display rankings with pagination\n */\nexport function displayRankings(rankings: RankingEntry[], rarity: Rarity): void {\n    const resultsDiv = document.getElementById('cube-rankings-results');\n    if (!resultsDiv) return;\n\n    const totalPages = Math.ceil(rankings.length / RANKINGS_PER_PAGE);\n    const startIdx = (currentRankingsPage - 1) * RANKINGS_PER_PAGE;\n    const endIdx = Math.min(startIdx + RANKINGS_PER_PAGE, rankings.length);\n    const pageRankings = rankings.slice(startIdx, endIdx);\n\n    let html = `\n        <div style=\"margin-bottom: 20px;\">\n            <h3 style=\"color: var(--tab-purple); margin-bottom: 10px;\">\n                Top Potential Combinations for ${rarity.charAt(0).toUpperCase() + rarity.slice(1)} Rarity\n            </h3>\n            <p style=\"color: var(--text-secondary); font-size: 0.9em;\">\n                Showing ${startIdx + 1}-${endIdx} of ${rankings.length} unique combinations\n            </p>\n        </div>\n        <div class=\"table-wrapper\">        \n        <table class=\"table\">\n            <thead>\n                <tr>\n                    <th>Rank</th>\n                    <th style=\"text-align: center;\">Line 1</th>\n                    <th style=\"text-align: center;\">Line 2</th>\n                    <th style=\"text-align: center;\">Line 3</th>\n                    <th>DPS Gain</th>\n                </tr>\n            </thead>\n            <tbody>\n    `;\n\n    pageRankings.forEach((combo, idx) => {\n        const rank = startIdx + idx + 1;\n        const formatLine = (line: PotentialLineEntry): string => {\n            const primeTag = line.prime ? ' <span style=\"color: var(--tab-purple); font-weight: 600;\">(Prime)</span>' : '';\n            const isPercentStat = line.stat.includes('%');\n            const valueSuffix = isPercentStat ? '%' : '';\n            return `${line.stat}: ${line.value}${valueSuffix}${primeTag}`;\n        };\n\n        html += `\n            <tr>\n                <td style=\"font-weight: 700; color: var(--tab-purple);\">#${rank}</td>\n                <td style=\"text-align: center;\">${formatLine(combo.line1)}</td>\n                <td style=\"text-align: center;\">${formatLine(combo.line2)}</td>\n                <td style=\"text-align: center;\">${formatLine(combo.line3)}</td>\n                <td><span class=\"gain-positive\">+${combo.dpsGain.toFixed(2)}%</span></td>\n            </tr>\n        `;\n    });\n\n    html += `\n            </tbody>\n        </table>\n        </div>\n        <div style=\"display: flex; justify-content: center; align-items: center; gap: 10px; margin-top: 20px;\">\n            <button onclick=\"window.changeCubeRankingsPage(${currentRankingsPage - 1})\"\n                    ${currentRankingsPage === 1 ? 'disabled' : ''}\n                    class=\"btn-primary\">Previous</button>\n            <span style=\"color: var(--text-secondary);\">Page ${currentRankingsPage} of ${totalPages}</span>\n            <button onclick=\"window.changeCubeRankingsPage(${currentRankingsPage + 1})\"\n                    ${currentRankingsPage === totalPages ? 'disabled' : ''}\n                    class=\"btn-primary\">Next</button>\n        </div>\n    `;\n\n    resultsDiv.innerHTML = html;\n}\n\n/**\n * Display or calculate rankings for a specific slot and rarity\n */\nexport async function displayOrCalculateRankingsForSlotAndRarity(\n    slotId: CubeSlotId,\n    rarity: Rarity\n): Promise<void> {\n    // Check if already calculated\n    if (rankingsCache[slotId]?.[rarity]) {\n        displayRankings(rankingsCache[slotId][rarity], rarity);\n        return;\n    }\n\n    // If calculation is in progress, show progress bar and wait\n    const key = `${slotId}-${rarity}`;\n    if (rankingsInProgress[key]) {\n        const progressBar = document.getElementById('cube-rankings-progress') as HTMLElement;\n        if (progressBar) progressBar.style.display = 'block';\n\n        let pollCount = 0;\n        const maxPolls = 600;\n        const checkInterval = setInterval(() => {\n            pollCount++;\n\n            if (rankingsCache[slotId]?.[rarity]) {\n                clearInterval(checkInterval);\n                displayRankings(rankingsCache[slotId][rarity], rarity);\n            } else if (!rankingsInProgress[key]) {\n                clearInterval(checkInterval);\n                calculateRankingsForRarity(rarity, slotId).then(() => {\n                    if (rankingsCache[slotId]?.[rarity]) {\n                        displayRankings(rankingsCache[slotId][rarity], rarity);\n                    }\n                });\n            } else if (pollCount >= maxPolls) {\n                clearInterval(checkInterval);\n                console.error('Rankings calculation timeout');\n                if (progressBar) progressBar.style.display = 'none';\n            }\n        }, 100);\n    } else {\n        // Not calculated and not in progress, start calculation\n        await calculateRankingsForRarity(rarity, slotId);\n        if (rankingsCache[slotId]?.[rarity]) {\n            displayRankings(rankingsCache[slotId][rarity], rarity);\n        }\n    }\n}\n\n/**\n * Display rankings for a specific rarity (uses independent selectors)\n */\nexport async function displayOrCalculateRankingsForRarity(rarity: Rarity): Promise<void> {\n    const slotSelector = document.getElementById('cube-rankings-slot-selector') as HTMLSelectElement;\n    const slotId = slotSelector ? slotSelector.value as CubeSlotId : currentCubeSlot;\n    await displayOrCalculateRankingsForSlotAndRarity(slotId, rarity);\n}\n\n/**\n * Change rankings page\n */\nexport function changeCubeRankingsPage(newPage: number): void {\n    changeRankingsPage(newPage);\n\n    // Refresh the display with the new page\n    const slotSelector = document.getElementById('cube-rankings-slot-selector') as HTMLSelectElement;\n    const raritySelector = document.getElementById('cube-rankings-rarity-selector') as HTMLSelectElement;\n\n    if (slotSelector && raritySelector) {\n        const slotId = slotSelector.value as CubeSlotId;\n        const rarity = raritySelector.value as Rarity;\n\n        if (rankingsCache[slotId]?.[rarity]) {\n            displayRankings(rankingsCache[slotId][rarity], rarity);\n        }\n    }\n}\n\n// ============================================================================\n// SUMMARY DISPLAY\n// ============================================================================\n\n/**\n * Load rankings for all slots and rarities needed for summary display\n * Skips slots that are already cached or currently being calculated\n */\nasync function loadAllRankingsForSummary(): Promise<void> {\n    if (!loadoutStore.getSelectedClass()) {\n        return; // Don't load rankings if no class is selected\n    }\n\n    const cubeData = gearLabStore.getCubeSlotData();\n    if (!cubeData) return;\n\n    const progressBar = document.getElementById('cube-summary-progress') as HTMLElement;\n    const progressFill = document.getElementById('cube-summary-progress-fill') as HTMLElement;\n    const progressText = document.getElementById('cube-summary-progress-text') as HTMLElement;\n\n    // Collect all unique slot+rarity combinations that need to be calculated\n    const calculationsNeeded: Array<{ slotId: CubeSlotId; rarity: Rarity }> = [];\n\n    SLOT_NAMES.forEach(slot => {\n        ['regular', 'bonus'].forEach(potentialType => {\n            const rarity = cubeData[slot.id][potentialType as PotentialType].rarity;\n            const key = `${slot.id}-${rarity}`;\n\n            // Skip if already cached or currently in progress\n            if (!rankingsCache[slot.id]?.[rarity] && !rankingsInProgress[key]) {\n                calculationsNeeded.push({ slotId: slot.id, rarity });\n            }\n        });\n    });\n\n    if (calculationsNeeded.length === 0) {\n        return; // All rankings already loaded or in progress\n    }\n\n    // Show progress bar\n    if (progressBar) progressBar.style.display = 'block';\n    if (progressText) progressText.textContent = `Loading rankings for ${calculationsNeeded.length} slot(s)...`;\n\n    // Track completed count with proper synchronization\n    let completed = 0;\n    const total = calculationsNeeded.length;\n\n    // Process calculations in parallel (but don't wait for all to complete before showing initial results)\n    const promises = calculationsNeeded.map(async ({ slotId, rarity }) => {\n        try {\n            await calculateRankingsForRarity(rarity, slotId);\n        } catch (error) {\n            console.error(`Failed to load rankings for ${slotId}-${rarity}:`, error);\n        } finally {\n            // Increment completed count and update progress\n            completed++;\n            if (progressFill && progressBar) {\n                progressFill.style.width = `${(completed / total) * 100}%`;\n            }\n            if (progressText) {\n                progressText.textContent = `Loading rankings... ${completed}/${total}`;\n            }\n        }\n    });\n\n    // Wait for all calculations to complete\n    await Promise.all(promises);\n\n    // Hide progress bar and refresh summary with updated rankings\n    if (progressBar) progressBar.style.display = 'none';\n    displayAllSlotsSummary();\n}\n\n/**\n * Display summary of all slots\n */\nfunction displayAllSlotsSummary(): void {\n    const resultsDiv = document.getElementById('cube-summary-results');\n    if (!resultsDiv) return;\n\n    if (!loadoutStore.getSelectedClass()) {\n        resultsDiv.innerHTML = '<p style=\"text-align: center; color: var(--text-secondary);\">Please select a class to view summary.</p>';\n        return;\n    }\n\n    const cubeData = gearLabStore.getCubeSlotData();\n    if (!cubeData) return;\n\n    const currentStats = loadoutStore.getBaseStats();\n\n    // Calculate DPS gain for each slot + potential type\n    const summaryData: Array<{\n        slotId: CubeSlotId;\n        slotName: string;\n        regularGain: number;\n        regularRarity: Rarity;\n        bonusGain: number;\n        bonusRarity: Rarity;\n    }> = [];\n\n    SLOT_NAMES.forEach(slot => {\n        // Regular Potential\n        const regularData = cubeData[slot.id].regular;\n        const regularResult = calculateSlotSetGain(slot.id, regularData.rarity, regularData.setA, regularData.setA, currentStats);\n        const regularGain = regularResult.gain;\n\n        // Bonus Potential\n        const bonusData = cubeData[slot.id].bonus;\n        const bonusResult = calculateSlotSetGain(slot.id, bonusData.rarity, bonusData.setA, bonusData.setA, currentStats);\n        const bonusGain = bonusResult.gain;\n\n        summaryData.push({\n            slotId: slot.id,\n            slotName: slot.name,\n            regularGain,\n            regularRarity: regularData.rarity,\n            bonusGain,\n            bonusRarity: bonusData.rarity\n        });\n    });\n\n    // Sort by selected column\n    if (summarySortColumn === 'regular') {\n        summaryData.sort((a, b) => summarySortDescending ? b.regularGain - a.regularGain : a.regularGain - b.regularGain);\n    } else {\n        summaryData.sort((a, b) => summarySortDescending ? b.bonusGain - a.bonusGain : a.bonusGain - b.bonusGain);\n    }\n\n    // Build HTML table with sortable headers\n    const regularSortIndicator = summarySortColumn === 'regular' ? (summarySortDescending ? ' \u25BC' : ' \u25B2') : '';\n    const bonusSortIndicator = summarySortColumn === 'bonus' ? (summarySortDescending ? ' \u25BC' : ' \u25B2') : '';\n\n    let html = `\n        <div class=\"table-wrapper\">\n        <table class=\"table\">\n            <thead>\n                <tr>\n                    <th style=\"text-align: center;\">Slot</th>\n                    <th style=\"text-align: center; cursor: pointer; user-select: none;\" onclick=\"window.sortCubeSummaryBy('regular')\">\n                        Regular Potential${regularSortIndicator}<br>\n                        <span style=\"font-size: 0.8em; font-weight: 400;\">(Set A Gain)</span>\n                    </th>\n                    <th style=\"text-align: center; cursor: pointer; user-select: none;\" onclick=\"window.sortCubeSummaryBy('bonus')\">\n                        Bonus Potential${bonusSortIndicator}<br>\n                        <span style=\"font-size: 0.8em; font-weight: 400;\">(Set A Gain)</span>\n                    </th>\n                </tr>\n            </thead>\n            <tbody>\n    `;\n\n    summaryData.forEach((data) => {\n        // Format regular potential display\n        let regularDisplay: string;\n        if (data.regularGain === 0) {\n            regularDisplay = '<span style=\"color: var(--text-secondary); font-size: 0.9em;\">No stats</span>';\n        } else {\n            const regularPercentile = getPercentileForGain(data.slotId, data.regularRarity, data.regularGain, rankingsCache, rankingsInProgress);\n            regularDisplay = `\n                <span style=\"color: ${data.regularGain >= 0 ? '#4ade80' : '#f87171'}; font-weight: 600;\">\n                    ${data.regularGain >= 0 ? '+' : ''}${data.regularGain.toFixed(2)}%\n                </span>\n                <span style=\"font-size: 0.8em; color: var(--text-secondary); margin: 0 4px;\">\n                    ${data.regularRarity.charAt(0).toUpperCase() + data.regularRarity.slice(1)}\n                </span>\n                <span style=\"font-size: 0.8em;\">\n                    ${regularPercentile}\n                </span>\n            `;\n        }\n\n        // Format bonus potential display\n        let bonusDisplay: string;\n        if (data.bonusGain === 0) {\n            bonusDisplay = '<span style=\"color: var(--text-secondary); font-size: 0.9em;\">No stats</span>';\n        } else {\n            const bonusPercentile = getPercentileForGain(data.slotId, data.bonusRarity, data.bonusGain, rankingsCache, rankingsInProgress);\n            bonusDisplay = `\n                <span style=\"color: ${data.bonusGain >= 0 ? '#4ade80' : '#f87171'}; font-weight: 600;\">\n                    ${data.bonusGain >= 0 ? '+' : ''}${data.bonusGain.toFixed(2)}%\n                </span>\n                <span style=\"font-size: 0.8em; color: var(--text-secondary); margin: 0 4px;\">\n                    ${data.bonusRarity.charAt(0).toUpperCase() + data.bonusRarity.slice(1)}\n                </span>\n                <span style=\"font-size: 0.8em;\">\n                    ${bonusPercentile}\n                </span>\n            `;\n        }\n\n        html += `\n            <tr>\n                <td style=\"font-weight: 600; text-align: center;\">${data.slotName}</td>\n                <td style=\"text-align: center;\">${regularDisplay}</td>\n                <td style=\"text-align: center;\">${bonusDisplay}</td>\n            </tr>\n        `;\n    });\n\n    html += `\n            </tbody>\n        </table>\n        </div>\n    `;\n\n    resultsDiv.innerHTML = html;\n}\n\n/**\n * Sort summary by column\n */\nexport function sortCubeSummaryBy(column: 'regular' | 'bonus'): void {\n    if (summarySortColumn === column) {\n        summarySortDescending = !summarySortDescending;\n    } else {\n        summarySortColumn = column;\n        summarySortDescending = true;\n    }\n    displayAllSlotsSummary();\n}\n\n// ============================================================================\n// GLOBAL FUNCTION EXPOSURE\n// ============================================================================\n\n/**\n * Expose functions to window for HTML onclick handlers\n */\nfunction exposeGlobalFunctions(): void {\n    (window as any).switchCubePotentialType = switchPotentialType;\n    (window as any).selectCubeSlot = selectCubeSlot;\n    (window as any).sortCubeSummaryBy = sortCubeSummaryBy;\n    (window as any).changeCubeRankingsPage = changeCubeRankingsPage;\n    (window as any).switchSimDetailTab = switchSimDetailTab;\n}\n\n/**\n * Change rankings page\n */\nexport function changeRankingsPage(newPage: number): void {\n    currentRankingsPage = newPage;\n    // Rankings display will be updated when tab is visible\n}\n\n// ============================================================================\n// SIMULATION DISPLAY HELPERS\n// ============================================================================\n\n/**\n * Format slot details for simulation display\n */\nexport function formatSlotDetails(slots: any[]): string {\n    return slots.map((slot) => {\n        const linesHTML = slot.lines && slot.lines.length > 0\n            ? slot.lines.map((line: PotentialLineEntry | null, i: number) => {\n                if (!line) return '';\n                const isPercentStat = line.stat.includes('%');\n                const valueSuffix = isPercentStat ? '%' : '';\n                const primeTag = line.prime ? ' <span style=\"color: var(--accent-primary); font-weight: 600;\">(P)</span>' : '';\n                return `L${i+1}: ${line.stat} ${line.value}${valueSuffix}${primeTag}`;\n            }).join('<br>')\n            : 'No lines';\n\n        return `\n            <div class=\"sim-slot-card\">\n                <div class=\"sim-slot-card-header\">\n                    ${slot.name} [${slot.rarity.toUpperCase()}]\n                </div>\n                <div class=\"sim-slot-card-lines\">\n                    ${linesHTML}\n                </div>\n                <div class=\"sim-slot-card-gain\">\n                    DPS Gain: +${slot.dpsGain.toFixed(2)}%\n                </div>\n            </div>\n        `;\n    }).join('');\n}\n\n/**\n * Switch between simulation detail tabs\n */\nexport function switchSimDetailTab(strategy: string, tab: string): void {\n    // Update tab buttons\n    document.querySelectorAll(`.sim-detail-tab[data-strategy=\"${strategy}\"]`).forEach(btn => {\n        const button = btn as HTMLElement;\n        if (button.dataset.tab === tab) {\n            button.classList.add('active');\n            button.style.borderBottomColor = 'var(--accent-primary)';\n        } else {\n            button.classList.remove('active');\n            button.style.borderBottomColor = 'transparent';\n        }\n    });\n\n    // Find the specific details container for this strategy\n    const detailsContainer = document.getElementById(`sim-details-${strategy}`);\n    if (!detailsContainer) {\n        console.error(`Details container for strategy \"${strategy}\" not found`);\n        return;\n    }\n\n    // Update content visibility - only within this strategy's details container\n    detailsContainer.querySelectorAll(`.sim-detail-content[data-strategy=\"${strategy}\"]`).forEach(content => {\n        const element = content as HTMLElement;\n        const shouldShow = element.dataset.tab === tab;\n        element.style.display = shouldShow ? 'block' : 'none';\n\n        // Create chart when Distribution tab is shown (charts don't render properly in hidden elements)\n        if (shouldShow && tab === 'distribution') {\n            const canvas = element.querySelector('canvas') as HTMLCanvasElement;\n            if (canvas && !(canvas as any).chart) {\n                // Get the stored simulation results and create the chart\n                const storedData = (window as any).simulationResultsForCharts;\n                if (storedData && storedData.results && storedData.results[strategy]) {\n                    const strategyInfo = storedData.strategyInfo[strategy];\n                    const gains = storedData.results[strategy].totalGains;\n                    // Small delay to ensure the element is visible\n                    setTimeout(() => {\n                        createSimulationDistributionChart(canvas.id, gains, strategyInfo.name);\n                    }, 50);\n                }\n            }\n        }\n    });\n}\n"],
  "mappings": "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",
  "names": ["strategyInfo"]
}
