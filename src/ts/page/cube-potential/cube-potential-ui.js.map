{
  "version": 3,
  "sources": ["cube-potential-ui.ts"],
  "sourcesContent": ["/**\r\n * Cube Potential UI\r\n * HTML generation and event handlers for the cube potential tab\r\n */\r\n\r\nimport {\r\n    currentCubeSlot,\r\n    currentPotentialType,\r\n    rankingsCache,\r\n    rankingsInProgress,\r\n    switchPotentialType,\r\n    selectCubeSlot,\r\n    clearCubeRankingsCache,\r\n    getRarityColor,\r\n    calculateComparison,\r\n    getPercentileForGain,\r\n    initializeCubePotential\r\n} from '@ts/page/cube-potential/cube-potential.js';\r\nimport { gearLabStore } from '@ts/store/gear-lab-store.js';\r\nimport { Chart } from 'chart.js/auto';\r\nimport {\r\n    SLOT_NAMES,\r\n    SLOT_SPECIFIC_POTENTIALS,\r\n    EQUIPMENT_POTENTIAL_DATA,\r\n    RANKINGS_PER_PAGE\r\n} from '@ts/page/cube-potential/cube-potential-data.js';\r\nimport { calculateRankingsForRarity, runCubeSimulation } from '@ts/page/cube-potential/cube-simulation.js';\r\nimport type {\r\n    CubeSlotId,\r\n    PotentialType,\r\n    Rarity,\r\n    PotentialLineEntry\r\n} from '@ts/types/page/gear-lab/gear-lab.types';\r\nimport { calculateSlotSetGain } from '@ts/page/cube-potential/cube-potential.js';\r\nimport { loadoutStore } from '@ts/store/loadout.store';\r\nimport { debounce } from '@ts/utils/event-emitter';\r\n\r\n// ============================================================================\r\n// STATE\r\n// ============================================================================\r\n\r\n/**\r\n * Current page for rankings pagination\r\n */\r\nlet currentRankingsPage = 1;\r\n\r\n/**\r\n * Summary sort column and direction\r\n */\r\nlet summarySortColumn: 'regular' | 'bonus' = 'regular';\r\nlet summarySortDescending = true;\r\n\r\n// ============================================================================\r\n// HTML GENERATION\r\n// ============================================================================\r\n\r\n/**\r\n * Generate the complete HTML for the cube potential tab\r\n */\r\nexport function generateCubePotentialHTML(): string {\r\n    return `\r\n        <!-- Class Warning Banner -->\r\n        <div id=\"cube-class-warning\" class=\"optimization-info-banner optimization-info-banner--warning\" style=\"display: none;\">\r\n            <span class=\"optimization-info-banner-icon\">\u26A0\uFE0F</span>\r\n            <div>\r\n                <div style=\"font-weight: 700; font-size: 1em; margin-bottom: 4px;\">No Class Selected</div>\r\n                <div style=\"color: var(--text-secondary); font-size: 0.9em;\">Please select your class in the Hero Power section above to use the Cube Potential calculator. Class selection is needed to properly calculate stat damage gains.</div>\r\n            </div>\r\n        </div>\r\n\r\n        <!-- Flattened Main Tab Navigation -->\r\n        <div id=\"tab-container-main\" class=\"cube-main-tabs\">\r\n            <button id=\"cube-main-tab-comparison\" class=\"tab-button active\" data-tab=\"comparison\">\r\n                <span class=\"cube-tab-label\">Comparison</span>\r\n            </button>\r\n            <button id=\"cube-main-tab-rankings\" class=\"tab-button\" data-tab=\"rankings\">\r\n                <span class=\"cube-tab-label\">Best Potentials</span>\r\n            </button>\r\n            <button id=\"cube-main-tab-summary\" class=\"tab-button\" data-tab=\"summary\">\r\n                <span class=\"cube-tab-label\">All Slots Summary</span>\r\n            </button>\r\n            <button id=\"cube-main-tab-simulation\" class=\"tab-button\" data-tab=\"simulation\">\r\n                <span class=\"cube-tab-label\">Simulation</span>\r\n            </button>\r\n            <button id=\"cube-main-tab-optimal\" class=\"tab-button\" style=\"display:none;\" data-tab=\"optimal\">\r\n                <span class=\"cube-tab-label\">Optimal Strategy</span>\r\n            </button>\r\n        </div>\r\n\r\n        <!-- Comparison Tab Content -->\r\n        <div id=\"cube-comparison-content\" class=\"cube-tab-content active\">\r\n            ${generateComparisonTabHTML()}\r\n        </div>\r\n\r\n        <!-- Best Potentials Tab Content -->\r\n        <div id=\"cube-rankings-content\" class=\"cube-tab-content\">\r\n            ${generateRankingsTabHTML()}\r\n        </div>\r\n\r\n        <!-- All Slots Summary Tab Content -->\r\n        <div id=\"cube-summary-content\" class=\"cube-tab-content\">\r\n            ${generateSummaryTabHTML()}\r\n        </div>\r\n\r\n        <!-- Simulation Tab Content -->\r\n        <div id=\"cube-simulation-content\" class=\"cube-tab-content\">\r\n            ${generateSimulationTabHTML()}\r\n        </div>\r\n\r\n        <!-- Optimal Strategy Tab Content -->\r\n        <div id=\"cube-optimal-content\" class=\"cube-tab-content\">\r\n            ${generateOptimalTabHTML()}\r\n        </div>\r\n    `;\r\n}\r\n\r\n/**\r\n * Generate HTML for the Comparison tab\r\n */\r\nfunction generateComparisonTabHTML(): string {\r\n    return `\r\n        <!-- Equipment Slot Selector -->\r\n        <div class=\"cube-slot-selector-wrapper\">\r\n            <label for=\"cube-slot-selector\" class=\"cube-slot-label\">Equipment Slot</label>\r\n            <div id=\"cube-slot-selector\" class=\"cube-slot-buttons-container\"></div>\r\n        </div>\r\n\r\n        <!-- Context Controls for Comparison Tab (Potential Type & Rarity) -->\r\n        <div id=\"cube-comparison-controls\" class=\"cube-context-controls\" style=\"display: block;\">\r\n            <div class=\"cube-controls-grid\">\r\n                <!-- Potential Type Toggle -->\r\n                <div class=\"cube-control-group\">\r\n                    <label class=\"cube-control-label\">Potential Type</label>\r\n                    <div class=\"cube-potential-type-buttons\">\r\n                        <button id=\"cube-regular-potential-btn\" class=\"cube-potential-type-btn active\">\r\n                            <span class=\"cube-type-icon\">\u2726</span>\r\n                            <span>Regular</span>\r\n                        </button>\r\n                        <button id=\"cube-bonus-potential-btn\" class=\"cube-potential-type-btn\">\r\n                            <span class=\"cube-type-icon\">\u2727</span>\r\n                            <span>Bonus</span>\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n\r\n                <!-- Rarity Selector -->\r\n                <div class=\"cube-rarity-row\">\r\n                    <div class=\"cube-control-group\">\r\n                        <label for=\"cube-rarity-selector\" class=\"cube-control-label\">Slot Rarity</label>\r\n                        <select id=\"cube-rarity-selector\" class=\"cube-rarity-select\">\r\n                            <option value=\"normal\">Normal</option>\r\n                            <option value=\"rare\">Rare</option>\r\n                            <option value=\"epic\">Epic</option>\r\n                            <option value=\"unique\">Unique</option>\r\n                            <option value=\"legendary\">Legendary</option>\r\n                            <option value=\"mystic\">Mystic</option>\r\n                        </select>\r\n                    </div>\r\n\r\n                    <div class=\"cube-roll-count-container\">\r\n                        <label for=\"cube-roll-count\" style=\"font-size: 0.85em; color: var(--text-secondary);\">\r\n                            Rolls at current rarity\r\n                        </label>\r\n                        <input type=\"number\" id=\"cube-roll-count\" min=\"0\" max=\"999\" value=\"0\"\r\n                               style=\"width: 80px; padding: 8px 12px; border-radius: 8px;\r\n                                      border: 1px solid var(--border-color); background: var(--bg-secondary);\r\n                                      color: var(--text-primary); font-size: 0.95em;\">\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n        <div class=\"cube-comparison-grid\">\r\n            <!-- Set A (Current) Card -->\r\n            <div class=\"cube-set-card cube-set-card--a\">\r\n                <div class=\"cube-set-card-header\">\r\n                    <h3 class=\"cube-set-card-title\">Set A (Current)</h3>\r\n                    <span class=\"cube-set-card-subtitle\">Your configured potential</span>\r\n                </div>\r\n\r\n                <div class=\"cube-set-card-body\">\r\n                    <div class=\"cube-line-input-group\">\r\n                        <label class=\"cube-line-label\" for=\"cube-setA-line1-stat\">Line 1</label>\r\n                        <select id=\"cube-setA-line1-stat\" class=\"cube-line-select\"></select>\r\n                    </div>\r\n\r\n                    <div class=\"cube-line-input-group\">\r\n                        <label class=\"cube-line-label\" for=\"cube-setA-line2-stat\">Line 2</label>\r\n                        <select id=\"cube-setA-line2-stat\" class=\"cube-line-select\"></select>\r\n                    </div>\r\n\r\n                    <div class=\"cube-line-input-group\">\r\n                        <label class=\"cube-line-label\" for=\"cube-setA-line3-stat\">Line 3</label>\r\n                        <select id=\"cube-setA-line3-stat\" class=\"cube-line-select\"></select>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <!-- Set B (Comparison) Card -->\r\n            <div class=\"cube-set-card cube-set-card--b\">\r\n                <div class=\"cube-set-card-header\">\r\n                    <h3 class=\"cube-set-card-title\">Set B (Comparison)</h3>\r\n                    <span class=\"cube-set-card-subtitle\">Test alternative potential</span>\r\n                </div>\r\n\r\n                <div class=\"cube-set-card-body\">\r\n                    <div class=\"cube-line-input-group\">\r\n                        <label class=\"cube-line-label\" for=\"cube-setB-line1-stat\">Line 1</label>\r\n                        <select id=\"cube-setB-line1-stat\" class=\"cube-line-select\"></select>\r\n                    </div>\r\n\r\n                    <div class=\"cube-line-input-group\">\r\n                        <label class=\"cube-line-label\" for=\"cube-setB-line2-stat\">Line 2</label>\r\n                        <select id=\"cube-setB-line2-stat\" class=\"cube-line-select\"></select>\r\n                    </div>\r\n\r\n                    <div class=\"cube-line-input-group\">\r\n                        <label class=\"cube-line-label\" for=\"cube-setB-line3-stat\">Line 3</label>\r\n                        <select id=\"cube-setB-line3-stat\" class=\"cube-line-select\"></select>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n        <!-- Comparison Results -->\r\n        <div id=\"cube-comparison-results\" class=\"cube-results-section\"></div>\r\n    `;\r\n}\r\n\r\n/**\r\n * Generate HTML for the Rankings tab\r\n */\r\nfunction generateRankingsTabHTML(): string {\r\n    return `\r\n        <!-- Controls for Rankings (Independent slot & rarity selectors) -->\r\n        <div id=\"cube-rankings-controls\" class=\"cube-context-controls\" style=\"display: block;\">\r\n            <div class=\"cube-controls-grid\">\r\n                <!-- Slot Selector -->\r\n                <div class=\"cube-control-group\">\r\n                    <label for=\"cube-rankings-slot-selector\" class=\"cube-control-label\">Equipment Slot</label>\r\n                    <select id=\"cube-rankings-slot-selector\" class=\"cube-rarity-select\">\r\n                        <!-- Populated by JavaScript -->\r\n                    </select>\r\n                    <p style=\"font-size: 0.85em; color: var(--text-secondary); margin-top: var(--cube-space-sm);\">\r\n                        Some slots have unique potential lines available only to them\r\n                    </p>\r\n                </div>\r\n\r\n                <!-- Rarity Selector -->\r\n                <div class=\"cube-control-group\">\r\n                    <label for=\"cube-rankings-rarity-selector\" class=\"cube-control-label\">Rarity Tier</label>\r\n                    <select id=\"cube-rankings-rarity-selector\" class=\"cube-rarity-select\">\r\n                        <option value=\"normal\">Normal</option>\r\n                        <option value=\"rare\">Rare</option>\r\n                        <option value=\"epic\" selected>Epic</option>\r\n                        <option value=\"unique\">Unique</option>\r\n                        <option value=\"legendary\">Legendary</option>\r\n                        <option value=\"mystic\">Mystic</option>\r\n                    </select>\r\n                    <p style=\"font-size: 0.85em; color: var(--text-secondary); margin-top: var(--cube-space-sm);\">\r\n                        View best combinations for this rarity (independent of saved config)\r\n                    </p>\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n        <!-- Progress Bar -->\r\n        <div id=\"cube-rankings-progress\" class=\"cube-progress-bar\" style=\"display: none;\">\r\n            <div class=\"cube-progress-track\">\r\n                <div id=\"cube-rankings-progress-fill\" class=\"cube-progress-fill\"></div>\r\n            </div>\r\n            <p id=\"cube-rankings-progress-text\" class=\"cube-progress-text\">Calculating best combinations...</p>\r\n        </div>\r\n\r\n        <!-- Rankings Results -->\r\n        <div id=\"cube-rankings-results\" class=\"cube-rankings-results\"></div>\r\n    `;\r\n}\r\n\r\n/**\r\n * Generate HTML for the Summary tab\r\n */\r\nfunction generateSummaryTabHTML(): string {\r\n    return `\r\n        <div class=\"cube-summary-header\">\r\n            <h3 class=\"cube-summary-title\">All Slots Potential Summary</h3>\r\n            <p class=\"cube-summary-description\">Overview of Set A DPS gains for all equipment slots (Regular and Bonus Potential)</p>\r\n        </div>\r\n\r\n        <!-- Loading Progress -->\r\n        <div id=\"cube-summary-progress\" class=\"cube-progress-bar\" style=\"display: none;\">\r\n            <div class=\"cube-progress-track\">\r\n                <div id=\"cube-summary-progress-fill\" class=\"cube-progress-fill\"></div>\r\n            </div>\r\n            <p id=\"cube-summary-progress-text\" class=\"cube-progress-text\">Loading rankings across all slots...</p>\r\n        </div>\r\n\r\n        <div id=\"cube-summary-results\" class=\"cube-summary-results\"></div>\r\n    `;\r\n}\r\n\r\n/**\r\n * Generate HTML for the Simulation tab\r\n */\r\nfunction generateSimulationTabHTML(): string {\r\n    return `\r\n        <div class=\"cube-simulation-header\">\r\n            <h3 class=\"cube-simulation-title\">Cube Potential Optimization Simulator</h3>\r\n            <p class=\"cube-simulation-description\">Simulates different cubing strategies to find the most efficient approach for maximizing damage across all equipment slots. Uses fictional slots that are all set to normal with 0 tries attempted. This does not account for your current slots or their rarities!</p>\r\n        </div>\r\n\r\n        <!-- Simulation Controls -->\r\n        <div class=\"cube-simulation-controls\">\r\n            <!-- Simulation Configuration -->\r\n            <div class=\"sim-config-row\" style=\"display: flex; gap: 20px; margin-bottom: 15px; align-items: center; flex-wrap: wrap;\">\r\n                <div class=\"sim-potential-type\" style=\"display: flex; align-items: center; gap: 10px;\">\r\n                    <label style=\"color: var(--text-secondary);\">Potential Type:</label>\r\n                    <label style=\"display: flex; align-items: center; gap: 6px; cursor: pointer;\">\r\n                        <input type=\"radio\" name=\"sim-potential-type\" value=\"regular\" checked>\r\n                        <span>Regular</span>\r\n                    </label>\r\n                    <label style=\"display: flex; align-items: center; gap: 6px; cursor: pointer; margin-left: 10px;\">\r\n                        <input type=\"radio\" name=\"sim-potential-type\" value=\"bonus\">\r\n                        <span>Bonus</span>\r\n                    </label>\r\n                </div>\r\n                <div class=\"sim-use-data\" style=\"display: flex; align-items: center; gap: 6px;\">\r\n                    <label style=\"display: flex; align-items: center; gap: 6px; cursor: pointer;\">\r\n                        <input type=\"checkbox\" id=\"sim-use-my-data\">\r\n                        <span style=\"color: var(--text-secondary);\">Use my current equipment data</span>\r\n                    </label>\r\n                </div>\r\n            </div>\r\n\r\n            <div class=\"cube-simulation-inputs\">\r\n                <div class=\"cube-sim-input-group\">\r\n                    <label for=\"simulation-cube-budget\" class=\"cube-sim-label\">Cube Budget</label>\r\n                    <input type=\"number\" id=\"simulation-cube-budget\" value=\"1000\" min=\"100\" max=\"50000\" step=\"100\" class=\"cube-sim-input\">\r\n                </div>\r\n                <div class=\"cube-sim-input-group\">\r\n                    <label for=\"simulation-count\" class=\"cube-sim-label\">Number of Simulations</label>\r\n                    <input type=\"number\" id=\"simulation-count\" value=\"10\" min=\"100\" max=\"10000\" step=\"100\" class=\"cube-sim-input\">\r\n                </div>\r\n            </div>\r\n            <button class=\"cube-sim-run-btn\" id=\"cube-simulation-run-btn\">\r\n                <span class=\"cube-sim-btn-icon\">\u25B6</span>\r\n                <span>Run Simulation</span>\r\n            </button>\r\n        </div>\r\n\r\n        <!-- Progress Bar -->\r\n        <div id=\"cube-simulation-progress\" class=\"cube-progress-bar\" style=\"display: none;\">\r\n            <div class=\"cube-progress-track\">\r\n                <div id=\"cube-simulation-progress-fill\" class=\"cube-progress-fill\"></div>\r\n            </div>\r\n            <p id=\"cube-simulation-progress-text\" class=\"cube-progress-text\">Running simulations...</p>\r\n        </div>\r\n\r\n        <!-- Results -->\r\n        <div id=\"cube-simulation-results\" class=\"cube-simulation-results\"></div>\r\n    `;\r\n}\r\n\r\n/**\r\n * Generate HTML for the Optimal Strategy tab\r\n */\r\nfunction generateOptimalTabHTML(): string {\r\n    return `\r\n        <div class=\"optimal-config\" style=\"display: flex; gap: 20px; margin-bottom: 20px; align-items: center;\">\r\n            <div>\r\n                <label style=\"color: var(--text-secondary);\">Potential Type:</label>\r\n                <select id=\"optimal-potential-type\" style=\"margin-left: 8px; padding: 6px 12px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--bg-secondary); color: var(--text-primary);\">\r\n                    <option value=\"regular\">Regular</option>\r\n                    <option value=\"bonus\">Bonus</option>\r\n                </select>\r\n            </div>\r\n            <div>\r\n                <label style=\"color: var(--text-secondary);\">Cube Budget:</label>\r\n                <input type=\"number\" id=\"optimal-cube-budget\" min=\"1\" max=\"9999\" value=\"100\" style=\"margin-left: 8px; width: 100px; padding: 6px 12px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--bg-secondary); color: var(--text-primary);\">\r\n            </div>\r\n        </div>\r\n\r\n        <div id=\"optimal-recommendation\" class=\"optimal-recommendation-panel\">\r\n            <!-- Populated dynamically -->\r\n        </div>\r\n\r\n        <div id=\"optimal-sequence\" class=\"optimal-sequence-table\">\r\n            <!-- Full optimal sequence table -->\r\n        </div>\r\n    `;\r\n}\r\n\r\n// ============================================================================\r\n// INITIALIZATION\r\n// ============================================================================\r\n\r\n/**\r\n * Initialize the cube potential UI\r\n */\r\nexport async function initializeCubePotentialUI(): Promise<void> {\r\n    const container = document.getElementById('optimization-cube-potential');\r\n    if (!container) {\r\n        console.error('Cube potential container not found');\r\n        return;\r\n    }\r\n\r\n    // Generate HTML\r\n    container.innerHTML = generateCubePotentialHTML();\r\n\r\n    // Initialize core system\r\n    await initializeCubePotential();\r\n\r\n    // Setup UI components\r\n    setupSlotSelector();\r\n    setupPotentialTypeButtons();\r\n    setupRaritySelector();\r\n    setupRollCountInput();\r\n    setupPotentialLineDropdowns();\r\n    setupTabNavigation();\r\n    setupRankingsControls();\r\n    setupSimulationButton();\r\n\r\n    // Load data from store\r\n    loadCubeDataFromStore();\r\n\r\n    // Initial UI update\r\n    updateSlotButtonColors();\r\n    updateCubePotentialUI();\r\n    updateClassWarning();\r\n\r\n    // Expose global functions\r\n    exposeGlobalFunctions();\r\n\r\n    loadoutStore.on('stat:changed', debounce((_) => {\r\n           clearCubeRankingsCache();\r\n           calculateComparisonAndDisplay();\r\n           const button = document.getElementById(\"cube-main-tab-comparison\");\r\n           button?.click();\r\n    }, 1500));\r\n}\r\n\r\n/**\r\n * Load cube data from store and update UI\r\n */\r\nfunction loadCubeDataFromStore(): void {\r\n    const cubeData = gearLabStore.getCubeSlotData();\r\n    if (!cubeData) return;\r\n\r\n    // Update rarity selector\r\n    const raritySelector = document.getElementById('cube-rarity-selector') as HTMLSelectElement;\r\n    if (raritySelector) {\r\n        raritySelector.value = cubeData[currentCubeSlot][currentPotentialType].rarity;\r\n    }\r\n\r\n    // Update roll count input\r\n    const rollCountInput = document.getElementById('cube-roll-count') as HTMLInputElement;\r\n    if (rollCountInput) {\r\n        rollCountInput.value = cubeData[currentCubeSlot][currentPotentialType].rollCount.toString();\r\n    }\r\n}\r\n\r\n// ============================================================================\r\n// UI SETUP FUNCTIONS\r\n// ============================================================================\r\n\r\n/**\r\n * Setup equipment slot selector buttons\r\n */\r\nfunction setupSlotSelector(): void {\r\n    const slotSelector = document.getElementById('cube-slot-selector');\r\n    if (!slotSelector) return;\r\n\r\n    const cubeData = gearLabStore.getCubeSlotData();\r\n    if (!cubeData) return;\r\n\r\n    slotSelector.innerHTML = '';\r\n\r\n    SLOT_NAMES.forEach(slot => {\r\n        const slotBtn = document.createElement('button');\r\n        slotBtn.className = 'cube-slot-btn';\r\n        slotBtn.textContent = slot.name;\r\n        slotBtn.dataset.slot = slot.id;\r\n\r\n        // Apply rarity color to border\r\n        const slotRarity = cubeData[slot.id]?.[currentPotentialType]?.rarity || 'normal';\r\n        const rarityColor = getRarityColor(slotRarity);\r\n        slotBtn.style.borderColor = rarityColor;\r\n\r\n        // Apply active state\r\n        const isActive = slot.id === currentCubeSlot;\r\n        if (isActive) {\r\n            slotBtn.classList.add('active');\r\n            slotBtn.style.boxShadow = `0 4px 16px ${rarityColor}60, 0 0 0 2px ${rarityColor}`;\r\n        } else {\r\n            slotBtn.style.boxShadow = `0 2px 8px ${rarityColor}40`;\r\n        }\r\n\r\n        slotBtn.addEventListener('click', () => {\r\n            selectCubeSlot(slot.id);\r\n            updateSlotButtonColors();\r\n            loadCubeDataFromStore();\r\n            updateCubePotentialUI();\r\n            calculateComparisonAndDisplay();\r\n        });\r\n\r\n        slotSelector.appendChild(slotBtn);\r\n    });\r\n}\r\n\r\n/**\r\n * Setup potential type toggle buttons\r\n */\r\nfunction setupPotentialTypeButtons(): void {\r\n    const regularBtn = document.getElementById('cube-regular-potential-btn');\r\n    const bonusBtn = document.getElementById('cube-bonus-potential-btn');\r\n\r\n    if (regularBtn && bonusBtn) {\r\n        regularBtn.addEventListener('click', () => {\r\n            switchPotentialType('regular');\r\n            updatePotentialTypeButtons();\r\n            loadCubeDataFromStore();\r\n            updateSlotButtonColors();\r\n            updateCubePotentialUI();\r\n            calculateComparisonAndDisplay();\r\n        });\r\n\r\n        bonusBtn.addEventListener('click', () => {\r\n            switchPotentialType('bonus');\r\n            updatePotentialTypeButtons();\r\n            loadCubeDataFromStore();\r\n            updateSlotButtonColors();\r\n            updateCubePotentialUI();\r\n            calculateComparisonAndDisplay();\r\n        });\r\n    }\r\n}\r\n\r\n/**\r\n * Setup rarity selector\r\n */\r\nfunction setupRaritySelector(): void {\r\n    const raritySelector = document.getElementById('cube-rarity-selector') as HTMLSelectElement;\r\n    if (!raritySelector) return;\r\n\r\n    raritySelector.addEventListener('change', (e) => {\r\n        const target = e.target as HTMLSelectElement;\r\n        const newRarity = target.value as Rarity;\r\n        gearLabStore.updateCubeRarity(currentCubeSlot, currentPotentialType, newRarity);\r\n\r\n        updateSlotButtonColors();\r\n        updateCubePotentialUI();\r\n        calculateComparisonAndDisplay();\r\n    });\r\n}\r\n\r\n/**\r\n * Setup roll count input\r\n */\r\nfunction setupRollCountInput(): void {\r\n    const rollCountInput = document.getElementById('cube-roll-count') as HTMLInputElement;\r\n    if (!rollCountInput) return;\r\n\r\n    rollCountInput.addEventListener('change', (e) => {\r\n        const target = e.target as HTMLInputElement;\r\n        const value = parseInt(target.value) || 0;\r\n        gearLabStore.updateCubeRollCount(currentCubeSlot, currentPotentialType, value);\r\n    });\r\n}\r\n\r\n/**\r\n * Setup potential line dropdowns\r\n */\r\nfunction setupPotentialLineDropdowns(): void {\r\n    const cubeData = gearLabStore.getCubeSlotData();\r\n    if (!cubeData) return;\r\n\r\n    const rarity = cubeData[currentCubeSlot][currentPotentialType].rarity;\r\n\r\n    // Setup Set A dropdowns\r\n    updatePotentialLineDropdowns('setA', rarity);\r\n\r\n    // Setup Set B dropdowns\r\n    updatePotentialLineDropdowns('setB', rarity);\r\n}\r\n\r\n/**\r\n * Setup tab navigation\r\n */\r\nfunction setupTabNavigation(): void {\r\n    const tabs = document.querySelectorAll('.cube-main-tabs .tab-button');\r\n    const contents = document.querySelectorAll('.cube-tab-content');\r\n\r\n    tabs.forEach(tab => {\r\n        tab.addEventListener('click', () => {\r\n            const tabName = tab.getAttribute('data-tab');\r\n            if (!tabName) return;\r\n\r\n            // Update active states\r\n            tabs.forEach(t => t.classList.remove('active'));\r\n            contents.forEach(c => c.classList.remove('active'));\r\n\r\n            tab.classList.add('active');\r\n            const targetContent = document.getElementById(`cube-${tabName}-content`);\r\n            if (targetContent) {\r\n                targetContent.classList.add('active');\r\n            }\r\n\r\n            // Handle tab-specific initialization\r\n            if (tabName === 'summary') {\r\n                displayAllSlotsSummary();\r\n                loadAllRankingsForSummary();\r\n            } else if (tabName === 'rankings') {\r\n                // Ensure selectors are initialized before accessing them\r\n                setupRankingsControls();\r\n                const raritySelector = document.getElementById('cube-rankings-rarity-selector') as HTMLSelectElement;\r\n                if (raritySelector) {\r\n                    const rarity = raritySelector.value as Rarity;\r\n                    displayOrCalculateRankingsForRarity(rarity);\r\n                }\r\n            }\r\n        });\r\n    });\r\n}\r\n\r\n/**\r\n * Setup rankings controls\r\n */\r\nfunction setupRankingsControls(): void {\r\n    const slotSelector = document.getElementById('cube-rankings-slot-selector') as HTMLSelectElement;\r\n    const raritySelector = document.getElementById('cube-rankings-rarity-selector') as HTMLSelectElement;\r\n\r\n    if (!slotSelector) {\r\n        console.error('Rankings slot selector (cube-rankings-slot-selector) not found in DOM');\r\n        return;\r\n    }\r\n    if (!raritySelector) {\r\n        console.error('Rankings rarity selector (cube-rankings-rarity-selector) not found in DOM');\r\n        return;\r\n    }\r\n\r\n    // Only populate if not already populated (check if empty)\r\n    if (slotSelector.options.length === 0) {\r\n        // Populate slot selector\r\n        SLOT_NAMES.forEach(slot => {\r\n            const option = document.createElement('option');\r\n            option.value = slot.id;\r\n            option.textContent = slot.name;\r\n            slotSelector.appendChild(option);\r\n        });\r\n\r\n        // Set default to current slot\r\n        slotSelector.value = currentCubeSlot;\r\n\r\n        // Verify the value was set successfully, fallback to first slot if not\r\n        if (!slotSelector.value && SLOT_NAMES.length > 0) {\r\n            slotSelector.value = SLOT_NAMES[0].id;\r\n            console.warn(`currentCubeSlot \"${currentCubeSlot}\" not found in options, defaulting to \"${SLOT_NAMES[0].id}\"`);\r\n        }\r\n    }\r\n\r\n    // Add event listeners if not already attached (using defensive element lookup)\r\n    if (!slotSelector.hasAttribute('data-listener-attached')) {\r\n        slotSelector.addEventListener('change', () => {\r\n            currentRankingsPage = 1;\r\n            // Defensively get current references to selectors\r\n            const currentRaritySelector = document.getElementById('cube-rankings-rarity-selector') as HTMLSelectElement;\r\n            const currentSlotSelector = document.getElementById('cube-rankings-slot-selector') as HTMLSelectElement;\r\n            if (currentRaritySelector && currentSlotSelector) {\r\n                const rarity = currentRaritySelector.value as Rarity;\r\n                const slotId = currentSlotSelector.value as CubeSlotId;\r\n                // Trigger calculation for the new slot\r\n                displayOrCalculateRankingsForSlotAndRarity(slotId, rarity);\r\n            }\r\n        });\r\n        slotSelector.setAttribute('data-listener-attached', 'true');\r\n    }\r\n\r\n    if (!raritySelector.hasAttribute('data-listener-attached')) {\r\n        raritySelector.addEventListener('change', () => {\r\n            currentRankingsPage = 1;\r\n            // Defensively get current references to selectors\r\n            const currentRaritySelector = document.getElementById('cube-rankings-rarity-selector') as HTMLSelectElement;\r\n            const currentSlotSelector = document.getElementById('cube-rankings-slot-selector') as HTMLSelectElement;\r\n            if (currentRaritySelector && currentSlotSelector) {\r\n                const rarity = currentRaritySelector.value as Rarity;\r\n                const slotId = currentSlotSelector.value as CubeSlotId;\r\n                // Trigger calculation for the new rarity\r\n                displayOrCalculateRankingsForSlotAndRarity(slotId, rarity);\r\n            }\r\n        });\r\n        raritySelector.setAttribute('data-listener-attached', 'true');\r\n    }\r\n}\r\n\r\n// Store simulation parameters for display\r\nlet cubeBudget = 1000;\r\nlet simulationCount = 1000;\r\n\r\n/**\r\n * Handle run simulation button click\r\n */\r\nasync function handleRunSimulation(): Promise<void> {\r\n    const budgetInput = document.getElementById('simulation-cube-budget') as HTMLInputElement;\r\n    const countInput = document.getElementById('simulation-count') as HTMLInputElement;\r\n    const potentialTypeInputs = document.querySelectorAll('input[name=\"sim-potential-type\"]');\r\n    const useUserDataCheckbox = document.getElementById('sim-use-my-data') as HTMLInputElement;\r\n\r\n    if (!budgetInput || !countInput || !potentialTypeInputs.length) {\r\n        console.error('Simulation inputs not found');\r\n        return;\r\n    }\r\n\r\n    cubeBudget = parseInt(budgetInput.value) || 1000;\r\n    simulationCount = parseInt(countInput.value) || 1000;\r\n\r\n    let potentialType: 'regular' | 'bonus' = 'regular';\r\n    for (const input of potentialTypeInputs) {\r\n        if ((input as HTMLInputElement).checked) {\r\n            potentialType = (input as HTMLInputElement).value as 'regular' | 'bonus';\r\n            break;\r\n        }\r\n    }\r\n\r\n    const useUserData = useUserDataCheckbox?.checked || false;\r\n\r\n    const cubeSlotData = gearLabStore.getCubeSlotData();\r\n    if (!cubeSlotData) {\r\n        console.error('Cube slot data not found');\r\n        return;\r\n    }\r\n\r\n    // Include base stats which is required by runCubeSimulation\r\n    const baseStats = loadoutStore.getBaseStats();\r\n    const cubeSlotDataWithStats = {\r\n        ...cubeSlotData,\r\n        baseStats\r\n    };\r\n\r\n    const results = await runCubeSimulation(\r\n        cubeBudget,\r\n        simulationCount,\r\n        potentialType,\r\n        useUserData,\r\n        cubeSlotDataWithStats\r\n    );\r\n\r\n    // Display results (includes chart creation)\r\n    displaySimulationResults(results);\r\n}\r\n\r\n/**\r\n * Display simulation results with full breakdown\r\n */\r\nfunction displaySimulationResults(results: Record<string, any>): void {\r\n    const resultsDiv = document.getElementById('cube-simulation-results');\r\n    if (!resultsDiv) return;\r\n\r\n    // Find best strategy\r\n    let bestStrategy = Object.keys(results)[0];\r\n    let bestAvg = results[bestStrategy]?.avgGain || 0;\r\n\r\n    for (const strategy of Object.keys(results)) {\r\n        if ((results[strategy]?.avgGain || 0) > bestAvg) {\r\n            bestStrategy = strategy;\r\n            bestAvg = results[strategy]?.avgGain || 0;\r\n        }\r\n    }\r\n\r\n    const formatStrategy = (strategyKey: string, name: string, data: any, isBest: boolean): string => {\r\n        const gains = [...(data.totalGains || [])].sort((a: number, b: number) => a - b);\r\n        if (gains.length === 0) return '';\r\n\r\n        const min = gains[0];\r\n        const max = gains[gains.length - 1];\r\n        const median = gains[Math.floor(gains.length / 2)];\r\n        const p25 = gains[Math.floor(gains.length * 0.25)];\r\n        const p75 = gains[Math.floor(gains.length * 0.75)];\r\n\r\n        // Find simulations for each percentile\r\n        const simulations = data.simulations || [];\r\n        const minSimIdx = simulations.findIndex((s: any) => Math.abs(s.totalGain - min) < 0.01);\r\n        const p25SimIdx = simulations.findIndex((s: any) => Math.abs(s.totalGain - p25) < 0.01);\r\n        const medianSimIdx = simulations.findIndex((s: any) => Math.abs(s.totalGain - median) < 0.01);\r\n        const p75SimIdx = simulations.findIndex((s: any) => Math.abs(s.totalGain - p75) < 0.01);\r\n        const maxSimIdx = simulations.findIndex((s: any) => Math.abs(s.totalGain - max) < 0.01);\r\n\r\n        const detailsId = `sim-details-${strategyKey}`;\r\n        const chartCanvasId = `sim-chart-${strategyKey}`;\r\n\r\n        return `\r\n            <details style=\"background: linear-gradient(135deg, ${isBest ? 'rgba(52, 199, 89, 0.1), rgba(0, 122, 255, 0.05)' : 'rgba(59, 130, 246, 0.1), rgba(147, 51, 234, 0.05)'}); border: 2px solid ${isBest ? 'var(--accent-success)' : 'rgba(59, 130, 246, 0.3)'}; border-radius: 12px; margin-bottom: 12px; transition: all 0.3s;\">\r\n                <summary style=\"cursor: pointer; padding: 16px 20px; user-select: none; list-style: none; display: flex; align-items: center; justify-content: space-between; gap: 15px;\">\r\n                    <div style=\"display: flex; align-items: center; gap: 10px; flex: 1; min-width: 0;\">\r\n                        <span style=\"color: ${isBest ? 'var(--accent-success)' : 'var(--accent-primary)'}; font-size: 1.05em; font-weight: 700;\">\r\n                            ${isBest ? '\u2B50 ' : ''}${name}\r\n                        </span>\r\n                    </div>\r\n                    <div style=\"display: flex; align-items: center; gap: 20px; font-size: 0.95em; flex-shrink: 0;\">\r\n                        <div style=\"text-align: right;\">\r\n                            <span style=\"color: var(--text-secondary); font-size: 0.85em;\">Avg:</span>\r\n                            <span style=\"color: ${isBest ? 'var(--accent-success)' : 'var(--accent-primary)'}; font-weight: 700; margin-left: 6px;\">+${data.avgGain.toFixed(2)}%</span>\r\n                        </div>\r\n                        <div style=\"text-align: right;\">\r\n                            <span style=\"color: var(--text-secondary); font-size: 0.85em;\">Range:</span>\r\n                            <span style=\"color: var(--text-primary); font-weight: 600; margin-left: 6px;\">+${min.toFixed(2)}% - +${max.toFixed(2)}%</span>\r\n                        </div>\r\n                    </div>\r\n                </summary>\r\n\r\n                <div style=\"padding: 0 20px 20px 20px; border-top: 1px solid rgba(0, 0, 0, 0.1); margin-top: -5px; padding-top: 20px;\">\r\n                    <!-- Stats Grid -->\r\n                    <div style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px; margin-bottom: 15px;\">\r\n                        <div class=\"sim-stat-card\">\r\n                            <div class=\"sim-stat-card-label\">Average Gain</div>\r\n                            <div class=\"sim-stat-card-value\">+${data.avgGain.toFixed(2)}%</div>\r\n                        </div>\r\n                        <div class=\"sim-stat-card\">\r\n                            <div class=\"sim-stat-card-label\">Median</div>\r\n                            <div class=\"sim-stat-card-value sim-stat-card-value--secondary\">+${median.toFixed(2)}%</div>\r\n                        </div>\r\n                        <div class=\"sim-stat-card\">\r\n                            <div class=\"sim-stat-card-label\">Min / Max</div>\r\n                            <div class=\"sim-stat-card-value sim-stat-card-value--secondary\">+${min.toFixed(2)}% / +${max.toFixed(2)}%</div>\r\n                        </div>\r\n                        <div class=\"sim-stat-card\">\r\n                            <div class=\"sim-stat-card-label\">P25 / P75</div>\r\n                            <div class=\"sim-stat-card-value sim-stat-card-value--secondary\">+${p25.toFixed(2)}% / +${p75.toFixed(2)}%</div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <!-- Detailed Results Dropdown -->\r\n                    <details class=\"sim-detail-results\" data-strategy=\"${strategyKey}\" style=\"background: rgba(0, 0, 0, 0.05); border-radius: 8px; padding: 10px; margin-top: 10px;\">\r\n                        <summary style=\"cursor: pointer; font-weight: 600; color: var(--accent-primary); user-select: none; font-size: 0.95em;\">\r\n                            View Detailed Results (Slot Stats & Distribution)\r\n                        </summary>\r\n                        <div id=\"${detailsId}\" style=\"margin-top: 15px;\">\r\n                            <!-- Sub-tabs -->\r\n                            <div style=\"display: flex; gap: 10px; margin-bottom: 15px; border-bottom: 2px solid rgba(0, 0, 0, 0.1); padding-bottom: 0; overflow-x: auto;\">\r\n                                <button class=\"sim-detail-tab active\" data-strategy=\"${strategyKey}\" data-tab=\"distribution\" onclick=\"window.switchSimDetailTab('${strategyKey}', 'distribution')\" style=\"padding: 8px 16px; background: none; border: none; border-bottom: 3px solid var(--accent-primary); cursor: pointer; font-weight: 600; color: var(--text-primary); transition: all 0.3s; white-space: nowrap;\">Distribution</button>\r\n                                <button class=\"sim-detail-tab\" data-strategy=\"${strategyKey}\" data-tab=\"min\" onclick=\"window.switchSimDetailTab('${strategyKey}', 'min')\" style=\"padding: 8px 16px; background: none; border: none; border-bottom: 3px solid transparent; cursor: pointer; font-weight: 600; color: var(--text-primary); transition: all 0.3s; white-space: nowrap;\">Min (+${min.toFixed(2)}%)</button>\r\n                                <button class=\"sim-detail-tab\" data-strategy=\"${strategyKey}\" data-tab=\"p25\" onclick=\"window.switchSimDetailTab('${strategyKey}', 'p25')\" style=\"padding: 8px 16px; background: none; border: none; border-bottom: 3px solid transparent; cursor: pointer; font-weight: 600; color: var(--text-primary); transition: all 0.3s; white-space: nowrap;\">P25 (+${p25.toFixed(2)}%)</button>\r\n                                <button class=\"sim-detail-tab\" data-strategy=\"${strategyKey}\" data-tab=\"median\" onclick=\"window.switchSimDetailTab('${strategyKey}', 'median')\" style=\"padding: 8px 16px; background: none; border: none; border-bottom: 3px solid transparent; cursor: pointer; font-weight: 600; color: var(--text-primary); transition: all 0.3s; white-space: nowrap;\">Median (+${median.toFixed(2)}%)</button>\r\n                                <button class=\"sim-detail-tab\" data-strategy=\"${strategyKey}\" data-tab=\"p75\" onclick=\"window.switchSimDetailTab('${strategyKey}', 'p75')\" style=\"padding: 8px 16px; background: none; border: none; border-bottom: 3px solid transparent; cursor: pointer; font-weight: 600; color: var(--text-primary); transition: all 0.3s; white-space: nowrap;\">P75 (+${p75.toFixed(2)}%)</button>\r\n                                <button class=\"sim-detail-tab\" data-strategy=\"${strategyKey}\" data-tab=\"max\" onclick=\"window.switchSimDetailTab('${strategyKey}', 'max')\" style=\"padding: 8px 16px; background: none; border: none; border-bottom: 3px solid transparent; cursor: pointer; font-weight: 600; color: var(--text-primary); transition: all 0.3s; white-space: nowrap;\">Max (+${max.toFixed(2)}%)</button>\r\n                            </div>\r\n\r\n                            <!-- Distribution Tab -->\r\n                            <div class=\"sim-detail-content\" data-strategy=\"${strategyKey}\" data-tab=\"distribution\" style=\"display: block;\">\r\n                                <canvas id=\"${chartCanvasId}\" style=\"max-height: 300px;\"></canvas>\r\n                            </div>\r\n\r\n                            <!-- Min Tab -->\r\n                            <div class=\"sim-detail-content\" data-strategy=\"${strategyKey}\" data-tab=\"min\" style=\"display: none;\">\r\n                                <div style=\"display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px;\">\r\n                                    ${minSimIdx >= 0 ? formatSlotDetails(simulations[minSimIdx].slots) : 'No data'}\r\n                                </div>\r\n                            </div>\r\n\r\n                            <!-- P25 Tab -->\r\n                            <div class=\"sim-detail-content\" data-strategy=\"${strategyKey}\" data-tab=\"p25\" style=\"display: none;\">\r\n                                <div style=\"display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px;\">\r\n                                    ${p25SimIdx >= 0 ? formatSlotDetails(simulations[p25SimIdx].slots) : 'No data'}\r\n                                </div>\r\n                            </div>\r\n\r\n                            <!-- Median Tab -->\r\n                            <div class=\"sim-detail-content\" data-strategy=\"${strategyKey}\" data-tab=\"median\" style=\"display: none;\">\r\n                                <div style=\"display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px;\">\r\n                                    ${medianSimIdx >= 0 ? formatSlotDetails(simulations[medianSimIdx].slots) : 'No data'}\r\n                                </div>\r\n                            </div>\r\n\r\n                            <!-- P75 Tab -->\r\n                            <div class=\"sim-detail-content\" data-strategy=\"${strategyKey}\" data-tab=\"p75\" style=\"display: none;\">\r\n                                <div style=\"display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px;\">\r\n                                    ${p75SimIdx >= 0 ? formatSlotDetails(simulations[p75SimIdx].slots) : 'No data'}\r\n                                </div>\r\n                            </div>\r\n\r\n                            <!-- Max Tab -->\r\n                            <div class=\"sim-detail-content\" data-strategy=\"${strategyKey}\" data-tab=\"max\" style=\"display: none;\">\r\n                                <div style=\"display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px;\">\r\n                                    ${maxSimIdx >= 0 ? formatSlotDetails(simulations[maxSimIdx].slots) : 'No data'}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </details>\r\n                </div>\r\n            </details>\r\n        `;\r\n    };\r\n\r\n    // Strategy names and descriptions\r\n    const strategyInfo: Record<string, { name: string; desc: string }> = {\r\n        worstFirst: { name: 'Worst First', desc: 'Always upgrades the slot currently providing the least DPS gain with a single cube at a time.' },\r\n        balancedThreshold: { name: 'Balanced Threshold', desc: 'Keeps all slots within a certain DPS gain range of each other, preventing over-investment in terrible slots.' },\r\n        hybridFastRarity: { name: 'Hybrid: Fast Rarity + Worst First', desc: 'First rushes all slots to Epic rarity, then switches to Worst First strategy for remaining cubes.' },\r\n        rarityWeightedWorstFirst: { name: 'Rarity-Weighted Worst First', desc: 'Like Worst First but factors in how close a slot is to its next rarity upgrade, prioritizing slots near upgrade thresholds.' },\r\n        dpOptimal: { name: 'DP Optimal', desc: 'Mathematically optimal strategy that cubes the slot with highest expected marginal DPS gain, accounting for tier-up probability and future rarity potential.' }\r\n    };\r\n\r\n    // Sort strategies by average gain (best first), filtering out dpOptimal\r\n    const sortedStrategies = Object.keys(results)\r\n        .filter(key => key !== 'dpOptimal')\r\n        .sort((a, b) => (results[b]?.avgGain || 0) - (results[a]?.avgGain || 0));\r\n\r\n    resultsDiv.innerHTML = `\r\n        <div style=\"margin-bottom: 20px;\">\r\n            <h3 style=\"color: var(--accent-primary); margin-bottom: 10px; font-size: 1.2em; font-weight: 600;\">\r\n                Simulation Results\r\n            </h3>\r\n            <p style=\"color: var(--text-secondary); font-size: 0.9em;\">\r\n                Cube Budget: ${cubeBudget} | Simulations: ${simulationCount}\r\n            </p>\r\n        </div>\r\n\r\n        ${sortedStrategies.map(strategyKey => {\r\n            const info = strategyInfo[strategyKey];\r\n            return formatStrategy(strategyKey, info.name, results[strategyKey], strategyKey === bestStrategy);\r\n        }).join('')}\r\n\r\n        <div style=\"background: linear-gradient(135deg, rgba(138, 43, 226, 0.1), rgba(75, 0, 130, 0.05)); border: 2px solid rgba(138, 43, 226, 0.3); border-radius: 12px; padding: 20px; margin-top: 20px;\">\r\n            <h4 style=\"color: var(--accent-primary); margin-bottom: 10px;\">Strategy Descriptions</h4>\r\n            <div style=\"color: var(--text-secondary); font-size: 0.9em; line-height: 1.6;\">\r\n                ${Object.keys(strategyInfo).filter(key => key !== 'dpOptimal').map(key => `\r\n                    <p style=\"margin-top: 8px;\"><strong>${strategyInfo[key].name}:</strong> ${strategyInfo[key].desc}</p>\r\n                `).join('')}\r\n            </div>\r\n        </div>\r\n    `;\r\n\r\n    // Store for chart creation (charts are created on-demand when tabs are shown)\r\n    (window as any).simulationResultsForCharts = { results, sortedStrategies, strategyInfo };\r\n\r\n    // Add event listeners to initialize charts when details are opened\r\n    resultsDiv.querySelectorAll('.sim-detail-results').forEach((details) => {\r\n        const detailsElement = details as HTMLDetailsElement;\r\n        detailsElement.addEventListener('toggle', () => {\r\n            if (detailsElement.open) {\r\n                const strategy = detailsElement.dataset.strategy;\r\n                if (!strategy) return;\r\n\r\n                // Initialize chart when details are opened (if not already created)\r\n                const canvas = detailsElement.querySelector('canvas') as HTMLCanvasElement;\r\n                if (canvas && !(canvas as any).chart) {\r\n                    const storedData = (window as any).simulationResultsForCharts;\r\n                    if (storedData && storedData.results && storedData.results[strategy]) {\r\n                        const strategyInfo = storedData.strategyInfo[strategy];\r\n                        const gains = storedData.results[strategy].totalGains;\r\n                        // Small delay to ensure the element is visible\r\n                        setTimeout(() => {\r\n                            createSimulationDistributionChart(canvas.id, gains, strategyInfo.name);\r\n                        }, 50);\r\n                    }\r\n                }\r\n\r\n                // Ensure Distribution tab button has active styling\r\n                const distributionTab = detailsElement.querySelector('.sim-detail-tab[data-tab=\"distribution\"]') as HTMLElement;\r\n                if (distributionTab) {\r\n                    distributionTab.classList.add('active');\r\n                    distributionTab.style.borderBottomColor = 'var(--accent-primary)';\r\n                }\r\n            }\r\n        });\r\n    });\r\n}\r\n\r\n/**\r\n * Create simulation distribution histogram chart\r\n */\r\nfunction createSimulationDistributionChart(canvasId: string, gains: number[], label: string): void {\r\n    const canvas = document.getElementById(canvasId) as HTMLCanvasElement;\r\n    if (!canvas) {\r\n        setTimeout(() => createSimulationDistributionChart(canvasId, gains, label), 50);\r\n        return;\r\n    }\r\n\r\n    // Create histogram\r\n    const sorted = [...gains].sort((a, b) => a - b);\r\n    const min = sorted[0];\r\n    const max = sorted[sorted.length - 1];\r\n    const bucketCount = 30;\r\n\r\n    // Handle case where all gains are the same (avoid division by zero)\r\n    let bucketSize = (max - min) / bucketCount;\r\n    if (bucketSize === 0) {\r\n        // All values are the same, create a single bucket\r\n        bucketSize = 1;\r\n    }\r\n\r\n    const buckets = new Array(bucketCount).fill(0);\r\n    const bucketLabels: string[] = [];\r\n\r\n    for (let i = 0; i < bucketCount; i++) {\r\n        const bucketStart = min + (i * bucketSize);\r\n        bucketLabels.push(bucketStart.toFixed(2));\r\n    }\r\n\r\n    sorted.forEach(gain => {\r\n        const bucketIndex = Math.min(\r\n            Math.floor((gain - min) / bucketSize),\r\n            bucketCount - 1\r\n        );\r\n        buckets[bucketIndex]++;\r\n    });\r\n\r\n    // Get theme colors\r\n    const isDark = document.documentElement.classList.contains('dark');\r\n    const textColor = isDark ? '#e5e7eb' : '#1f2937';\r\n    const gridColor = isDark ? 'rgba(55, 65, 81, 0.5)' : 'rgba(209, 213, 219, 0.5)';\r\n\r\n    // Destroy existing chart if any\r\n    const existingChart = (canvas as any).chart;\r\n    if (existingChart) {\r\n        existingChart.destroy();\r\n    }\r\n\r\n    // Create new chart\r\n    (canvas as any).chart = new Chart(canvas, {\r\n        type: 'bar',\r\n        data: {\r\n            labels: bucketLabels,\r\n            datasets: [{\r\n                label: 'Simulations',\r\n                data: buckets,\r\n                backgroundColor: 'rgba(59, 130, 246, 0.6)',\r\n                borderColor: 'rgba(59, 130, 246, 1)',\r\n                borderWidth: 1\r\n            }]\r\n        },\r\n        options: {\r\n            responsive: true,\r\n            maintainAspectRatio: true,\r\n            aspectRatio: 2.5,\r\n            plugins: {\r\n                legend: { display: false },\r\n                title: {\r\n                    display: true,\r\n                    text: `${label} - DPS Gain Distribution`,\r\n                    color: textColor,\r\n                    font: { size: 14, weight: 'bold' }\r\n                },\r\n                tooltip: {\r\n                    callbacks: {\r\n                        title: function(context: any) {\r\n                            const idx = context[0].dataIndex;\r\n                            const start = parseFloat(bucketLabels[idx]);\r\n                            const end = start + bucketSize;\r\n                            return `${start.toFixed(2)}% - ${end.toFixed(2)}%`;\r\n                        },\r\n                        label: function(context: any) {\r\n                            const count = buckets[context.dataIndex];\r\n                            const total = buckets.reduce((a: number, b: number) => a + b, 0);\r\n                            const percentage = ((count / total) * 100).toFixed(1);\r\n                            return `${count} simulations (${percentage}%)`;\r\n                        }\r\n                    }\r\n                }\r\n            },\r\n            scales: {\r\n                x: {\r\n                    display: false,\r\n                    grid: { display: false }\r\n                },\r\n                y: {\r\n                    display: true,\r\n                    grid: { color: gridColor },\r\n                    ticks: { color: textColor }\r\n                }\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * Setup simulation button\r\n */\r\nfunction setupSimulationButton(): void {\r\n    const simulationButton = document.getElementById('cube-simulation-run-btn');\r\n    if (!simulationButton) return;\r\n\r\n    simulationButton.addEventListener('click', () => {\r\n        handleRunSimulation().catch(err => {\r\n            console.error('Simulation failed:', err);\r\n        });\r\n    });\r\n}\r\n\r\n// ============================================================================\r\n// UI UPDATE FUNCTIONS\r\n// ============================================================================\r\n\r\n/**\r\n * Update slot button colors based on rarity\r\n */\r\nexport function updateSlotButtonColors(): void {\r\n    const cubeData = gearLabStore.getCubeSlotData();\r\n    if (!cubeData) return;\r\n\r\n    SLOT_NAMES.forEach(slot => {\r\n        const slotBtn = document.querySelector(`.cube-slot-btn[data-slot=\"${slot.id}\"]`) as HTMLElement;\r\n        if (!slotBtn) return;\r\n\r\n        const slotRarity = cubeData[slot.id]?.[currentPotentialType]?.rarity || 'normal';\r\n        const rarityColor = getRarityColor(slotRarity);\r\n        slotBtn.style.borderColor = rarityColor;\r\n\r\n        const isActive = slot.id === currentCubeSlot;\r\n        if (isActive) {\r\n            slotBtn.style.boxShadow = `0 4px 16px ${rarityColor}60, 0 0 0 2px ${rarityColor}`;\r\n        } else {\r\n            slotBtn.style.boxShadow = `0 2px 8px ${rarityColor}40`;\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * Update potential type button states\r\n */\r\nfunction updatePotentialTypeButtons(): void {\r\n    const regularBtn = document.getElementById('cube-regular-potential-btn');\r\n    const bonusBtn = document.getElementById('cube-bonus-potential-btn');\r\n\r\n    if (regularBtn && bonusBtn) {\r\n        regularBtn.classList.toggle('active', currentPotentialType === 'regular');\r\n        bonusBtn.classList.toggle('active', currentPotentialType === 'bonus');\r\n    }\r\n}\r\n\r\n/**\r\n * Update potential line dropdowns for a set\r\n */\r\nfunction updatePotentialLineDropdowns(setName: 'setA' | 'setB', rarity: Rarity): void {\r\n    const potentialData = EQUIPMENT_POTENTIAL_DATA[rarity];\r\n    if (!potentialData) return;\r\n\r\n    for (let lineNum = 1; lineNum <= 3; lineNum++) {\r\n        const statSelect = document.getElementById(`cube-${setName}-line${lineNum}-stat`) as HTMLSelectElement;\r\n        if (!statSelect) continue;\r\n\r\n        // Clear existing options\r\n        statSelect.innerHTML = '<option value=\"\">-- Select Stat --</option>';\r\n\r\n        // Get available stats for this line\r\n        const lineKey = `line${lineNum}` as 'line1' | 'line2' | 'line3';\r\n        let lineData: PotentialLineEntry[] = [...(potentialData[lineKey] || [])];\r\n\r\n        // Add slot-specific lines if available\r\n        if (SLOT_SPECIFIC_POTENTIALS[currentCubeSlot] && SLOT_SPECIFIC_POTENTIALS[currentCubeSlot][rarity]) {\r\n            const slotSpecificLines = SLOT_SPECIFIC_POTENTIALS[currentCubeSlot][rarity][lineKey as keyof typeof SLOT_SPECIFIC_POTENTIALS[CubeSlotId][Rarity]];\r\n            if (slotSpecificLines) {\r\n                lineData = [...slotSpecificLines, ...lineData];\r\n            }\r\n        }\r\n\r\n        if (!lineData || lineData.length === 0) continue;\r\n\r\n        // Build unique stat list with values\r\n        const statOptions = new Map<string, { text: string; stat: string; value: number; prime: boolean }>();\r\n\r\n        lineData.forEach(entry => {\r\n            const isPercentStat = entry.stat.includes('%');\r\n            const valueSuffix = isPercentStat ? '%' : '';\r\n            const displayText = entry.prime\r\n                ? `${entry.stat} - ${entry.value}${valueSuffix} (Prime)`\r\n                : `${entry.stat} - ${entry.value}${valueSuffix}`;\r\n\r\n            const key = `${entry.stat}|${entry.value}|${entry.prime}`;\r\n            statOptions.set(key, {\r\n                text: displayText,\r\n                stat: entry.stat,\r\n                value: entry.value,\r\n                prime: entry.prime\r\n            });\r\n        });\r\n\r\n        // Add options to dropdown\r\n        statOptions.forEach((opt, key) => {\r\n            const option = document.createElement('option');\r\n            option.value = key;\r\n            option.textContent = opt.text;\r\n            option.dataset.stat = opt.stat;\r\n            option.dataset.value = opt.value.toString();\r\n            option.dataset.prime = opt.prime.toString();\r\n            statSelect.appendChild(option);\r\n        });\r\n\r\n        // Add change listener\r\n        statSelect.addEventListener('change', (e) => {\r\n            const selectedOption = statSelect.selectedOptions[0];\r\n            if (selectedOption && selectedOption.dataset.value) {\r\n                const [stat, value, prime] = (e.target as HTMLSelectElement).value.split('|');\r\n                gearLabStore.updateCubeLine(\r\n                    currentCubeSlot,\r\n                    currentPotentialType,\r\n                    setName,\r\n                    lineNum as 1 | 2 | 3,\r\n                    { stat, value: parseFloat(value), prime: prime === 'true' }\r\n                );\r\n            } else {\r\n                gearLabStore.updateCubeLine(\r\n                    currentCubeSlot,\r\n                    currentPotentialType,\r\n                    setName,\r\n                    lineNum as 1 | 2 | 3,\r\n                    { stat: '', value: 0, prime: false }\r\n                );\r\n            }\r\n\r\n            calculateComparisonAndDisplay();\r\n        });\r\n    }\r\n\r\n    // Restore saved values\r\n    restorePotentialLineValues(setName);\r\n}\r\n\r\n/**\r\n * Restore saved values to potential line dropdowns\r\n */\r\nfunction restorePotentialLineValues(setName: 'setA' | 'setB'): void {\r\n    const cubeData = gearLabStore.getCubeSlotData();\r\n    if (!cubeData) return;\r\n\r\n    const setData = cubeData[currentCubeSlot][currentPotentialType][setName];\r\n\r\n    for (let lineNum = 1; lineNum <= 3; lineNum++) {\r\n        const lineKey = `line${lineNum}` as 'line1' | 'line2' | 'line3';\r\n        const line = setData[lineKey];\r\n        const statSelect = document.getElementById(`cube-${setName}-line${lineNum}-stat`) as HTMLSelectElement;\r\n\r\n        if (!statSelect) continue;\r\n\r\n        if (!line || !line.stat) {\r\n            statSelect.value = '';\r\n            continue;\r\n        }\r\n\r\n        // Find matching option\r\n        const key = `${line.stat}|${line.value}|${line.prime}`;\r\n        const option = Array.from(statSelect.options).find(opt => opt.value === key);\r\n\r\n        if (option) {\r\n            statSelect.value = key;\r\n        } else {\r\n            statSelect.value = '';\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Update cube potential UI\r\n */\r\nexport function updateCubePotentialUI(): void {\r\n    const cubeData = gearLabStore.getCubeSlotData();\r\n    if (!cubeData) return;\r\n\r\n    const rarity = cubeData[currentCubeSlot][currentPotentialType].rarity;\r\n\r\n    // Update dropdowns for Set A and Set B\r\n    updatePotentialLineDropdowns('setA', rarity);\r\n    updatePotentialLineDropdowns('setB', rarity);\r\n\r\n    // Calculate and display comparison\r\n    calculateComparisonAndDisplay();\r\n}\r\n\r\n/**\r\n * Update class warning banner\r\n */\r\nexport function updateClassWarning(): void {\r\n    const warningBanner = document.getElementById('cube-class-warning');\r\n    if (!warningBanner) return;\r\n\r\n    if (!loadoutStore.getSelectedClass()) {\r\n        warningBanner.style.display = 'block';\r\n    } else {\r\n        warningBanner.style.display = 'none';\r\n    }\r\n}\r\n\r\n// ============================================================================\r\n// COMPARISON DISPLAY\r\n// ============================================================================\r\n\r\n/**\r\n * Calculate comparison and display results\r\n */\r\nfunction calculateComparisonAndDisplay(): void {\r\n    if (!loadoutStore.getSelectedClass()) {\r\n        updateClassWarning();\r\n        return;\r\n    }\r\n\r\n    const cubeData = gearLabStore.getCubeSlotData();\r\n    if (!cubeData) return;\r\n\r\n    const result = calculateComparison(cubeData, currentCubeSlot, currentPotentialType);\r\n    if (!result) return;\r\n\r\n    displayComparisonResults(result);\r\n}\r\n\r\n/**\r\n * Display comparison results\r\n */\r\nfunction displayComparisonResults(result: {\r\n    setAGain: number;\r\n    setBGain: number;\r\n    setBAbsoluteGain: number;\r\n    deltaGain: number;\r\n    setAStats: any;\r\n    setBStats: any;\r\n}): void {\r\n    const resultsDiv = document.getElementById('cube-comparison-results');\r\n    if (!resultsDiv) return;\r\n\r\n    const { setAGain, setBGain, setBAbsoluteGain } = result;\r\n\r\n    resultsDiv.innerHTML = `\r\n        <div style=\"display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;\">\r\n            <div style=\"background: linear-gradient(135deg, rgba(52, 199, 89, 0.1), rgba(0, 122, 255, 0.05)); border: 2px solid var(--accent-success); border-radius: 12px; padding: 20px; box-shadow: 0 4px 16px var(--shadow); text-align: center;\">\r\n                <div style=\"font-size: 0.9em; color: var(--text-secondary); margin-bottom: 8px;\">Set A Gain<br><span style=\"font-size: 0.85em;\">(vs Baseline)</span></div>\r\n                <div style=\"font-size: 1.8em; font-weight: 700; color: ${setAGain >= 0 ? '#4ade80' : '#f87171'};\">\r\n                    ${setAGain >= 0 ? '+' : ''}${setAGain.toFixed(2)}%\r\n                </div>\r\n            </div>\r\n            <div style=\"background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(147, 51, 234, 0.05)); border: 2px solid #3b82f6; border-radius: 12px; padding: 20px; box-shadow: 0 4px 16px var(--shadow); text-align: center;\">\r\n                <div style=\"font-size: 0.9em; color: var(--text-secondary); margin-bottom: 8px;\">Set B Gain<br><span style=\"font-size: 0.85em;\">(vs Set A)</span></div>\r\n                <div style=\"font-size: 1.8em; font-weight: 700; color: ${setBGain >= 0 ? '#4ade80' : '#f87171'};\">\r\n                    ${setBGain >= 0 ? '+' : ''}${setBGain.toFixed(2)}%\r\n                </div>\r\n            </div>\r\n        </div>\r\n    `;\r\n}\r\n\r\n// ============================================================================\r\n// RANKINGS DISPLAY\r\n// ============================================================================\r\n\r\n/**\r\n * Ranking entry interface\r\n */\r\ninterface RankingEntry {\r\n    line1: PotentialLineEntry;\r\n    line2: PotentialLineEntry;\r\n    line3: PotentialLineEntry;\r\n    dpsGain: number;\r\n}\r\n\r\n/**\r\n * Display rankings with pagination\r\n */\r\nexport function displayRankings(rankings: RankingEntry[], rarity: Rarity): void {\r\n    const resultsDiv = document.getElementById('cube-rankings-results');\r\n    if (!resultsDiv) return;\r\n\r\n    const totalPages = Math.ceil(rankings.length / RANKINGS_PER_PAGE);\r\n    const startIdx = (currentRankingsPage - 1) * RANKINGS_PER_PAGE;\r\n    const endIdx = Math.min(startIdx + RANKINGS_PER_PAGE, rankings.length);\r\n    const pageRankings = rankings.slice(startIdx, endIdx);\r\n\r\n    let html = `\r\n        <div style=\"margin-bottom: 20px;\">\r\n            <h3 style=\"color: var(--accent-primary); margin-bottom: 10px;\">\r\n                Top Potential Combinations for ${rarity.charAt(0).toUpperCase() + rarity.slice(1)} Rarity\r\n            </h3>\r\n            <p style=\"color: var(--text-secondary); font-size: 0.9em;\">\r\n                Showing ${startIdx + 1}-${endIdx} of ${rankings.length} unique combinations\r\n            </p>\r\n        </div>\r\n        <table class=\"stat-weight-table\">\r\n            <thead>\r\n                <tr>\r\n                    <th>Rank</th>\r\n                    <th style=\"text-align: center;\">Line 1</th>\r\n                    <th style=\"text-align: center;\">Line 2</th>\r\n                    <th style=\"text-align: center;\">Line 3</th>\r\n                    <th>DPS Gain</th>\r\n                </tr>\r\n            </thead>\r\n            <tbody>\r\n    `;\r\n\r\n    pageRankings.forEach((combo, idx) => {\r\n        const rank = startIdx + idx + 1;\r\n        const formatLine = (line: PotentialLineEntry): string => {\r\n            const primeTag = line.prime ? ' <span style=\"color: var(--accent-primary); font-weight: 600;\">(Prime)</span>' : '';\r\n            const isPercentStat = line.stat.includes('%');\r\n            const valueSuffix = isPercentStat ? '%' : '';\r\n            return `${line.stat}: ${line.value}${valueSuffix}${primeTag}`;\r\n        };\r\n\r\n        html += `\r\n            <tr>\r\n                <td style=\"font-weight: 700; color: var(--accent-primary);\">#${rank}</td>\r\n                <td style=\"text-align: center;\">${formatLine(combo.line1)}</td>\r\n                <td style=\"text-align: center;\">${formatLine(combo.line2)}</td>\r\n                <td style=\"text-align: center;\">${formatLine(combo.line3)}</td>\r\n                <td><span class=\"gain-positive\">+${combo.dpsGain.toFixed(2)}%</span></td>\r\n            </tr>\r\n        `;\r\n    });\r\n\r\n    html += `\r\n            </tbody>\r\n        </table>\r\n        <div style=\"display: flex; justify-content: center; align-items: center; gap: 10px; margin-top: 20px;\">\r\n            <button onclick=\"window.changeCubeRankingsPage(${currentRankingsPage - 1})\"\r\n                    ${currentRankingsPage === 1 ? 'disabled' : ''}\r\n                    class=\"btn-primary\">Previous</button>\r\n            <span style=\"color: var(--text-secondary);\">Page ${currentRankingsPage} of ${totalPages}</span>\r\n            <button onclick=\"window.changeCubeRankingsPage(${currentRankingsPage + 1})\"\r\n                    ${currentRankingsPage === totalPages ? 'disabled' : ''}\r\n                    class=\"btn-primary\">Next</button>\r\n        </div>\r\n    `;\r\n\r\n    resultsDiv.innerHTML = html;\r\n}\r\n\r\n/**\r\n * Display or calculate rankings for a specific slot and rarity\r\n */\r\nexport async function displayOrCalculateRankingsForSlotAndRarity(\r\n    slotId: CubeSlotId,\r\n    rarity: Rarity\r\n): Promise<void> {\r\n    // Check if already calculated\r\n    if (rankingsCache[slotId]?.[rarity]) {\r\n        displayRankings(rankingsCache[slotId][rarity], rarity);\r\n        return;\r\n    }\r\n\r\n    // If calculation is in progress, show progress bar and wait\r\n    const key = `${slotId}-${rarity}`;\r\n    if (rankingsInProgress[key]) {\r\n        const progressBar = document.getElementById('cube-rankings-progress') as HTMLElement;\r\n        if (progressBar) progressBar.style.display = 'block';\r\n\r\n        let pollCount = 0;\r\n        const maxPolls = 600;\r\n        const checkInterval = setInterval(() => {\r\n            pollCount++;\r\n\r\n            if (rankingsCache[slotId]?.[rarity]) {\r\n                clearInterval(checkInterval);\r\n                displayRankings(rankingsCache[slotId][rarity], rarity);\r\n            } else if (!rankingsInProgress[key]) {\r\n                clearInterval(checkInterval);\r\n                calculateRankingsForRarity(rarity, slotId).then(() => {\r\n                    if (rankingsCache[slotId]?.[rarity]) {\r\n                        displayRankings(rankingsCache[slotId][rarity], rarity);\r\n                    }\r\n                });\r\n            } else if (pollCount >= maxPolls) {\r\n                clearInterval(checkInterval);\r\n                console.error('Rankings calculation timeout');\r\n                if (progressBar) progressBar.style.display = 'none';\r\n            }\r\n        }, 100);\r\n    } else {\r\n        // Not calculated and not in progress, start calculation\r\n        await calculateRankingsForRarity(rarity, slotId);\r\n        if (rankingsCache[slotId]?.[rarity]) {\r\n            displayRankings(rankingsCache[slotId][rarity], rarity);\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Display rankings for a specific rarity (uses independent selectors)\r\n */\r\nexport async function displayOrCalculateRankingsForRarity(rarity: Rarity): Promise<void> {\r\n    const slotSelector = document.getElementById('cube-rankings-slot-selector') as HTMLSelectElement;\r\n    const slotId = slotSelector ? slotSelector.value as CubeSlotId : currentCubeSlot;\r\n    await displayOrCalculateRankingsForSlotAndRarity(slotId, rarity);\r\n}\r\n\r\n/**\r\n * Change rankings page\r\n */\r\nexport function changeCubeRankingsPage(newPage: number): void {\r\n    changeRankingsPage(newPage);\r\n\r\n    // Refresh the display with the new page\r\n    const slotSelector = document.getElementById('cube-rankings-slot-selector') as HTMLSelectElement;\r\n    const raritySelector = document.getElementById('cube-rankings-rarity-selector') as HTMLSelectElement;\r\n\r\n    if (slotSelector && raritySelector) {\r\n        const slotId = slotSelector.value as CubeSlotId;\r\n        const rarity = raritySelector.value as Rarity;\r\n\r\n        if (rankingsCache[slotId]?.[rarity]) {\r\n            displayRankings(rankingsCache[slotId][rarity], rarity);\r\n        }\r\n    }\r\n}\r\n\r\n// ============================================================================\r\n// SUMMARY DISPLAY\r\n// ============================================================================\r\n\r\n/**\r\n * Load rankings for all slots and rarities needed for summary display\r\n * Skips slots that are already cached or currently being calculated\r\n */\r\nasync function loadAllRankingsForSummary(): Promise<void> {\r\n    if (!loadoutStore.getSelectedClass()) {\r\n        return; // Don't load rankings if no class is selected\r\n    }\r\n\r\n    const cubeData = gearLabStore.getCubeSlotData();\r\n    if (!cubeData) return;\r\n\r\n    const progressBar = document.getElementById('cube-summary-progress') as HTMLElement;\r\n    const progressFill = document.getElementById('cube-summary-progress-fill') as HTMLElement;\r\n    const progressText = document.getElementById('cube-summary-progress-text') as HTMLElement;\r\n\r\n    // Collect all unique slot+rarity combinations that need to be calculated\r\n    const calculationsNeeded: Array<{ slotId: CubeSlotId; rarity: Rarity }> = [];\r\n\r\n    SLOT_NAMES.forEach(slot => {\r\n        ['regular', 'bonus'].forEach(potentialType => {\r\n            const rarity = cubeData[slot.id][potentialType as PotentialType].rarity;\r\n            const key = `${slot.id}-${rarity}`;\r\n\r\n            // Skip if already cached or currently in progress\r\n            if (!rankingsCache[slot.id]?.[rarity] && !rankingsInProgress[key]) {\r\n                calculationsNeeded.push({ slotId: slot.id, rarity });\r\n            }\r\n        });\r\n    });\r\n\r\n    if (calculationsNeeded.length === 0) {\r\n        return; // All rankings already loaded or in progress\r\n    }\r\n\r\n    // Show progress bar\r\n    if (progressBar) progressBar.style.display = 'block';\r\n    if (progressText) progressText.textContent = `Loading rankings for ${calculationsNeeded.length} slot(s)...`;\r\n\r\n    // Track completed count with proper synchronization\r\n    let completed = 0;\r\n    const total = calculationsNeeded.length;\r\n\r\n    // Process calculations in parallel (but don't wait for all to complete before showing initial results)\r\n    const promises = calculationsNeeded.map(async ({ slotId, rarity }) => {\r\n        try {\r\n            await calculateRankingsForRarity(rarity, slotId);\r\n        } catch (error) {\r\n            console.error(`Failed to load rankings for ${slotId}-${rarity}:`, error);\r\n        } finally {\r\n            // Increment completed count and update progress\r\n            completed++;\r\n            if (progressFill && progressBar) {\r\n                progressFill.style.width = `${(completed / total) * 100}%`;\r\n            }\r\n            if (progressText) {\r\n                progressText.textContent = `Loading rankings... ${completed}/${total}`;\r\n            }\r\n        }\r\n    });\r\n\r\n    // Wait for all calculations to complete\r\n    await Promise.all(promises);\r\n\r\n    // Hide progress bar and refresh summary with updated rankings\r\n    if (progressBar) progressBar.style.display = 'none';\r\n    displayAllSlotsSummary();\r\n}\r\n\r\n/**\r\n * Display summary of all slots\r\n */\r\nfunction displayAllSlotsSummary(): void {\r\n    const resultsDiv = document.getElementById('cube-summary-results');\r\n    if (!resultsDiv) return;\r\n\r\n    if (!loadoutStore.getSelectedClass()) {\r\n        resultsDiv.innerHTML = '<p style=\"text-align: center; color: var(--text-secondary);\">Please select a class to view summary.</p>';\r\n        return;\r\n    }\r\n\r\n    const cubeData = gearLabStore.getCubeSlotData();\r\n    if (!cubeData) return;\r\n\r\n    const currentStats = loadoutStore.getBaseStats();\r\n\r\n    // Calculate DPS gain for each slot + potential type\r\n    const summaryData: Array<{\r\n        slotId: CubeSlotId;\r\n        slotName: string;\r\n        regularGain: number;\r\n        regularRarity: Rarity;\r\n        bonusGain: number;\r\n        bonusRarity: Rarity;\r\n    }> = [];\r\n\r\n    SLOT_NAMES.forEach(slot => {\r\n        // Regular Potential\r\n        const regularData = cubeData[slot.id].regular;\r\n        const regularResult = calculateSlotSetGain(slot.id, regularData.rarity, regularData.setA, currentStats);\r\n        const regularGain = regularResult.gain;\r\n\r\n        // Bonus Potential\r\n        const bonusData = cubeData[slot.id].bonus;\r\n        const bonusResult = calculateSlotSetGain(slot.id, bonusData.rarity, bonusData.setA, currentStats);\r\n        const bonusGain = bonusResult.gain;\r\n\r\n        summaryData.push({\r\n            slotId: slot.id,\r\n            slotName: slot.name,\r\n            regularGain,\r\n            regularRarity: regularData.rarity,\r\n            bonusGain,\r\n            bonusRarity: bonusData.rarity\r\n        });\r\n    });\r\n\r\n    // Sort by selected column\r\n    if (summarySortColumn === 'regular') {\r\n        summaryData.sort((a, b) => summarySortDescending ? b.regularGain - a.regularGain : a.regularGain - b.regularGain);\r\n    } else {\r\n        summaryData.sort((a, b) => summarySortDescending ? b.bonusGain - a.bonusGain : a.bonusGain - b.bonusGain);\r\n    }\r\n\r\n    // Build HTML table with sortable headers\r\n    const regularSortIndicator = summarySortColumn === 'regular' ? (summarySortDescending ? ' \u25BC' : ' \u25B2') : '';\r\n    const bonusSortIndicator = summarySortColumn === 'bonus' ? (summarySortDescending ? ' \u25BC' : ' \u25B2') : '';\r\n\r\n    let html = `\r\n        <table class=\"stat-weight-table\">\r\n            <thead>\r\n                <tr>\r\n                    <th style=\"text-align: center;\">Slot</th>\r\n                    <th style=\"text-align: center; cursor: pointer; user-select: none;\" onclick=\"window.sortCubeSummaryBy('regular')\">\r\n                        Regular Potential${regularSortIndicator}<br>\r\n                        <span style=\"font-size: 0.8em; font-weight: 400;\">(Set A Gain)</span>\r\n                    </th>\r\n                    <th style=\"text-align: center; cursor: pointer; user-select: none;\" onclick=\"window.sortCubeSummaryBy('bonus')\">\r\n                        Bonus Potential${bonusSortIndicator}<br>\r\n                        <span style=\"font-size: 0.8em; font-weight: 400;\">(Set A Gain)</span>\r\n                    </th>\r\n                </tr>\r\n            </thead>\r\n            <tbody>\r\n    `;\r\n\r\n    summaryData.forEach((data) => {\r\n        // Format regular potential display\r\n        let regularDisplay: string;\r\n        if (data.regularGain === 0) {\r\n            regularDisplay = '<span style=\"color: var(--text-secondary); font-size: 0.9em;\">No stats</span>';\r\n        } else {\r\n            const regularPercentile = getPercentileForGain(data.slotId, data.regularRarity, data.regularGain, rankingsCache, rankingsInProgress);\r\n            regularDisplay = `\r\n                <span style=\"color: ${data.regularGain >= 0 ? '#4ade80' : '#f87171'}; font-weight: 600;\">\r\n                    ${data.regularGain >= 0 ? '+' : ''}${data.regularGain.toFixed(2)}%\r\n                </span>\r\n                <span style=\"font-size: 0.8em; color: var(--text-secondary); margin: 0 4px;\">\r\n                    ${data.regularRarity.charAt(0).toUpperCase() + data.regularRarity.slice(1)}\r\n                </span>\r\n                <span style=\"font-size: 0.8em;\">\r\n                    ${regularPercentile}\r\n                </span>\r\n            `;\r\n        }\r\n\r\n        // Format bonus potential display\r\n        let bonusDisplay: string;\r\n        if (data.bonusGain === 0) {\r\n            bonusDisplay = '<span style=\"color: var(--text-secondary); font-size: 0.9em;\">No stats</span>';\r\n        } else {\r\n            const bonusPercentile = getPercentileForGain(data.slotId, data.bonusRarity, data.bonusGain, rankingsCache, rankingsInProgress);\r\n            bonusDisplay = `\r\n                <span style=\"color: ${data.bonusGain >= 0 ? '#4ade80' : '#f87171'}; font-weight: 600;\">\r\n                    ${data.bonusGain >= 0 ? '+' : ''}${data.bonusGain.toFixed(2)}%\r\n                </span>\r\n                <span style=\"font-size: 0.8em; color: var(--text-secondary); margin: 0 4px;\">\r\n                    ${data.bonusRarity.charAt(0).toUpperCase() + data.bonusRarity.slice(1)}\r\n                </span>\r\n                <span style=\"font-size: 0.8em;\">\r\n                    ${bonusPercentile}\r\n                </span>\r\n            `;\r\n        }\r\n\r\n        html += `\r\n            <tr>\r\n                <td style=\"font-weight: 600; text-align: center;\">${data.slotName}</td>\r\n                <td style=\"text-align: center;\">${regularDisplay}</td>\r\n                <td style=\"text-align: center;\">${bonusDisplay}</td>\r\n            </tr>\r\n        `;\r\n    });\r\n\r\n    html += `\r\n            </tbody>\r\n        </table>\r\n    `;\r\n\r\n    resultsDiv.innerHTML = html;\r\n}\r\n\r\n/**\r\n * Sort summary by column\r\n */\r\nexport function sortCubeSummaryBy(column: 'regular' | 'bonus'): void {\r\n    if (summarySortColumn === column) {\r\n        summarySortDescending = !summarySortDescending;\r\n    } else {\r\n        summarySortColumn = column;\r\n        summarySortDescending = true;\r\n    }\r\n    displayAllSlotsSummary();\r\n}\r\n\r\n// ============================================================================\r\n// GLOBAL FUNCTION EXPOSURE\r\n// ============================================================================\r\n\r\n/**\r\n * Expose functions to window for HTML onclick handlers\r\n */\r\nfunction exposeGlobalFunctions(): void {\r\n    (window as any).switchCubePotentialType = switchPotentialType;\r\n    (window as any).selectCubeSlot = selectCubeSlot;\r\n    (window as any).sortCubeSummaryBy = sortCubeSummaryBy;\r\n    (window as any).changeCubeRankingsPage = changeCubeRankingsPage;\r\n    (window as any).switchSimDetailTab = switchSimDetailTab;\r\n}\r\n\r\n/**\r\n * Change rankings page\r\n */\r\nexport function changeRankingsPage(newPage: number): void {\r\n    currentRankingsPage = newPage;\r\n    // Rankings display will be updated when tab is visible\r\n}\r\n\r\n// ============================================================================\r\n// SIMULATION DISPLAY HELPERS\r\n// ============================================================================\r\n\r\n/**\r\n * Format slot details for simulation display\r\n */\r\nexport function formatSlotDetails(slots: any[]): string {\r\n    return slots.map((slot) => {\r\n        const linesHTML = slot.lines && slot.lines.length > 0\r\n            ? slot.lines.map((line: PotentialLineEntry | null, i: number) => {\r\n                if (!line) return '';\r\n                const isPercentStat = line.stat.includes('%');\r\n                const valueSuffix = isPercentStat ? '%' : '';\r\n                const primeTag = line.prime ? ' <span style=\"color: var(--accent-primary); font-weight: 600;\">(P)</span>' : '';\r\n                return `L${i+1}: ${line.stat} ${line.value}${valueSuffix}${primeTag}`;\r\n            }).join('<br>')\r\n            : 'No lines';\r\n\r\n        return `\r\n            <div class=\"sim-slot-card\">\r\n                <div class=\"sim-slot-card-header\">\r\n                    ${slot.name} [${slot.rarity.toUpperCase()}]\r\n                </div>\r\n                <div class=\"sim-slot-card-lines\">\r\n                    ${linesHTML}\r\n                </div>\r\n                <div class=\"sim-slot-card-gain\">\r\n                    DPS Gain: +${slot.dpsGain.toFixed(2)}%\r\n                </div>\r\n            </div>\r\n        `;\r\n    }).join('');\r\n}\r\n\r\n/**\r\n * Switch between simulation detail tabs\r\n */\r\nexport function switchSimDetailTab(strategy: string, tab: string): void {\r\n    // Update tab buttons\r\n    document.querySelectorAll(`.sim-detail-tab[data-strategy=\"${strategy}\"]`).forEach(btn => {\r\n        const button = btn as HTMLElement;\r\n        if (button.dataset.tab === tab) {\r\n            button.classList.add('active');\r\n            button.style.borderBottomColor = 'var(--accent-primary)';\r\n        } else {\r\n            button.classList.remove('active');\r\n            button.style.borderBottomColor = 'transparent';\r\n        }\r\n    });\r\n\r\n    // Find the specific details container for this strategy\r\n    const detailsContainer = document.getElementById(`sim-details-${strategy}`);\r\n    if (!detailsContainer) {\r\n        console.error(`Details container for strategy \"${strategy}\" not found`);\r\n        return;\r\n    }\r\n\r\n    // Update content visibility - only within this strategy's details container\r\n    detailsContainer.querySelectorAll(`.sim-detail-content[data-strategy=\"${strategy}\"]`).forEach(content => {\r\n        const element = content as HTMLElement;\r\n        const shouldShow = element.dataset.tab === tab;\r\n        element.style.display = shouldShow ? 'block' : 'none';\r\n\r\n        // Create chart when Distribution tab is shown (charts don't render properly in hidden elements)\r\n        if (shouldShow && tab === 'distribution') {\r\n            const canvas = element.querySelector('canvas') as HTMLCanvasElement;\r\n            if (canvas && !(canvas as any).chart) {\r\n                // Get the stored simulation results and create the chart\r\n                const storedData = (window as any).simulationResultsForCharts;\r\n                if (storedData && storedData.results && storedData.results[strategy]) {\r\n                    const strategyInfo = storedData.strategyInfo[strategy];\r\n                    const gains = storedData.results[strategy].totalGains;\r\n                    // Small delay to ensure the element is visible\r\n                    setTimeout(() => {\r\n                        createSimulationDistributionChart(canvas.id, gains, strategyInfo.name);\r\n                    }, 50);\r\n                }\r\n            }\r\n        }\r\n    });\r\n}\r\n"],
  "mappings": "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",
  "names": ["strategyInfo"]
}
