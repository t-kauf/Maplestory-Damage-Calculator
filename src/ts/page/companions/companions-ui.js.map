{
  "version": 3,
  "sources": ["companions-ui.ts"],
  "sourcesContent": ["/**\r\n * Companion System UI\r\n * Merged from companions-ui.js and companions-presets-ui.js\r\n * Handles all HTML generation and event handling for the companions tab\r\n */\r\n\r\nimport { getCompanionEffects, getMaxCompanionLevel } from '@ts/services/index.js';\r\nimport { loadoutStore } from '@ts/store/loadout.store.js';\r\nimport { addStat, subtractStat } from '@core/services/stat-inputs-service.js';\r\nimport { calculateBothDpsDifferences, presetHasAnyCompanion, generateOptimalPreset } from './companion.js';\r\nimport type {\r\n    CompanionKey,\r\n    CompanionPresetId,\r\n    CompanionPreset,\r\n    CompanionData,\r\n    CompanionEffects,\r\n    CompanionRarity,\r\n    ProcessedEffect,\r\n    DpsComparisonResult,\r\n    BothDpsResults,\r\n    CompanionClass\r\n} from '@ts/types/page/companions/companions.types';\r\nimport { CLASS_DISPLAY_NAMES, RARITY_CONFIG } from '@ts/types/page/companions/companions.types';\r\n\r\n// ============================================================================\r\n// STATE TRACKING\r\n// ============================================================================\r\n\r\n// Track currently selected companion for re-opening detail panel after updates\r\ninterface CurrentCompanion {\r\n    companionKey: CompanionKey;\r\n    className: CompanionClass;\r\n    rarity: CompanionRarity;\r\n    borderColor: string;\r\n    color: string;\r\n}\r\n\r\nlet currentCompanion: CurrentCompanion | null = null;\r\n\r\n// ============================================================================\r\n// INITIALIZATION FUNCTIONS\r\n// ============================================================================\r\n\r\n/**\r\n * Initialize the companions UI\r\n */\r\nexport function initializeCompanionsUI(): void {\r\n    renderCompanionsGrid();\r\n    updateSummary();\r\n    initializePresetsUI();\r\n}\r\n\r\n/**\r\n * Load companions UI from saved state\r\n */\r\nexport function loadCompanionsUI(): void {\r\n    // Load and update UI based on store state\r\n    // (Individual components update themselves via event listeners)\r\n}\r\n\r\n/**\r\n * Attach event listeners to companion-related elements\r\n */\r\nexport function attachCompanionsEventListeners(): void {\r\n    attachCompanionIconListeners();\r\n    attachPresetEventListeners();\r\n    attachClickOutsideListener();\r\n}\r\n\r\n/**\r\n * Refresh the companions UI\r\n */\r\nexport function refreshCompanionsUI(): void {\r\n    renderCompanionsGrid();\r\n    updateSummary();\r\n    refreshPresetsUI();\r\n}\r\n\r\n// ============================================================================\r\n// RENDER FUNCTIONS - GRID & DETAIL PANEL\r\n// ============================================================================\r\n\r\n/**\r\n * Render the companions grid\r\n */\r\nfunction renderCompanionsGrid(): void {\r\n    const container = document.getElementById('companions-grid-container');\r\n    if (!container) return;\r\n\r\n    // Render icon grid and detail panel as separate flex items\r\n    let html = `\r\n        <!-- Icon Grid wrapper -->\r\n        <div class=\"companions-icon-grid-wrapper\">\r\n            <div class=\"companions-icon-grid\">\r\n                ${renderIconGrid()}\r\n            </div>\r\n\r\n            <!-- Clear Slot Button (shown when slot is selected) -->\r\n            <div id=\"clear-slot-selection-container\" style=\"display: none; margin-top: 15px;\">\r\n                <button id=\"clear-slot-selection-btn\" onclick=\"window.clearSelectedSlotCompanion()\" style=\"\r\n                    padding: 10px 20px;\r\n                    background: linear-gradient(135deg, rgba(239, 68, 68, 0.15), rgba(220, 38, 38, 0.1));\r\n                    border: 2px solid #ef4444;\r\n                    border-radius: 8px;\r\n                    color: #ef4444;\r\n                    font-weight: 600;\r\n                    font-size: 0.95em;\r\n                    cursor: pointer;\r\n                    transition: all 0.2s ease;\r\n                    box-shadow: 0 2px 8px rgba(239, 68, 68, 0.2);\r\n                \" onmouseover=\"this.style.background='linear-gradient(135deg, rgba(239, 68, 68, 0.25), rgba(220, 38, 38, 0.2))'; this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 12px rgba(239, 68, 68, 0.3)';\"\r\n                   onmouseout=\"this.style.background='linear-gradient(135deg, rgba(239, 68, 68, 0.15), rgba(220, 38, 38, 0.1))'; this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(239, 68, 68, 0.2)';\">\r\n                    \uD83D\uDDD1\uFE0F Clear Slot\r\n                </button>\r\n            </div>\r\n        </div>\r\n\r\n        <!-- Detail Panel -->\r\n        <div id=\"companion-detail-panel\" class=\"companions-detail-panel\">\r\n            <div id=\"companion-detail-content\">\r\n                ${renderDetailPlaceholder()}\r\n            </div>\r\n        </div>\r\n    `;\r\n\r\n    // Append to container without removing existing elements (like presets)\r\n    const presetsContainer = document.getElementById('companions-presets-container');\r\n    container.innerHTML = html;\r\n\r\n    // Re-append presets container if it existed\r\n    if (presetsContainer) {\r\n        container.appendChild(presetsContainer);\r\n    } else {\r\n        // Create presets container if it doesn't exist\r\n        const newPresetsContainer = document.createElement('div');\r\n        newPresetsContainer.id = 'companions-presets-container';\r\n        newPresetsContainer.className = 'companions-presets-panel';\r\n        container.appendChild(newPresetsContainer);\r\n    }\r\n\r\n    // Attach event listeners\r\n    attachCompanionIconListeners();\r\n}\r\n\r\n/**\r\n * Render placeholder for detail panel\r\n */\r\nfunction renderDetailPlaceholder(): string {\r\n    return `\r\n        <div style=\"\r\n            display: flex;\r\n            flex-direction: column;\r\n            align-items: center;\r\n            justify-content: center;\r\n            height: 300px;\r\n            color: var(--text-secondary);\r\n            text-align: center;\r\n        \">\r\n            <div style=\"font-size: 1.1em; font-weight: 500;\">Select a companion</div>\r\n            <div style=\"font-size: 0.9em; margin-top: 8px; opacity: 0.7;\">\r\n                Click any companion icon to view details and effects\r\n            </div>\r\n        </div>\r\n    `;\r\n}\r\n\r\n/**\r\n * Render the icon grid (all class-rarity combinations)\r\n */\r\nfunction renderIconGrid(): string {\r\n    let html = '';\r\n\r\n    // Create grid for all rarity-class combinations\r\n    Object.entries(RARITY_CONFIG).forEach(([rarity, config]) => {\r\n        config.classes.forEach(className => {\r\n            const companionKey: CompanionKey = `${className}-${rarity}` as CompanionKey;\r\n            const companionData = loadoutStore.getCompanion(companionKey);\r\n            const isUnlocked = companionData?.unlocked ?? false;\r\n            const level = companionData?.level ?? 1;\r\n\r\n            html += `\r\n                <div class=\"companion-icon\"\r\n                     data-companion=\"${companionKey}\"\r\n                     data-class=\"${className}\"\r\n                     data-rarity=\"${rarity}\"\r\n                     data-config-color=\"${config.color}\"\r\n                     data-config-border=\"${config.borderColor}\"\r\n                     style=\"\r\n                        width: 60px;\r\n                        height: 60px;\r\n                        background: linear-gradient(135deg, ${config.color}22, ${config.borderColor}44);\r\n                        border: 2px solid ${isUnlocked ? config.borderColor : '#666'};\r\n                        border-radius: 8px;\r\n                        cursor: pointer;\r\n                        transition: all 0.2s ease;\r\n                        opacity: ${isUnlocked ? '1' : '0.4'};\r\n                        filter: ${isUnlocked ? 'none' : 'grayscale(100%)'};\r\n                        display: flex;\r\n                        align-items: center;\r\n                        justify-content: center;\r\n                        position: relative;\r\n                     \"\r\n                     onmouseover=\"this.style.transform='scale(1.1)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.3)';\"\r\n                     onmouseout=\"this.style.transform='scale(1)'; this.style.boxShadow='none';\">\r\n                    <img class=\"comp-image comp-${className}\" src=\"media/classes/${getClassPngName(className)}.png\" style=\"width: 45px; height: 45px; object-fit: contain;\">\r\n                    ${isUnlocked ? `\r\n                        <div class=\"companion-icon-level\" data-companion=\"${companionKey}\" style=\"position: absolute; top: 2px; right: 2px; font-size: 0.75em; color: white; font-weight: 900; text-shadow: 2px 2px 3px rgba(0,0,0,0.9);\">\r\n                            Lv.${level}\r\n                        </div>\r\n                    ` : ''}\r\n                </div>\r\n            `;\r\n        });\r\n    });\r\n\r\n    return html;\r\n}\r\n\r\n/**\r\n * Show the detail panel for a companion\r\n */\r\nfunction showDetailPanel(\r\n    companionKey: CompanionKey,\r\n    className: CompanionClass,\r\n    rarity: CompanionRarity,\r\n    borderColor: string,\r\n    color: string\r\n): void {\r\n    const panel = document.getElementById('companion-detail-panel');\r\n    const content = document.getElementById('companion-detail-content');\r\n    if (!panel || !content) return;\r\n\r\n    const companionData = loadoutStore.getCompanion(companionKey);\r\n\r\n    const displayName = CLASS_DISPLAY_NAMES[className];\r\n    const isUnlocked = companionData.unlocked;\r\n    const level = companionData.level || 1;\r\n    const maxLevel = getMaxCompanionLevel();\r\n\r\n    // Get companion effects\r\n    let inventoryEffectText = '';\r\n    let equipEffectText = '';\r\n\r\n    if (isUnlocked) {\r\n        const effects = getCompanionEffects(className, rarity, level);\r\n        if (effects) {\r\n            inventoryEffectText = formatEffects(effects.inventoryEffect);\r\n            equipEffectText = formatEffects(effects.equipEffect);\r\n        }\r\n    }\r\n\r\n    content.innerHTML = `\r\n        <!-- Gradient background with color at bottom - takes top 1/3 -->\r\n        <div style=\"\r\n            background: linear-gradient(to top, ${borderColor}88 0%, transparent 50%);\r\n            border-radius: 12px;\r\n            height: 265px;\r\n            width: 400px;\r\n            margin: -20px -20px 20px -20px;\r\n            position: relative;\r\n            pointer-events: none;\r\n            border: solid 1px ${borderColor}\r\n        \">\r\n            <!-- Class animated webp - much larger, centered -->\r\n            <div style=\"position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 400px; height: 400px;\">\r\n                <img class=\"comp-image comp-${className}\" src=\"media/classes/${getClassWebpName(className)}.webp\" style=\"width: 100%; height: 100%; object-fit: contain;\">\r\n            </div>\r\n\r\n            <!-- Class name - absolute bottom left -->\r\n            <div style=\"\r\n                position: absolute;\r\n                bottom: 12px;\r\n                left: 12px;\r\n                color: white;\r\n                font-size: 1.2em;\r\n                font-weight: bold;\r\n                text-shadow: 2px 2px 4px rgba(0,0,0,0.8);\r\n            \">${displayName}</div>\r\n\r\n            <!-- Rarity badge - absolute bottom right -->\r\n            <div style=\"\r\n                position: absolute;\r\n                bottom: 12px;\r\n                right: 12px;\r\n                background: ${borderColor};\r\n                color: white;\r\n                padding: 4px 12px;\r\n                border-radius: 12px;\r\n                font-size: 0.85em;\r\n                font-weight: 600;\r\n                box-shadow: 0 2px 8px rgba(0,0,0,0.3);\r\n            \">${rarity}</div>\r\n        </div>\r\n\r\n        ${isUnlocked ? `\r\n            <!-- Level Input -->\r\n            <div style=\"margin-bottom: 20px;\">\r\n                <label style=\"\r\n                    display: block;\r\n                    margin-bottom: 8px;\r\n                    font-weight: 600;\r\n                    color: var(--text-primary);\r\n                \">Level</label>\r\n                <input type=\"number\"\r\n                       class=\"companion-level-input\"\r\n                       data-companion=\"${companionKey}\"\r\n                       value=\"${level}\"\r\n                       min=\"1\"\r\n                       max=\"${maxLevel}\"\r\n                       onchange=\"window.handleLevelChange('${companionKey}', this.value)\"\r\n                       style=\"\r\n                        width: 100%;\r\n                        padding: 10px;\r\n                        border: 2px solid ${borderColor};\r\n                        border-radius: 8px;\r\n                        background: var(--input-bg);\r\n                        color: var(--text-primary);\r\n                        text-align: center;\r\n                        font-size: 1.1em;\r\n                        font-weight: 600;\r\n                       \">\r\n            </div>\r\n\r\n            <!-- Two column layout: Effects and Lock button -->\r\n            <div style=\"display: flex; gap: 15px;\">\r\n                <!-- Left: Effects Display -->\r\n                <div style=\"\r\n                    flex: 1;\r\n                    border-top: 1px solid var(--border-color);\r\n                \">\r\n                    <h4 style=\"\r\n                        color: ${borderColor};\r\n                        margin: 0 0 10px 0;\r\n                        font-size: 1em;\r\n                        font-weight: 600;\r\n                    \">Effects</h4>\r\n\r\n                    ${inventoryEffectText ? `\r\n                        <div style=\"margin-bottom: 12px;\">\r\n                            <div style=\"\r\n                                font-weight: 600;\r\n                                color: var(--text-primary);\r\n                                margin-bottom: 4px;\r\n                                font-size: 0.9em;\r\n                            \">Inventory</div>\r\n                            <div style=\"\r\n                                font-size: 0.85em;\r\n                                color: var(--text-secondary);\r\n                                line-height: 1.5;\r\n                            \">${inventoryEffectText}</div>\r\n                        </div>\r\n                    ` : ''}\r\n\r\n                    ${equipEffectText ? `\r\n                        <div>\r\n                            <div style=\"\r\n                                font-weight: 600;\r\n                                color: var(--text-primary);\r\n                                margin-bottom: 4px;\r\n                                font-size: 0.9em;\r\n                            \">Equip</div>\r\n                            <div style=\"\r\n                                font-size: 0.85em;\r\n                                color: var(--text-secondary);\r\n                                line-height: 1.5;\r\n                            \">${equipEffectText}</div>\r\n                        </div>\r\n                    ` : ''}\r\n                </div>\r\n\r\n                <!-- Right: Lock/Unlock button -->\r\n                <div style=\"flex: 1; display: flex; align-items: flex-start;\">\r\n                    <button onclick=\"window.toggleCompanionLock('${companionKey}')\" style=\"\r\n                        width: 100%;\r\n                        padding: 12px;\r\n                        background: rgba(239, 68, 68, 0.15);\r\n                        border: 2px solid #ef4444;\r\n                        border-radius: 8px;\r\n                        color: #ef4444;\r\n                        font-weight: 600;\r\n                        cursor: pointer;\r\n                        transition: all 0.2s ease;\r\n                    \">\r\n                        \uD83D\uDD12 Lock Companion\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        ` : `\r\n            <!-- Locked state: show unlock button -->\r\n            <div style=\"display: flex; justify-content: center; padding-top: 20px;\">\r\n                <button onclick=\"window.toggleCompanionLock('${companionKey}')\" style=\"\r\n                    width: 100%;\r\n                    padding: 12px;\r\n                    background: rgba(16, 185, 129, 0.15);\r\n                    border: 2px solid #10b981;\r\n                    border-radius: 8px;\r\n                    color: #10b981;\r\n                    font-weight: 600;\r\n                    cursor: pointer;\r\n                    transition: all 0.2s ease;\r\n                \">\r\n                    \uD83D\uDD13 Unlock Companion\r\n                </button>\r\n            </div>\r\n        `}\r\n    `;\r\n\r\n    panel.style.borderColor = borderColor;\r\n}\r\n\r\n// ============================================================================\r\n// RENDER FUNCTIONS - PRESETS\r\n// ============================================================================\r\n\r\n/**\r\n * Initialize the presets UI\r\n */\r\nfunction initializePresetsUI(): void {\r\n    // Update ContributedStats for current equipped preset on init\r\n    const equippedPresetId = loadoutStore.getEquippedPresetId();\r\n    updateContributedStatsForPreset(equippedPresetId);\r\n    renderPresetsPanel();\r\n}\r\n\r\n/**\r\n * Render the presets panel\r\n */\r\nfunction renderPresetsPanel(): void {\r\n    const container = document.getElementById('companions-presets-container');\r\n    if (!container) return;\r\n\r\n    // Skip expensive optimal preset generation if companions tab is not visible\r\n    const companionsTab = document.getElementById('setup-companions');\r\n    const isTabVisible = companionsTab && companionsTab.classList.contains('active');\r\n\r\n    if (!isTabVisible) {\r\n        // Still render basic UI without optimal presets\r\n        const showDpsComparison = loadoutStore.getShowPresetDpsComparison();\r\n        const equippedPresetId = loadoutStore.getEquippedPresetId();\r\n        const currentPresetEffects = getPresetEquipEffects(equippedPresetId);\r\n\r\n        let html = '<div style=\"display: flex; flex-direction: column; gap: 12px;\">';\r\n\r\n        // Add toggle header\r\n        html += `\r\n            <header style=\"margin-bottom: 8px; padding: 10px 12px; background: rgba(0, 122, 255, 0.08); border: 1px solid rgba(0, 122, 255, 0.2); border-radius: 8px; display: flex; align-items: center; justify-content: space-between;\">\r\n                <span style=\"font-weight: 600; color: var(--text-primary);\">Show DPS Comparison</span>\r\n                <label style=\"display: flex; align-items: center; gap: 8px; cursor: pointer;\">\r\n                    <input type=\"checkbox\" id=\"preset-dps-comparison-toggle\" onchange=\"window.togglePresetDpsComparison(this.checked)\" ${showDpsComparison ? 'checked' : ''}>\r\n                    <span style=\"font-size: 0.9em; color: var(--text-secondary);\">Enable DPS info below each preset</span>\r\n                </label>\r\n            </header>\r\n        `;\r\n\r\n        // Render user presets only (skip optimal ones)\r\n        for (let i = 1; i <= 5; i++) {\r\n            const presetId: CompanionPresetId = `preset${i}` as CompanionPresetId;\r\n            const presetData = loadoutStore.getPreset(presetId);\r\n            const isEquipped = presetId === equippedPresetId;\r\n            html += renderPresetRow(presetId, presetData, isEquipped, showDpsComparison, currentPresetEffects, false);\r\n        }\r\n\r\n        html += '</div>';\r\n        container.innerHTML = html;\r\n        attachPresetEventListeners();\r\n        return;\r\n    }\r\n\r\n    const showDpsComparison = loadoutStore.getShowPresetDpsComparison();\r\n    const equippedPresetId = loadoutStore.getEquippedPresetId();\r\n\r\n    // Get current and all preset effects for DPS comparison\r\n    const currentPresetEffects = getPresetEquipEffects(equippedPresetId);\r\n\r\n    // Generate optimal presets for boss and normal damage\r\n    const maxBossDpsPreset = generateOptimalPreset(\r\n        'bossDamage',\r\n        getCompanionEffects,\r\n        (key) => loadoutStore.getCompanion(key),\r\n        getMaxCompanionLevel,\r\n        loadoutStore.getLockedMainCompanion('optimal-boss')\r\n    );\r\n    const maxNormalDpsPreset = generateOptimalPreset(\r\n        'normalDamage',\r\n        getCompanionEffects,\r\n        (key) => loadoutStore.getCompanion(key),\r\n        getMaxCompanionLevel,\r\n        loadoutStore.getLockedMainCompanion('optimal-normal')\r\n    );\r\n\r\n    let html = '<div style=\"display: flex; flex-direction: column; gap: 12px;\">';\r\n\r\n    // Add toggle header at the top\r\n    html += `\r\n        <header style=\"margin-bottom: 8px; padding: 10px 12px; background: rgba(0, 122, 255, 0.08); border: 1px solid rgba(0, 122, 255, 0.2); border-radius: 8px; display: flex; align-items: center; justify-content: space-between;\">\r\n            <span style=\"font-weight: 600; color: var(--text-primary);\">Show DPS Comparison</span>\r\n            <label style=\"display: flex; align-items: center; gap: 8px; cursor: pointer;\">\r\n                <input type=\"checkbox\" id=\"preset-dps-comparison-toggle\" onchange=\"window.togglePresetDpsComparison(this.checked)\" ${showDpsComparison ? 'checked' : ''}>\r\n                <span style=\"font-size: 0.9em; color: var(--text-secondary);\">Enable DPS info below each preset</span>\r\n            </label>\r\n        </header>\r\n    `;\r\n\r\n    // Render 5 user presets\r\n    for (let i = 1; i <= 5; i++) {\r\n        const presetId: CompanionPresetId = `preset${i}` as CompanionPresetId;\r\n        const presetData = loadoutStore.getPreset(presetId);\r\n        const isEquipped = presetId === equippedPresetId;\r\n\r\n        html += renderPresetRow(presetId, presetData, isEquipped, showDpsComparison, currentPresetEffects, false);\r\n    }\r\n\r\n    // Render 2 special optimal presets\r\n    html += renderPresetRow('optimal-boss', maxBossDpsPreset, false, showDpsComparison, currentPresetEffects, true, 'Max Boss Dmg');\r\n    html += renderPresetRow('optimal-normal', maxNormalDpsPreset, false, showDpsComparison, currentPresetEffects, true, 'Max Normal Dmg');\r\n\r\n    html += '</div>';\r\n\r\n    container.innerHTML = html;\r\n\r\n    // Attach event listeners (only for user presets, not optimal ones)\r\n    attachPresetEventListeners();\r\n}\r\n\r\n/**\r\n * Render a single preset row\r\n */\r\nfunction renderPresetRow(\r\n    presetId: CompanionPresetId,\r\n    presetData: CompanionPreset,\r\n    isEquipped: boolean,\r\n    showDpsComparison: boolean,\r\n    currentPresetEffects: Record<string, number>,\r\n    isSpecialPreset = false,\r\n    customLabel: string | null = null\r\n): string {\r\n    // Format number helper\r\n    const formatNumber = (num: number): string => {\r\n        if (num >= 1000000) return (num / 1000000).toFixed(2) + 'M';\r\n        if (num >= 1000) return (num / 1000).toFixed(1) + 'K';\r\n        return Math.floor(num).toString();\r\n    };\r\n\r\n    // Determine label\r\n    const labelText = customLabel || presetId.replace('preset', '#');\r\n\r\n    // Determine border color (gold for special presets)\r\n    const borderColor = isSpecialPreset ? '#fbbf24' : (isEquipped ? '#10b981' : 'var(--border-color)');\r\n\r\n    // For optimal presets, check if main is locked\r\n    const isLocked = isSpecialPreset &&\r\n        (presetId === 'optimal-boss' || presetId === 'optimal-normal') &&\r\n        loadoutStore.getLockedMainCompanion(presetId) !== null;\r\n\r\n    // Build the preset row HTML\r\n    let html = `\r\n        <div class=\"preset-row\" data-preset=\"${presetId}\" data-special=\"${isSpecialPreset}\" style=\"\r\n            display: flex;\r\n            flex-direction: column;\r\n            background: var(--background);\r\n            border: 2px solid ${borderColor};\r\n            border-radius: 8px;\r\n            transition: all 0.2s ease;\r\n            ${isSpecialPreset ? 'background: linear-gradient(135deg, rgba(251, 191, 36, 0.05), rgba(245, 158, 11, 0.03));' : ''}\r\n        \">\r\n            <!-- Top row: label, slots, and badge -->\r\n            <div style=\"\r\n                display: flex;\r\n                align-items: center;\r\n                gap: 8px;\r\n                padding: 10px 12px;\r\n            \">\r\n                <!-- Preset label -->\r\n                <div style=\"\r\n                    font-size: 0.8em;\r\n                    font-weight: 600;\r\n                    color: ${isSpecialPreset ? '#fbbf24' : 'var(--text-secondary)'};\r\n                    min-width: ${customLabel ? '100px' : '45px'};\r\n                    text-align: right;\r\n                    margin-right: 4px;\r\n                \">${labelText}</div>\r\n\r\n                <!-- Main slot -->\r\n                ${isSpecialPreset ? renderOptimalMainSlot(presetId, presetData.main, 80, isLocked) : renderSlot(presetId, 'main', 0, presetData.main, 80)}\r\n\r\n                <!-- Sub slots (6 in a row) -->\r\n                ${presetData.subs.map((sub, index) =>\r\n                    isSpecialPreset ? renderReadOnlySlot(sub, 50) : renderSlot(presetId, 'sub', index, sub, 50)\r\n                ).join('')}\r\n\r\n                <!-- Badge for equipped or lock button for special presets -->\r\n                ${isSpecialPreset ? `\r\n                    <button onclick=\"window.toggleOptimalLock('${presetId}')\" style=\"\r\n                        margin-left: auto;\r\n                        padding: 6px 12px;\r\n                        background: ${isLocked ? 'linear-gradient(135deg, rgba(239, 68, 68, 0.15), rgba(220, 38, 38, 0.1))' : 'linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(59, 130, 246, 0.1))'};\r\n                        border: 2px solid ${isLocked ? '#ef4444' : '#3b82f6'};\r\n                        border-radius: 6px;\r\n                        color: ${isLocked ? '#ef4444' : '#3b82f6'};\r\n                        font-weight: 600;\r\n                        font-size: 0.8em;\r\n                        cursor: pointer;\r\n                        transition: all 0.2s ease;\r\n                        white-space: nowrap;\r\n                    \" onmouseover=\"this.style.background='${isLocked ? 'rgba(239, 68, 68, 0.25)' : 'rgba(59, 130, 246, 0.25)'}'; this.style.transform='translateY(-1px)';\"\r\n                       onmouseout=\"this.style.background='${isLocked ? 'linear-gradient(135deg, rgba(239, 68, 68, 0.15), rgba(220, 38, 38, 0.1))' : 'linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(59, 130, 246, 0.1))'}'; this.style.transform='translateY(0)';\">\r\n                        ${isLocked ? 'CLEAR LOCK' : 'LOCK MAIN'}\r\n                    </button>\r\n                ` : (isEquipped ? `\r\n                    <div style=\"\r\n                        margin-left: auto;\r\n                        padding: 6px 12px;\r\n                        background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(16, 185, 129, 0.1));\r\n                        border: 2px solid #10b981;\r\n                        border-radius: 6px;\r\n                        color: #10b981;\r\n                        font-weight: 700;\r\n                        font-size: 0.8em;\r\n                        white-space: nowrap;\r\n                    \">\u2713 EQUIPPED</div>\r\n                ` : `\r\n                    <button onclick=\"window.equipPreset('${presetId}')\" style=\"\r\n                        margin-left: auto;\r\n                        padding: 6px 14px;\r\n                        background: linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(59, 130, 246, 0.1));\r\n                        border: 2px solid #3b82f6;\r\n                        border-radius: 6px;\r\n                        color: #3b82f6;\r\n                        font-weight: 600;\r\n                        font-size: 0.8em;\r\n                        cursor: pointer;\r\n                        transition: all 0.2s ease;\r\n                        white-space: nowrap;\r\n                    \" onmouseover=\"this.style.background='rgba(59, 130, 246, 0.25)'; this.style.transform='translateY(-1px)';\"\r\n                       onmouseout=\"this.style.background='linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(59, 130, 246, 0.1))'; this.style.transform='translateY(0)';\">\r\n                        EQUIP\r\n                    </button>\r\n                `)}\r\n            </div>\r\n    `;\r\n\r\n    // Add DPS comparison section if enabled and preset has companions\r\n    if (showDpsComparison && presetHasAnyCompanion(presetData)) {\r\n        const targetPresetEffects = isSpecialPreset\r\n            ? getPresetEquipEffectsFromData(presetData)\r\n            : getPresetEquipEffects(presetId);\r\n\r\n        const dpsResults = calculateBothDpsDifferences(currentPresetEffects, targetPresetEffects);\r\n\r\n        html += renderDpsComparisonSection(dpsResults, isEquipped, formatNumber);\r\n    }\r\n\r\n    html += `</div>`;\r\n    return html;\r\n}\r\n\r\n/**\r\n * Render DPS comparison section for a preset row\r\n */\r\nfunction renderDpsComparisonSection(\r\n    dpsResults: BothDpsResults,\r\n    isEquipped: boolean,\r\n    formatNumber: (num: number) => string\r\n): string {\r\n    let html = `\r\n        <div class=\"preset-dps-comparison\" style=\"\r\n            margin-top: 8px;\r\n            padding: 10px 12px;\r\n            background: linear-gradient(135deg, rgba(0, 122, 255, 0.08), rgba(88, 86, 214, 0.05));\r\n            border-top: 1px solid rgba(0, 122, 255, 0.2);\r\n            border-radius: 0 0 6px 6px;\r\n        \">\r\n            <div style=\"display: flex; gap: 20px; justify-content: space-around;\">\r\n    `;\r\n\r\n    if (isEquipped) {\r\n        // Show current DPS and gain over baseline for equipped preset\r\n        const bossGainOverBaseline = dpsResults.boss.currentPresetGain;\r\n        const normalGainOverBaseline = dpsResults.normal.currentPresetGain;\r\n        const bossPctGain = dpsResults.boss.baselineDps > 0 ? (bossGainOverBaseline / dpsResults.boss.baselineDps) * 100 : 0;\r\n        const normalPctGain = dpsResults.normal.baselineDps > 0 ? (normalGainOverBaseline / dpsResults.normal.baselineDps) * 100 : 0;\r\n\r\n        html += `\r\n            <div style=\"text-align: center;\">\r\n                <div style=\"font-size: 0.75em; color: var(--text-secondary); margin-bottom: 4px;\">DPS vs Boss</div>\r\n                <div style=\"font-size: 1em; font-weight: 700; color: var(--accent-success);\">\r\n                    Current\r\n                </div>\r\n                <div style=\"font-size: 0.7em; color: var(--text-secondary);\">\r\n                    ${formatNumber(dpsResults.boss.currentPresetDps)}\r\n                </div>\r\n                <div style=\"font-size: 0.65em; color: var(--text-secondary);\">\r\n                    +${bossPctGain.toFixed(1)}% over baseline\r\n                </div>\r\n            </div>\r\n            <div style=\"text-align: center;\">\r\n                <div style=\"font-size: 0.75em; color: var(--text-secondary); margin-bottom: 4px;\">DPS vs Monster</div>\r\n                <div style=\"font-size: 1em; font-weight: 700; color: var(--accent-success);\">\r\n                    Current\r\n                </div>\r\n                <div style=\"font-size: 0.7em; color: var(--text-secondary);\">\r\n                    ${formatNumber(dpsResults.normal.currentPresetDps)}\r\n                </div>\r\n                <div style=\"font-size: 0.65em; color: var(--text-secondary);\">\r\n                    +${normalPctGain.toFixed(1)}% over baseline\r\n                </div>\r\n            </div>\r\n        `;\r\n    } else {\r\n        // Show DPS difference relative to current preset for non-equipped presets\r\n        const bossGain = dpsResults.boss.dpsGain;\r\n        const normalGain = dpsResults.normal.dpsGain;\r\n\r\n        html += `\r\n            <div style=\"text-align: center;\">\r\n                <div style=\"font-size: 0.75em; color: var(--text-secondary); margin-bottom: 4px;\">DPS vs Boss</div>\r\n                <div style=\"font-size: 1em; font-weight: 700;\">\r\n                    <span style=\"color: ${bossGain >= 0 ? '#10b981' : '#ef4444'};\">\r\n                        ${bossGain >= 0 ? '+' : ''}${bossGain.toFixed(2)}%\r\n                    </span>\r\n                </div>\r\n                <div style=\"font-size: 0.7em; color: var(--text-secondary);\">\r\n                    ${formatNumber(dpsResults.boss.newPresetDps)}\r\n                </div>\r\n            </div>\r\n            <div style=\"text-align: center;\">\r\n                <div style=\"font-size: 0.75em; color: var(--text-secondary); margin-bottom: 4px;\">DPS vs Monster</div>\r\n                <div style=\"font-size: 1em; font-weight: 700;\">\r\n                    <span style=\"color: ${normalGain >= 0 ? '#10b981' : '#ef4444'};\">\r\n                        ${normalGain >= 0 ? '+' : ''}${normalGain.toFixed(2)}%\r\n                    </span>\r\n                </div>\r\n                <div style=\"font-size: 0.7em; color: var(--text-secondary);\">\r\n                    ${formatNumber(dpsResults.normal.newPresetDps)}\r\n                </div>\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    html += `\r\n                </div>\r\n            </div>\r\n        `;\r\n\r\n    return html;\r\n}\r\n\r\n/**\r\n * Render a single slot\r\n */\r\nfunction renderSlot(\r\n    presetId: CompanionPresetId,\r\n    slotType: 'main' | 'sub',\r\n    slotIndex: number,\r\n    companionKey: CompanionKey | null,\r\n    size: number\r\n): string {\r\n    const slotId = `${presetId}-${slotType}-${slotIndex}`;\r\n\r\n    if (!companionKey) {\r\n        // Empty slot\r\n        return `\r\n            <div class=\"preset-slot empty-slot\"\r\n                 data-preset=\"${presetId}\"\r\n                 data-slot-type=\"${slotType}\"\r\n                 data-slot-index=\"${slotIndex}\"\r\n                 data-slot-id=\"${slotId}\"\r\n                 style=\"\r\n                    width: ${size}px;\r\n                    height: ${size}px;\r\n                    border: 2px dashed #666;\r\n                    border-radius: 8px;\r\n                    background: rgba(255,255,255,0.05);\r\n                    display: flex;\r\n                    align-items: center;\r\n                    justify-content: center;\r\n                    cursor: pointer;\r\n                    transition: all 0.2s ease;\r\n                    position: relative;\r\n                    overflow: hidden;\r\n                 \"\r\n                 onmouseover=\"this.style.background='rgba(255,255,255,0.1)';\"\r\n                 onmouseout=\"this.style.background='rgba(255,255,255,0.05)';\">\r\n                <div style=\"font-size: ${size * 0.5}px; color: #888; font-weight: bold;\">+</div>\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    // Filled slot\r\n    const [className, rarity] = companionKey.split('-');\r\n    const config = RARITY_CONFIG[rarity as CompanionRarity] || RARITY_CONFIG['Normal'];\r\n    const companionData = loadoutStore.getCompanion(companionKey);\r\n    const level = companionData?.level ?? 1;\r\n    const isLocked = !companionData?.unlocked;\r\n\r\n    // For main slots: use webp with preset-specific class\r\n    // For sub slots: use png with preset-specific sub class\r\n    const isMain = slotType === 'main';\r\n    const iconName = isMain ? getClassWebpName(className as CompanionClass) : getClassPngName(className as CompanionClass);\r\n    const iconExt = isMain ? 'webp' : 'png';\r\n    const iconClass = isMain\r\n        ? `comp-image comp-preset-${className}`\r\n        : `comp-image comp-preset-sub-${className}`;\r\n\r\n    return `\r\n        <div class=\"preset-slot filled-slot ${isLocked ? 'locked-companion-slot' : ''}\"\r\n             data-preset=\"${presetId}\"\r\n             data-slot-type=\"${slotType}\"\r\n             data-slot-index=\"${slotIndex}\"\r\n             data-slot-id=\"${slotId}\"\r\n             data-companion=\"${companionKey}\"\r\n             data-main-rarity=\"${isMain ? rarity : ''}\"\r\n             style=\"\r\n                width: ${size}px;\r\n                height: ${size}px;\r\n                background: linear-gradient(135deg, ${config.color}22, ${config.borderColor}44);\r\n                border: 2px solid ${isLocked ? '#ef4444' : config.borderColor};\r\n                border-radius: 8px;\r\n                cursor: pointer;\r\n                transition: all 0.2s ease;\r\n                position: relative;\r\n                overflow: hidden;\r\n                display: flex;\r\n                align-items: center;\r\n                justify-content: center;\r\n                opacity: ${isLocked ? '0.6' : '1'};\r\n             \">\r\n            <!-- Companion icon (scaled up and clipped) -->\r\n            <div style=\"\r\n                position: absolute;\r\n                width: ${size * 1.5}px;\r\n                height: ${size * 1.5}px;\r\n                display: flex;\r\n                align-items: center;\r\n                justify-content: center;\r\n                ${isLocked ? 'filter: grayscale(100%);' : ''}\r\n            \">\r\n                <img class=\"${iconClass}\" src=\"media/classes/${iconName}.${iconExt}\" style=\"\r\n                    width: 100%;\r\n                    height: 100%;\r\n                    object-fit: contain;\r\n                \">\r\n            </div>\r\n\r\n            <!-- Level badge -->\r\n            <div style=\"\r\n                position: absolute;\r\n                top: 2px;\r\n                right: 2px;\r\n                font-size: 0.65em;\r\n                color: white;\r\n                font-weight: 900;\r\n                text-shadow: 1px 1px 2px rgba(0,0,0,0.9);\r\n                background: rgba(0,0,0,0.5);\r\n                padding: 1px 3px;\r\n                border-radius: 4px;\r\n            \">${level}</div>\r\n\r\n            ${isLocked ? `\r\n            <!-- Locked warning indicator -->\r\n            <div style=\"\r\n                position: absolute;\r\n                top: 2px;\r\n                left: 2px;\r\n                font-size: ${size * 0.25}px;\r\n                line-height: 1;\r\n                background: rgba(239, 68, 68, 0.9);\r\n                color: white;\r\n                width: ${size * 0.35}px;\r\n                height: ${size * 0.35}px;\r\n                border-radius: 50%;\r\n                display: flex;\r\n                align-items: center;\r\n                justify-content: center;\r\n                box-shadow: 0 2px 4px rgba(0,0,0,0.3);\r\n                z-index: 10;\r\n            \">\u26A0\uFE0F</div>\r\n            ` : ''}\r\n        </div>\r\n    `;\r\n}\r\n\r\n/**\r\n * Render optimal preset main slot (clickable for lock management)\r\n */\r\nfunction renderOptimalMainSlot(\r\n    presetId: CompanionPresetId,\r\n    companionKey: CompanionKey | null,\r\n    size: number,\r\n    isLocked: boolean\r\n): string {\r\n    if (!companionKey) {\r\n        // Empty slot - clickable to select\r\n        return `\r\n            <div class=\"preset-slot optimal-main-slot\"\r\n                 data-preset=\"${presetId}\"\r\n                 data-slot-type=\"main\"\r\n                 data-slot-index=\"0\"\r\n                 style=\"\r\n                    width: ${size}px;\r\n                    height: ${size}px;\r\n                    border: 2px dashed #666;\r\n                    border-radius: 8px;\r\n                    background: rgba(255,255,255,0.05);\r\n                    display: flex;\r\n                    align-items: center;\r\n                    justify-content: center;\r\n                    cursor: pointer;\r\n                    transition: all 0.2s ease;\r\n                    position: relative;\r\n                    overflow: hidden;\r\n                 \"\r\n                 onmouseover=\"this.style.background='rgba(255,255,255,0.1)';\"\r\n                 onmouseout=\"this.style.background='rgba(255,255,255,0.05)';\">\r\n                <div style=\"font-size: ${size * 0.5}px; color: #888; font-weight: bold;\">+</div>\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    // Filled slot\r\n    const [className, rarity] = companionKey.split('-');\r\n    const config = RARITY_CONFIG[rarity as CompanionRarity] || RARITY_CONFIG['Normal'];\r\n    const iconName = getClassWebpName(className as CompanionClass);\r\n    const iconClass = `comp-image comp-preset-${className}`;\r\n\r\n    return `\r\n        <div class=\"preset-slot optimal-main-slot filled-slot\"\r\n             data-preset=\"${presetId}\"\r\n             data-slot-type=\"main\"\r\n             data-slot-index=\"0\"\r\n             data-companion=\"${companionKey}\"\r\n             style=\"\r\n                width: ${size}px;\r\n                height: ${size}px;\r\n                background: linear-gradient(135deg, ${config.color}22, ${config.borderColor}44);\r\n                border: 2px solid ${config.borderColor};\r\n                border-radius: 8px;\r\n                cursor: pointer;\r\n                transition: all 0.2s ease;\r\n                position: relative;\r\n                overflow: hidden;\r\n                display: flex;\r\n                align-items: center;\r\n                justify-content: center;\r\n                opacity: 0.8;\r\n             \">\r\n            <!-- Companion icon (scaled up and clipped) -->\r\n            <div style=\"\r\n                position: absolute;\r\n                width: ${size * 1.5}px;\r\n                height: ${size * 1.5}px;\r\n                display: flex;\r\n                align-items: center;\r\n                justify-content: center;\r\n            \">\r\n                <img src=\"media/classes/${iconName}.webp\"\r\n                     class=\"${iconClass}\"\r\n                     style=\"width: 100%; height: 100%; object-fit: contain;\"\r\n                     alt=\"${className}\">\r\n            </div>\r\n\r\n            ${isLocked ? `\r\n            <!-- Lock icon indicator -->\r\n            <div style=\"\r\n                position: absolute;\r\n                top: 2px;\r\n                left: 2px;\r\n                font-size: ${size * 0.25}px;\r\n                line-height: 1;\r\n                background: rgba(239, 68, 68, 0.9);\r\n                color: white;\r\n                width: ${size * 0.35}px;\r\n                height: ${size * 0.35}px;\r\n                border-radius: 50%;\r\n                display: flex;\r\n                align-items: center;\r\n                justify-content: center;\r\n                box-shadow: 0 2px 4px rgba(0,0,0,0.3);\r\n                z-index: 10;\r\n            \">\uD83D\uDD12</div>\r\n            ` : ''}\r\n        </div>\r\n    `;\r\n}\r\n\r\n/**\r\n * Render a read-only slot (for optimal presets - non-clickable)\r\n */\r\nfunction renderReadOnlySlot(companionKey: CompanionKey | null, size: number): string {\r\n    if (!companionKey) {\r\n        // Empty slot\r\n        return `\r\n            <div class=\"optimal-readonly-slot\" style=\"\r\n                width: ${size}px;\r\n                height: ${size}px;\r\n                border: 2px dashed #444;\r\n                border-radius: 8px;\r\n                background: rgba(255,255,255,0.03);\r\n                display: flex;\r\n                align-items: center;\r\n                justify-content: center;\r\n                opacity: 0.5;\r\n             \">\r\n                <div style=\"font-size: ${size * 0.5}px; color: #666; font-weight: bold;\">+</div>\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    // Filled slot (read-only)\r\n    const [className, rarity] = companionKey.split('-');\r\n    const config = RARITY_CONFIG[rarity as CompanionRarity] || RARITY_CONFIG['Normal'];\r\n\r\n    // Use PNG icons for sub slots in optimal presets\r\n    const iconName = getClassPngName(className as CompanionClass);\r\n    const iconClass = `comp-image comp-preset-sub-${className}`;\r\n\r\n    return `\r\n        <div class=\"optimal-readonly-slot\" style=\"\r\n            width: ${size}px;\r\n            height: ${size}px;\r\n            background: linear-gradient(135deg, ${config.color}22, ${config.borderColor}44);\r\n            border: 2px solid ${config.borderColor};\r\n            border-radius: 8px;\r\n            position: relative;\r\n            overflow: hidden;\r\n            display: flex;\r\n            align-items: center;\r\n            justify-content: center;\r\n            opacity: 0.8;\r\n         \">\r\n            <!-- Companion icon (scaled up and clipped) -->\r\n            <div style=\"\r\n                position: absolute;\r\n                width: ${size * 1.5}px;\r\n                height: ${size * 1.5}px;\r\n                display: flex;\r\n                align-items: center;\r\n                justify-content: center;\r\n            \">\r\n                <img src=\"media/classes/${iconName}.png\"\r\n                     class=\"${iconClass}\"\r\n                     style=\"width: 100%; height: 100%; object-fit: contain;\"\r\n                     alt=\"${className}\">\r\n            </div>\r\n        </div>\r\n    `;\r\n}\r\n\r\n// ============================================================================\r\n// EVENT HANDLERS\r\n// ============================================================================\r\n\r\n/**\r\n * Attach event listeners to companion icons\r\n */\r\nfunction attachCompanionIconListeners(): void {\r\n    // Icon click to show detail panel\r\n    document.querySelectorAll('.companion-icon').forEach(icon => {\r\n        icon.addEventListener('click', (e) => {\r\n            const target = icon as HTMLElement;\r\n            const companionKey = target.dataset.companion as CompanionKey;\r\n            const className = target.dataset.class as CompanionClass;\r\n            const rarity = target.dataset.rarity as CompanionRarity;\r\n            const borderColor = target.dataset.configBorder || '';\r\n            const color = target.dataset.configColor || '';\r\n\r\n            // Check if a preset slot is selected for assignment\r\n            const selectedSlot = getSelectedSlotInfo();\r\n            if (selectedSlot) {\r\n                // Check if companion is locked and show visual feedback\r\n                const companionData = loadoutStore.getCompanion(companionKey);\r\n                if (!companionData?.unlocked) {\r\n                    // Add shake animation\r\n                    target.style.animation = 'shake 0.5s ease-in-out';\r\n                    setTimeout(() => {\r\n                        target.style.animation = '';\r\n                    }, 500);\r\n\r\n                    // For locked companions, show detail panel so user can unlock them\r\n                    // Don't return early - fall through to detail panel display below\r\n                } else {\r\n                    // Unlocked companion - assign to slot and return\r\n                    assignCompanionToSlot(companionKey);\r\n                    return;\r\n                }\r\n            }\r\n\r\n            // Track current companion\r\n            currentCompanion = { companionKey, className, rarity, borderColor, color };\r\n\r\n            // Update active state\r\n            document.querySelectorAll('.companion-icon').forEach(i => {\r\n                (i as HTMLElement).style.boxShadow = 'none';\r\n            });\r\n            target.style.boxShadow = `0 0 0 3px ${borderColor}`;\r\n\r\n            // Show detail panel\r\n            showDetailPanel(companionKey, className, rarity, borderColor, color);\r\n        });\r\n    });\r\n}\r\n\r\n/**\r\n * Attach event listeners to preset slots\r\n */\r\nfunction attachPresetEventListeners(): void {\r\n    document.querySelectorAll('.preset-slot').forEach(slot => {\r\n        slot.addEventListener('click', (e) => {\r\n            e.stopPropagation();\r\n            handleSlotClick(slot as HTMLElement);\r\n        });\r\n\r\n        // Right-click to clear filled slot\r\n        slot.addEventListener('contextmenu', (e) => {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n            const target = slot as HTMLElement;\r\n            const presetId = target.dataset.preset as CompanionPresetId;\r\n            const slotType = target.dataset.slotType as 'main' | 'sub';\r\n            const slotIndex = parseInt(target.dataset.slotIndex || '0');\r\n            const companionKey = target.dataset.companion as CompanionKey | null;\r\n\r\n            if (companionKey) {\r\n                loadoutStore.clearPresetSlot(presetId, slotType, slotIndex);\r\n                renderPresetsPanel();\r\n            }\r\n        });\r\n    });\r\n}\r\n\r\n/**\r\n * Attach click outside listener to clear selection\r\n */\r\nfunction attachClickOutsideListener(): void {\r\n    // Remove existing listener if any\r\n    const existingHandler = (window as any)._companionsClickOutsideHandler;\r\n    if (existingHandler) {\r\n        document.removeEventListener('click', existingHandler);\r\n    }\r\n\r\n    const handler = (e: Event) => {\r\n        const selectedSlot = getSelectedSlotInfo();\r\n        if (!selectedSlot) return;\r\n\r\n        // Check if clicking outside of preset slots and companion icons\r\n        const target = e.target as HTMLElement;\r\n        const clickedSlot = target.closest('.preset-slot');\r\n        const clickedIcon = target.closest('.companion-icon');\r\n\r\n        if (!clickedSlot && !clickedIcon) {\r\n            clearSelectionFeedback();\r\n            clearSelectedSlot();\r\n        }\r\n    };\r\n\r\n    (window as any)._companionsClickOutsideHandler = handler;\r\n    document.addEventListener('click', handler);\r\n}\r\n\r\n/**\r\n * Handle slot click\r\n */\r\nfunction handleSlotClick(slot: HTMLElement): void {\r\n    const presetId = slot.dataset.preset as CompanionPresetId;\r\n    const slotType = slot.dataset.slotType as 'main' | 'sub';\r\n    const slotIndex = parseInt(slot.dataset.slotIndex || '0');\r\n    const mainRarity = slot.dataset.mainRarity;\r\n\r\n    // Check if this is an optimal preset slot\r\n    const isOptimalSlot = slot.classList.contains('optimal-main-slot');\r\n\r\n    // For optimal slots, toggle the lock instead of selecting for assignment\r\n    if (isOptimalSlot) {\r\n        // Only optimal-boss and optimal-normal have locked companions\r\n        if (presetId === 'optimal-boss' || presetId === 'optimal-normal') {\r\n            const currentLock = loadoutStore.getLockedMainCompanion(presetId);\r\n            if (currentLock) {\r\n                // Currently locked - clicking the slot should just show that it's locked\r\n                return;\r\n            }\r\n        }\r\n        // Not locked - proceed with selection\r\n    }\r\n\r\n    // Set this as the selected slot\r\n    setSelectedSlot(presetId, slotType, slotIndex);\r\n\r\n    // Clear any previous selection feedback\r\n    clearSelectionFeedback();\r\n\r\n    // Show selection feedback\r\n    if (isOptimalSlot) {\r\n        // For optimal slots, use custom feedback\r\n        slot.style.boxShadow = '0 0 15px 3px rgba(255, 255, 255, 0.6)';\r\n        slot.style.animation = 'pulse-glow 1s infinite';\r\n        showTooltip(slot, 'Select main companion from grid');\r\n        highlightSourceIcons();\r\n    } else {\r\n        showSelectionFeedback(presetId, mainRarity || '');\r\n    }\r\n\r\n    // Show the clear selection button\r\n    const clearBtnContainer = document.getElementById('clear-slot-selection-container');\r\n    if (clearBtnContainer) {\r\n        clearBtnContainer.style.display = 'block';\r\n    }\r\n}\r\n\r\n// ============================================================================\r\n// HELPER FUNCTIONS\r\n// ============================================================================\r\n\r\n/**\r\n * Process effects and return formatted entries\r\n */\r\nfunction processEffects(effects: Record<string, number>): ProcessedEffect[] {\r\n    if (!effects || Object.keys(effects).length === 0) return [];\r\n\r\n    return Object.entries(effects)\r\n        .map(([stat, value]) => {\r\n            // Determine if this stat should display as a percentage\r\n            // Raw value stats (not divided by 10): HitChance, MaxHp, Attack, MainStat\r\n            const isPercentage = !['HitChance', 'MaxHp', 'Attack', 'MainStat'].includes(stat);\r\n\r\n            // Values are already pre-formatted from companion-data.js\r\n            // Just format for display (avoid floating point issues)\r\n            const formattedValue = typeof value === 'number' ?\r\n                (Number.isInteger(value) ? value : value.toFixed(1).replace(/\\.0$/, '')) : value;\r\n\r\n            return {\r\n                stat,\r\n                displayName: formatStat(stat),\r\n                value: formattedValue,\r\n                isPercentage\r\n            };\r\n        });\r\n}\r\n\r\n/**\r\n * Format effects for display in detail panel\r\n */\r\nfunction formatEffects(effects: Record<string, number>): string {\r\n    if (!effects || Object.keys(effects).length === 0) return '';\r\n\r\n    return processEffects(effects)\r\n        .map(entry => `${entry.displayName}: +${entry.value}${entry.isPercentage ? '%' : ''}`)\r\n        .join('<br>');\r\n}\r\n\r\n/**\r\n * Format stat name for display\r\n */\r\nfunction formatStat(stat: string): string {\r\n    const stats: Record<string, string> = {\r\n        'maxhpr': 'Max HP',\r\n        'maxhp': 'Max HP',\r\n        'damage': 'Damage',\r\n        'maxdamage': 'Max Damage Multiplier',\r\n        'hitchance': 'Accuracy',\r\n        'normaldamage': 'Normal Monster Damage',\r\n        'critrate': 'Critical Rate',\r\n        'attackspeed': 'Attack Speed',\r\n        'attack speed': 'Attack Speed',\r\n        'damageInCc': 'Status Effect Damage',\r\n        'bossdamage': 'Boss Monster Damage',\r\n        'mindamage': 'Min Damage Multiplier',\r\n        'mainstat': 'Main Stat',\r\n        'attack': 'Attack'\r\n    };\r\n\r\n    return stats[stat.toLowerCase()] || stat;\r\n}\r\n\r\n/**\r\n * Set the current companion and save its details\r\n */\r\nfunction setCurrentCompanion(\r\n    companionKey: CompanionKey,\r\n    className: CompanionClass,\r\n    rarity: CompanionRarity,\r\n    borderColor: string,\r\n    color: string\r\n): void {\r\n    currentCompanion = { companionKey, className, rarity, borderColor, color };\r\n}\r\n\r\n/**\r\n * Get png icon representation for class\r\n */\r\nfunction getClassPngName(className: CompanionClass): string {\r\n    const names: Record<CompanionClass, string> = {\r\n        'Hero': 'hero',\r\n        'DarkKnight': 'dk',\r\n        'ArchMageIL': 'mage-il',\r\n        'ArchMageFP': 'mage-fp',\r\n        'BowMaster': 'bowmaster',\r\n        'Marksman': 'marksman',\r\n        'NightLord': 'nl',\r\n        'Shadower': 'shadower'\r\n    };\r\n    return names[className];\r\n}\r\n\r\n/**\r\n * Get webp representation for class\r\n */\r\nfunction getClassWebpName(className: CompanionClass): string {\r\n    const names: Record<CompanionClass, string> = {\r\n        'Hero': 'hero',\r\n        'DarkKnight': 'dk',\r\n        'ArchMageIL': 'il',\r\n        'ArchMageFP': 'fp',\r\n        'BowMaster': 'bow',\r\n        'Marksman': 'mark',\r\n        'NightLord': 'night',\r\n        'Shadower': 'shad'\r\n    };\r\n    return names[className];\r\n}\r\n\r\n/**\r\n * Update the summary section\r\n */\r\nfunction updateSummary(): void {\r\n    const container = document.getElementById('companions-summary-content');\r\n    if (!container) return;\r\n\r\n    const totalEffects: Record<string, number> = {};\r\n\r\n    // Calculate total inventory effects from all unlocked companions\r\n    // Iterate over all possible companion combinations\r\n    Object.entries(RARITY_CONFIG).forEach(([rarity, config]) => {\r\n        config.classes.forEach(className => {\r\n            const companionKey: CompanionKey = `${className}-${rarity}` as CompanionKey;\r\n            const data = loadoutStore.getCompanion(companionKey);\r\n\r\n            if (!data?.unlocked) return;\r\n\r\n            const effects = getCompanionEffects(className, rarity, data.level);\r\n\r\n            if (effects && effects.inventoryEffect) {\r\n                Object.entries(effects.inventoryEffect).forEach(([stat, value]) => {\r\n                    totalEffects[stat] = (totalEffects[stat] || 0) + value;\r\n                });\r\n            }\r\n        });\r\n    });\r\n\r\n    // Render summary\r\n    if (Object.keys(totalEffects).length === 0) {\r\n        container.innerHTML = '<span style=\"color: var(--text-secondary); font-style: italic;\">No unlocked companions</span>';\r\n        return;\r\n    }\r\n\r\n    // Use the same processEffects logic for consistency\r\n    const processedEffects = processEffects(totalEffects);\r\n\r\n    // Render each effect as a compact inline badge\r\n    container.innerHTML = processedEffects\r\n        .map(entry => `\r\n            <span style=\"\r\n                display: inline-flex;\r\n                align-items: center;\r\n                gap: 4px;\r\n                background: rgba(0, 122, 255, 0.1);\r\n                padding: 3px 10px;\r\n                border-radius: 12px;\r\n                border: 1px solid var(--border-color);\r\n                white-space: nowrap;\r\n            \">\r\n                <span style=\"font-weight: 600; color: var(--accent-primary);\">${entry.displayName}:</span>\r\n                <span style=\"color: var(--text-primary);\">+${entry.value}${entry.isPercentage ? '%' : ''}</span>\r\n            </span>\r\n        `)\r\n        .join('');\r\n}\r\n\r\n/**\r\n * Get equip effects for all companions in a preset\r\n */\r\nfunction getPresetEquipEffects(presetId: CompanionPresetId): Record<string, number> {\r\n    const preset = loadoutStore.getPreset(presetId);\r\n    const allSlots: (CompanionKey | null)[] = [preset.main, ...preset.subs];\r\n    const totalEffects: Record<string, number> = {};\r\n\r\n    allSlots.forEach(companionKey => {\r\n        if (!companionKey) return;\r\n\r\n        const [className, rarity] = companionKey.split('-');\r\n        const companionData = loadoutStore.getCompanion(companionKey);\r\n\r\n        if (!companionData?.unlocked) return;\r\n\r\n        const level = companionData.level || 1;\r\n        const effects = getCompanionEffects(className, rarity, level);\r\n\r\n        if (effects && effects.equipEffect) {\r\n            Object.entries(effects.equipEffect).forEach(([stat, value]) => {\r\n                totalEffects[stat] = (totalEffects[stat] || 0) + value;\r\n            });\r\n        }\r\n    });\r\n\r\n    return totalEffects;\r\n}\r\n\r\n/**\r\n * Get equip effects from preset data directly (for special optimal presets)\r\n */\r\nfunction getPresetEquipEffectsFromData(preset: CompanionPreset): Record<string, number> {\r\n    if (!preset) return {};\r\n    const allSlots: (CompanionKey | null)[] = [preset.main, ...preset.subs];\r\n    const totalEffects: Record<string, number> = {};\r\n\r\n    allSlots.forEach(companionKey => {\r\n        if (!companionKey) return;\r\n\r\n        const [className, rarity] = companionKey.split('-');\r\n        const companionData = loadoutStore.getCompanion(companionKey);\r\n\r\n        if (!companionData?.unlocked) return;\r\n\r\n        const level = companionData.level || 1;\r\n        const effects = getCompanionEffects(className, rarity, level);\r\n\r\n        if (effects && effects.equipEffect) {\r\n            Object.entries(effects.equipEffect).forEach(([stat, value]) => {\r\n                totalEffects[stat] = (totalEffects[stat] || 0) + value;\r\n            });\r\n        }\r\n    });\r\n\r\n    return totalEffects;\r\n}\r\n\r\n/**\r\n * Update ContributedStats with current preset's effects\r\n */\r\nfunction updateContributedStatsForPreset(presetId: CompanionPresetId): void {\r\n    const effects = getPresetEquipEffects(presetId);\r\n    // TODO: Implement updateCompanionEquippedContributions\r\n    // This will be added when integrating with state management\r\n}\r\n\r\n/**\r\n * Refresh the presets UI\r\n */\r\nfunction refreshPresetsUI(): void {\r\n    renderPresetsPanel();\r\n}\r\n\r\n// ============================================================================\r\n// SLOT SELECTION MANAGEMENT\r\n// ============================================================================\r\n\r\ninterface SlotSelection {\r\n    presetId: CompanionPresetId;\r\n    type: 'main' | 'sub';\r\n    index: number;\r\n}\r\n\r\nfunction getSelectedSlotInfo(): SlotSelection | null {\r\n    return (window as any)._selectedSlotInfo || null;\r\n}\r\n\r\nfunction setSelectedSlot(presetId: CompanionPresetId, type: 'main' | 'sub', index: number): void {\r\n    (window as any)._selectedSlotInfo = { presetId, type, index };\r\n}\r\n\r\nfunction clearSelectedSlot(): void {\r\n    (window as any)._selectedSlotInfo = null;\r\n}\r\n\r\n/**\r\n * Show selection feedback based on main companion's rarity\r\n */\r\nfunction showSelectionFeedback(presetId: CompanionPresetId, mainRarity: string): void {\r\n    const slot = getSelectedSlotInfo();\r\n    if (!slot) return;\r\n\r\n    const slotElement = document.querySelector(`[data-slot-id=\"${presetId}-${slot.type}-${slot.index}\"]`) as HTMLElement;\r\n    if (!slotElement) return;\r\n\r\n    // Add common glow effect\r\n    slotElement.style.boxShadow = '0 0 15px 3px rgba(255, 255, 255, 0.6)';\r\n    slotElement.style.animation = 'pulse-glow 1s infinite';\r\n\r\n    // Show tooltip and highlight source icons for all rarities\r\n    showTooltip(slotElement, 'Select a companion from the left');\r\n    highlightSourceIcons();\r\n}\r\n\r\n/**\r\n * Show tooltip above slot\r\n */\r\nfunction showTooltip(slotElement: HTMLElement, text: string): void {\r\n    const tooltip = document.createElement('div');\r\n    tooltip.id = 'preset-selection-tooltip';\r\n    tooltip.style.cssText = `\r\n        position: absolute;\r\n        top: -35px;\r\n        left: 50%;\r\n        transform: translateX(-50%);\r\n        background: rgba(0,0,0,0.9);\r\n        color: white;\r\n        padding: 6px 12px;\r\n        border-radius: 6px;\r\n        font-size: 0.85em;\r\n        white-space: nowrap;\r\n        z-index: 1000;\r\n        pointer-events: none;\r\n    `;\r\n    tooltip.textContent = text;\r\n    slotElement.style.position = 'relative';\r\n    slotElement.appendChild(tooltip);\r\n}\r\n\r\n/**\r\n * Highlight source companion icons (only unlocked ones)\r\n */\r\nfunction highlightSourceIcons(): void {\r\n    document.querySelectorAll('.companion-icon').forEach(icon => {\r\n        const target = icon as HTMLElement;\r\n        const companionKey = target.dataset.companion as CompanionKey;\r\n        const companionData = loadoutStore.getCompanion(companionKey);\r\n\r\n        // Only highlight unlocked companions\r\n        if (companionData?.unlocked) {\r\n            target.style.transition = 'all 0.3s ease';\r\n            target.style.boxShadow = '0 0 20px 5px rgba(187, 119, 255, 0.4)';\r\n            target.style.transform = 'scale(1.05)';\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * Clear all selection feedback\r\n */\r\nfunction clearSelectionFeedback(): void {\r\n    // Remove glow and animation from slots\r\n    document.querySelectorAll('.preset-slot').forEach(slot => {\r\n        const target = slot as HTMLElement;\r\n        target.style.boxShadow = '';\r\n        target.style.animation = '';\r\n    });\r\n\r\n    // Remove tooltip\r\n    const tooltip = document.getElementById('preset-selection-tooltip');\r\n    if (tooltip) tooltip.remove();\r\n\r\n    // Remove highlight from icons\r\n    document.querySelectorAll('.companion-icon').forEach(icon => {\r\n        const target = icon as HTMLElement;\r\n        target.style.boxShadow = '';\r\n        target.style.transform = '';\r\n    });\r\n\r\n    // Hide the clear selection button\r\n    const clearBtnContainer = document.getElementById('clear-slot-selection-container');\r\n    if (clearBtnContainer) {\r\n        clearBtnContainer.style.display = 'none';\r\n    }\r\n}\r\n\r\n/**\r\n * Assign companion to selected slot\r\n */\r\nfunction assignCompanionToSlot(companionKey: CompanionKey): void {\r\n    const slotInfo = getSelectedSlotInfo();\r\n    if (!slotInfo) return;\r\n\r\n    // Check if this is an optimal preset slot\r\n    const isOptimalPreset = slotInfo.presetId === 'optimal-boss' || slotInfo.presetId === 'optimal-normal';\r\n\r\n    // Check if companion is unlocked\r\n    const companionData = loadoutStore.getCompanion(companionKey);\r\n    if (!companionData?.unlocked) {\r\n        // Show error feedback\r\n        const slotSelector = isOptimalPreset\r\n            ? `.optimal-main-slot[data-preset=\"${slotInfo.presetId}\"]`\r\n            : `[data-slot-id=\"${slotInfo.presetId}-${slotInfo.type}-${slotInfo.index}\"]`;\r\n        const slotElement = document.querySelector(slotSelector) as HTMLElement;\r\n        if (slotElement) {\r\n            showTooltip(slotElement, '\u274C Companion not unlocked!');\r\n            setTimeout(() => {\r\n                const tooltip = document.getElementById('preset-selection-tooltip');\r\n                if (tooltip) tooltip.remove();\r\n            }, 1500);\r\n        }\r\n        return;\r\n    }\r\n\r\n    // For optimal presets, just set the locked main\r\n    if (isOptimalPreset && slotInfo.type === 'main') {\r\n        loadoutStore.setLockedMainCompanion(slotInfo.presetId as 'optimal-boss' | 'optimal-normal', companionKey);\r\n        clearSelectionFeedback();\r\n        clearSelectedSlot();\r\n        renderPresetsPanel();\r\n        return;\r\n    }\r\n\r\n    // Check for duplicates in regular presets\r\n    const preset = loadoutStore.getPreset(slotInfo.presetId);\r\n    const allSlots: (CompanionKey | null)[] = [preset.main, ...preset.subs];\r\n\r\n    const duplicateSlot = allSlots.find((slotKey, idx) => {\r\n        if (slotInfo.type === 'main' && idx === 0) return false;\r\n        if (slotInfo.type === 'sub' && idx === slotInfo.index + 1) return false;\r\n        return slotKey === companionKey;\r\n    });\r\n\r\n    if (duplicateSlot) {\r\n        const slotElement = document.querySelector(`[data-slot-id=\"${slotInfo.presetId}-${slotInfo.type}-${slotInfo.index}\"]`) as HTMLElement;\r\n        if (slotElement) {\r\n            showTooltip(slotElement, '\u274C Already equipped in this preset!');\r\n            setTimeout(() => {\r\n                const tooltip = document.getElementById('preset-selection-tooltip');\r\n                if (tooltip) tooltip.remove();\r\n            }, 1500);\r\n        }\r\n        return;\r\n    }\r\n\r\n    loadoutStore.setPresetSlot(slotInfo.presetId, slotInfo.type, slotInfo.index, companionKey);\r\n\r\n    clearSelectionFeedback();\r\n    clearSelectedSlot();\r\n    renderPresetsPanel();\r\n}\r\n\r\n// ============================================================================\r\n// GLOBAL WINDOW FUNCTIONS (for HTML onclick attributes)\r\n// ============================================================================\r\n\r\n/**\r\n * Toggle companion lock status\r\n */\r\n(window as any).toggleCompanionLock = function(companionKey: CompanionKey): void {\r\n    const current = loadoutStore.getCompanion(companionKey);\r\n    if (!current) return;\r\n\r\n    loadoutStore.updateCompanion(companionKey, {\r\n        ...current,\r\n        unlocked: !current.unlocked\r\n    });\r\n\r\n    // Re-render the grid\r\n    const savedCompanion = currentCompanion;\r\n    renderCompanionsGrid();\r\n    updateSummary();\r\n    refreshPresetsUI();\r\n\r\n    // Re-open the detail panel if there was a selected companion\r\n    if (savedCompanion) {\r\n        setTimeout(() => {\r\n            const icon = document.querySelector(`.companion-icon[data-companion=\"${savedCompanion.companionKey}\"]`) as HTMLElement;\r\n            if (icon) {\r\n                icon.style.boxShadow = `0 0 0 3px ${savedCompanion.borderColor}`;\r\n                showDetailPanel(\r\n                    savedCompanion.companionKey,\r\n                    savedCompanion.className,\r\n                    savedCompanion.rarity,\r\n                    savedCompanion.borderColor,\r\n                    savedCompanion.color\r\n                );\r\n            }\r\n        }, 0);\r\n    }\r\n};\r\n\r\n/**\r\n * Handle level change\r\n */\r\n(window as any).handleLevelChange = function(companionKey: CompanionKey, newLevel: string): void {\r\n    const level = parseInt(newLevel);\r\n    const maxLevel = getMaxCompanionLevel();\r\n\r\n    if (isNaN(level) || level < 1 || level > maxLevel) {\r\n        return;\r\n    }\r\n\r\n    const current = loadoutStore.getCompanion(companionKey);\r\n    if (!current) return;\r\n\r\n    loadoutStore.updateCompanion(companionKey, {\r\n        ...current,\r\n        level: level\r\n    });\r\n\r\n    // Update the icon level text in real-time\r\n    const levelDisplay = document.querySelector(`.companion-icon-level[data-companion=\"${companionKey}\"]`) as HTMLElement;\r\n    if (levelDisplay) {\r\n        levelDisplay.textContent = `Lv.${level}`;\r\n    }\r\n\r\n    // Only update the detail panel and summary, not the whole grid\r\n    if (currentCompanion && currentCompanion.companionKey === companionKey) {\r\n        showDetailPanel(\r\n            currentCompanion.companionKey,\r\n            currentCompanion.className,\r\n            currentCompanion.rarity,\r\n            currentCompanion.borderColor,\r\n            currentCompanion.color\r\n        );\r\n    }\r\n    updateSummary();\r\n    refreshPresetsUI();\r\n};\r\n\r\n/**\r\n * Clear the companion from the selected slot\r\n */\r\n(window as any).clearSelectedSlotCompanion = function(): void {\r\n    const slotInfo = getSelectedSlotInfo();\r\n    if (!slotInfo) return;\r\n\r\n    // Clear the companion from the slot\r\n    loadoutStore.clearPresetSlot(slotInfo.presetId, slotInfo.type, slotInfo.index);\r\n\r\n    // Clear the selection feedback\r\n    clearSelectionFeedback();\r\n    clearSelectedSlot();\r\n\r\n    // Re-render the presets panel\r\n    renderPresetsPanel();\r\n};\r\n\r\n/**\r\n * Toggle preset DPS comparison visibility\r\n */\r\n(window as any).togglePresetDpsComparison = function(checked: boolean): void {\r\n    loadoutStore.setShowPresetDpsComparison(checked);\r\n    renderPresetsPanel();\r\n};\r\n\r\n/**\r\n * Toggle optimal preset lock\r\n */\r\n(window as any).toggleOptimalLock = function(optimalType: 'optimal-boss' | 'optimal-normal'): void {\r\n    const currentLock = loadoutStore.getLockedMainCompanion(optimalType);\r\n\r\n    if (currentLock) {\r\n        // Currently locked - clear the lock\r\n        loadoutStore.setLockedMainCompanion(optimalType, null);\r\n        clearSelectedSlot();\r\n        clearSelectionFeedback();\r\n        renderPresetsPanel();\r\n    } else {\r\n        // Currently unlocked - select the main slot for assignment\r\n        setSelectedSlot(optimalType, 'main', 0);\r\n\r\n        // Clear any previous selection feedback\r\n        clearSelectionFeedback();\r\n\r\n        // Re-render the presets panel\r\n        renderPresetsPanel();\r\n\r\n        // Apply glow effects AFTER render completes\r\n        setTimeout(() => {\r\n            // Find the preset row container\r\n            const presetRow = document.querySelector(`.preset-row[data-preset=\"${optimalType}\"]`) as HTMLElement;\r\n            if (presetRow) {\r\n                // Make all slots in this preset row glow (main + readonly subs)\r\n                const allSlots = presetRow.querySelectorAll('.optimal-main-slot, .optimal-readonly-slot');\r\n                allSlots.forEach(slot => {\r\n                    const target = slot as HTMLElement;\r\n                    target.style.boxShadow = '0 0 15px 3px rgba(255, 255, 255, 0.6)';\r\n                    target.style.animation = 'pulse-glow 1s infinite';\r\n                });\r\n\r\n                // Show tooltip on main slot\r\n                const mainSlot = presetRow.querySelector('.optimal-main-slot') as HTMLElement;\r\n                if (mainSlot) {\r\n                    showTooltip(mainSlot, 'Select main companion from grid');\r\n                }\r\n\r\n                // Highlight companion icons in grid\r\n                highlightSourceIcons();\r\n            }\r\n        }, 0);\r\n    }\r\n};\r\n\r\n/**\r\n * Equip a preset with confirmation modal\r\n */\r\n(window as any).equipPreset = async function(presetId: CompanionPresetId): Promise<void> {\r\n    const currentPresetId = loadoutStore.getEquippedPresetId();\r\n    if (currentPresetId === presetId) return; // Already equipped\r\n\r\n    const newPresetEffects = getPresetEquipEffects(presetId);\r\n    const currentPresetEffects = getPresetEquipEffects(currentPresetId);\r\n\r\n    // Check if new preset has any equip effects\r\n    const hasEquipEffects = Object.keys(newPresetEffects).length > 0 || Object.keys(currentPresetEffects).length > 0;\r\n\r\n    if (hasEquipEffects) {\r\n        // Show confirmation modal\r\n        const userChoice = await showEquipConfirmModal(presetId, currentPresetEffects, newPresetEffects);\r\n\r\n        if (userChoice === 'cancel') {\r\n            return;\r\n        }\r\n\r\n        if (userChoice === 'no') {\r\n            // User says stats are NOT incorporated - just switch presets\r\n            loadoutStore.setEquippedPresetId(presetId);\r\n            updateContributedStatsForPreset(presetId);\r\n            renderPresetsPanel();\r\n        } else if (userChoice === 'yes') {\r\n            // User says stats ARE incorporated - need to subtract old and add new\r\n            // Subtract current preset effects from input stats (excluding Attack flat stat)\r\n            Object.entries(currentPresetEffects).forEach(([stat, value]) => {\r\n                if (stat !== 'Attack') {\r\n                    subtractStat(stat, value);\r\n                }\r\n            });\r\n\r\n            // Add new preset effects to input stats (excluding Attack flat stat)\r\n            Object.entries(newPresetEffects).forEach(([stat, value]) => {\r\n                if (stat !== 'Attack') {\r\n                    addStat(stat, value);\r\n                }\r\n            });\r\n\r\n            loadoutStore.setEquippedPresetId(presetId);\r\n            updateContributedStatsForPreset(presetId);\r\n            renderPresetsPanel();\r\n        }\r\n    } else {\r\n        // No equip effects - just switch presets\r\n        loadoutStore.setEquippedPresetId(presetId);\r\n        updateContributedStatsForPreset(presetId);\r\n        renderPresetsPanel();\r\n    }\r\n};\r\n\r\n/**\r\n * Show equip preset confirmation modal\r\n */\r\nfunction showEquipConfirmModal(\r\n    presetId: CompanionPresetId,\r\n    currentEffects: Record<string, number>,\r\n    newEffects: Record<string, number>\r\n): Promise<'yes' | 'no' | 'cancel'> {\r\n    return new Promise((resolve) => {\r\n        // Remove any existing modal\r\n        const existingModal = document.getElementById('equip-preset-modal');\r\n        if (existingModal) {\r\n            existingModal.remove();\r\n        }\r\n\r\n        // Create modal overlay\r\n        const overlay = document.createElement('div');\r\n        overlay.id = 'equip-preset-modal';\r\n        overlay.className = 'modal-overlay';\r\n\r\n        // Create modal box\r\n        const modalBox = document.createElement('div');\r\n        modalBox.className = 'modal-box';\r\n\r\n        // Create title\r\n        const title = document.createElement('h2');\r\n        title.className = 'modal-title';\r\n        title.textContent = `Equip ${presetId.replace('preset', '#')}`;\r\n\r\n        // Create message\r\n        const message = document.createElement('p');\r\n        message.className = 'modal-message';\r\n        message.textContent = 'Are the stats from the currently equipped preset already incorporated in your input stats?';\r\n\r\n        // Create stat comparison table\r\n        const tableContainer = document.createElement('div');\r\n        tableContainer.className = 'stat-comparison-table';\r\n        tableContainer.innerHTML = createStatComparisonTable(currentEffects, newEffects);\r\n\r\n        // Create button container\r\n        const buttonContainer = document.createElement('div');\r\n        buttonContainer.className = 'modal-buttons';\r\n\r\n        // Create Yes button\r\n        const yesBtn = document.createElement('button');\r\n        yesBtn.className = 'modal-btn btn-yes';\r\n        yesBtn.textContent = 'Yes - Adjust Stats';\r\n        yesBtn.onclick = () => {\r\n            overlay.remove();\r\n            resolve('yes');\r\n        };\r\n\r\n        // Create No button\r\n        const noBtn = document.createElement('button');\r\n        noBtn.className = 'modal-btn btn-no';\r\n        noBtn.style.background = 'linear-gradient(135deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.02))';\r\n        noBtn.style.borderColor = 'rgba(255, 255, 255, 0.3)';\r\n        noBtn.style.color = 'rgba(255, 255, 255, 0.7)';\r\n        noBtn.textContent = 'No - Just Switch';\r\n        noBtn.onclick = () => {\r\n            overlay.remove();\r\n            resolve('no');\r\n        };\r\n\r\n        // Hover for neutral No button\r\n        noBtn.onmouseenter = () => {\r\n            noBtn.style.background = 'rgba(255, 255, 255, 0.1)';\r\n        };\r\n        noBtn.onmouseleave = () => {\r\n            noBtn.style.background = 'linear-gradient(135deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.02))';\r\n        };\r\n\r\n        // Create Cancel button\r\n        const cancelBtn = document.createElement('button');\r\n        cancelBtn.className = 'modal-btn btn-cancel';\r\n        cancelBtn.textContent = 'Cancel';\r\n        cancelBtn.onclick = () => {\r\n            overlay.remove();\r\n            resolve('cancel');\r\n        };\r\n\r\n        // Assemble modal\r\n        buttonContainer.appendChild(yesBtn);\r\n        buttonContainer.appendChild(noBtn);\r\n        buttonContainer.appendChild(cancelBtn);\r\n\r\n        modalBox.appendChild(title);\r\n        modalBox.appendChild(message);\r\n        modalBox.appendChild(tableContainer);\r\n        modalBox.appendChild(buttonContainer);\r\n\r\n        overlay.appendChild(modalBox);\r\n        document.body.appendChild(overlay);\r\n\r\n        // Handle ESC key\r\n        const escHandler = (e: KeyboardEvent) => {\r\n            if (e.key === 'Escape') {\r\n                overlay.remove();\r\n                document.removeEventListener('keydown', escHandler);\r\n                resolve('cancel');\r\n            }\r\n        };\r\n        document.addEventListener('keydown', escHandler);\r\n\r\n        // Focus on Yes button by default\r\n        yesBtn.focus();\r\n    });\r\n}\r\n\r\n/**\r\n * Create stat comparison table HTML\r\n */\r\nfunction createStatComparisonTable(\r\n    currentEffects: Record<string, number>,\r\n    newEffects: Record<string, number>\r\n): string {\r\n    // Get all unique stats from both effects (excluding Attack)\r\n    const allStats = new Set([\r\n        ...Object.keys(currentEffects),\r\n        ...Object.keys(newEffects)\r\n    ]);\r\n\r\n    // Filter out Attack stat\r\n    allStats.delete('Attack');\r\n\r\n    if (allStats.size === 0) {\r\n        return '<div style=\"text-align: center; color: var(--text-secondary);\">No stat changes</div>';\r\n    }\r\n\r\n    let rows = '';\r\n    for (const stat of allStats) {\r\n        const currentValue = currentEffects[stat] || 0;\r\n        const newValue = newEffects[stat] || 0;\r\n\r\n        // Determine if this stat displays as a percentage\r\n        const isPercentage = !['hitChance', 'maxHp', 'attack', 'mainStat'].includes(stat);\r\n\r\n        const formatValue = (val: number): string => {\r\n            if (val === 0) return '-';\r\n            const displayValue = isPercentage ? val.toFixed(1).replace(/\\.0$/, '') : val;\r\n            return `+${displayValue}${isPercentage ? '%' : ''}`;\r\n        };\r\n\r\n        // Determine color class\r\n        const currentClass = currentValue > 0 ? 'stat-value-negative' : 'stat-value-neutral';\r\n        const newClass = newValue > 0 ? 'stat-value-positive' : 'stat-value-neutral';\r\n\r\n        rows += `\r\n            <tr>\r\n                <td>${formatStat(stat)}</td>\r\n                <td class=\"${currentClass}\">${formatValue(currentValue)}</td>\r\n                <td class=\"${newClass}\">${formatValue(newValue)}</td>\r\n            </tr>\r\n        `;\r\n    }\r\n\r\n    return `\r\n        <table class=\"stat-table\">\r\n            <thead>\r\n                <tr>\r\n                    <th>Stat</th>\r\n                    <th>Current Preset</th>\r\n                    <th>New Preset</th>\r\n                </tr>\r\n            </thead>\r\n            <tbody>\r\n                ${rows}\r\n            </tbody>\r\n        </table>\r\n    `;\r\n}\r\n"],
  "mappings": "AAMA,SAAS,qBAAqB,4BAA4B;AAC1D,SAAS,oBAAoB;AAC7B,SAAS,SAAS,oBAAoB;AACtC,SAAS,6BAA6B,uBAAuB,6BAA6B;AAa1F,SAAS,qBAAqB,qBAAqB;AAenD,IAAI,mBAA4C;AASzC,SAAS,yBAA+B;AAC3C,uBAAqB;AACrB,gBAAc;AACd,sBAAoB;AACxB;AAKO,SAAS,mBAAyB;AAGzC;AAKO,SAAS,iCAAuC;AACnD,+BAA6B;AAC7B,6BAA2B;AAC3B,6BAA2B;AAC/B;AAKO,SAAS,sBAA4B;AACxC,uBAAqB;AACrB,gBAAc;AACd,mBAAiB;AACrB;AASA,SAAS,uBAA6B;AAClC,QAAM,YAAY,SAAS,eAAe,2BAA2B;AACrE,MAAI,CAAC,UAAW;AAGhB,MAAI,OAAO;AAAA;AAAA;AAAA;AAAA,kBAIG,eAAe,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBA0BhB,wBAAwB,CAAC;AAAA;AAAA;AAAA;AAMvC,QAAM,mBAAmB,SAAS,eAAe,8BAA8B;AAC/E,YAAU,YAAY;AAGtB,MAAI,kBAAkB;AAClB,cAAU,YAAY,gBAAgB;AAAA,EAC1C,OAAO;AAEH,UAAM,sBAAsB,SAAS,cAAc,KAAK;AACxD,wBAAoB,KAAK;AACzB,wBAAoB,YAAY;AAChC,cAAU,YAAY,mBAAmB;AAAA,EAC7C;AAGA,+BAA6B;AACjC;AAKA,SAAS,0BAAkC;AACvC,SAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAgBX;AAKA,SAAS,iBAAyB;AAC9B,MAAI,OAAO;AAGX,SAAO,QAAQ,aAAa,EAAE,QAAQ,CAAC,CAAC,QAAQ,MAAM,MAAM;AACxD,WAAO,QAAQ,QAAQ,eAAa;AAChC,YAAM,eAA6B,GAAG,SAAS,IAAI,MAAM;AACzD,YAAM,gBAAgB,aAAa,aAAa,YAAY;AAC5D,YAAM,aAAa,eAAe,YAAY;AAC9C,YAAM,QAAQ,eAAe,SAAS;AAEtC,cAAQ;AAAA;AAAA,uCAEmB,YAAY;AAAA,mCAChB,SAAS;AAAA,oCACR,MAAM;AAAA,0CACA,OAAO,KAAK;AAAA,2CACX,OAAO,WAAW;AAAA;AAAA;AAAA;AAAA,8DAIC,OAAO,KAAK,OAAO,OAAO,WAAW;AAAA,4CACvD,aAAa,OAAO,cAAc,MAAM;AAAA;AAAA;AAAA;AAAA,mCAIjD,aAAa,MAAM,KAAK;AAAA,kCACzB,aAAa,SAAS,iBAAiB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kDAQvB,SAAS,wBAAwB,gBAAgB,SAAS,CAAC;AAAA,sBACvF,aAAa;AAAA,4EACyC,YAAY;AAAA,iCACvD,KAAK;AAAA;AAAA,wBAEd,EAAE;AAAA;AAAA;AAAA,IAGlB,CAAC;AAAA,EACL,CAAC;AAED,SAAO;AACX;AAKA,SAAS,gBACL,cACA,WACA,QACA,aACA,OACI;AACJ,QAAM,QAAQ,SAAS,eAAe,wBAAwB;AAC9D,QAAM,UAAU,SAAS,eAAe,0BAA0B;AAClE,MAAI,CAAC,SAAS,CAAC,QAAS;AAExB,QAAM,gBAAgB,aAAa,aAAa,YAAY;AAE5D,QAAM,cAAc,oBAAoB,SAAS;AACjD,QAAM,aAAa,cAAc;AACjC,QAAM,QAAQ,cAAc,SAAS;AACrC,QAAM,WAAW,qBAAqB;AAGtC,MAAI,sBAAsB;AAC1B,MAAI,kBAAkB;AAEtB,MAAI,YAAY;AACZ,UAAM,UAAU,oBAAoB,WAAW,QAAQ,KAAK;AAC5D,QAAI,SAAS;AACT,4BAAsB,cAAc,QAAQ,eAAe;AAC3D,wBAAkB,cAAc,QAAQ,WAAW;AAAA,IACvD;AAAA,EACJ;AAEA,UAAQ,YAAY;AAAA;AAAA;AAAA,kDAG0B,WAAW;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gCAO7B,WAAW;AAAA;AAAA;AAAA;AAAA,8CAIG,SAAS,wBAAwB,iBAAiB,SAAS,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBAY1F,WAAW;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,8BAOG,WAAW;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBAOzB,MAAM;AAAA;AAAA;AAAA,UAGZ,aAAa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yCAWkB,YAAY;AAAA,gCACrB,KAAK;AAAA;AAAA,8BAEP,QAAQ;AAAA,6DACuB,YAAY;AAAA;AAAA;AAAA;AAAA,4CAI7B,WAAW;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iCAkBtB,WAAW;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAMtB,sBAAsB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gCAYZ,mBAAmB;AAAA;AAAA,wBAE3B,EAAE;AAAA;AAAA,sBAEJ,kBAAkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gCAYR,eAAe;AAAA;AAAA,wBAEvB,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA,mEAKyC,YAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YAenE;AAAA;AAAA;AAAA,+DAGmD,YAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAclE;AAAA;AAGL,QAAM,MAAM,cAAc;AAC9B;AASA,SAAS,sBAA4B;AAEjC,QAAM,mBAAmB,aAAa,oBAAoB;AAC1D,kCAAgC,gBAAgB;AAChD,qBAAmB;AACvB;AAKA,SAAS,qBAA2B;AAChC,QAAM,YAAY,SAAS,eAAe,8BAA8B;AACxE,MAAI,CAAC,UAAW;AAGhB,QAAM,gBAAgB,SAAS,eAAe,kBAAkB;AAChE,QAAM,eAAe,iBAAiB,cAAc,UAAU,SAAS,QAAQ;AAE/E,MAAI,CAAC,cAAc;AAEf,UAAMA,qBAAoB,aAAa,2BAA2B;AAClE,UAAMC,oBAAmB,aAAa,oBAAoB;AAC1D,UAAMC,wBAAuB,sBAAsBD,iBAAgB;AAEnE,QAAIE,QAAO;AAGX,IAAAA,SAAQ;AAAA;AAAA;AAAA;AAAA,yIAIyHH,qBAAoB,YAAY,EAAE;AAAA;AAAA;AAAA;AAAA;AAOnK,aAAS,IAAI,GAAG,KAAK,GAAG,KAAK;AACzB,YAAM,WAA8B,SAAS,CAAC;AAC9C,YAAM,aAAa,aAAa,UAAU,QAAQ;AAClD,YAAM,aAAa,aAAaC;AAChC,MAAAE,SAAQ,gBAAgB,UAAU,YAAY,YAAYH,oBAAmBE,uBAAsB,KAAK;AAAA,IAC5G;AAEA,IAAAC,SAAQ;AACR,cAAU,YAAYA;AACtB,+BAA2B;AAC3B;AAAA,EACJ;AAEA,QAAM,oBAAoB,aAAa,2BAA2B;AAClE,QAAM,mBAAmB,aAAa,oBAAoB;AAG1D,QAAM,uBAAuB,sBAAsB,gBAAgB;AAGnE,QAAM,mBAAmB;AAAA,IACrB;AAAA,IACA;AAAA,IACA,CAAC,QAAQ,aAAa,aAAa,GAAG;AAAA,IACtC;AAAA,IACA,aAAa,uBAAuB,cAAc;AAAA,EACtD;AACA,QAAM,qBAAqB;AAAA,IACvB;AAAA,IACA;AAAA,IACA,CAAC,QAAQ,aAAa,aAAa,GAAG;AAAA,IACtC;AAAA,IACA,aAAa,uBAAuB,gBAAgB;AAAA,EACxD;AAEA,MAAI,OAAO;AAGX,UAAQ;AAAA;AAAA;AAAA;AAAA,qIAIyH,oBAAoB,YAAY,EAAE;AAAA;AAAA;AAAA;AAAA;AAOnK,WAAS,IAAI,GAAG,KAAK,GAAG,KAAK;AACzB,UAAM,WAA8B,SAAS,CAAC;AAC9C,UAAM,aAAa,aAAa,UAAU,QAAQ;AAClD,UAAM,aAAa,aAAa;AAEhC,YAAQ,gBAAgB,UAAU,YAAY,YAAY,mBAAmB,sBAAsB,KAAK;AAAA,EAC5G;AAGA,UAAQ,gBAAgB,gBAAgB,kBAAkB,OAAO,mBAAmB,sBAAsB,MAAM,cAAc;AAC9H,UAAQ,gBAAgB,kBAAkB,oBAAoB,OAAO,mBAAmB,sBAAsB,MAAM,gBAAgB;AAEpI,UAAQ;AAER,YAAU,YAAY;AAGtB,6BAA2B;AAC/B;AAKA,SAAS,gBACL,UACA,YACA,YACA,mBACA,sBACA,kBAAkB,OAClB,cAA6B,MACvB;AAEN,QAAM,eAAe,CAAC,QAAwB;AAC1C,QAAI,OAAO,IAAS,SAAQ,MAAM,KAAS,QAAQ,CAAC,IAAI;AACxD,QAAI,OAAO,IAAM,SAAQ,MAAM,KAAM,QAAQ,CAAC,IAAI;AAClD,WAAO,KAAK,MAAM,GAAG,EAAE,SAAS;AAAA,EACpC;AAGA,QAAM,YAAY,eAAe,SAAS,QAAQ,UAAU,GAAG;AAG/D,QAAM,cAAc,kBAAkB,YAAa,aAAa,YAAY;AAG5E,QAAM,WAAW,oBACZ,aAAa,kBAAkB,aAAa,qBAC7C,aAAa,uBAAuB,QAAQ,MAAM;AAGtD,MAAI,OAAO;AAAA,+CACgC,QAAQ,mBAAmB,eAAe;AAAA;AAAA;AAAA;AAAA,gCAIzD,WAAW;AAAA;AAAA;AAAA,cAG7B,kBAAkB,6FAA6F,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,6BAalG,kBAAkB,YAAY,uBAAuB;AAAA,iCACjD,cAAc,UAAU,MAAM;AAAA;AAAA;AAAA,oBAG3C,SAAS;AAAA;AAAA;AAAA,kBAGX,kBAAkB,sBAAsB,UAAU,WAAW,MAAM,IAAI,QAAQ,IAAI,WAAW,UAAU,QAAQ,GAAG,WAAW,MAAM,EAAE,CAAC;AAAA;AAAA;AAAA,kBAGvI,WAAW,KAAK;AAAA,IAAI,CAAC,KAAK,UACxB,kBAAkB,mBAAmB,KAAK,EAAE,IAAI,WAAW,UAAU,OAAO,OAAO,KAAK,EAAE;AAAA,EAC9F,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA,kBAGR,kBAAkB;AAAA,iEAC6B,QAAQ;AAAA;AAAA;AAAA,sCAGnC,WAAW,6EAA6E,4EAA4E;AAAA,4CAC9J,WAAW,YAAY,SAAS;AAAA;AAAA,iCAE3C,WAAW,YAAY,SAAS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,4DAML,WAAW,4BAA4B,0BAA0B;AAAA,4DACjE,WAAW,6EAA6E,4EAA4E;AAAA,0BACtM,WAAW,eAAe,WAAW;AAAA;AAAA,oBAE1C,aAAa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAYd;AAAA,2DACuC,QAAQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAgBjD;AAAA;AAAA;AAKd,MAAI,qBAAqB,sBAAsB,UAAU,GAAG;AACxD,UAAM,sBAAsB,kBACtB,8BAA8B,UAAU,IACxC,sBAAsB,QAAQ;AAEpC,UAAM,aAAa,4BAA4B,sBAAsB,mBAAmB;AAExF,YAAQ,2BAA2B,YAAY,YAAY,YAAY;AAAA,EAC3E;AAEA,UAAQ;AACR,SAAO;AACX;AAKA,SAAS,2BACL,YACA,YACA,cACM;AACN,MAAI,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAWX,MAAI,YAAY;AAEZ,UAAM,uBAAuB,WAAW,KAAK;AAC7C,UAAM,yBAAyB,WAAW,OAAO;AACjD,UAAM,cAAc,WAAW,KAAK,cAAc,IAAK,uBAAuB,WAAW,KAAK,cAAe,MAAM;AACnH,UAAM,gBAAgB,WAAW,OAAO,cAAc,IAAK,yBAAyB,WAAW,OAAO,cAAe,MAAM;AAE3H,YAAQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAOM,aAAa,WAAW,KAAK,gBAAgB,CAAC;AAAA;AAAA;AAAA,uBAG7C,YAAY,QAAQ,CAAC,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBASvB,aAAa,WAAW,OAAO,gBAAgB,CAAC;AAAA;AAAA;AAAA,uBAG/C,cAAc,QAAQ,CAAC,CAAC;AAAA;AAAA;AAAA;AAAA,EAI3C,OAAO;AAEH,UAAM,WAAW,WAAW,KAAK;AACjC,UAAM,aAAa,WAAW,OAAO;AAErC,YAAQ;AAAA;AAAA;AAAA;AAAA,0CAI0B,YAAY,IAAI,YAAY,SAAS;AAAA,0BACrD,YAAY,IAAI,MAAM,EAAE,GAAG,SAAS,QAAQ,CAAC,CAAC;AAAA;AAAA;AAAA;AAAA,sBAIlD,aAAa,WAAW,KAAK,YAAY,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0CAMtB,cAAc,IAAI,YAAY,SAAS;AAAA,0BACvD,cAAc,IAAI,MAAM,EAAE,GAAG,WAAW,QAAQ,CAAC,CAAC;AAAA;AAAA;AAAA;AAAA,sBAItD,aAAa,WAAW,OAAO,YAAY,CAAC;AAAA;AAAA;AAAA;AAAA,EAI9D;AAEA,UAAQ;AAAA;AAAA;AAAA;AAKR,SAAO;AACX;AAKA,SAAS,WACL,UACA,UACA,WACA,cACA,MACM;AACN,QAAM,SAAS,GAAG,QAAQ,IAAI,QAAQ,IAAI,SAAS;AAEnD,MAAI,CAAC,cAAc;AAEf,WAAO;AAAA;AAAA,gCAEiB,QAAQ;AAAA,mCACL,QAAQ;AAAA,oCACP,SAAS;AAAA,iCACZ,MAAM;AAAA;AAAA,6BAEV,IAAI;AAAA,8BACH,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yCAcO,OAAO,GAAG;AAAA;AAAA;AAAA,EAG/C;AAGA,QAAM,CAAC,WAAW,MAAM,IAAI,aAAa,MAAM,GAAG;AAClD,QAAM,SAAS,cAAc,MAAyB,KAAK,cAAc,QAAQ;AACjF,QAAM,gBAAgB,aAAa,aAAa,YAAY;AAC5D,QAAM,QAAQ,eAAe,SAAS;AACtC,QAAM,WAAW,CAAC,eAAe;AAIjC,QAAM,SAAS,aAAa;AAC5B,QAAM,WAAW,SAAS,iBAAiB,SAA2B,IAAI,gBAAgB,SAA2B;AACrH,QAAM,UAAU,SAAS,SAAS;AAClC,QAAM,YAAY,SACZ,0BAA0B,SAAS,KACnC,8BAA8B,SAAS;AAE7C,SAAO;AAAA,8CACmC,WAAW,0BAA0B,EAAE;AAAA,4BACzD,QAAQ;AAAA,+BACL,QAAQ;AAAA,gCACP,SAAS;AAAA,6BACZ,MAAM;AAAA,+BACJ,YAAY;AAAA,iCACV,SAAS,SAAS,EAAE;AAAA;AAAA,yBAE5B,IAAI;AAAA,0BACH,IAAI;AAAA,sDACwB,OAAO,KAAK,OAAO,OAAO,WAAW;AAAA,oCACvD,WAAW,YAAY,OAAO,WAAW;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,2BASlD,WAAW,QAAQ,GAAG;AAAA;AAAA;AAAA;AAAA;AAAA,yBAKxB,OAAO,GAAG;AAAA,0BACT,OAAO,GAAG;AAAA;AAAA;AAAA;AAAA,kBAIlB,WAAW,6BAA6B,EAAE;AAAA;AAAA,8BAE9B,SAAS,wBAAwB,QAAQ,IAAI,OAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBAmBlE,KAAK;AAAA;AAAA,cAEP,WAAW;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,6BAMI,OAAO,IAAI;AAAA;AAAA;AAAA;AAAA,yBAIf,OAAO,IAAI;AAAA,0BACV,OAAO,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBAQrB,EAAE;AAAA;AAAA;AAGlB;AAKA,SAAS,sBACL,UACA,cACA,MACA,UACM;AACN,MAAI,CAAC,cAAc;AAEf,WAAO;AAAA;AAAA,gCAEiB,QAAQ;AAAA;AAAA;AAAA;AAAA,6BAIX,IAAI;AAAA,8BACH,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yCAcO,OAAO,GAAG;AAAA;AAAA;AAAA,EAG/C;AAGA,QAAM,CAAC,WAAW,MAAM,IAAI,aAAa,MAAM,GAAG;AAClD,QAAM,SAAS,cAAc,MAAyB,KAAK,cAAc,QAAQ;AACjF,QAAM,WAAW,iBAAiB,SAA2B;AAC7D,QAAM,YAAY,0BAA0B,SAAS;AAErD,SAAO;AAAA;AAAA,4BAEiB,QAAQ;AAAA;AAAA;AAAA,+BAGL,YAAY;AAAA;AAAA,yBAElB,IAAI;AAAA,0BACH,IAAI;AAAA,sDACwB,OAAO,KAAK,OAAO,OAAO,WAAW;AAAA,oCACvD,OAAO,WAAW;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yBAc7B,OAAO,GAAG;AAAA,0BACT,OAAO,GAAG;AAAA;AAAA;AAAA;AAAA;AAAA,0CAKM,QAAQ;AAAA,8BACpB,SAAS;AAAA;AAAA,4BAEX,SAAS;AAAA;AAAA;AAAA,cAGvB,WAAW;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,6BAMI,OAAO,IAAI;AAAA;AAAA;AAAA;AAAA,yBAIf,OAAO,IAAI;AAAA,0BACV,OAAO,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBAQrB,EAAE;AAAA;AAAA;AAGlB;AAKA,SAAS,mBAAmB,cAAmC,MAAsB;AACjF,MAAI,CAAC,cAAc;AAEf,WAAO;AAAA;AAAA,yBAEU,IAAI;AAAA,0BACH,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yCASW,OAAO,GAAG;AAAA;AAAA;AAAA,EAG/C;AAGA,QAAM,CAAC,WAAW,MAAM,IAAI,aAAa,MAAM,GAAG;AAClD,QAAM,SAAS,cAAc,MAAyB,KAAK,cAAc,QAAQ;AAGjF,QAAM,WAAW,gBAAgB,SAA2B;AAC5D,QAAM,YAAY,8BAA8B,SAAS;AAEzD,SAAO;AAAA;AAAA,qBAEU,IAAI;AAAA,sBACH,IAAI;AAAA,kDACwB,OAAO,KAAK,OAAO,OAAO,WAAW;AAAA,gCACvD,OAAO,WAAW;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yBAYzB,OAAO,GAAG;AAAA,0BACT,OAAO,GAAG;AAAA;AAAA;AAAA;AAAA;AAAA,0CAKM,QAAQ;AAAA,8BACpB,SAAS;AAAA;AAAA,4BAEX,SAAS;AAAA;AAAA;AAAA;AAIrC;AASA,SAAS,+BAAqC;AAE1C,WAAS,iBAAiB,iBAAiB,EAAE,QAAQ,UAAQ;AACzD,SAAK,iBAAiB,SAAS,CAAC,MAAM;AAClC,YAAM,SAAS;AACf,YAAM,eAAe,OAAO,QAAQ;AACpC,YAAM,YAAY,OAAO,QAAQ;AACjC,YAAM,SAAS,OAAO,QAAQ;AAC9B,YAAM,cAAc,OAAO,QAAQ,gBAAgB;AACnD,YAAM,QAAQ,OAAO,QAAQ,eAAe;AAG5C,YAAM,eAAe,oBAAoB;AACzC,UAAI,cAAc;AAEd,cAAM,gBAAgB,aAAa,aAAa,YAAY;AAC5D,YAAI,CAAC,eAAe,UAAU;AAE1B,iBAAO,MAAM,YAAY;AACzB,qBAAW,MAAM;AACb,mBAAO,MAAM,YAAY;AAAA,UAC7B,GAAG,GAAG;AAAA,QAIV,OAAO;AAEH,gCAAsB,YAAY;AAClC;AAAA,QACJ;AAAA,MACJ;AAGA,yBAAmB,EAAE,cAAc,WAAW,QAAQ,aAAa,MAAM;AAGzE,eAAS,iBAAiB,iBAAiB,EAAE,QAAQ,OAAK;AACtD,QAAC,EAAkB,MAAM,YAAY;AAAA,MACzC,CAAC;AACD,aAAO,MAAM,YAAY,aAAa,WAAW;AAGjD,sBAAgB,cAAc,WAAW,QAAQ,aAAa,KAAK;AAAA,IACvE,CAAC;AAAA,EACL,CAAC;AACL;AAKA,SAAS,6BAAmC;AACxC,WAAS,iBAAiB,cAAc,EAAE,QAAQ,UAAQ;AACtD,SAAK,iBAAiB,SAAS,CAAC,MAAM;AAClC,QAAE,gBAAgB;AAClB,sBAAgB,IAAmB;AAAA,IACvC,CAAC;AAGD,SAAK,iBAAiB,eAAe,CAAC,MAAM;AACxC,QAAE,eAAe;AACjB,QAAE,gBAAgB;AAClB,YAAM,SAAS;AACf,YAAM,WAAW,OAAO,QAAQ;AAChC,YAAM,WAAW,OAAO,QAAQ;AAChC,YAAM,YAAY,SAAS,OAAO,QAAQ,aAAa,GAAG;AAC1D,YAAM,eAAe,OAAO,QAAQ;AAEpC,UAAI,cAAc;AACd,qBAAa,gBAAgB,UAAU,UAAU,SAAS;AAC1D,2BAAmB;AAAA,MACvB;AAAA,IACJ,CAAC;AAAA,EACL,CAAC;AACL;AAKA,SAAS,6BAAmC;AAExC,QAAM,kBAAmB,OAAe;AACxC,MAAI,iBAAiB;AACjB,aAAS,oBAAoB,SAAS,eAAe;AAAA,EACzD;AAEA,QAAM,UAAU,CAAC,MAAa;AAC1B,UAAM,eAAe,oBAAoB;AACzC,QAAI,CAAC,aAAc;AAGnB,UAAM,SAAS,EAAE;AACjB,UAAM,cAAc,OAAO,QAAQ,cAAc;AACjD,UAAM,cAAc,OAAO,QAAQ,iBAAiB;AAEpD,QAAI,CAAC,eAAe,CAAC,aAAa;AAC9B,6BAAuB;AACvB,wBAAkB;AAAA,IACtB;AAAA,EACJ;AAEA,EAAC,OAAe,iCAAiC;AACjD,WAAS,iBAAiB,SAAS,OAAO;AAC9C;AAKA,SAAS,gBAAgB,MAAyB;AAC9C,QAAM,WAAW,KAAK,QAAQ;AAC9B,QAAM,WAAW,KAAK,QAAQ;AAC9B,QAAM,YAAY,SAAS,KAAK,QAAQ,aAAa,GAAG;AACxD,QAAM,aAAa,KAAK,QAAQ;AAGhC,QAAM,gBAAgB,KAAK,UAAU,SAAS,mBAAmB;AAGjE,MAAI,eAAe;AAEf,QAAI,aAAa,kBAAkB,aAAa,kBAAkB;AAC9D,YAAM,cAAc,aAAa,uBAAuB,QAAQ;AAChE,UAAI,aAAa;AAEb;AAAA,MACJ;AAAA,IACJ;AAAA,EAEJ;AAGA,kBAAgB,UAAU,UAAU,SAAS;AAG7C,yBAAuB;AAGvB,MAAI,eAAe;AAEf,SAAK,MAAM,YAAY;AACvB,SAAK,MAAM,YAAY;AACvB,gBAAY,MAAM,iCAAiC;AACnD,yBAAqB;AAAA,EACzB,OAAO;AACH,0BAAsB,UAAU,cAAc,EAAE;AAAA,EACpD;AAGA,QAAM,oBAAoB,SAAS,eAAe,gCAAgC;AAClF,MAAI,mBAAmB;AACnB,sBAAkB,MAAM,UAAU;AAAA,EACtC;AACJ;AASA,SAAS,eAAe,SAAoD;AACxE,MAAI,CAAC,WAAW,OAAO,KAAK,OAAO,EAAE,WAAW,EAAG,QAAO,CAAC;AAE3D,SAAO,OAAO,QAAQ,OAAO,EACxB,IAAI,CAAC,CAAC,MAAM,KAAK,MAAM;AAGpB,UAAM,eAAe,CAAC,CAAC,aAAa,SAAS,UAAU,UAAU,EAAE,SAAS,IAAI;AAIhF,UAAM,iBAAiB,OAAO,UAAU,WACnC,OAAO,UAAU,KAAK,IAAI,QAAQ,MAAM,QAAQ,CAAC,EAAE,QAAQ,QAAQ,EAAE,IAAK;AAE/E,WAAO;AAAA,MACH;AAAA,MACA,aAAa,WAAW,IAAI;AAAA,MAC5B,OAAO;AAAA,MACP;AAAA,IACJ;AAAA,EACJ,CAAC;AACT;AAKA,SAAS,cAAc,SAAyC;AAC5D,MAAI,CAAC,WAAW,OAAO,KAAK,OAAO,EAAE,WAAW,EAAG,QAAO;AAE1D,SAAO,eAAe,OAAO,EACxB,IAAI,WAAS,GAAG,MAAM,WAAW,MAAM,MAAM,KAAK,GAAG,MAAM,eAAe,MAAM,EAAE,EAAE,EACpF,KAAK,MAAM;AACpB;AAKA,SAAS,WAAW,MAAsB;AACtC,QAAM,QAAgC;AAAA,IAClC,UAAU;AAAA,IACV,SAAS;AAAA,IACT,UAAU;AAAA,IACV,aAAa;AAAA,IACb,aAAa;AAAA,IACb,gBAAgB;AAAA,IAChB,YAAY;AAAA,IACZ,eAAe;AAAA,IACf,gBAAgB;AAAA,IAChB,cAAc;AAAA,IACd,cAAc;AAAA,IACd,aAAa;AAAA,IACb,YAAY;AAAA,IACZ,UAAU;AAAA,EACd;AAEA,SAAO,MAAM,KAAK,YAAY,CAAC,KAAK;AACxC;AAKA,SAAS,oBACL,cACA,WACA,QACA,aACA,OACI;AACJ,qBAAmB,EAAE,cAAc,WAAW,QAAQ,aAAa,MAAM;AAC7E;AAKA,SAAS,gBAAgB,WAAmC;AACxD,QAAM,QAAwC;AAAA,IAC1C,QAAQ;AAAA,IACR,cAAc;AAAA,IACd,cAAc;AAAA,IACd,cAAc;AAAA,IACd,aAAa;AAAA,IACb,YAAY;AAAA,IACZ,aAAa;AAAA,IACb,YAAY;AAAA,EAChB;AACA,SAAO,MAAM,SAAS;AAC1B;AAKA,SAAS,iBAAiB,WAAmC;AACzD,QAAM,QAAwC;AAAA,IAC1C,QAAQ;AAAA,IACR,cAAc;AAAA,IACd,cAAc;AAAA,IACd,cAAc;AAAA,IACd,aAAa;AAAA,IACb,YAAY;AAAA,IACZ,aAAa;AAAA,IACb,YAAY;AAAA,EAChB;AACA,SAAO,MAAM,SAAS;AAC1B;AAKA,SAAS,gBAAsB;AAC3B,QAAM,YAAY,SAAS,eAAe,4BAA4B;AACtE,MAAI,CAAC,UAAW;AAEhB,QAAM,eAAuC,CAAC;AAI9C,SAAO,QAAQ,aAAa,EAAE,QAAQ,CAAC,CAAC,QAAQ,MAAM,MAAM;AACxD,WAAO,QAAQ,QAAQ,eAAa;AAChC,YAAM,eAA6B,GAAG,SAAS,IAAI,MAAM;AACzD,YAAM,OAAO,aAAa,aAAa,YAAY;AAEnD,UAAI,CAAC,MAAM,SAAU;AAErB,YAAM,UAAU,oBAAoB,WAAW,QAAQ,KAAK,KAAK;AAEjE,UAAI,WAAW,QAAQ,iBAAiB;AACpC,eAAO,QAAQ,QAAQ,eAAe,EAAE,QAAQ,CAAC,CAAC,MAAM,KAAK,MAAM;AAC/D,uBAAa,IAAI,KAAK,aAAa,IAAI,KAAK,KAAK;AAAA,QACrD,CAAC;AAAA,MACL;AAAA,IACJ,CAAC;AAAA,EACL,CAAC;AAGD,MAAI,OAAO,KAAK,YAAY,EAAE,WAAW,GAAG;AACxC,cAAU,YAAY;AACtB;AAAA,EACJ;AAGA,QAAM,mBAAmB,eAAe,YAAY;AAGpD,YAAU,YAAY,iBACjB,IAAI,WAAS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gFAW0D,MAAM,WAAW;AAAA,6DACpC,MAAM,KAAK,GAAG,MAAM,eAAe,MAAM,EAAE;AAAA;AAAA,SAE/F,EACA,KAAK,EAAE;AAChB;AAKA,SAAS,sBAAsB,UAAqD;AAChF,QAAM,SAAS,aAAa,UAAU,QAAQ;AAC9C,QAAM,WAAoC,CAAC,OAAO,MAAM,GAAG,OAAO,IAAI;AACtE,QAAM,eAAuC,CAAC;AAE9C,WAAS,QAAQ,kBAAgB;AAC7B,QAAI,CAAC,aAAc;AAEnB,UAAM,CAAC,WAAW,MAAM,IAAI,aAAa,MAAM,GAAG;AAClD,UAAM,gBAAgB,aAAa,aAAa,YAAY;AAE5D,QAAI,CAAC,eAAe,SAAU;AAE9B,UAAM,QAAQ,cAAc,SAAS;AACrC,UAAM,UAAU,oBAAoB,WAAW,QAAQ,KAAK;AAE5D,QAAI,WAAW,QAAQ,aAAa;AAChC,aAAO,QAAQ,QAAQ,WAAW,EAAE,QAAQ,CAAC,CAAC,MAAM,KAAK,MAAM;AAC3D,qBAAa,IAAI,KAAK,aAAa,IAAI,KAAK,KAAK;AAAA,MACrD,CAAC;AAAA,IACL;AAAA,EACJ,CAAC;AAED,SAAO;AACX;AAKA,SAAS,8BAA8B,QAAiD;AACpF,MAAI,CAAC,OAAQ,QAAO,CAAC;AACrB,QAAM,WAAoC,CAAC,OAAO,MAAM,GAAG,OAAO,IAAI;AACtE,QAAM,eAAuC,CAAC;AAE9C,WAAS,QAAQ,kBAAgB;AAC7B,QAAI,CAAC,aAAc;AAEnB,UAAM,CAAC,WAAW,MAAM,IAAI,aAAa,MAAM,GAAG;AAClD,UAAM,gBAAgB,aAAa,aAAa,YAAY;AAE5D,QAAI,CAAC,eAAe,SAAU;AAE9B,UAAM,QAAQ,cAAc,SAAS;AACrC,UAAM,UAAU,oBAAoB,WAAW,QAAQ,KAAK;AAE5D,QAAI,WAAW,QAAQ,aAAa;AAChC,aAAO,QAAQ,QAAQ,WAAW,EAAE,QAAQ,CAAC,CAAC,MAAM,KAAK,MAAM;AAC3D,qBAAa,IAAI,KAAK,aAAa,IAAI,KAAK,KAAK;AAAA,MACrD,CAAC;AAAA,IACL;AAAA,EACJ,CAAC;AAED,SAAO;AACX;AAKA,SAAS,gCAAgC,UAAmC;AACxE,QAAM,UAAU,sBAAsB,QAAQ;AAGlD;AAKA,SAAS,mBAAyB;AAC9B,qBAAmB;AACvB;AAYA,SAAS,sBAA4C;AACjD,SAAQ,OAAe,qBAAqB;AAChD;AAEA,SAAS,gBAAgB,UAA6B,MAAsB,OAAqB;AAC7F,EAAC,OAAe,oBAAoB,EAAE,UAAU,MAAM,MAAM;AAChE;AAEA,SAAS,oBAA0B;AAC/B,EAAC,OAAe,oBAAoB;AACxC;AAKA,SAAS,sBAAsB,UAA6B,YAA0B;AAClF,QAAM,OAAO,oBAAoB;AACjC,MAAI,CAAC,KAAM;AAEX,QAAM,cAAc,SAAS,cAAc,kBAAkB,QAAQ,IAAI,KAAK,IAAI,IAAI,KAAK,KAAK,IAAI;AACpG,MAAI,CAAC,YAAa;AAGlB,cAAY,MAAM,YAAY;AAC9B,cAAY,MAAM,YAAY;AAG9B,cAAY,aAAa,kCAAkC;AAC3D,uBAAqB;AACzB;AAKA,SAAS,YAAY,aAA0B,MAAoB;AAC/D,QAAM,UAAU,SAAS,cAAc,KAAK;AAC5C,UAAQ,KAAK;AACb,UAAQ,MAAM,UAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAcxB,UAAQ,cAAc;AACtB,cAAY,MAAM,WAAW;AAC7B,cAAY,YAAY,OAAO;AACnC;AAKA,SAAS,uBAA6B;AAClC,WAAS,iBAAiB,iBAAiB,EAAE,QAAQ,UAAQ;AACzD,UAAM,SAAS;AACf,UAAM,eAAe,OAAO,QAAQ;AACpC,UAAM,gBAAgB,aAAa,aAAa,YAAY;AAG5D,QAAI,eAAe,UAAU;AACzB,aAAO,MAAM,aAAa;AAC1B,aAAO,MAAM,YAAY;AACzB,aAAO,MAAM,YAAY;AAAA,IAC7B;AAAA,EACJ,CAAC;AACL;AAKA,SAAS,yBAA+B;AAEpC,WAAS,iBAAiB,cAAc,EAAE,QAAQ,UAAQ;AACtD,UAAM,SAAS;AACf,WAAO,MAAM,YAAY;AACzB,WAAO,MAAM,YAAY;AAAA,EAC7B,CAAC;AAGD,QAAM,UAAU,SAAS,eAAe,0BAA0B;AAClE,MAAI,QAAS,SAAQ,OAAO;AAG5B,WAAS,iBAAiB,iBAAiB,EAAE,QAAQ,UAAQ;AACzD,UAAM,SAAS;AACf,WAAO,MAAM,YAAY;AACzB,WAAO,MAAM,YAAY;AAAA,EAC7B,CAAC;AAGD,QAAM,oBAAoB,SAAS,eAAe,gCAAgC;AAClF,MAAI,mBAAmB;AACnB,sBAAkB,MAAM,UAAU;AAAA,EACtC;AACJ;AAKA,SAAS,sBAAsB,cAAkC;AAC7D,QAAM,WAAW,oBAAoB;AACrC,MAAI,CAAC,SAAU;AAGf,QAAM,kBAAkB,SAAS,aAAa,kBAAkB,SAAS,aAAa;AAGtF,QAAM,gBAAgB,aAAa,aAAa,YAAY;AAC5D,MAAI,CAAC,eAAe,UAAU;AAE1B,UAAM,eAAe,kBACf,mCAAmC,SAAS,QAAQ,OACpD,kBAAkB,SAAS,QAAQ,IAAI,SAAS,IAAI,IAAI,SAAS,KAAK;AAC5E,UAAM,cAAc,SAAS,cAAc,YAAY;AACvD,QAAI,aAAa;AACb,kBAAY,aAAa,gCAA2B;AACpD,iBAAW,MAAM;AACb,cAAM,UAAU,SAAS,eAAe,0BAA0B;AAClE,YAAI,QAAS,SAAQ,OAAO;AAAA,MAChC,GAAG,IAAI;AAAA,IACX;AACA;AAAA,EACJ;AAGA,MAAI,mBAAmB,SAAS,SAAS,QAAQ;AAC7C,iBAAa,uBAAuB,SAAS,UAA+C,YAAY;AACxG,2BAAuB;AACvB,sBAAkB;AAClB,uBAAmB;AACnB;AAAA,EACJ;AAGA,QAAM,SAAS,aAAa,UAAU,SAAS,QAAQ;AACvD,QAAM,WAAoC,CAAC,OAAO,MAAM,GAAG,OAAO,IAAI;AAEtE,QAAM,gBAAgB,SAAS,KAAK,CAAC,SAAS,QAAQ;AAClD,QAAI,SAAS,SAAS,UAAU,QAAQ,EAAG,QAAO;AAClD,QAAI,SAAS,SAAS,SAAS,QAAQ,SAAS,QAAQ,EAAG,QAAO;AAClE,WAAO,YAAY;AAAA,EACvB,CAAC;AAED,MAAI,eAAe;AACf,UAAM,cAAc,SAAS,cAAc,kBAAkB,SAAS,QAAQ,IAAI,SAAS,IAAI,IAAI,SAAS,KAAK,IAAI;AACrH,QAAI,aAAa;AACb,kBAAY,aAAa,yCAAoC;AAC7D,iBAAW,MAAM;AACb,cAAM,UAAU,SAAS,eAAe,0BAA0B;AAClE,YAAI,QAAS,SAAQ,OAAO;AAAA,MAChC,GAAG,IAAI;AAAA,IACX;AACA;AAAA,EACJ;AAEA,eAAa,cAAc,SAAS,UAAU,SAAS,MAAM,SAAS,OAAO,YAAY;AAEzF,yBAAuB;AACvB,oBAAkB;AAClB,qBAAmB;AACvB;AASC,OAAe,sBAAsB,SAAS,cAAkC;AAC7E,QAAM,UAAU,aAAa,aAAa,YAAY;AACtD,MAAI,CAAC,QAAS;AAEd,eAAa,gBAAgB,cAAc;AAAA,IACvC,GAAG;AAAA,IACH,UAAU,CAAC,QAAQ;AAAA,EACvB,CAAC;AAGD,QAAM,iBAAiB;AACvB,uBAAqB;AACrB,gBAAc;AACd,mBAAiB;AAGjB,MAAI,gBAAgB;AAChB,eAAW,MAAM;AACb,YAAM,OAAO,SAAS,cAAc,mCAAmC,eAAe,YAAY,IAAI;AACtG,UAAI,MAAM;AACN,aAAK,MAAM,YAAY,aAAa,eAAe,WAAW;AAC9D;AAAA,UACI,eAAe;AAAA,UACf,eAAe;AAAA,UACf,eAAe;AAAA,UACf,eAAe;AAAA,UACf,eAAe;AAAA,QACnB;AAAA,MACJ;AAAA,IACJ,GAAG,CAAC;AAAA,EACR;AACJ;AAKC,OAAe,oBAAoB,SAAS,cAA4B,UAAwB;AAC7F,QAAM,QAAQ,SAAS,QAAQ;AAC/B,QAAM,WAAW,qBAAqB;AAEtC,MAAI,MAAM,KAAK,KAAK,QAAQ,KAAK,QAAQ,UAAU;AAC/C;AAAA,EACJ;AAEA,QAAM,UAAU,aAAa,aAAa,YAAY;AACtD,MAAI,CAAC,QAAS;AAEd,eAAa,gBAAgB,cAAc;AAAA,IACvC,GAAG;AAAA,IACH;AAAA,EACJ,CAAC;AAGD,QAAM,eAAe,SAAS,cAAc,yCAAyC,YAAY,IAAI;AACrG,MAAI,cAAc;AACd,iBAAa,cAAc,MAAM,KAAK;AAAA,EAC1C;AAGA,MAAI,oBAAoB,iBAAiB,iBAAiB,cAAc;AACpE;AAAA,MACI,iBAAiB;AAAA,MACjB,iBAAiB;AAAA,MACjB,iBAAiB;AAAA,MACjB,iBAAiB;AAAA,MACjB,iBAAiB;AAAA,IACrB;AAAA,EACJ;AACA,gBAAc;AACd,mBAAiB;AACrB;AAKC,OAAe,6BAA6B,WAAiB;AAC1D,QAAM,WAAW,oBAAoB;AACrC,MAAI,CAAC,SAAU;AAGf,eAAa,gBAAgB,SAAS,UAAU,SAAS,MAAM,SAAS,KAAK;AAG7E,yBAAuB;AACvB,oBAAkB;AAGlB,qBAAmB;AACvB;AAKC,OAAe,4BAA4B,SAAS,SAAwB;AACzE,eAAa,2BAA2B,OAAO;AAC/C,qBAAmB;AACvB;AAKC,OAAe,oBAAoB,SAAS,aAAsD;AAC/F,QAAM,cAAc,aAAa,uBAAuB,WAAW;AAEnE,MAAI,aAAa;AAEb,iBAAa,uBAAuB,aAAa,IAAI;AACrD,sBAAkB;AAClB,2BAAuB;AACvB,uBAAmB;AAAA,EACvB,OAAO;AAEH,oBAAgB,aAAa,QAAQ,CAAC;AAGtC,2BAAuB;AAGvB,uBAAmB;AAGnB,eAAW,MAAM;AAEb,YAAM,YAAY,SAAS,cAAc,4BAA4B,WAAW,IAAI;AACpF,UAAI,WAAW;AAEX,cAAM,WAAW,UAAU,iBAAiB,4CAA4C;AACxF,iBAAS,QAAQ,UAAQ;AACrB,gBAAM,SAAS;AACf,iBAAO,MAAM,YAAY;AACzB,iBAAO,MAAM,YAAY;AAAA,QAC7B,CAAC;AAGD,cAAM,WAAW,UAAU,cAAc,oBAAoB;AAC7D,YAAI,UAAU;AACV,sBAAY,UAAU,iCAAiC;AAAA,QAC3D;AAGA,6BAAqB;AAAA,MACzB;AAAA,IACJ,GAAG,CAAC;AAAA,EACR;AACJ;AAKC,OAAe,cAAc,eAAe,UAA4C;AACrF,QAAM,kBAAkB,aAAa,oBAAoB;AACzD,MAAI,oBAAoB,SAAU;AAElC,QAAM,mBAAmB,sBAAsB,QAAQ;AACvD,QAAM,uBAAuB,sBAAsB,eAAe;AAGlE,QAAM,kBAAkB,OAAO,KAAK,gBAAgB,EAAE,SAAS,KAAK,OAAO,KAAK,oBAAoB,EAAE,SAAS;AAE/G,MAAI,iBAAiB;AAEjB,UAAM,aAAa,MAAM,sBAAsB,UAAU,sBAAsB,gBAAgB;AAE/F,QAAI,eAAe,UAAU;AACzB;AAAA,IACJ;AAEA,QAAI,eAAe,MAAM;AAErB,mBAAa,oBAAoB,QAAQ;AACzC,sCAAgC,QAAQ;AACxC,yBAAmB;AAAA,IACvB,WAAW,eAAe,OAAO;AAG7B,aAAO,QAAQ,oBAAoB,EAAE,QAAQ,CAAC,CAAC,MAAM,KAAK,MAAM;AAC5D,YAAI,SAAS,UAAU;AACnB,uBAAa,MAAM,KAAK;AAAA,QAC5B;AAAA,MACJ,CAAC;AAGD,aAAO,QAAQ,gBAAgB,EAAE,QAAQ,CAAC,CAAC,MAAM,KAAK,MAAM;AACxD,YAAI,SAAS,UAAU;AACnB,kBAAQ,MAAM,KAAK;AAAA,QACvB;AAAA,MACJ,CAAC;AAED,mBAAa,oBAAoB,QAAQ;AACzC,sCAAgC,QAAQ;AACxC,yBAAmB;AAAA,IACvB;AAAA,EACJ,OAAO;AAEH,iBAAa,oBAAoB,QAAQ;AACzC,oCAAgC,QAAQ;AACxC,uBAAmB;AAAA,EACvB;AACJ;AAKA,SAAS,sBACL,UACA,gBACA,YACgC;AAChC,SAAO,IAAI,QAAQ,CAAC,YAAY;AAE5B,UAAM,gBAAgB,SAAS,eAAe,oBAAoB;AAClE,QAAI,eAAe;AACf,oBAAc,OAAO;AAAA,IACzB;AAGA,UAAM,UAAU,SAAS,cAAc,KAAK;AAC5C,YAAQ,KAAK;AACb,YAAQ,YAAY;AAGpB,UAAM,WAAW,SAAS,cAAc,KAAK;AAC7C,aAAS,YAAY;AAGrB,UAAM,QAAQ,SAAS,cAAc,IAAI;AACzC,UAAM,YAAY;AAClB,UAAM,cAAc,SAAS,SAAS,QAAQ,UAAU,GAAG,CAAC;AAG5D,UAAM,UAAU,SAAS,cAAc,GAAG;AAC1C,YAAQ,YAAY;AACpB,YAAQ,cAAc;AAGtB,UAAM,iBAAiB,SAAS,cAAc,KAAK;AACnD,mBAAe,YAAY;AAC3B,mBAAe,YAAY,0BAA0B,gBAAgB,UAAU;AAG/E,UAAM,kBAAkB,SAAS,cAAc,KAAK;AACpD,oBAAgB,YAAY;AAG5B,UAAM,SAAS,SAAS,cAAc,QAAQ;AAC9C,WAAO,YAAY;AACnB,WAAO,cAAc;AACrB,WAAO,UAAU,MAAM;AACnB,cAAQ,OAAO;AACf,cAAQ,KAAK;AAAA,IACjB;AAGA,UAAM,QAAQ,SAAS,cAAc,QAAQ;AAC7C,UAAM,YAAY;AAClB,UAAM,MAAM,aAAa;AACzB,UAAM,MAAM,cAAc;AAC1B,UAAM,MAAM,QAAQ;AACpB,UAAM,cAAc;AACpB,UAAM,UAAU,MAAM;AAClB,cAAQ,OAAO;AACf,cAAQ,IAAI;AAAA,IAChB;AAGA,UAAM,eAAe,MAAM;AACvB,YAAM,MAAM,aAAa;AAAA,IAC7B;AACA,UAAM,eAAe,MAAM;AACvB,YAAM,MAAM,aAAa;AAAA,IAC7B;AAGA,UAAM,YAAY,SAAS,cAAc,QAAQ;AACjD,cAAU,YAAY;AACtB,cAAU,cAAc;AACxB,cAAU,UAAU,MAAM;AACtB,cAAQ,OAAO;AACf,cAAQ,QAAQ;AAAA,IACpB;AAGA,oBAAgB,YAAY,MAAM;AAClC,oBAAgB,YAAY,KAAK;AACjC,oBAAgB,YAAY,SAAS;AAErC,aAAS,YAAY,KAAK;AAC1B,aAAS,YAAY,OAAO;AAC5B,aAAS,YAAY,cAAc;AACnC,aAAS,YAAY,eAAe;AAEpC,YAAQ,YAAY,QAAQ;AAC5B,aAAS,KAAK,YAAY,OAAO;AAGjC,UAAM,aAAa,CAAC,MAAqB;AACrC,UAAI,EAAE,QAAQ,UAAU;AACpB,gBAAQ,OAAO;AACf,iBAAS,oBAAoB,WAAW,UAAU;AAClD,gBAAQ,QAAQ;AAAA,MACpB;AAAA,IACJ;AACA,aAAS,iBAAiB,WAAW,UAAU;AAG/C,WAAO,MAAM;AAAA,EACjB,CAAC;AACL;AAKA,SAAS,0BACL,gBACA,YACM;AAEN,QAAM,WAAW,oBAAI,IAAI;AAAA,IACrB,GAAG,OAAO,KAAK,cAAc;AAAA,IAC7B,GAAG,OAAO,KAAK,UAAU;AAAA,EAC7B,CAAC;AAGD,WAAS,OAAO,QAAQ;AAExB,MAAI,SAAS,SAAS,GAAG;AACrB,WAAO;AAAA,EACX;AAEA,MAAI,OAAO;AACX,aAAW,QAAQ,UAAU;AACzB,UAAM,eAAe,eAAe,IAAI,KAAK;AAC7C,UAAM,WAAW,WAAW,IAAI,KAAK;AAGrC,UAAM,eAAe,CAAC,CAAC,aAAa,SAAS,UAAU,UAAU,EAAE,SAAS,IAAI;AAEhF,UAAM,cAAc,CAAC,QAAwB;AACzC,UAAI,QAAQ,EAAG,QAAO;AACtB,YAAM,eAAe,eAAe,IAAI,QAAQ,CAAC,EAAE,QAAQ,QAAQ,EAAE,IAAI;AACzE,aAAO,IAAI,YAAY,GAAG,eAAe,MAAM,EAAE;AAAA,IACrD;AAGA,UAAM,eAAe,eAAe,IAAI,wBAAwB;AAChE,UAAM,WAAW,WAAW,IAAI,wBAAwB;AAExD,YAAQ;AAAA;AAAA,sBAEM,WAAW,IAAI,CAAC;AAAA,6BACT,YAAY,KAAK,YAAY,YAAY,CAAC;AAAA,6BAC1C,QAAQ,KAAK,YAAY,QAAQ,CAAC;AAAA;AAAA;AAAA,EAG3D;AAEA,SAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAUO,IAAI;AAAA;AAAA;AAAA;AAItB;",
  "names": ["showDpsComparison", "equippedPresetId", "currentPresetEffects", "html"]
}
