{
  "version": 3,
  "sources": ["item-comparison.service.ts"],
  "sourcesContent": ["/**\n * Item Comparison Service\n * Provides passive gains calculation for items with job skill level bonuses\n */\n\nimport {\n    calculateJobSkillPassiveGains\n} from '@ts/services/skill-coefficient.service.js';\nimport { BaseStats, STAT } from '@ts/types';\nimport type { ComparisonItem } from '@ts/types/page/gear-lab/gear-lab.types';\n\n// Re-export for convenience\nexport type { ComparisonItem };\n\n// ============================================================================\n// TYPE DEFINITIONS\n// ============================================================================\n\n/**\n * Context for passive gains calculations\n */\nexport interface PassiveGainsContext {\n    /** Character class (e.g., 'dark-knight') */\n    currentClass: string;\n    /** Character level */\n    characterLevel: number;\n    /**\n     * Defense stat for passive gains calculations\n     *\n     * For Dark Knight: Used for Iron Wall passive (defense \u2192 STR conversion).\n     * Should be the character's base defense value (before item modifications),\n     * as item defense bonuses are handled separately via addDefense/subtractDefense.\n     *\n     * @example\n     * // Get base defense from stats\n     * defense: baseStats.DEFENSE || 0\n     */\n    baseStats: BaseStats;\n}\n\n// ============================================================================\n// PASSIVE GAINS CALCULATION\n// ============================================================================\n\n/**\n * Calculate passive gains for a single item based on its skill level bonuses\n *\n * @param item - Item with skill level bonuses\n * @param context - Calculation context\n * @returns Passive gains with statChanges, breakdown, and complexPassives\n */\nexport function calculatePassiveGainsForItem(\n    item: ComparisonItem,\n    context: PassiveGainsContext\n): {\n    statChanges: Record<string, number>;\n    breakdown: Array<{\n        passive: string;\n        stat: string;\n        statDisplay?: string;\n        baseValue: number;\n        bonusValue: number;\n        gain: number;\n        isPercent: boolean;\n        note?: string;\n    }>;\n    complexPassives: Array<{\n        passive: string;\n        stat?: string;\n        baseValue?: number;\n        bonusValue?: number;\n        gain?: number;\n        isPercent?: boolean;\n        note?: string;\n    }>;\n    complexStatChanges: Record<string, number>;\n} {\n    const { currentClass, characterLevel, baseStats } = context;\n\n    // Extract and validate skill level bonuses from item\n    const skillLevelBonuses = {\n        firstJob: validateSkillLevel(item.statLines.find(s => s.type === STAT.SKILL_LEVEL_1ST.id)?.value),\n        secondJob: validateSkillLevel(item.statLines.find(s => s.type === STAT.SKILL_LEVEL_2ND.id)?.value),\n        thirdJob: validateSkillLevel(item.statLines.find(s => s.type === STAT.SKILL_LEVEL_3RD.id)?.value),\n        fourthJob: validateSkillLevel(item.statLines.find(s => s.type === STAT.SKILL_LEVEL_4TH.id)?.value),\n        allSkills: validateSkillLevel(item.statLines.find(s => s.type === STAT.SKILL_LEVEL_ALL.id)?.value),\n    };\n\n    // Check if item has any skill level bonuses\n    const hasSkillLevels = Object.values(skillLevelBonuses).some(v => v > 0);\n\n    if (!hasSkillLevels) {\n        return {\n            statChanges: {},\n            breakdown: [],\n            complexPassives: [],\n            complexStatChanges: {}\n        };\n    }\n\n    // Calculate passive gains using the skill coefficient service\n    const result = calculateJobSkillPassiveGains(\n        currentClass,\n        characterLevel,\n        skillLevelBonuses,\n        baseStats\n    );\n\n    return {\n        statChanges: result.statChanges,\n        breakdown: result.breakdown,\n        complexPassives: result.complexPassives,\n        complexStatChanges: result.complexStatChanges || {}\n    };\n}\n\n/**\n * Validate and normalize a skill level value\n * @param value - Skill level value from item\n * @returns Validated skill level (0-50)\n */\nfunction validateSkillLevel(value: number | undefined): number {\n    if (typeof value !== 'number' || isNaN(value)) {\n        return 0;\n    }\n    // Clamp to reasonable range (0-50)\n    return Math.max(0, Math.min(50, Math.floor(value)));\n}\n"],
  "mappings": "AAKA;AAAA,EACI;AAAA,OACG;AACP,SAAoB,YAAY;AA2CzB,SAAS,6BACZ,MACA,SAuBF;AACE,QAAM,EAAE,cAAc,gBAAgB,UAAU,IAAI;AAGpD,QAAM,oBAAoB;AAAA,IACtB,UAAU,mBAAmB,KAAK,UAAU,KAAK,OAAK,EAAE,SAAS,KAAK,gBAAgB,EAAE,GAAG,KAAK;AAAA,IAChG,WAAW,mBAAmB,KAAK,UAAU,KAAK,OAAK,EAAE,SAAS,KAAK,gBAAgB,EAAE,GAAG,KAAK;AAAA,IACjG,UAAU,mBAAmB,KAAK,UAAU,KAAK,OAAK,EAAE,SAAS,KAAK,gBAAgB,EAAE,GAAG,KAAK;AAAA,IAChG,WAAW,mBAAmB,KAAK,UAAU,KAAK,OAAK,EAAE,SAAS,KAAK,gBAAgB,EAAE,GAAG,KAAK;AAAA,IACjG,WAAW,mBAAmB,KAAK,UAAU,KAAK,OAAK,EAAE,SAAS,KAAK,gBAAgB,EAAE,GAAG,KAAK;AAAA,EACrG;AAGA,QAAM,iBAAiB,OAAO,OAAO,iBAAiB,EAAE,KAAK,OAAK,IAAI,CAAC;AAEvE,MAAI,CAAC,gBAAgB;AACjB,WAAO;AAAA,MACH,aAAa,CAAC;AAAA,MACd,WAAW,CAAC;AAAA,MACZ,iBAAiB,CAAC;AAAA,MAClB,oBAAoB,CAAC;AAAA,IACzB;AAAA,EACJ;AAGA,QAAM,SAAS;AAAA,IACX;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACJ;AAEA,SAAO;AAAA,IACH,aAAa,OAAO;AAAA,IACpB,WAAW,OAAO;AAAA,IAClB,iBAAiB,OAAO;AAAA,IACxB,oBAAoB,OAAO,sBAAsB,CAAC;AAAA,EACtD;AACJ;AAOA,SAAS,mBAAmB,OAAmC;AAC3D,MAAI,OAAO,UAAU,YAAY,MAAM,KAAK,GAAG;AAC3C,WAAO;AAAA,EACX;AAEA,SAAO,KAAK,IAAI,GAAG,KAAK,IAAI,IAAI,KAAK,MAAM,KAAK,CAAC,CAAC;AACtD;",
  "names": []
}
