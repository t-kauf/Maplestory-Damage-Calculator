{
  "version": 3,
  "sources": ["item-comparison.service.ts"],
  "sourcesContent": ["/**\r\n * Item Comparison Service\r\n * Provides passive gains calculation for items with job skill level bonuses\r\n */\r\n\r\nimport {\r\n    calculateJobSkillPassiveGains\r\n} from '@ts/services/skill-coefficient.service.js';\r\nimport { BaseStats, STAT } from '@ts/types';\r\nimport type { ComparisonItem } from '@ts/types/page/gear-lab/gear-lab.types';\r\n\r\n// Re-export for convenience\r\nexport type { ComparisonItem };\r\n\r\n// ============================================================================\r\n// TYPE DEFINITIONS\r\n// ============================================================================\r\n\r\n/**\r\n * Context for passive gains calculations\r\n */\r\nexport interface PassiveGainsContext {\r\n    /** Character class (e.g., 'dark-knight') */\r\n    currentClass: string;\r\n    /** Character level */\r\n    characterLevel: number;\r\n    /**\r\n     * Defense stat for passive gains calculations\r\n     *\r\n     * For Dark Knight: Used for Iron Wall passive (defense \u2192 STR conversion).\r\n     * Should be the character's base defense value (before item modifications),\r\n     * as item defense bonuses are handled separately via addDefense/subtractDefense.\r\n     *\r\n     * @example\r\n     * // Get base defense from stats\r\n     * defense: baseStats.DEFENSE || 0\r\n     */\r\n    baseStats: BaseStats;\r\n}\r\n\r\n// ============================================================================\r\n// PASSIVE GAINS CALCULATION\r\n// ============================================================================\r\n\r\n/**\r\n * Calculate passive gains for a single item based on its skill level bonuses\r\n *\r\n * @param item - Item with skill level bonuses\r\n * @param context - Calculation context\r\n * @returns Passive gains with statChanges, breakdown, and complexPassives\r\n */\r\nexport function calculatePassiveGainsForItem(\r\n    item: ComparisonItem,\r\n    context: PassiveGainsContext\r\n): {\r\n    statChanges: Record<string, number>;\r\n    breakdown: Array<{\r\n        passive: string;\r\n        stat: string;\r\n        statDisplay?: string;\r\n        baseValue: number;\r\n        bonusValue: number;\r\n        gain: number;\r\n        isPercent: boolean;\r\n        note?: string;\r\n    }>;\r\n    complexPassives: Array<{\r\n        passive: string;\r\n        stat?: string;\r\n        baseValue?: number;\r\n        bonusValue?: number;\r\n        gain?: number;\r\n        isPercent?: boolean;\r\n        note?: string;\r\n    }>;\r\n    complexStatChanges: Record<string, number>;\r\n} {\r\n    const { currentClass, characterLevel, baseStats } = context;\r\n\r\n    // Extract and validate skill level bonuses from item\r\n    const skillLevelBonuses = {\r\n        firstJob: validateSkillLevel(item.statLines.find(s => s.type === STAT.SKILL_LEVEL_1ST.id)?.value),\r\n        secondJob: validateSkillLevel(item.statLines.find(s => s.type === STAT.SKILL_LEVEL_2ND.id)?.value),\r\n        thirdJob: validateSkillLevel(item.statLines.find(s => s.type === STAT.SKILL_LEVEL_3RD.id)?.value),\r\n        fourthJob: validateSkillLevel(item.statLines.find(s => s.type === STAT.SKILL_LEVEL_4TH.id)?.value),\r\n        allSkills: validateSkillLevel(item.statLines.find(s => s.type === STAT.SKILL_LEVEL_ALL.id)?.value),\r\n    };\r\n\r\n    // Check if item has any skill level bonuses\r\n    const hasSkillLevels = Object.values(skillLevelBonuses).some(v => v > 0);\r\n\r\n    if (!hasSkillLevels) {\r\n        return {\r\n            statChanges: {},\r\n            breakdown: [],\r\n            complexPassives: [],\r\n            complexStatChanges: {}\r\n        };\r\n    }\r\n\r\n    // Calculate passive gains using the skill coefficient service\r\n    const result = calculateJobSkillPassiveGains(\r\n        currentClass,\r\n        characterLevel,\r\n        skillLevelBonuses,\r\n        baseStats\r\n    );\r\n\r\n    return {\r\n        statChanges: result.statChanges,\r\n        breakdown: result.breakdown,\r\n        complexPassives: result.complexPassives,\r\n        complexStatChanges: result.complexStatChanges || {}\r\n    };\r\n}\r\n\r\n/**\r\n * Validate and normalize a skill level value\r\n * @param value - Skill level value from item\r\n * @returns Validated skill level (0-50)\r\n */\r\nfunction validateSkillLevel(value: number | undefined): number {\r\n    if (typeof value !== 'number' || isNaN(value)) {\r\n        return 0;\r\n    }\r\n    // Clamp to reasonable range (0-50)\r\n    return Math.max(0, Math.min(50, Math.floor(value)));\r\n}\r\n"],
  "mappings": "AAKA;AAAA,EACI;AAAA,OACG;AACP,SAAoB,YAAY;AA2CzB,SAAS,6BACZ,MACA,SAuBF;AACE,QAAM,EAAE,cAAc,gBAAgB,UAAU,IAAI;AAGpD,QAAM,oBAAoB;AAAA,IACtB,UAAU,mBAAmB,KAAK,UAAU,KAAK,OAAK,EAAE,SAAS,KAAK,gBAAgB,EAAE,GAAG,KAAK;AAAA,IAChG,WAAW,mBAAmB,KAAK,UAAU,KAAK,OAAK,EAAE,SAAS,KAAK,gBAAgB,EAAE,GAAG,KAAK;AAAA,IACjG,UAAU,mBAAmB,KAAK,UAAU,KAAK,OAAK,EAAE,SAAS,KAAK,gBAAgB,EAAE,GAAG,KAAK;AAAA,IAChG,WAAW,mBAAmB,KAAK,UAAU,KAAK,OAAK,EAAE,SAAS,KAAK,gBAAgB,EAAE,GAAG,KAAK;AAAA,IACjG,WAAW,mBAAmB,KAAK,UAAU,KAAK,OAAK,EAAE,SAAS,KAAK,gBAAgB,EAAE,GAAG,KAAK;AAAA,EACrG;AAGA,QAAM,iBAAiB,OAAO,OAAO,iBAAiB,EAAE,KAAK,OAAK,IAAI,CAAC;AAEvE,MAAI,CAAC,gBAAgB;AACjB,WAAO;AAAA,MACH,aAAa,CAAC;AAAA,MACd,WAAW,CAAC;AAAA,MACZ,iBAAiB,CAAC;AAAA,MAClB,oBAAoB,CAAC;AAAA,IACzB;AAAA,EACJ;AAGA,QAAM,SAAS;AAAA,IACX;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACJ;AAEA,SAAO;AAAA,IACH,aAAa,OAAO;AAAA,IACpB,WAAW,OAAO;AAAA,IAClB,iBAAiB,OAAO;AAAA,IACxB,oBAAoB,OAAO,sBAAsB,CAAC;AAAA,EACtD;AACJ;AAOA,SAAS,mBAAmB,OAAmC;AAC3D,MAAI,OAAO,UAAU,YAAY,MAAM,KAAK,GAAG;AAC3C,WAAO;AAAA,EACX;AAEA,SAAO,KAAK,IAAI,GAAG,KAAK,IAAI,IAAI,KAAK,MAAM,KAAK,CAAC,CAAC;AACtD;",
  "names": []
}
