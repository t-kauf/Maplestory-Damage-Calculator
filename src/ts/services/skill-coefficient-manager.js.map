{
  "version": 3,
  "sources": ["skill-coefficient-manager.ts"],
  "sourcesContent": ["/**\r\n * Skill Coefficient Manager\r\n *\r\n * Listens for changes to character level and skill levels (3rd/4th/all)\r\n * and automatically updates the SKILL_COEFFICIENT stat in the loadout store.\r\n *\r\n * This provides an event-driven approach to keeping skill coefficients\r\n * in sync with the underlying character data.\r\n */\r\n\r\nimport { loadoutStore } from '@ts/store/loadout.store';\r\nimport { calculate3rdJobSkillCoefficient, calculate4thJobSkillCoefficient } from '@ts/services/skill-coefficient.service';\r\nimport { JOB_TIER } from '@ts/types/constants';\r\n\r\n/**\r\n * Manages skill coefficient updates through event subscriptions\r\n */\r\nclass SkillCoefficientManager {\r\n    private unsubscribeFunctions: (() => void)[] = [];\r\n    private isInitialized: boolean = false;\r\n\r\n    /**\r\n     * Initialize the manager and subscribe to relevant events\r\n     * Call this during app initialization\r\n     */\r\n    initialize(): void {\r\n        if (this.isInitialized) {\r\n            console.warn('SkillCoefficientManager already initialized');\r\n            return;\r\n        }\r\n\r\n        // Subscribe to skill level changes\r\n        this.unsubscribeFunctions.push(\r\n            loadoutStore.on('skill:level:changed', () => {\r\n                this.updateSkillCoefficient();\r\n            })\r\n        );\r\n\r\n        // Subscribe to character level changes\r\n        this.unsubscribeFunctions.push(\r\n            loadoutStore.on('character:level:changed', () => {\r\n                this.updateSkillCoefficient();\r\n            })\r\n        );\r\n\r\n        // Subscribe to job tier changes\r\n        this.unsubscribeFunctions.push(\r\n            loadoutStore.on('character:jobtier:changed', () => {\r\n                this.updateSkillCoefficient();\r\n            })\r\n        );\r\n\r\n        // Calculate initial coefficient on load to ensure it's up-to-date\r\n        this.updateSkillCoefficient();\r\n\r\n        this.isInitialized = true;\r\n    }\r\n\r\n    /**\r\n     * Update the skill coefficient based on current character data\r\n     * Reads from the store and writes back to the store\r\n     */\r\n    private updateSkillCoefficient(): void {\r\n        const character = loadoutStore.getCharacter();\r\n        const baseStats = loadoutStore.getBaseStats();\r\n\r\n        let coefficient: number;\r\n\r\n        // Calculate coefficient based on job tier\r\n        if (character.jobTier === JOB_TIER.FOURTH) {\r\n            coefficient = calculate4thJobSkillCoefficient(\r\n                character.level,\r\n                baseStats.SKILL_LEVEL_4TH + baseStats.SKILL_LEVEL_ALL\r\n            );\r\n        } else if (character.jobTier === JOB_TIER.THIRD) {\r\n            coefficient = calculate3rdJobSkillCoefficient(\r\n                character.level,\r\n                baseStats.SKILL_LEVEL_3RD + baseStats.SKILL_LEVEL_ALL\r\n            );\r\n        } else {\r\n            // Not applicable for 1st/2nd job\r\n            return;\r\n        }\r\n\r\n        // Update the coefficient in the store\r\n        loadoutStore.updateBaseStat('SKILL_COEFFICIENT', coefficient);\r\n    }\r\n\r\n    /**\r\n     * Clean up event subscriptions\r\n     * Call this during app teardown (if applicable)\r\n     */\r\n    destroy(): void {\r\n        this.unsubscribeFunctions.forEach(fn => fn());\r\n        this.unsubscribeFunctions = [];\r\n        this.isInitialized = false;\r\n    }\r\n\r\n    /**\r\n     * Check if manager is initialized\r\n     */\r\n    isActive(): boolean {\r\n        return this.isInitialized;\r\n    }\r\n}\r\n\r\n// Export singleton instance\r\nexport const skillCoefficientManager = new SkillCoefficientManager();\r\n"],
  "mappings": "AAUA,SAAS,oBAAoB;AAC7B,SAAS,iCAAiC,uCAAuC;AACjF,SAAS,gBAAgB;AAKzB,MAAM,wBAAwB;AAAA,EAA9B;AACI,SAAQ,uBAAuC,CAAC;AAChD,SAAQ,gBAAyB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAMjC,aAAmB;AACf,QAAI,KAAK,eAAe;AACpB,cAAQ,KAAK,6CAA6C;AAC1D;AAAA,IACJ;AAGA,SAAK,qBAAqB;AAAA,MACtB,aAAa,GAAG,uBAAuB,MAAM;AACzC,aAAK,uBAAuB;AAAA,MAChC,CAAC;AAAA,IACL;AAGA,SAAK,qBAAqB;AAAA,MACtB,aAAa,GAAG,2BAA2B,MAAM;AAC7C,aAAK,uBAAuB;AAAA,MAChC,CAAC;AAAA,IACL;AAGA,SAAK,qBAAqB;AAAA,MACtB,aAAa,GAAG,6BAA6B,MAAM;AAC/C,aAAK,uBAAuB;AAAA,MAChC,CAAC;AAAA,IACL;AAGA,SAAK,uBAAuB;AAE5B,SAAK,gBAAgB;AAAA,EACzB;AAAA;AAAA;AAAA;AAAA;AAAA,EAMQ,yBAA+B;AACnC,UAAM,YAAY,aAAa,aAAa;AAC5C,UAAM,YAAY,aAAa,aAAa;AAE5C,QAAI;AAGJ,QAAI,UAAU,YAAY,SAAS,QAAQ;AACvC,oBAAc;AAAA,QACV,UAAU;AAAA,QACV,UAAU,kBAAkB,UAAU;AAAA,MAC1C;AAAA,IACJ,WAAW,UAAU,YAAY,SAAS,OAAO;AAC7C,oBAAc;AAAA,QACV,UAAU;AAAA,QACV,UAAU,kBAAkB,UAAU;AAAA,MAC1C;AAAA,IACJ,OAAO;AAEH;AAAA,IACJ;AAGA,iBAAa,eAAe,qBAAqB,WAAW;AAAA,EAChE;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,UAAgB;AACZ,SAAK,qBAAqB,QAAQ,QAAM,GAAG,CAAC;AAC5C,SAAK,uBAAuB,CAAC;AAC7B,SAAK,gBAAgB;AAAA,EACzB;AAAA;AAAA;AAAA;AAAA,EAKA,WAAoB;AAChB,WAAO,KAAK;AAAA,EAChB;AACJ;AAGO,MAAM,0BAA0B,IAAI,wBAAwB;",
  "names": []
}
