{
  "version": 3,
  "sources": ["skill-coefficient.service.ts"],
  "sourcesContent": ["// Skill Coefficient Calculator\r\n// Calculates skill damage % based on character level for 3rd and 4th job skills\r\n\r\n// Import all class skill data\r\nimport { SKILL_LEVEL_FACTOR_TABLE } from '@ts/data/factor-table-data.js';\r\nimport {\r\n    HERO_SKILLS,\r\n    DARK_KNIGHT_SKILLS as DK_GENERATED_SKILLS,\r\n    ARCH_MAGE_IL_SKILLS,\r\n    ARCH_MAGE_FP_SKILLS,\r\n    BOWMASTER_SKILLS,\r\n    MARKSMAN_SKILLS,\r\n    NIGHT_LORD_SKILLS,\r\n    SHADOWER_SKILLS\r\n} from '@ts/data/all-class-skills.js';\r\nimport { BaseStats, STAT } from '@ts/types';\r\nimport { StatCalculationService } from '@ts/services/stat-calculation-service';\r\n\r\n// ============================================================================\r\n// TYPE DEFINITIONS\r\n// ============================================================================\r\n\r\n/**\r\n * Factor table type - maps level (as string key) to array of factors\r\n */\r\ntype FactorTable = Record<string, number[]>;\r\n\r\n/**\r\n * Job tier values\r\n */\r\ntype JobTier = 1 | 2 | 3 | 4;\r\n\r\n/**\r\n * Job tier string names\r\n */\r\ntype JobTierString = 'firstJob' | 'secondJob' | 'thirdJob' | 'fourthJob';\r\n\r\n/**\r\n * Skill effect configuration\r\n */\r\ninterface SkillEffect {\r\n    stat: string;\r\n    baseValue: number;\r\n    factorIndex: number;\r\n    type: 'flat' | 'percent' | string;\r\n}\r\n\r\n/**\r\n * Base skill data structure\r\n */\r\ninterface BaseSkillData {\r\n    name: string;\r\n    jobStep?: number;\r\n    skillIndex?: number;\r\n    effects?: SkillEffect[];\r\n    isComplex?: boolean;\r\n    note?: string;\r\n}\r\n\r\n/**\r\n * Skill data from generated class skills (all-class-skills.ts)\r\n */\r\ninterface GeneratedSkillData extends BaseSkillData {\r\n    jobStep: number;\r\n    skillIndex: number;\r\n    effects: SkillEffect[];\r\n    isComplex?: boolean;\r\n    note?: string;\r\n}\r\n\r\n/**\r\n * Class skills collection type\r\n */\r\ninterface ClassSkills {\r\n    [key: string]: GeneratedSkillData;\r\n}\r\n\r\n/**\r\n * Skill configuration with base damage and factor index\r\n */\r\ninterface SkillConfig {\r\n    baseDamage: number;\r\n    factorIndex: number;\r\n    scalesWithLevel: boolean;\r\n}\r\n\r\n/**\r\n * Skill configuration for stat bonuses\r\n */\r\ninterface SkillBonusConfig {\r\n    base: number;\r\n    factorIndex: number;\r\n    scalesWithLevel: boolean;\r\n    isFlat?: boolean;\r\n}\r\n\r\n/**\r\n * Dark Knight skill structure\r\n */\r\ninterface DarkKnightSkill {\r\n    key: string;\r\n    name: string;\r\n    icon: string;\r\n    description: string;\r\n    effects: string[];\r\n    isPassive: boolean;\r\n    jobTier: JobTierString;\r\n    baseDamage?: number;\r\n    factorIndex?: number;\r\n    scalesWithLevel?: boolean;\r\n    attackBonus?: SkillBonusConfig;\r\n    defenseBonus?: SkillBonusConfig;\r\n    damageTakenIncrease?: SkillBonusConfig;\r\n    attackSpeed?: SkillBonusConfig;\r\n    strFromDefense?: SkillBonusConfig;\r\n    minDamageRatio?: SkillBonusConfig;\r\n    toughnessBonus?: SkillBonusConfig;\r\n    hpRecovery?: SkillBonusConfig;\r\n    criticalRate?: SkillBonusConfig;\r\n    criticalDamage?: SkillBonusConfig;\r\n    debuffTolerance?: SkillBonusConfig;\r\n    triggerChance?: number;\r\n}\r\n\r\n/**\r\n * Dark Knight skills collection\r\n */\r\ninterface DarkKnightSkills {\r\n    [key: string]: DarkKnightSkill;\r\n}\r\n\r\n/**\r\n * Skill coefficient breakdown\r\n */\r\ninterface SkillCoefficientBreakdown {\r\n    level: number;\r\n    jobTier: string;\r\n    baseDamage: number;\r\n    baseDamagePercent: number;\r\n    factorIndex: number;\r\n    factor: number;\r\n    multiplier: number;\r\n    finalDamagePercent: number;\r\n    formula: string;\r\n}\r\n\r\n/**\r\n * Hyper Body calculation result\r\n */\r\ninterface HyperBodyResult {\r\n    attackBonus: number;\r\n    defenseBonus: number;\r\n}\r\n\r\n/**\r\n * Lord of Darkness calculation result\r\n */\r\ninterface LordOfDarknessResult {\r\n    hpRecovery: number;\r\n    criticalRate: number;\r\n    criticalDamage: number;\r\n}\r\n\r\n/**\r\n * All Dark Knight skills result\r\n */\r\ninterface AllDarkKnightSkills {\r\n    level: number;\r\n    secondJobSkills: {\r\n        spearSweep: { name: string; damage: string };\r\n        evilEye: { name: string; damageTakenIncrease: string };\r\n        evilEyeShock: { name: string; damage: string };\r\n        hyperBody: { name: string; attackBonus: string; defenseBonus: string };\r\n        weaponAcceleration: { name: string; attackSpeed: string };\r\n        ironWall: { name: string; strFromDefense: string };\r\n        weaponMastery: { name: string; minDamageRatio: string };\r\n        finalAttack: { name: string; damage: string; triggerChance: string };\r\n    };\r\n    thirdJobSkills: {\r\n        laManchaSpear: { name: string; damage: string };\r\n        evilEyeOfDominant: { name: string; damage: string };\r\n        rush: { name: string; damage: string };\r\n        crossOverChains: { name: string; attackBonus: string; toughnessBonus: string };\r\n        evilEyeShockEnhancement: { name: string; damage: string };\r\n        hexOfTheEvilEye: { name: string; attackBonus: string };\r\n        lordOfDarkness: { name: string; hpRecovery: string; criticalRate: string; criticalDamage: string };\r\n        endure: { name: string; debuffTolerance: string };\r\n    };\r\n}\r\n\r\n/**\r\n * Passive skill entry for breakdown\r\n */\r\ninterface PassiveBreakdown {\r\n    passive: string;\r\n    stat: string;\r\n    statDisplay?: string;\r\n    baseValue: number;\r\n    bonusValue: number;\r\n    gain: number;\r\n    isPercent: boolean;\r\n    note?: string;\r\n}\r\n\r\n/**\r\n * Complex passive entry\r\n */\r\ninterface ComplexPassive {\r\n    passive: string;\r\n    stat?: string;\r\n    baseValue?: number;\r\n    bonusValue?: number;\r\n    gain?: number;\r\n    isPercent?: boolean;\r\n    note?: string;\r\n}\r\n\r\n/**\r\n * Result from calculateJobSkillPassiveGains\r\n */\r\ninterface JobSkillPassiveGainsResult {\r\n    statChanges: Record<string, number>;\r\n    breakdown: PassiveBreakdown[];\r\n    complexPassives: ComplexPassive[];\r\n    complexStatChanges: Record<string, number>;\r\n}\r\n\r\n/**\r\n * Skill level bonuses object\r\n */\r\ninterface SkillLevelBonuses {\r\n    firstJob?: number;\r\n    secondJob?: number;\r\n    thirdJob?: number;\r\n    fourthJob?: number;\r\n    allSkills?: number;\r\n}\r\n\r\n// Map class names to their skill data\r\nconst CLASS_TO_SKILLS_MAP: Record<string, ClassSkills> = {\r\n    'hero': HERO_SKILLS,\r\n    'dark-knight': DK_GENERATED_SKILLS,\r\n    'arch-mage-il': ARCH_MAGE_IL_SKILLS,\r\n    'arch-mage-fp': ARCH_MAGE_FP_SKILLS,\r\n    'bowmaster': BOWMASTER_SKILLS,\r\n    'marksman': MARKSMAN_SKILLS,\r\n    'night-lord': NIGHT_LORD_SKILLS,\r\n    'shadower': SHADOWER_SKILLS\r\n};\r\n\r\n// 3rd Job Skills Configuration\r\n// All main 3rd job attacking skills share these parameters:\r\n// - Base damage: 800 (represents 80%)\r\n// - Factor index: 21 (index into the Factor array for level scaling)\r\nconst THIRD_JOB_SKILLS: SkillConfig = {\r\n    baseDamage: 800,      // Base damage value (divide by 10 to get %)\r\n    factorIndex: 21,      // Index in the Factor array for level scaling\r\n    scalesWithLevel: true\r\n};\r\n\r\n// 4th Job Skills Configuration\r\n// All main 4th job attacking skills share these parameters:\r\n// - Base damage: 2900 (represents 290%)\r\n// - Factor index: 22 (index into the Factor array for level scaling)\r\nconst FOURTH_JOB_SKILLS: SkillConfig = {\r\n    baseDamage: 2900,     // Base damage value (divide by 10 to get %)\r\n    factorIndex: 21,      // Index in the Factor array for level scaling\r\n    scalesWithLevel: true\r\n};\r\n\r\n/**\r\n * Gets the factor value for a given level\r\n * Interpolates between known level values if exact level is not in table\r\n * @param level - Character level\r\n * @param factorIndex - Index in the factor array to use\r\n * @returns Factor value (1000 = 1.0x multiplier)\r\n */\r\nfunction getFactorForLevel(level: number, factorIndex: number): number {\r\n    // If exact level exists in table, return it\r\n    if (SKILL_LEVEL_FACTOR_TABLE[level]) {\r\n        return SKILL_LEVEL_FACTOR_TABLE[level][factorIndex];\r\n    }\r\n\r\n    // Find the two nearest levels to interpolate between\r\n    const levels = Object.keys(SKILL_LEVEL_FACTOR_TABLE).map(Number).sort((a, b) => a - b);\r\n\r\n    // Find lower and upper bounds\r\n    let lowerLevel = levels[0];\r\n    let upperLevel = levels[levels.length - 1];\r\n\r\n    for (let i = 0; i < levels.length - 1; i++) {\r\n        if (level >= levels[i] && level <= levels[i + 1]) {\r\n            lowerLevel = levels[i];\r\n            upperLevel = levels[i + 1];\r\n            break;\r\n        }\r\n    }\r\n\r\n    // If level is below minimum or above maximum, clamp to bounds\r\n    if (level < levels[0]) {\r\n        return SKILL_LEVEL_FACTOR_TABLE[levels[0]][factorIndex];\r\n    }\r\n    if (level > levels[levels.length - 1]) {\r\n        return SKILL_LEVEL_FACTOR_TABLE[levels[levels.length - 1]][factorIndex];\r\n    }\r\n\r\n    // Linear interpolation\r\n    const lowerFactor = SKILL_LEVEL_FACTOR_TABLE[lowerLevel][factorIndex];\r\n    const upperFactor = SKILL_LEVEL_FACTOR_TABLE[upperLevel][factorIndex];\r\n    const ratio = (level - lowerLevel) / (upperLevel - lowerLevel);\r\n\r\n    return Math.round(lowerFactor + (upperFactor - lowerFactor) * ratio);\r\n}\r\n\r\n/**\r\n * Calculate the input level for skills based on character level and job tier\r\n * This is used to look up the appropriate factor in the skill level factor table\r\n * @param characterLevel - Current character level\r\n * @param jobTier - Job tier (1, 2, 3, or 4)\r\n * @param skillLevelBonus - Bonus to skill level from items (default 0)\r\n * @returns Input level for factor table lookup\r\n */\r\nfunction calculateSkillInputLevel(characterLevel: number, jobTier: JobTier, skillLevelBonus: number = 0): number {\r\n    let baseInputLevel = 0;\r\n\r\n    switch (jobTier) {\r\n        case 1:\r\n            // 1st job skills scale directly with character level (assumption - needs verification)\r\n            baseInputLevel = characterLevel;\r\n            break;\r\n        case 2:\r\n            // 2nd job skills: Similar pattern, starts at level 30\r\n            // Using same formula pattern until exact formula is confirmed\r\n            baseInputLevel = Math.max(0, Math.min((characterLevel - 30) * 3, 120));\r\n            break;\r\n        case 3:\r\n            // 3rd job skills: (characterLevel - 60) * 3, capped at 120\r\n            baseInputLevel = Math.max(0, Math.min((characterLevel - 60) * 3, 120));\r\n            break;\r\n        case 4:\r\n            // 4th job skills: (characterLevel - 100) * 3, no cap\r\n            baseInputLevel = Math.max(0, (characterLevel - 100) * 3);\r\n            break;\r\n        default:\r\n            baseInputLevel = characterLevel;\r\n    }\r\n\r\n    return baseInputLevel + skillLevelBonus;\r\n}\r\n\r\n/**\r\n * Calculates the skill coefficient (damage %) for 3rd job skills\r\n * All main 3rd job attacking skills use the same scaling:\r\n * - Intrepid Slash (Hero)\r\n * - Ice Strike (I/L Mage)\r\n * - Explosion (F/P Mage)\r\n * - Midnight Carnival (Night Lord)\r\n * - Wind Arrow II (Bowmaster)\r\n * - Piercing Arrow II (Marksman)\r\n * - La Mancha Spear (Dark Knight)\r\n *\r\n * Formula:\r\n * - Input level = min((characterLevel - 60) * 3, 120) + skillLevel\r\n * - Coefficient = Base damage (80%) * (factor at input level / 1000)\r\n *\r\n * @param characterLevel - Character level (1-200)\r\n * @param skillLevel - Skill level bonus (default 0)\r\n * @returns Skill damage percentage (e.g., 110.08 for 110.08%)\r\n */\r\nexport function calculate3rdJobSkillCoefficient(characterLevel: number, skillLevel: number = 0): number {\r\n    const baseDamagePercent = THIRD_JOB_SKILLS.baseDamage / 10;\r\n\r\n    // Calculate input level for factor table using shared helper\r\n    const inputLevel = calculateSkillInputLevel(characterLevel, 3, skillLevel);\r\n\r\n    // Get factor from table using the input level\r\n    const factor = getFactorForLevel(inputLevel, THIRD_JOB_SKILLS.factorIndex);\r\n    const multiplier = factor / 1000;\r\n\r\n    return baseDamagePercent * multiplier;\r\n}\r\n\r\n/**\r\n * Calculates the skill coefficient (damage %) for 4th job skills\r\n * All main 4th job attacking skills use the same scaling\r\n *\r\n * Formula:\r\n * - Input level = (characterLevel - 100) * 3 + skillLevel\r\n * - Coefficient = Base damage (290%) * (factor at input level / 1000)\r\n *\r\n * @param characterLevel - Character level (1-200)\r\n * @param skillLevel - Skill level bonus (default 0)\r\n * @returns Skill damage percentage\r\n */\r\nexport function calculate4thJobSkillCoefficient(characterLevel: number, skillLevel: number = 0): number {\r\n    const baseDamagePercent = FOURTH_JOB_SKILLS.baseDamage / 10;\r\n\r\n    // Calculate input level for factor table using shared helper\r\n    const inputLevel = calculateSkillInputLevel(characterLevel, 4, skillLevel);\r\n\r\n    // Get factor from table using the input level\r\n    const factor = getFactorForLevel(inputLevel, FOURTH_JOB_SKILLS.factorIndex);\r\n    const multiplier = factor / 1000;\r\n\r\n    return baseDamagePercent * multiplier;\r\n}\r\n\r\n/**\r\n * Gets detailed calculation breakdown for debugging\r\n * @param level - Character level\r\n * @param jobTier - '3rd' or '4th'\r\n * @returns Breakdown of calculation steps\r\n */\r\nexport function getSkillCoefficientBreakdown(level: number, jobTier: '3rd' | '4th'): SkillCoefficientBreakdown {\r\n    const config = jobTier === '4th' ? FOURTH_JOB_SKILLS : THIRD_JOB_SKILLS;\r\n    const factor = getFactorForLevel(level, config.factorIndex);\r\n    const baseDamagePercent = config.baseDamage / 10;\r\n    const multiplier = factor / 1000;\r\n    const finalDamage = baseDamagePercent * multiplier;\r\n\r\n    return {\r\n        level,\r\n        jobTier,\r\n        baseDamage: config.baseDamage,\r\n        baseDamagePercent,\r\n        factorIndex: config.factorIndex,\r\n        factor,\r\n        multiplier,\r\n        finalDamagePercent: finalDamage,\r\n        formula: `${baseDamagePercent}% \u00D7 (${factor} / 1000) = ${finalDamage.toFixed(2)}%`\r\n    };\r\n}\r\n\r\n// ============================================================================\r\n// DARK KNIGHT SPECIFIC SKILLS\r\n// ============================================================================\r\n\r\n/**\r\n * Dark Knight skill configurations with UI data\r\n * Factor indices: 12, 21, 22\r\n */\r\nexport const DARK_KNIGHT_SKILLS: DarkKnightSkills = {\r\n    // 2nd Job Active Skills\r\n    SPEAR_SWEEP: {\r\n        key: 'spearSweep',\r\n        name: \"Spear Sweep\",\r\n        icon: 'media/skills/dark knight/Skill_Spear_Sweep.png',\r\n        description: 'Performs a sweeping attack with your spear.',\r\n        effects: ['Damage: {damage}'],\r\n        isPassive: false,\r\n        jobTier: 'secondJob',\r\n        baseDamage: 400,\r\n        factorIndex: 21,\r\n        scalesWithLevel: true\r\n    },\r\n\r\n    EVIL_EYE: {\r\n        key: 'evilEye',\r\n        name: \"Evil Eye\",\r\n        icon: 'media/skills/dark knight/Skill_Evil_Eye.png',\r\n        description: 'Summons an Evil Eye that increases damage taken by enemies.',\r\n        effects: ['Damage Taken Increase: {damageTakenIncrease}'],\r\n        isPassive: false,\r\n        jobTier: 'secondJob',\r\n        damageTakenIncrease: { base: 150, factorIndex: 21, scalesWithLevel: true  }\r\n    },\r\n\r\n    EVIL_EYE_SHOCK: {\r\n        key: 'evilEyeShock',\r\n        name: \"Evil Eye Shock\",\r\n        icon: 'media/skills/dark knight/Skill_Evil_Eye_Shock.png',\r\n        description: 'The Evil Eye releases a shock attack.',\r\n        effects: ['Damage: {damage}'],\r\n        isPassive: false,\r\n        jobTier: 'secondJob',\r\n        baseDamage: 700,\r\n        factorIndex: 12,\r\n        scalesWithLevel: true\r\n    },\r\n\r\n    HYPER_BODY: {\r\n        key: 'hyperBody',\r\n        name: \"Hyper Body\",\r\n        icon: 'media/skills/dark knight/Skill_Hyper_Body.png',\r\n        description: 'Increases your attack and defense temporarily.',\r\n        effects: ['Attack Bonus: {attackBonus}', 'Defense Bonus: {defenseBonus}'],\r\n        isPassive: false,\r\n        jobTier: 'secondJob',\r\n        attackBonus: { base: 120, factorIndex: 21, scalesWithLevel: true },\r\n        defenseBonus: { base: 150, factorIndex: 21, scalesWithLevel: true  }\r\n    },\r\n\r\n    // 2nd Job Passive Skills\r\n    WEAPON_ACCELERATION: {\r\n        key: 'weaponAcceleration',\r\n        name: \"Weapon Acceleration\",\r\n        icon: 'media/skills/dark knight/Skill_Weapon_Acceleration_(Dark_Knight).png',\r\n        description: 'Increases your attack speed.',\r\n        effects: ['Attack Speed: {attackSpeed}'],\r\n        isPassive: true,\r\n        jobTier: 'secondJob',\r\n        attackSpeed: { base: 50, factorIndex: 22 , scalesWithLevel: true }\r\n    },\r\n\r\n    IRON_WALL: {\r\n        key: 'ironWall',\r\n        name: \"Iron Wall\",\r\n        icon: 'media/skills/dark knight/Skill_Iron_Wall.png',\r\n        description: 'Converts a portion of your Defense into STR.',\r\n        effects: ['STR from Defense: {strFromDefense}'],\r\n        isPassive: true,\r\n        jobTier: 'secondJob',\r\n        strFromDefense: { base: 100, factorIndex: 22, scalesWithLevel: true  }\r\n    },\r\n\r\n    WEAPON_MASTERY: {\r\n        key: 'weaponMastery',\r\n        name: \"Weapon Mastery\",\r\n        icon: 'media/skills/dark knight/Skill_Weapon_Mastery_(Dark_Knight).png',\r\n        description: 'Increases your minimum damage ratio.',\r\n        effects: ['Min Damage Ratio: {minDamageRatio}'],\r\n        isPassive: true,\r\n        jobTier: 'secondJob',\r\n        minDamageRatio: { base: 150, factorIndex: 22, scalesWithLevel: true  }\r\n    },\r\n\r\n    FINAL_ATTACK: {\r\n        key: 'finalAttack',\r\n        name: \"Final Attack\",\r\n        icon: 'media/skills/dark knight/Skill_Final_Attack.png',\r\n        description: 'Has a chance to trigger an additional attack.',\r\n        effects: ['Damage: {damage}', 'Trigger Chance: 25%'],\r\n        isPassive: true,\r\n        jobTier: 'secondJob',\r\n        baseDamage: 350,\r\n        factorIndex: 21,\r\n        scalesWithLevel: true,\r\n        triggerChance: 25\r\n    },\r\n\r\n    // 3rd Job Skills\r\n    LA_MANCHA_SPEAR: {\r\n        key: 'laManchaSpear',\r\n        name: \"La Mancha Spear\",\r\n        icon: 'media/skills/dark knight/Skill_La_Mancha_Spear.png',\r\n        description: 'Your primary 3rd job attack skill.',\r\n        effects: ['Damage: {damage}'],\r\n        isPassive: false,\r\n        jobTier: 'thirdJob',\r\n        baseDamage: 800,\r\n        factorIndex: 21,\r\n        scalesWithLevel: true\r\n    },\r\n\r\n    EVIL_EYE_OF_DOMINANT: {\r\n        key: 'evilEyeOfDominant',\r\n        name: \"Evil Eye of Dominant\",\r\n        icon: 'media/skills/dark knight/Skill_Evil_Eye_of_Dominant.png',\r\n        description: 'Enhanced Evil Eye attack.',\r\n        effects: ['Damage: {damage}'],\r\n        isPassive: false,\r\n        jobTier: 'thirdJob',\r\n        baseDamage: 600,\r\n        factorIndex: 21,\r\n        scalesWithLevel: true\r\n    },\r\n\r\n    RUSH: {\r\n        key: 'rush',\r\n        name: \"Rush\",\r\n        icon: 'media/skills/dark knight/Skill_Rush_(Dark_Knight).png',\r\n        description: 'Rush forward and attack enemies.',\r\n        effects: ['Damage: {damage}'],\r\n        isPassive: false,\r\n        jobTier: 'thirdJob',\r\n        baseDamage: 6000,\r\n        factorIndex: 12,\r\n        scalesWithLevel: true\r\n    },\r\n\r\n    CROSS_OVER_CHAINS: {\r\n        key: 'crossOverChains',\r\n        name: \"Cross Over Chains\",\r\n        icon: 'media/skills/dark knight/Skill_Cross_Over_Chains.png',\r\n        description: 'Increases attack and toughness.',\r\n        effects: ['Attack Bonus: {attackBonus}', 'Toughness Bonus: {toughnessBonus}'],\r\n        isPassive: false,\r\n        jobTier: 'thirdJob',\r\n        attackBonus: { base: 150, factorIndex: 21, scalesWithLevel: true },\r\n        toughnessBonus: { base: 100, factorIndex: 21, scalesWithLevel: true  }\r\n    },\r\n\r\n    EVIL_EYE_SHOCK_ENHANCEMENT: {\r\n        key: 'evilEyeShockEnhancement',\r\n        name: \"Evil Eye Shock Enhancement\",\r\n        icon: 'media/skills/dark knight/Skill_Evil_Eye_Shock_Enhancement.png',\r\n        description: 'Significantly enhances Evil Eye Shock damage.',\r\n        effects: ['Damage: {damage}'],\r\n        isPassive: false,\r\n        jobTier: 'thirdJob',\r\n        baseDamage: 1075,\r\n        factorIndex: 22,\r\n        scalesWithLevel: true\r\n    },\r\n\r\n    HEX_OF_THE_EVIL_EYE: {\r\n        key: 'hexOfTheEvilEye',\r\n        name: \"Hex of the Evil Eye\",\r\n        icon: 'media/skills/dark knight/Skill_Hex_of_the_Evil_Eye.png',\r\n        description: 'Evil Eye places a hex that increases attack.',\r\n        effects: ['Attack Bonus: {attackBonus}'],\r\n        isPassive: false,\r\n        jobTier: 'thirdJob',\r\n        attackBonus: { base: 150, factorIndex: 22, scalesWithLevel: true }\r\n    },\r\n\r\n    LORD_OF_DARKNESS: {\r\n        key: 'lordOfDarkness',\r\n        name: \"Lord of Darkness\",\r\n        icon: 'media/skills/dark knight/Skill_Lord_of_Darkness.png',\r\n        description: 'Passive skill that enhances HP recovery and critical stats.',\r\n        effects: ['HP Recovery: {hpRecovery}', 'Critical Rate: {criticalRate}', 'Critical Damage: {criticalDamage}'],\r\n        isPassive: true,\r\n        jobTier: 'thirdJob',\r\n        hpRecovery: { base: 15, factorIndex: 22, scalesWithLevel: false },\r\n        criticalRate: { base: 80, factorIndex: 22, scalesWithLevel: true },\r\n        criticalDamage: { base: 300, factorIndex: 22, scalesWithLevel: true }\r\n    },\r\n\r\n    ENDURE: {\r\n        key: 'endure',\r\n        name: \"Endure\",\r\n        icon: 'media/skills/dark knight/Skill_Endure.png',\r\n        description: 'Increases Debuff Tolerance.',\r\n        effects: ['Debuff Tolerance: {debuffTolerance}'],\r\n        isPassive: true,\r\n        jobTier: 'thirdJob',\r\n        debuffTolerance: { base: 15, factorIndex: 22, scalesWithLevel: true, isFlat: true }\r\n    }\r\n};\r\n\r\n/**\r\n * Calculate skill effect value based on level\r\n * @param baseValue - Base value from skill data\r\n * @param factorIndex - Factor table index (12, 21, or 22)\r\n * @param level - Character level\r\n * @param scalesWithLevel - Whether the skill scales with level (default: true)\r\n * @param isFlat - Whether the value is a flat number (not a percentage) (default: false)\r\n * @returns Calculated value\r\n */\r\nfunction calculateSkillValue(baseValue: number, factorIndex: number, level: number, scalesWithLevel: boolean = true, isFlat: boolean = false): number {\r\n    if (!scalesWithLevel) {\r\n        return isFlat ? baseValue : baseValue / 10; // Convert to percentage unless it's a flat value\r\n    }\r\n\r\n    const factor = getFactorForLevel(level, factorIndex);\r\n    const base = isFlat ? baseValue : baseValue / 10;\r\n    const multiplier = factor / 1000;\r\n\r\n    return base * multiplier;\r\n}\r\n\r\n// ============================================================================\r\n// 2ND JOB DARK KNIGHT SKILLS\r\n// ============================================================================\r\n\r\n/**\r\n * Calculate Spear Sweep damage\r\n * @param level - Character level\r\n * @returns Damage percentage\r\n */\r\nexport function calculateSpearSweep(level: number): number {\r\n    const config = DARK_KNIGHT_SKILLS.SPEAR_SWEEP;\r\n    return calculateSkillValue(config.baseDamage, config.factorIndex, level);\r\n}\r\n\r\n/**\r\n * Calculate Evil Eye damage taken increase\r\n * @param level - Character level\r\n * @returns Damage taken increase percentage\r\n */\r\nexport function calculateEvilEye(level: number): number {\r\n    const config = DARK_KNIGHT_SKILLS.EVIL_EYE.damageTakenIncrease;\r\n    return calculateSkillValue(config.base, config.factorIndex, level);\r\n}\r\n\r\n/**\r\n * Calculate Evil Eye Shock damage\r\n * @param level - Character level\r\n * @returns Damage percentage\r\n */\r\nexport function calculateEvilEyeShock(level: number): number {\r\n    const config = DARK_KNIGHT_SKILLS.EVIL_EYE_SHOCK;\r\n    return calculateSkillValue(config.baseDamage!, config.factorIndex!, level);\r\n}\r\n\r\n/**\r\n * Calculate Hyper Body bonuses\r\n * @param level - Character level\r\n * @returns Attack and Defense bonuses\r\n */\r\nexport function calculateHyperBody(level: number): HyperBodyResult {\r\n    const config = DARK_KNIGHT_SKILLS.HYPER_BODY;\r\n    return {\r\n        attackBonus: calculateSkillValue(config.attackBonus!.base, config.attackBonus!.factorIndex, level),\r\n        defenseBonus: calculateSkillValue(config.defenseBonus!.base, config.defenseBonus!.factorIndex, level)\r\n    };\r\n}\r\n\r\n/**\r\n * Calculate Weapon Acceleration attack speed bonus\r\n * @param level - Character level\r\n * @returns Attack speed percentage\r\n */\r\nexport function calculateWeaponAcceleration(level: number): number {\r\n    const config = DARK_KNIGHT_SKILLS.WEAPON_ACCELERATION.attackSpeed!;\r\n    return calculateSkillValue(config.base, config.factorIndex, level);\r\n}\r\n\r\n/**\r\n * Calculate Iron Wall STR bonus from Defense\r\n * @param level - Character level\r\n * @returns Percentage of Defense converted to STR\r\n */\r\nexport function calculateIronWall(level: number): number {\r\n    const config = DARK_KNIGHT_SKILLS.IRON_WALL.strFromDefense!;\r\n    return calculateSkillValue(config.base, config.factorIndex, level);\r\n}\r\n\r\n/**\r\n * Calculate Weapon Mastery min damage ratio bonus\r\n * @param level - Character level\r\n * @returns Min damage ratio percentage\r\n */\r\nexport function calculateWeaponMastery(level: number): number {\r\n    const config = DARK_KNIGHT_SKILLS.WEAPON_MASTERY.minDamageRatio!;\r\n    return calculateSkillValue(config.base, config.factorIndex, level);\r\n}\r\n\r\n/**\r\n * Calculate Final Attack damage\r\n * @param level - Character level\r\n * @returns Damage percentage\r\n */\r\nexport function calculateFinalAttack(level: number): number {\r\n    const config = DARK_KNIGHT_SKILLS.FINAL_ATTACK;\r\n    return calculateSkillValue(config.baseDamage!, config.factorIndex!, level, config.scalesWithLevel!);\r\n}\r\n\r\n// ============================================================================\r\n// 3RD JOB DARK KNIGHT SKILLS\r\n// ============================================================================\r\n\r\n/**\r\n * Calculate Dark Knight La Mancha Spear damage\r\n * @param level - Character level\r\n * @returns Damage percentage\r\n */\r\nexport function calculateLaManchaSpear(level: number): number {\r\n    const config = DARK_KNIGHT_SKILLS.LA_MANCHA_SPEAR;\r\n    return calculateSkillValue(config.baseDamage!, config.factorIndex!, level, config.scalesWithLevel!);\r\n}\r\n\r\n/**\r\n * Calculate Evil Eye of Dominant damage\r\n * @param level - Character level\r\n * @returns Damage percentage\r\n */\r\nexport function calculateEvilEyeOfDominant(level: number): number {\r\n    const config = DARK_KNIGHT_SKILLS.EVIL_EYE_OF_DOMINANT;\r\n    return calculateSkillValue(config.baseDamage!, config.factorIndex!, level, config.scalesWithLevel!);\r\n}\r\n\r\n/**\r\n * Calculate Dark Knight Rush damage\r\n * @param level - Character level\r\n * @returns Damage percentage\r\n */\r\nexport function calculateRush(level: number): number {\r\n    const config = DARK_KNIGHT_SKILLS.RUSH;\r\n    return calculateSkillValue(config.baseDamage!, config.factorIndex!, level, config.scalesWithLevel!);\r\n}\r\n\r\n/**\r\n * Calculate Cross Over Chains attack bonus\r\n * @param level - Character level\r\n * @returns Attack bonus percentage\r\n */\r\nexport function calculateCrossOverChainsAttack(level: number): number {\r\n    const config = DARK_KNIGHT_SKILLS.CROSS_OVER_CHAINS.attackBonus!;\r\n    return calculateSkillValue(config.base, config.factorIndex, level);\r\n}\r\n\r\n/**\r\n * Calculate Cross Over Chains toughness bonus\r\n * @param level - Character level\r\n * @returns Toughness bonus percentage\r\n */\r\nexport function calculateCrossOverChainsToughness(level: number): number {\r\n    const config = DARK_KNIGHT_SKILLS.CROSS_OVER_CHAINS.toughnessBonus!;\r\n    return calculateSkillValue(config.base, config.factorIndex, level);\r\n}\r\n\r\n/**\r\n * Calculate Evil Eye Shock Enhancement damage\r\n * @param level - Character level\r\n * @returns Damage percentage\r\n */\r\nexport function calculateEvilEyeShockEnhancement(level: number): number {\r\n    const config = DARK_KNIGHT_SKILLS.EVIL_EYE_SHOCK_ENHANCEMENT;\r\n    return calculateSkillValue(config.baseDamage!, config.factorIndex!, level, config.scalesWithLevel!);\r\n}\r\n\r\n/**\r\n * Calculate Hex of the Evil Eye attack bonus\r\n * @param level - Character level\r\n * @returns Attack bonus percentage\r\n */\r\nexport function calculateHexOfTheEvilEye(level: number): number {\r\n    const config = DARK_KNIGHT_SKILLS.HEX_OF_THE_EVIL_EYE.attackBonus!;\r\n    return calculateSkillValue(config.base, config.factorIndex, level);\r\n}\r\n\r\n/**\r\n * Calculate Lord of Darkness effects\r\n * @param level - Character level\r\n * @returns Object with HP recovery, crit rate, and crit damage\r\n */\r\nexport function calculateLordOfDarkness(level: number): LordOfDarknessResult {\r\n    const config = DARK_KNIGHT_SKILLS.LORD_OF_DARKNESS;\r\n\r\n    return {\r\n        hpRecovery: calculateSkillValue(\r\n            config.hpRecovery!.base,\r\n            config.hpRecovery!.factorIndex,\r\n            level,\r\n            config.hpRecovery!.scalesWithLevel\r\n        ),\r\n        criticalRate: calculateSkillValue(\r\n            config.criticalRate!.base,\r\n            config.criticalRate!.factorIndex,\r\n            level\r\n        ),\r\n        criticalDamage: calculateSkillValue(\r\n            config.criticalDamage!.base,\r\n            config.criticalDamage!.factorIndex,\r\n            level\r\n        )\r\n    };\r\n}\r\n\r\n/**\r\n * Calculate Endure debuff tolerance\r\n * @param level - Character level\r\n * @returns Debuff tolerance\r\n */\r\nexport function calculateEndure(level: number): number {\r\n    const config = DARK_KNIGHT_SKILLS.ENDURE.debuffTolerance!;\r\n    return calculateSkillValue(config.base, config.factorIndex, level, config.scalesWithLevel, config.isFlat!);\r\n}\r\n\r\n/**\r\n * Get all Dark Knight skill values at a specific level\r\n * @param level - Character level\r\n * @returns All Dark Knight skill values\r\n */\r\nexport function getAllDarkKnightSkills(level: number): AllDarkKnightSkills {\r\n    const lordOfDarkness = calculateLordOfDarkness(level);\r\n    const hyperBody = calculateHyperBody(level);\r\n\r\n    return {\r\n        level,\r\n        secondJobSkills: {\r\n            spearSweep: {\r\n                name: \"Spear Sweep\",\r\n                damage: calculateSpearSweep(level).toFixed(2) + \"%\"\r\n            },\r\n            evilEye: {\r\n                name: \"Evil Eye\",\r\n                damageTakenIncrease: calculateEvilEye(level).toFixed(2) + \"%\"\r\n            },\r\n            evilEyeShock: {\r\n                name: \"Evil Eye Shock\",\r\n                damage: calculateEvilEyeShock(level).toFixed(2) + \"%\"\r\n            },\r\n            hyperBody: {\r\n                name: \"Hyper Body\",\r\n                attackBonus: hyperBody.attackBonus.toFixed(2) + \"%\",\r\n                defenseBonus: hyperBody.defenseBonus.toFixed(2) + \"%\"\r\n            },\r\n            weaponAcceleration: {\r\n                name: \"Weapon Acceleration\",\r\n                attackSpeed: calculateWeaponAcceleration(level).toFixed(2) + \"%\"\r\n            },\r\n            ironWall: {\r\n                name: \"Iron Wall\",\r\n                strFromDefense: calculateIronWall(level).toFixed(2) + \"%\"\r\n            },\r\n            weaponMastery: {\r\n                name: \"Weapon Mastery\",\r\n                minDamageRatio: calculateWeaponMastery(level).toFixed(2) + \"%\"\r\n            },\r\n            finalAttack: {\r\n                name: \"Final Attack\",\r\n                damage: calculateFinalAttack(level).toFixed(2) + \"%\",\r\n                triggerChance: \"25%\"\r\n            }\r\n        },\r\n        thirdJobSkills: {\r\n            laManchaSpear: {\r\n                name: \"La Mancha Spear\",\r\n                damage: calculateLaManchaSpear(level).toFixed(2) + \"%\"\r\n            },\r\n            evilEyeOfDominant: {\r\n                name: \"Evil Eye of Dominant\",\r\n                damage: calculateEvilEyeOfDominant(level).toFixed(2) + \"%\"\r\n            },\r\n            rush: {\r\n                name: \"Rush\",\r\n                damage: calculateRush(level).toFixed(2) + \"%\"\r\n            },\r\n            crossOverChains: {\r\n                name: \"Cross Over Chains\",\r\n                attackBonus: calculateCrossOverChainsAttack(level).toFixed(2) + \"%\",\r\n                toughnessBonus: calculateCrossOverChainsToughness(level).toFixed(2) + \"%\"\r\n            },\r\n            evilEyeShockEnhancement: {\r\n                name: \"Evil Eye Shock Enhancement\",\r\n                damage: calculateEvilEyeShockEnhancement(level).toFixed(2) + \"%\"\r\n            },\r\n            hexOfTheEvilEye: {\r\n                name: \"Hex of the Evil Eye\",\r\n                attackBonus: calculateHexOfTheEvilEye(level).toFixed(2) + \"%\"\r\n            },\r\n            lordOfDarkness: {\r\n                name: \"Lord of Darkness\",\r\n                hpRecovery: lordOfDarkness.hpRecovery.toFixed(2) + \"%\",\r\n                criticalRate: lordOfDarkness.criticalRate.toFixed(2) + \"%\",\r\n                criticalDamage: lordOfDarkness.criticalDamage.toFixed(2) + \"%\"\r\n            },\r\n            endure: {\r\n                name: \"Endure\",\r\n                debuffTolerance: calculateEndure(level).toFixed(0)\r\n            }\r\n        }\r\n    };\r\n}\r\n\r\n// ============================================================================\r\n// JOB SKILL PASSIVE GAINS FOR DPS CALCULATION\r\n// ============================================================================\r\n\r\n/**\r\n * Get DPS-relevant passives from generated class skills by job tier\r\n * Works with the new format from all-class-skills.js\r\n * @param classSkills - The skill data object for a class (e.g., HERO_SKILLS)\r\n * @param jobTier - Numeric job tier (1, 2, 3, or 4)\r\n * @returns Array of passive skill objects with DPS-relevant effects\r\n */\r\nfunction getPassivesByTier(classSkills: ClassSkills, jobTier: JobTier): Array<{ skillKey: string; name: string; skillData: GeneratedSkillData }> {\r\n    const passives: Array<{ skillKey: string; name: string; skillData: GeneratedSkillData }> = [];\r\n\r\n    for (const [skillKey, skillData] of Object.entries(classSkills)) {\r\n        // Only include skills from the specified job tier that are DPS relevant\r\n        if (skillData.jobStep === jobTier && !skillData.isComplex) {\r\n            passives.push({\r\n                skillKey,\r\n                name: skillData.name,\r\n                skillData\r\n            });\r\n        }\r\n    }\r\n\r\n    return passives;\r\n}\r\n\r\n/**\r\n * Get DPS-relevant complex passives from generated class skills by job tier\r\n * @param classSkills - The skill data object for a class (e.g., HERO_SKILLS)\r\n * @param jobTier - Numeric job tier (1, 2, 3, or 4)\r\n * @returns Array of complex passive skill objects\r\n */\r\nfunction getComplexPassivesByTier(classSkills: ClassSkills, jobTier: JobTier): Array<{ skillKey: string; name: string; skillData: GeneratedSkillData }> {\r\n    const passives: Array<{ skillKey: string; name: string; skillData: GeneratedSkillData }> = [];\r\n\r\n    for (const [skillKey, skillData] of Object.entries(classSkills)) {\r\n        // Only include complex skills from the specified job tier\r\n        if (skillData.jobStep === jobTier && skillData.isComplex) {\r\n            passives.push({\r\n                skillKey,\r\n                name: skillData.name,\r\n                skillData\r\n            });\r\n        }\r\n    }\r\n\r\n    return passives;\r\n}\r\n\r\n/**\r\n * Calculate passive stat gains from job skill level bonuses\r\n * @param className - Class name (e.g., 'dark-knight')\r\n * @param characterLevel - Current character level\r\n * @param skillLevelBonuses - Object with jobTier keys and skill level bonus values\r\n *   Example: { firstJob: 0, secondJob: 1, thirdJob: 2, fourthJob: 0, allSkills: 1 }\r\n * @param currentStats - Current character stats (needed for Iron Wall defense \u2192 STR conversion)\r\n * @returns Object with stat changes and breakdown\r\n *   Example: {\r\n *     statChanges: { attackSpeed: 6.5, minDamage: 19.5, critRate: 10.4, critDamage: 39 },\r\n *     breakdown: [{ passive: \"Weapon Acceleration\", stat: \"attackSpeed\", gain: 6.5 }],\r\n *     complexPassives: [{ passive: \"Final Attack\", note: \"25% chance to proc 45.5% damage\" }]\r\n *   }\r\n */\r\nexport function calculateJobSkillPassiveGains(\r\n    className: string,\r\n    characterLevel: number,\r\n    skillLevelBonuses: SkillLevelBonuses,\r\n    baseStats: BaseStats\r\n): JobSkillPassiveGainsResult {\r\n    // Get the class skills data\r\n    const classSkills = CLASS_TO_SKILLS_MAP[className];\r\n\r\n    if (!classSkills) {\r\n        return {\r\n            statChanges: {},\r\n            breakdown: [],\r\n            complexPassives: [],\r\n            complexStatChanges: {}\r\n        };\r\n    }\r\n\r\n    const statChanges: Record<string, number> = {};\r\n    const breakdown: PassiveBreakdown[] = [];\r\n    const complexPassives: ComplexPassive[] = [];\r\n    const complexStatChanges: Record<string, number> = {};\r\n    complexStatChanges['finalAttack'] = 0;\r\n\r\n    const jobTiers: JobTier[] = [1, 2, 3, 4];\r\n    const jobTierNames: JobTierString[] = ['firstJob', 'secondJob', 'thirdJob', 'fourthJob'];\r\n    const allSkillsBonus = skillLevelBonuses.allSkills || 0;\r\n\r\n    for (let i = 0; i < jobTiers.length; i++) {\r\n        const tierNumber = jobTiers[i];\r\n        const tierName = jobTierNames[i];\r\n        const tierBonus = (skillLevelBonuses[tierName] || 0) + allSkillsBonus;\r\n\r\n        // Get regular passives for this tier\r\n        const passives = getPassivesByTier(classSkills, tierNumber as JobTier);\r\n\r\n        for (const { name, skillData } of passives) {\r\n            // Calculate input levels for factor table lookup using shared helper\r\n            const baseInputLevel = calculateSkillInputLevel(characterLevel, tierNumber as JobTier, 0);\r\n            const bonusInputLevel = calculateSkillInputLevel(characterLevel, tierNumber as JobTier, tierBonus);\r\n\r\n            // Process each effect in the skill's effects array\r\n            for (const effect of skillData.effects) {\r\n                // The 'type' field is \"flat\" or \"percent\"\r\n                const isFlat = effect.type === 'flat';\r\n\r\n                // Calculate the stat value at base input level\r\n                const baseValue = calculateSkillValue(\r\n                    effect.baseValue,\r\n                    effect.factorIndex,\r\n                    baseInputLevel,\r\n                    true,  // scalesWithLevel - always true for passives\r\n                    isFlat\r\n                );\r\n\r\n                // Calculate the stat value at bonus input level\r\n                const bonusValue = calculateSkillValue(\r\n                    effect.baseValue,\r\n                    effect.factorIndex,\r\n                    bonusInputLevel,\r\n                    true,  // scalesWithLevel - always true for passives\r\n                    isFlat\r\n                );\r\n\r\n                const statGain = bonusValue - baseValue;\r\n                const calculatorStat = effect.stat;\r\n\r\n                // Special handling for defense stat (converts to mainStat for Dark Knight)\r\n                if (calculatorStat === 'defense') {\r\n                    // Calculate the actual defense increase (as a flat number)\r\n                    const defenseValue = statGain; // This is the defense % value from the skill\r\n                    const mainStatIncrease = (baseStats.DEFENSE || 0) * (defenseValue / 100);\r\n\r\n                    // Use StatCalculationService to apply defense core\r\n                    // The circular dependency is avoided by using calculateFinalAttackBonusFromJobSkills\r\n                    // which doesn't create a StatCalculationService\r\n                    const statService = new StatCalculationService(baseStats);\r\n                    const beforeStats = statService.getStats();\r\n\r\n                    // Add the defense - for Dark Knight this will convert to main stat, attack, and stat damage\r\n                    statService.add(STAT.PRIMARY_MAIN_STAT.id, mainStatIncrease);\r\n                    const afterStats = statService.getStats();\r\n\r\n                    // Calculate the gains by comparing before and after\r\n                    const mainStatGain = afterStats.PRIMARY_MAIN_STAT - beforeStats.PRIMARY_MAIN_STAT;\r\n                    const statDamageGain = afterStats.STAT_DAMAGE - beforeStats.STAT_DAMAGE;\r\n                    const attackGain = afterStats.ATTACK - beforeStats.ATTACK;\r\n\r\n                    // Add gains to statChanges\r\n                    if (!statChanges['mainStat']) statChanges['mainStat'] = 0;\r\n                    statChanges['mainStat'] += mainStatGain;\r\n                    if (!statChanges['statDamage']) statChanges['statDamage'] = 0;\r\n                    statChanges['statDamage'] += statDamageGain;\r\n                    if (!statChanges['attack']) statChanges['attack'] = 0;\r\n                    statChanges['attack'] += attackGain;\r\n\r\n                    breakdown.push({\r\n                        passive: name,\r\n                        stat: 'defense',\r\n                        statDisplay: 'Defense',\r\n                        baseValue: baseValue,\r\n                        bonusValue: bonusValue,\r\n                        gain: statGain,\r\n                        isPercent: true,\r\n                        note: `+${statGain.toFixed(2)} DEF% \u2192 +${mainStatGain.toFixed(0)} Main Stat, +${statDamageGain.toFixed(2)}% Stat Damage, +${attackGain.toFixed(0)} ATK`\r\n                    });\r\n                } else {\r\n                    // Standard stat gain\r\n                    if (!statChanges[calculatorStat]) statChanges[calculatorStat] = 0;\r\n                    statChanges[calculatorStat] += statGain;\r\n\r\n                    // Determine if this stat should display with % sign\r\n                    const isPercent = ['attackSpeed', 'minDamage', 'maxDamage', 'critRate', 'critDamage', 'statDamage', 'finalDamage', 'damage', 'bossDamage', 'normalDamage', 'skillDamage', 'damageAmp', 'basicAttackDamage'].includes(calculatorStat);\r\n\r\n                    breakdown.push({\r\n                        passive: name,\r\n                        stat: calculatorStat,\r\n                        baseValue: baseValue,\r\n                        bonusValue: bonusValue,\r\n                        gain: statGain,\r\n                        isPercent: isPercent\r\n                    });\r\n                }\r\n            }\r\n        }\r\n\r\n        // Get complex passives for this tier (these have notes/conditions and are shown separately)\r\n        const complexPassivesForTier = getComplexPassivesByTier(classSkills, tierNumber as JobTier);\r\n\r\n        for (const { name, skillData } of complexPassivesForTier) {\r\n            const baseInputLevel = calculateSkillInputLevel(characterLevel, tierNumber as JobTier, 0);\r\n            const bonusInputLevel = calculateSkillInputLevel(characterLevel, tierNumber as JobTier, tierBonus);\r\n\r\n            // Complex passives are just shown with their note\r\n            // If they have effects, we calculate the difference to show the gain\r\n            if (skillData.effects && skillData.effects.length > 0) {\r\n                for (const effect of skillData.effects) {\r\n                    const isFlat = effect.type === 'flat';\r\n\r\n                    const baseValue = calculateSkillValue(\r\n                        effect.baseValue,\r\n                        effect.factorIndex,\r\n                        baseInputLevel,\r\n                        true,\r\n                        isFlat\r\n                    );\r\n\r\n                    const bonusValue = calculateSkillValue(\r\n                        effect.baseValue,\r\n                        effect.factorIndex,\r\n                        bonusInputLevel,\r\n                        true,\r\n                        isFlat\r\n                    );\r\n\r\n                    const gain = bonusValue - baseValue;\r\n                    const calculatorStat = effect.stat;\r\n\r\n                    if (calculatorStat.toLowerCase() === 'finalattack')\r\n                    {\r\n                        complexStatChanges['finalAttack'] += bonusValue;\r\n                    }\r\n\r\n                    complexPassives.push({\r\n                        passive: name,\r\n                        stat: calculatorStat,\r\n                        baseValue: baseValue,\r\n                        bonusValue: bonusValue,\r\n                        gain: gain,\r\n                        isPercent: !isFlat,\r\n                        note: skillData.note || ''\r\n                    });\r\n                }\r\n            } else {\r\n                // Just show the note for complex passives with no effects\r\n                complexPassives.push({\r\n                    passive: name,\r\n                    note: skillData.note || 'Complex passive'\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    return {\r\n        statChanges,\r\n        breakdown,\r\n        complexPassives,\r\n        complexStatChanges\r\n    };\r\n}\r\n\r\n/**\r\n * Calculate final attack bonus from job skills without creating a StatCalculationService\r\n * This directly calculates the Final Attack skill value to avoid circular dependencies\r\n * @param className - Class name\r\n * @param characterLevel - Character level\r\n * @param skillLevels - Skill level bonuses\r\n * @returns Final attack bonus multiplier (e.g., 1.45 for 45% bonus)\r\n */\r\nexport function calculateFinalAttackBonusFromJobSkills(\r\n    className: string | null,\r\n    characterLevel: number,\r\n    skillLevels: {\r\n        firstJob?: number;\r\n        secondJob?: number;\r\n        thirdJob?: number;\r\n        fourthJob?: number;\r\n        allSkills?: number;\r\n    }\r\n): number {\r\n    if (!className) return 1;\r\n\r\n    const classSkills = CLASS_TO_SKILLS_MAP[className];\r\n    if (!classSkills) return 1;\r\n\r\n    let finalAttackBonus = 0;\r\n\r\n    // Check all job tiers for Final Attack skills\r\n    const jobTiers: JobTier[] = [1, 2, 3, 4];\r\n    const jobTierNames: JobTierString[] = ['firstJob', 'secondJob', 'thirdJob', 'fourthJob'];\r\n    const allSkillsBonus = skillLevels.allSkills || 0;\r\n\r\n    for (let i = 0; i < jobTiers.length; i++) {\r\n        const tierNumber = jobTiers[i];\r\n        const tierName = jobTierNames[i];\r\n        const tierBonus = (skillLevels[tierName] || 0) + allSkillsBonus;\r\n\r\n        // Get complex passives for this tier (Final Attack is a complex passive)\r\n        for (const [skillKey, skillData] of Object.entries(classSkills)) {\r\n            if (skillData.jobStep === tierNumber && skillData.isComplex) {\r\n                // Check if this is a Final Attack skill (by checking effect stat)\r\n                const hasFinalAttack = skillData.effects?.some(\r\n                    effect => effect.stat.toLowerCase() === 'finalattack'\r\n                );\r\n\r\n                if (hasFinalAttack && skillData.effects) {\r\n                    const effect = skillData.effects[0]; // Final Attack skills have one effect\r\n                    const bonusInputLevel = calculateSkillInputLevel(characterLevel, tierNumber, tierBonus);\r\n\r\n                    const bonusValue = calculateSkillValue(\r\n                        effect.baseValue,\r\n                        effect.factorIndex,\r\n                        bonusInputLevel,\r\n                        true,\r\n                        effect.type === 'flat'\r\n                    );\r\n\r\n                    finalAttackBonus += bonusValue;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    if (finalAttackBonus !== 0) {\r\n        return (1 + finalAttackBonus / 100);\r\n    }\r\n\r\n    return 1;\r\n}\r\n"],
  "mappings": "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",
  "names": []
}
