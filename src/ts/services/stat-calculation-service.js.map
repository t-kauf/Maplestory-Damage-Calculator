{
  "version": 3,
  "sources": ["stat-calculation-service.ts"],
  "sourcesContent": ["// StatCalculationService - Unified stat modification service\r\n// Provides a consistent, chainable API for modifying stats before calculating DPS\r\n\r\nimport { loadoutStore } from '@ts/store/loadout.store.js';\r\nimport { calculateJobSkillPassiveGains } from '@ts/services/skill-coefficient.service.js';\r\nimport { BaseStats, type StatKey } from '@ts/types/loadout.js';\r\nimport { STAT } from '@ts/types/constants';\r\nimport { calculateDamage } from './damage-calculation.service';\r\n\r\n/**\r\n * Damage calculation result\r\n */\r\nexport interface DamageResult {\r\n    baseDamage: number;\r\n    baseHitDamage: number;\r\n    nonCritMin: number;\r\n    nonCritMax: number;\r\n    nonCritAvg: number;\r\n    critMin: number;\r\n    critMax: number;\r\n    critAvg: number;\r\n    expectedDamage: number;\r\n    dps: number;\r\n    damageAmpMultiplier: number;\r\n    attackSpeedMultiplier: number;\r\n    finalDamageMultiplier: number;\r\n}\r\n\r\n/**\r\n * Monster type for damage calculations\r\n */\r\nexport type MonsterType = 'boss' | 'normal';\r\n\r\n/**\r\n * Context object for stat calculations\r\n */\r\nexport interface StatContext {\r\n    mainStatPct: number;\r\n    mainStat: number;\r\n    defense: number;\r\n    selectedClass: string | null;\r\n}\r\n\r\n/**\r\n * Options for creating stat service\r\n */\r\nexport interface CreateStatServiceOptions {\r\n    weaponAttackBonus?: number;\r\n}\r\n\r\n/**\r\n * Options for cumulative calculator series\r\n */\r\ninterface CumulativeSeriesOptions {\r\n    weaponAttackBonus?: number;\r\n    monsterType?: MonsterType;\r\n    numSteps?: number;\r\n}\r\n\r\n/**\r\n * Series state for cumulative calculator\r\n */\r\ninterface SeriesState {\r\n    baseStats: BaseStats;\r\n    baseDPS: number;\r\n    previousDPS: number;\r\n    cumulativeStats: BaseStats;\r\n    weaponAttackBonus: number;\r\n    monsterType: MonsterType;\r\n    numSteps: number;\r\n    mainStatPct: number;\r\n    mainStat: number;\r\n    defense: number;\r\n    selectedClass: string | null;\r\n    previousCumulativeIncrease: number;\r\n}\r\n\r\n/**\r\n * Chart data point\r\n */\r\nexport interface ChartPoint {\r\n    x: number;\r\n    y: number;\r\n}\r\n\r\n/**\r\n * StatCalculationService - A unified service for stat manipulation\r\n *\r\n * This class provides a consistent, chainable API for modifying stats before\r\n * calling calculateDamage(). It eliminates the duplication and inconsistency\r\n * of stat manipulation patterns across the codebase.\r\n *\r\n * Usage:\r\n *   const service = new StatCalculationService(baseStats);\r\n *   const result = service.addAttack(500).addMainStat(1000).computeDPS('boss');\r\n *   const dpsGain = ((result.dps - baseDPS) / baseDPS * 100);\r\n */\r\nexport class StatCalculationService {\r\n    private static readonly DARK_KNIGHT_DEFENSE_CONVERSION_RATE = 0.127;\r\n\r\n    /**\r\n     * Convert lowercase stat ID to StatKey (uppercase)\r\n     * Maps 'attack' -> 'ATTACK', 'critRate' -> 'CRIT_RATE', etc.\r\n     */\r\n    private static idToStatKey(id: string): StatKey {\r\n        // Find the STAT entry with matching ID\r\n        for (const key of Object.keys(STAT) as StatKey[]) {\r\n            if (STAT[key].id === id) {\r\n                return key;\r\n            }\r\n        }\r\n        throw new Error(`Unknown stat ID: ${id}`);\r\n    }\r\n\r\n    stats: BaseStats;\r\n    weaponAttackBonus: number;\r\n    context: StatContext;\r\n    baseBossDPS: number;\r\n    baseNormalDPS: number;\r\n    private _originalStats?: BaseStats;\r\n\r\n    /**\r\n     * @param baseStats - The base stats object to modify\r\n     * @param weaponAttackBonus - Weapon attack bonus percentage (undefined = auto-fetch from state)\r\n     */\r\n    constructor(baseStats: BaseStats, weaponAttackBonus?: number) {\r\n        // Clone the stats to avoid mutating the original\r\n        this.stats = { ...baseStats };\r\n\r\n        // Handle weaponAttackBonus: explicit value or auto-fetch from state\r\n        if (weaponAttackBonus !== undefined) {\r\n            // Explicit override provided\r\n            this.weaponAttackBonus = weaponAttackBonus;\r\n        } else {\r\n            // Auto-fetch from loadout store\r\n            const result = loadoutStore.getWeaponAttackBonus().totalAttack;\r\n\r\n            if (typeof result !== 'number' || isNaN(result) || result < 0) {\r\n                console.error('loadoutStore.getWeaponAttackBonus returned unexpected value:', result, '- treating as 0');\r\n                this.weaponAttackBonus = 0;\r\n            } else {\r\n                this.weaponAttackBonus = result;\r\n            }\r\n        }\r\n\r\n        // Read context values from stats object or state\r\n        this.context = {\r\n            mainStatPct: baseStats.MAIN_STAT_PCT || 0,\r\n            mainStat: baseStats.PRIMARY_MAIN_STAT || 0,\r\n            defense: baseStats.DEFENSE || 0,\r\n            selectedClass: loadoutStore.getSelectedClass()\r\n        };\r\n\r\n        // Calculate base DPS for both monster types\r\n        const baseDamage = calculateDamage(baseStats, 'boss');\r\n        this.baseBossDPS = baseDamage.dps;\r\n        this.baseNormalDPS = calculateDamage(baseStats, 'normal').dps;\r\n    }\r\n\r\n    /**\r\n     * Add flat attack with optional weapon attack bonus application\r\n     * @param value - Attack value to add\r\n     * @param applyWeaponBonus - Whether to apply weapon attack bonus (default: true)\r\n     * @returns Returns this for chaining\r\n     * @private\r\n     */\r\n    private addAttackCore(value: number, applyWeaponBonus = true): this {\r\n        let finalAttackBonus = 1;\r\n        let classFinalAttackBonus = 0;\r\n        const result = calculateJobSkillPassiveGains(this.context.selectedClass, loadoutStore.getCharacterLevel(),\r\n            {\r\n                firstJob: this.stats.SKILL_LEVEL_1ST,\r\n                secondJob: this.stats.SKILL_LEVEL_2ND,\r\n                thirdJob: this.stats.SKILL_LEVEL_3RD,\r\n                fourthJob: this.stats.SKILL_LEVEL_4TH,\r\n                allSkills: this.stats.SKILL_LEVEL_ALL\r\n            });\r\n\r\n        if (result.complexStatChanges) {\r\n            classFinalAttackBonus = result.complexStatChanges['finalAttack'] ?? 0;\r\n        }\r\n\r\n        if (classFinalAttackBonus != 0) {\r\n            finalAttackBonus = (1 + classFinalAttackBonus / 100);\r\n        }\r\n\r\n        const effective = applyWeaponBonus\r\n            ? value * (1 + this.weaponAttackBonus / 100) * finalAttackBonus\r\n            : value;\r\n        this.stats.ATTACK += effective;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Add main stat (flat value, converts to stat damage)\r\n     * 100 main stat = 1% stat damage\r\n     * @param value - Main stat value to add\r\n     * @returns Returns this for chaining\r\n     * @private\r\n     */\r\n    private addMainStatCore(value: number): this {\r\n        const increaseWithMainstatPct = this.calculateMainStatIncreaseWithPct(value);\r\n        const statDamageIncrease = increaseWithMainstatPct / 100;\r\n\r\n        this.stats.PRIMARY_MAIN_STAT += increaseWithMainstatPct;\r\n\r\n        this.addAttackCore(increaseWithMainstatPct);\r\n\r\n        this.stats.STAT_DAMAGE += statDamageIncrease;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Add main stat % with proper diminishing returns calculation\r\n     * @param value - Main stat % to add\r\n     * @returns Returns this for chaining\r\n     * @private\r\n     */\r\n    private addMainStatPctCore(value: number): this {\r\n        const mainStatGain = this.calculateMainStatPercentGain(\r\n            value,\r\n            this.context.mainStatPct,\r\n            this.context.mainStat,\r\n            this.context.defense,\r\n            this.context.selectedClass\r\n        );\r\n\r\n        const statDamageIncrease = mainStatGain / 100;\r\n        this.addAttackCore(mainStatGain);\r\n        this.stats.STAT_DAMAGE += statDamageIncrease;\r\n        this.stats.PRIMARY_MAIN_STAT += mainStatGain;\r\n\r\n        this.context.mainStatPct += value;\r\n        return this;\r\n    }\r\n\r\n    calculateMainStatIncreaseWithPct(value: number): number {\r\n        const mainStatPct = this.context.mainStatPct;\r\n        const mainStatWithPctIncrease = value * (1 + mainStatPct / 100);\r\n        return mainStatWithPctIncrease;\r\n    }\r\n\r\n    /**\r\n     * Add a percentage-based stat (additive)\r\n     * @param statId - The stat ID (e.g., 'bossDamage', 'critRate')\r\n     * @param value - Value to add\r\n     * @returns Returns this for chaining\r\n     * @private\r\n     */\r\n    private addPercentageStatCore(statId: string, value: number): this {\r\n        const statKey = StatCalculationService.idToStatKey(statId);\r\n        this.stats[statKey] = (this.stats[statKey] || 0) + value;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Add a multiplicative stat (like Final Damage)\r\n     * Uses formula: newValue = ((1 + old/100) * (1 + value/100) - 1) * 100\r\n     * @param statId - The stat ID\r\n     * @param value - Value to add\r\n     * @returns Returns this for chaining\r\n     * @private\r\n     */\r\n    private addMultiplicativeStatCore(statId: string, value: number): this {\r\n        const statKey = StatCalculationService.idToStatKey(statId);\r\n        const oldValue = this.stats[statKey] || 0;\r\n        const newValue = (((1 + oldValue / 100) * (1 + value / 100)) - 1) * 100;\r\n        this.stats[statKey] = newValue;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Add a stat with diminishing returns (like Attack Speed)\r\n     * Uses formula: newValue = (1 - (1 - old/factor) * (1 - value/factor)) * factor\r\n     * @param statId - The stat ID\r\n     * @param value - Value to add\r\n     * @param factor - Diminishing returns factor (e.g., 150 for attack speed)\r\n     * @returns Returns this for chaining\r\n     * @private\r\n     */\r\n    private addDiminishingReturnStatCore(statId: string, value: number, factor: number): this {\r\n        const statKey = StatCalculationService.idToStatKey(statId);\r\n        const oldValue = this.stats[statKey] || 0;\r\n        const newValue = (1 - (1 - oldValue / factor) * (1 - value / factor)) * factor;\r\n        this.stats[statKey] = newValue;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Add a stat by key - routes to dedicated add method\r\n     * This is the main public API for adding stats\r\n     * @param statId - The stat ID (e.g., 'attack', 'mainStat', 'mainStatPct', 'defense')\r\n     * @param value - Value to add\r\n     * @returns Returns this for chaining\r\n     */\r\n    add(statId: string, value: number): this {\r\n        switch (statId) {\r\n            case STAT.ATTACK.id:\r\n                return this.addAttackCore(value, true);\r\n            case STAT.PRIMARY_MAIN_STAT.id:\r\n                return this.addMainStatCore(value);\r\n            case STAT.MAIN_STAT_PCT.id:\r\n                return this.addMainStatPctCore(value);\r\n            case STAT.DEFENSE.id:\r\n                return this.addDefenseCore(value);\r\n            case STAT.FINAL_DAMAGE.id:\r\n                return this.addMultiplicativeStatCore(statId, value);\r\n            case STAT.ATTACK_SPEED.id:\r\n                // Attack speed uses diminishing returns formula with factor 150\r\n                return this.addDiminishingReturnStatCore(statId, value, 150);\r\n            case STAT.DEF_PEN.id:\r\n                // Defense penetration uses diminishing returns formula with factor 100\r\n                return this.addDiminishingReturnStatCore(statId, value, 100);\r\n            default:\r\n                // Most stats (critDamage, bossDamage, critRate, etc.) use simple addition\r\n                return this.addPercentageStatCore(statId, value);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Subtract a stat by key - routes to dedicated subtract method\r\n     * This is the main public API for subtracting stats\r\n     * @param statId - The stat ID (e.g., 'attack', 'mainStat', 'mainStatPct', 'defense')\r\n     * @param value - Value to subtract\r\n     * @returns Returns this for chaining\r\n     */\r\n    subtract(statId: string, value: number): this {\r\n        switch (statId) {\r\n            case STAT.ATTACK.id:\r\n                return this.subtractAttackCore(value);\r\n            case STAT.PRIMARY_MAIN_STAT.id:\r\n                return this.subtractMainStatCore(value);\r\n            case STAT.MAIN_STAT_PCT.id:\r\n                return this.subtractMainStatPctCore(value);\r\n            case STAT.DEFENSE.id:\r\n                return this.subtractDefenseCore(value);\r\n            case STAT.FINAL_DAMAGE.id: {\r\n                const statKey = StatCalculationService.idToStatKey(statId);\r\n                return this.subtractMultiplicativeStatCore(statKey, value);\r\n            }\r\n            case STAT.ATTACK_SPEED.id:\r\n                // Attack speed uses diminishing returns formula with factor 150\r\n                return this.subtractDiminishingReturnStatCore(statId, value, 150);\r\n            case STAT.DEF_PEN.id:\r\n                // Defense penetration uses diminishing returns formula with factor 100\r\n                return this.subtractDiminishingReturnStatCore(statId, value, 100);\r\n            default:\r\n                // Most stats (critDamage, bossDamage, etc.) use simple subtraction\r\n                return this.subtractStatCore(statId, value);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Subtract a flat stat value (fallback method)\r\n     * @param statId - The stat ID\r\n     * @param value - Value to subtract\r\n     * @returns Returns this for chaining\r\n     * @private\r\n     */\r\n    private subtractStatCore(statId: string, value: number): this {\r\n        const statKey = StatCalculationService.idToStatKey(statId);\r\n        this.stats[statKey] -= value;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Subtract attack with optional weapon attack bonus application\r\n     * @param value - Attack value to subtract\r\n     * @returns Returns this for chaining\r\n     * @private\r\n     */\r\n    private subtractAttackCore(value: number): this {\r\n        let finalAttackBonus = 0;\r\n        let classFinalAttackBonus = 0;\r\n        const result = calculateJobSkillPassiveGains(this.context.selectedClass, loadoutStore.getCharacterLevel(),\r\n            {\r\n                firstJob: this.stats.SKILL_LEVEL_1ST,\r\n                secondJob: this.stats.SKILL_LEVEL_2ND,\r\n                thirdJob: this.stats.SKILL_LEVEL_3RD,\r\n                fourthJob: this.stats.SKILL_LEVEL_4TH,\r\n                allSkills: this.stats.SKILL_LEVEL_ALL\r\n            });\r\n\r\n        if (result.complexStatChanges) {\r\n            classFinalAttackBonus = result.complexStatChanges['finalAttack'] ?? 0;\r\n        }\r\n\r\n        if (classFinalAttackBonus != 0) {\r\n            finalAttackBonus = (1 + classFinalAttackBonus / 100);\r\n        }\r\n\r\n        const effective = value * (1 + this.weaponAttackBonus / 100) * finalAttackBonus;\r\n        this.stats.ATTACK -= effective;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Subtract main stat (flat value, converts to stat damage)\r\n     * 100 main stat = 1% stat damage\r\n     * @param value - Main stat value to subtract\r\n     * @returns Returns this for chaining\r\n     * @private\r\n     */\r\n    private subtractMainStatCore(value: number): this {\r\n        const increaseWithMainstatPct = this.calculateMainStatIncreaseWithPct(value);\r\n        const statDamageIncrease = increaseWithMainstatPct / 100;\r\n\r\n        this.stats.PRIMARY_MAIN_STAT -= increaseWithMainstatPct;\r\n\r\n        this.subtractAttackCore(increaseWithMainstatPct);\r\n\r\n        this.stats.STAT_DAMAGE -= statDamageIncrease;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Subtract main stat % with proper diminishing returns calculation\r\n     * @param value - Main stat % to subtract\r\n     * @returns Returns this for chaining\r\n     * @private\r\n     */\r\n    private subtractMainStatPctCore(value: number): this {\r\n        const mainStatGain = this.calculateMainStatPercentGain(\r\n            value,\r\n            this.context.mainStatPct,\r\n            this.context.mainStat,\r\n            this.context.defense,\r\n            this.context.selectedClass\r\n        );\r\n\r\n        const statDamageIncrease = mainStatGain / 100;\r\n        this.subtractAttackCore(mainStatGain);\r\n        this.stats.STAT_DAMAGE -= statDamageIncrease;\r\n        this.stats.PRIMARY_MAIN_STAT -= mainStatGain;\r\n\r\n        this.context.mainStatPct -= value;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Subtract a multiplicative stat (like Final Damage)\r\n     * Uses formula: newValue = ((1 + old/100) / (1 + value/100) - 1) * 100\r\n     * This reverses the addition of a multiplicative stat\r\n     * @param statKey - The stat key\r\n     * @param value - Value to subtract (the multiplicative contribution to remove)\r\n     * @returns Returns this for chaining\r\n     * @private\r\n     */\r\n    private subtractMultiplicativeStatCore(statKey: keyof BaseStats, value: number): this {\r\n        const oldValue = this.stats[statKey] || 0;\r\n        const newValue = (((1 + oldValue / 100) / (1 + value / 100)) - 1) * 100;\r\n        this.stats[statKey] = newValue;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Subtract a stat with diminishing returns (like Attack Speed)\r\n     * Uses formula: oldValue = (1 - (1 - current/factor) / (1 - value/factor)) * factor\r\n     * This reverses the addition of a diminishing returns stat\r\n     * @param statId - The stat ID\r\n     * @param value - Value to subtract (the diminishing returns contribution to remove)\r\n     * @param factor - Diminishing returns factor (e.g., 150 for attack speed)\r\n     * @returns Returns this for chaining\r\n     * @private\r\n     */\r\n    private subtractDiminishingReturnStatCore(statId: string, value: number, factor: number): this {\r\n        const statKey = StatCalculationService.idToStatKey(statId);\r\n        const currentValue = this.stats[statKey] || 0;\r\n\r\n        // Avoid division by zero\r\n        if (value >= factor) {\r\n            console.warn(`subtractDiminishingReturnStat: value ${value} >= factor ${factor}, clamping to factor - 0.01`);\r\n            value = factor - 0.01;\r\n        }\r\n\r\n        const oldValue = (1 - (1 - currentValue / factor) / (1 - value / factor)) * factor;\r\n        this.stats[statKey] = Math.max(0, oldValue);\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Add defense with Dark Knight conversion to main stat\r\n     * For Dark Knight: defense converts to main stat (but is NOT affected by main stat %)\r\n     * Conversion rate: 1 defense = 0.127 main stat\r\n     * Then converted to stat damage: 100 main stat = 1% stat damage\r\n     * @param value - Defense value to add\r\n     * @returns Returns this for chaining\r\n     * @private\r\n     */\r\n    private addDefenseCore(value: number): this {\r\n        // Add the defense value itself\r\n        this.stats.DEFENSE = (this.stats.DEFENSE || 0) + value;\r\n\r\n        // For Dark Knight: convert defense to main stat, then to stat damage\r\n        if (this.context.selectedClass === 'dark-knight') {\r\n            const mainStatFromDefense = value * StatCalculationService.DARK_KNIGHT_DEFENSE_CONVERSION_RATE;\r\n            const statDamageIncrease = mainStatFromDefense / 100;\r\n            this.stats.STAT_DAMAGE += statDamageIncrease;\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Subtract defense with Dark Knight conversion to main stat\r\n     * For Dark Knight: defense converts to main stat (but is NOT affected by main stat %)\r\n     * Conversion rate: 1 defense = 0.127 main stat\r\n     * Then converted to stat damage: 100 main stat = 1% stat damage\r\n     * @param value - Defense value to subtract\r\n     * @returns Returns this for chaining\r\n     * @private\r\n     */\r\n    private subtractDefenseCore(value: number): this {\r\n        // Subtract the defense value itself\r\n        this.stats.DEFENSE = (this.stats.DEFENSE || 0) - value;\r\n\r\n        // For Dark Knight: convert defense to main stat, then to stat damage\r\n        if (this.context.selectedClass === 'dark-knight') {\r\n            const mainStatFromDefense = value * StatCalculationService.DARK_KNIGHT_DEFENSE_CONVERSION_RATE;\r\n            const statDamageDecrease = mainStatFromDefense / 100;\r\n            this.stats.STAT_DAMAGE -= statDamageDecrease;\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Set a stat to a specific value\r\n     * @param statKey - The stat key\r\n     * @param value - Value to set\r\n     * @returns Returns this for chaining\r\n     */\r\n    setStat(statKey: keyof BaseStats, value: number): this {\r\n        this.stats[statKey] = value;\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * Get a copy of the current stats\r\n     * @returns Copy of current stats\r\n     */\r\n    getStats(): BaseStats {\r\n        return { ...this.stats };\r\n    }\r\n\r\n    /**\r\n     * Compute damage and return the full result object\r\n     * @param monsterType - 'boss' or 'normal' (default: 'boss')\r\n     * @returns Result from calculateDamage (includes dps, expectedDamage, etc.)\r\n     */\r\n    compute(monsterType: MonsterType = 'boss'): DamageResult {\r\n        return calculateDamage(this.stats, monsterType);\r\n    }\r\n\r\n    /**\r\n     * Calculate DPS only (shorthand for compute().dps)\r\n     * @param monsterType - 'boss' or 'normal' (default: 'boss')\r\n     * @returns DPS value\r\n     */\r\n    computeDPS(monsterType: MonsterType = 'boss'): number {\r\n        return this.compute(monsterType).dps;\r\n    }\r\n\r\n    /**\r\n     * Calculate DPS gain compared to base stats\r\n     * @param baseDPS - Base DPS to compare against\r\n     * @param monsterType - 'boss' or 'normal' (default: 'boss')\r\n     * @returns DPS gain as percentage\r\n     */\r\n    computeDPSGain(baseDPS: number, monsterType: MonsterType = 'boss'): number {\r\n        const newDPS = this.computeDPS(monsterType);\r\n        return ((newDPS - baseDPS) / baseDPS * 100);\r\n    }\r\n\r\n    /**\r\n     * Reset stats to original base stats\r\n     * @returns Returns this for chaining\r\n     */\r\n    reset(): this {\r\n        // We need to store the original stats\r\n        if (!this._originalStats) {\r\n            this._originalStats = { ...this.stats };\r\n        }\r\n        this.stats = { ...this._originalStats };\r\n        return this;\r\n    }\r\n\r\n    calculateMainStatPercentGain(mainStatPctIncrease, currentMainStatPct, mainStat, defense, selectedClass) {\r\n        let defenseToMainStat = 0;\r\n        if (selectedClass === 'dark-knight') {\r\n            defenseToMainStat = defense * 0.127;\r\n        }\r\n\r\n        const currentMultiplier = 1 + currentMainStatPct / 100;\r\n        const baseMainStat = (mainStat - defenseToMainStat) / currentMultiplier;\r\n\r\n        // Now calculate the new total with the increased main stat %\r\n        const newMultiplier = 1 + (currentMainStatPct + mainStatPctIncrease) / 100;\r\n        const newTotalMainStat = (baseMainStat * newMultiplier) + defenseToMainStat;\r\n\r\n        // Calculate the gain in main stat\r\n        const mainStatGain = newTotalMainStat - mainStat;\r\n        return mainStatGain;\r\n    }\r\n}\r\n\r\n\r\n\r\n/**\r\n * Factory function to create a StatCalculationService with common setup\r\n * @param baseStats - Base stats\r\n * @param options - Configuration options\r\n * @returns\r\n */\r\nexport function createStatService(baseStats: BaseStats, options: CreateStatServiceOptions = {}): StatCalculationService {\r\n    const { weaponAttackBonus } = options;\r\n    return new StatCalculationService(baseStats, weaponAttackBonus);\r\n}\r\n\r\n/**\r\n * CumulativeStatCalculator - Specialized calculator for stat weight charts\r\n *\r\n * This class handles cumulative stat calculations across multiple iterations,\r\n * maintaining internal state to track progression. Designed specifically for\r\n * generating chart data points that show marginal DPS gains.\r\n *\r\n * Usage:\r\n *   const calculator = new CumulativeStatCalculator();\r\n *   calculator.startSeries(baseStats, { weaponAttackBonus, monsterType, numSteps });\r\n *\r\n *   for (let i = 0; i <= numPoints; i++) {\r\n *       const point = calculator.nextStep('attack', cumulativeIncrease, i, true);\r\n *       dataPoints.push(point); // point = { x: cumulativeIncrease, y: gainPerUnit }\r\n *   }\r\n */\r\nexport class CumulativeStatCalculator {\r\n    seriesState: SeriesState | null;\r\n\r\n    constructor() {\r\n        this.seriesState = null;\r\n    }\r\n\r\n    /**\r\n     * Initialize a new calculation series\r\n     * @param baseStats - Starting stats\r\n     * @param options - Configuration\r\n     */\r\n    startSeries(baseStats: BaseStats, options: CumulativeSeriesOptions = {}): void {\r\n        const { weaponAttackBonus = 0, monsterType = 'boss', numSteps = 50 } = options;\r\n\r\n        const baseDamage = calculateDamage(baseStats, monsterType);\r\n        const baseDPS = baseDamage.dps;\r\n\r\n        this.seriesState = {\r\n            baseStats: { ...baseStats },\r\n            baseDPS: baseDPS,\r\n            previousDPS: baseDPS,\r\n            cumulativeStats: { ...baseStats },\r\n            weaponAttackBonus: weaponAttackBonus,\r\n            monsterType: monsterType,\r\n            numSteps: numSteps,\r\n            mainStatPct: baseStats.MAIN_STAT_PCT || 0,\r\n            mainStat: baseStats.PRIMARY_MAIN_STAT || 0,\r\n            defense: baseStats.DEFENSE || 0,\r\n            selectedClass: loadoutStore.getSelectedClass(),\r\n            previousCumulativeIncrease: 0\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Calculate the next step in the series\r\n     * @param statKey - Stat being modified\r\n     * @param cumulativeIncrease - Total increase at this step\r\n     * @param currentStep - Current step index (0-based)\r\n     * @param isFlat - Whether this is a flat stat (attack/mainStat)\r\n     * @returns Chart-ready point {cumulativeIncrease, gainPerUnit}\r\n     */\r\n    nextStep(statKey: string, cumulativeIncrease: number, currentStep: number, isFlat: boolean): ChartPoint {\r\n        if (!this.seriesState) {\r\n            throw new Error('Must call startSeries() before nextStep()');\r\n        }\r\n\r\n        const stepIncrease = cumulativeIncrease - this.seriesState.previousCumulativeIncrease;\r\n\r\n        // Route to appropriate type-specific method\r\n        let currentDPS;\r\n        if (isFlat) {\r\n            if (statKey === 'attack') {\r\n                currentDPS = this._stepAttack(cumulativeIncrease, stepIncrease);\r\n            } else if (statKey === 'mainStat') {\r\n                currentDPS = this._stepMainStat(cumulativeIncrease, stepIncrease);\r\n            } else {\r\n                throw new Error(`Unknown flat stat: ${statKey}`);\r\n            }\r\n        } else {\r\n            if (statKey === 'statDamage') {\r\n                currentDPS = this._stepMainStatPct(cumulativeIncrease, stepIncrease);\r\n            } else if (statKey === 'finalDamage') {\r\n                currentDPS = this._stepMultiplicative(statKey, cumulativeIncrease, stepIncrease);\r\n            } else if (statKey === 'attackSpeed' || statKey === 'defPenMultiplier') {\r\n                const factor = statKey === 'attackSpeed' ? 150 : 100;\r\n                currentDPS = this._stepDiminishing(statKey, cumulativeIncrease, stepIncrease, factor);\r\n            } else {\r\n                // Default: additive stat\r\n                currentDPS = this._stepAdditive(statKey, cumulativeIncrease, stepIncrease);\r\n            }\r\n        }\r\n\r\n        // Calculate marginal gain relative to previous DPS\r\n        const marginalGain = ((currentDPS - this.seriesState.previousDPS) / this.seriesState.previousDPS * 100);\r\n\r\n        // Calculate gain per unit\r\n        // For attack: per 500, for mainStat: per 100, for percentage stats: per 1%\r\n        const actualStepSize = isFlat\r\n            ? (statKey === 'attack' ? stepIncrease / 500 : stepIncrease / 100)\r\n            : stepIncrease;\r\n\r\n        const gainPerUnit = actualStepSize > 0 ? marginalGain / actualStepSize : 0;\r\n\r\n        // Update state for next iteration\r\n        this.seriesState.previousDPS = currentDPS;\r\n        this.seriesState.previousCumulativeIncrease = cumulativeIncrease;\r\n\r\n        return {\r\n            x: cumulativeIncrease,\r\n            y: parseFloat(gainPerUnit.toFixed(2))\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Handle attack stat step with weapon bonus\r\n     * @private\r\n     */\r\n    private _stepAttack(cumulativeIncrease: number, stepIncrease: number): number {\r\n        const effectiveIncrease = stepIncrease * (1 + this.seriesState.weaponAttackBonus / 100);\r\n        const modifiedStats = { ...this.seriesState.cumulativeStats };\r\n        modifiedStats.ATTACK += effectiveIncrease;\r\n\r\n        this.seriesState.cumulativeStats = modifiedStats;\r\n        return calculateDamage(modifiedStats, this.seriesState.monsterType).dps;\r\n    }\r\n\r\n    /**\r\n     * Handle main stat step (converts to statDamage)\r\n     * @private\r\n     */\r\n    private _stepMainStat(cumulativeIncrease: number, stepIncrease: number): number {\r\n        const statDamageIncrease = stepIncrease / 100;\r\n        const modifiedStats = { ...this.seriesState.cumulativeStats };\r\n        modifiedStats.STAT_DAMAGE += statDamageIncrease;\r\n\r\n        this.seriesState.cumulativeStats = modifiedStats;\r\n        return calculateDamage(modifiedStats, this.seriesState.monsterType).dps;\r\n    }\r\n\r\n    /**\r\n     * Handle main stat % step with diminishing returns\r\n     * @private\r\n     */\r\n    private _stepMainStatPct(cumulativeIncrease: number, stepIncrease: number): number {\r\n        const prevCumulativeIncrease = this.seriesState.previousCumulativeIncrease;\r\n        const mainStatGain = this.calculateMainStatPercentGain(\r\n            stepIncrease,\r\n            this.seriesState.mainStatPct + prevCumulativeIncrease,\r\n            this.seriesState.mainStat,\r\n            this.seriesState.defense,\r\n            this.seriesState.selectedClass\r\n        );\r\n\r\n        this.seriesState.cumulativeStats.PRIMARY_MAIN_STAT += mainStatGain;\r\n        this.seriesState.cumulativeStats.ATTACK += mainStatGain;\r\n        this.seriesState.cumulativeStats.STAT_DAMAGE += mainStatGain / 100;\r\n\r\n        this.seriesState.cumulativeStats = { ...this.seriesState.cumulativeStats };\r\n        return calculateDamage(this.seriesState.cumulativeStats, this.seriesState.monsterType).dps;\r\n    }\r\n\r\n    /**\r\n     * Handle multiplicative stat (like finalDamage)\r\n     * @private\r\n     */\r\n    private _stepMultiplicative(statKey: string, cumulativeIncrease: number, stepIncrease: number): number {\r\n        const oldValue = this.seriesState.cumulativeStats[statKey] || 0;\r\n        const newValue = (((1 + oldValue / 100) * (1 + stepIncrease / 100)) - 1) * 100;\r\n\r\n        const modifiedStats = { ...this.seriesState.cumulativeStats };\r\n        modifiedStats[statKey] = newValue;\r\n\r\n        this.seriesState.cumulativeStats = modifiedStats;\r\n        return calculateDamage(modifiedStats, this.seriesState.monsterType).dps;\r\n    }\r\n\r\n    /**\r\n     * Handle diminishing returns stat (like attackSpeed)\r\n     * @private\r\n     */\r\n    private _stepDiminishing(statKey: string, cumulativeIncrease: number, stepIncrease: number, factor: number): number {\r\n        const oldValue = this.seriesState.cumulativeStats[statKey] || 0;\r\n        const newValue = (1 - (1 - oldValue / factor) * (1 - stepIncrease / factor)) * factor;\r\n\r\n        const modifiedStats = { ...this.seriesState.cumulativeStats };\r\n        modifiedStats[statKey] = newValue;\r\n\r\n        this.seriesState.cumulativeStats = modifiedStats;\r\n        return calculateDamage(modifiedStats, this.seriesState.monsterType).dps;\r\n    }\r\n\r\n    /**\r\n     * Handle additive stat (like bossDamage, critRate)\r\n     * @private\r\n     */\r\n    private _stepAdditive(statKey: string, cumulativeIncrease: number, stepIncrease: number): number {\r\n        const oldValue = this.seriesState.cumulativeStats[statKey] || 0;\r\n        const newValue = oldValue + stepIncrease;\r\n\r\n        const modifiedStats = { ...this.seriesState.cumulativeStats };\r\n        modifiedStats[statKey] = newValue;\r\n\r\n        this.seriesState.cumulativeStats = modifiedStats;\r\n        return calculateDamage(modifiedStats, this.seriesState.monsterType).dps;\r\n    }\r\n\r\n    /**\r\n     * Reset the calculator state\r\n     */\r\n    reset(): void {\r\n        this.seriesState = null;\r\n    }\r\n\r\n    private addMainStat(mainStatGain: number): void {\r\n        if (!this.seriesState) {\r\n            throw new Error('Series not initialized - must call startSeries() first');\r\n        }\r\n        const increaseWithMainstatPct = this.calculateMainStatIncreaseWithPct(mainStatGain);\r\n        const statDamageIncrease = increaseWithMainstatPct / 100;\r\n\r\n        this.seriesState.cumulativeStats.PRIMARY_MAIN_STAT += increaseWithMainstatPct;\r\n        this.seriesState.cumulativeStats.ATTACK += increaseWithMainstatPct;\r\n        this.seriesState.cumulativeStats.STAT_DAMAGE += statDamageIncrease;\r\n    }\r\n\r\n    private calculateMainStatIncreaseWithPct(value: number): number {\r\n        const mainStatPct = this.seriesState.mainStatPct;\r\n        const mainStatWithPctIncrease = value * (1 + mainStatPct / 100);\r\n        return mainStatWithPctIncrease;\r\n    }\r\n\r\n    private calculateMainStatPercentGain(mainStatPctIncrease, currentMainStatPct, mainStat, defense, selectedClass) {\r\n        let defenseToMainStat = 0;\r\n        if (selectedClass === 'dark-knight') {\r\n            defenseToMainStat = defense * 0.127;\r\n        }\r\n\r\n        const currentMultiplier = 1 + currentMainStatPct / 100;\r\n        const baseMainStat = (mainStat - defenseToMainStat) / currentMultiplier;\r\n\r\n        // Now calculate the new total with the increased main stat %\r\n        const newMultiplier = 1 + (currentMainStatPct + mainStatPctIncrease) / 100;\r\n        const newTotalMainStat = (baseMainStat * newMultiplier) + defenseToMainStat;\r\n\r\n        // Calculate the gain in main stat\r\n        const mainStatGain = newTotalMainStat - mainStat;\r\n        return mainStatGain;\r\n    }\r\n}\r\n"],
  "mappings": "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",
  "names": []
}
