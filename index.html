<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Damage Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            light: '#007aff',
                            dark: '#0a84ff'
                        },
                        secondary: {
                            light: '#5856d6',
                            dark: '#5e5ce6'
                        },
                        success: {
                            light: '#34c759',
                            dark: '#30d158'
                        },
                        warning: {
                            light: '#ff9500',
                            dark: '#ff9f0a'
                        }
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="styles.css">

	<script async src="https://www.googletagmanager.com/gtag/js?id=G-GKDLXCWZ9R"></script>
	<script>
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());

	gtag('config', 'G-GKDLXCWZ9R');
	</script>
</head>

<body class="bg-gray-50 dark:bg-black text-gray-900 dark:text-gray-100 min-h-screen p-5 transition-colors duration-300">
    <div class="fixed top-5 right-5 z-50 flex gap-2 items-center">
        <a href="https://paypal.me/freakehms" target="_blank" rel="noopener noreferrer" class="bg-white/70 dark:bg-gray-800/70 backdrop-blur-sm border border-gray-200 dark:border-gray-700 rounded-full px-5 py-2.5 text-sm font-medium text-gray-600 dark:text-gray-400 opacity-70 hover:opacity-90 hover:-translate-y-0.5 transition-all duration-300 shadow-lg hover:shadow-xl">DONATE</a>
        <button onclick="toggleTheme()" id="theme-toggle" class="bg-white/70 dark:bg-gray-800/70 backdrop-blur-sm border border-gray-200 dark:border-gray-700 rounded-full px-5 py-2.5 text-xl hover:-translate-y-0.5 transition-all duration-300 shadow-lg hover:shadow-xl">ðŸŒ™</button>
    </div>
    <div class="max-w-7xl mx-auto">
        <h1 class="text-center mb-8 text-5xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 dark:from-blue-400 dark:to-purple-400 bg-clip-text text-transparent">Damage Calculator</h1>
        <div class="flex flex-col sm:flex-row justify-end gap-2.5 mb-4">
            <button onclick="exportData()" class="bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold text-sm shadow-md hover:shadow-lg transition-all">ðŸ“‹ Copy Data</button>
            <button onclick="importData()" class="bg-purple-600 hover:bg-purple-700 dark:bg-purple-500 dark:hover:bg-purple-600 text-white px-4 py-2 rounded-lg font-semibold text-sm shadow-md hover:shadow-lg transition-all">ðŸ“¥ Paste Data</button>
        </div>

        <!-- First Tabbed Area: Character Setup -->
        <div class="bg-white/70 dark:bg-gray-800/70 backdrop-blur-sm border border-gray-200 dark:border-gray-700 rounded-2xl p-6 shadow-lg mb-5">
            <div class="text-2xl mb-5 text-center text-blue-600 dark:text-blue-400 font-semibold">Character Setup</div>
            <div class="flex flex-wrap gap-2.5 mb-5 border-b-2 border-gray-200/50 dark:border-gray-700/50 pb-0">
                <button class="tab-button active px-6 py-3 text-base font-semibold cursor-pointer transition-all duration-300 border-b-[3px] border-transparent -mb-0.5 rounded-t-lg" onclick="switchTab('setup', 'base-stats')">Base Stats</button>
                <button class="tab-button px-6 py-3 text-base font-semibold cursor-pointer transition-all duration-300 border-b-[3px] border-transparent -mb-0.5 rounded-t-lg" onclick="switchTab('setup', 'weapon-levels')">Weapon Levels</button>
                <button class="tab-button px-6 py-3 text-base font-semibold cursor-pointer transition-all duration-300 border-b-[3px] border-transparent -mb-0.5 rounded-t-lg" onclick="switchTab('setup', 'hero-power')">Hero Power Ability</button>
                <button class="tab-button px-6 py-3 text-base font-semibold cursor-pointer transition-all duration-300 border-b-[3px] border-transparent -mb-0.5 rounded-t-lg" onclick="switchTab('setup', 'equipment-slots')">Slot Scrolling</button>
            </div>

            <!-- Base Stats Tab -->
            <div id="setup-base-stats" class="tab-content active">
                <div class="bg-transparent p-4">
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-2.5">
                        <div class="input-group">
                            <label>Attack</label>
                            <input type="number" id="attack-base" value="500">
                        </div>
                        <div class="input-group">
                            <label>Critical Rate (%)</label>
                            <input type="number" step="0.1" id="crit-rate-base" value="15">
                        </div>
                        <div class="input-group">
                            <label>Critical Damage (%)</label>
                            <input type="number" step="0.1" id="crit-damage-base" value="15">
                        </div>
                        <div class="input-group">
                            <label>Attack Speed (%)</label>
                            <input type="number" step="0.1" id="attack-speed-base" value="0">
                        </div>
                        <div class="input-group">
                            <label>Primary Main Stat</label>
                            <input type="number" id="primary-main-stat-base" value="1000">
                        </div>
                        <div class="input-group">
                            <label>Secondary Main Stat</label>
                            <input type="number" id="secondary-main-stat-base" value="0">
                        </div>
                        <div class="input-group">
                            <label>Stat Prop. Damage (%)</label>
                            <input type="number" step="0.1" id="stat-damage-base" value="0">
                        </div>
                        <div class="input-group">
                            <label>Damage (%)</label>
                            <input type="number" step="0.1" id="damage-base" value="10">
                        </div>
                        <div class="input-group">
                            <label>Damage Amplification (x)</label>
                            <input type="number" step="0.1" id="damage-amp-base" value="0">
                        </div>
                        <div class="input-group">
                            <label>Boss Monster Damage (%)</label>
                            <input type="number" step="0.1" id="boss-damage-base" value="10">
                        </div>
                        <div class="input-group">
                            <label>Normal Monster Damage (%)</label>
                            <input type="number" step="0.1" id="normal-damage-base" value="0">
                        </div>
                        <div class="input-group">
                            <label>Min Damage Multiplier (%)</label>
                            <input type="number" step="0.1" id="min-damage-base" value="50">
                        </div>
                        <div class="input-group">
                            <label>Max Damage Multiplier (%)</label>
                            <input type="number" step="0.1" id="max-damage-base" value="100">
                        </div>
                        <div class="input-group">
                            <label>Final Damage (%)</label>
                            <input type="number" step="0.1" id="final-damage-base" value="0">
                        </div>
                        <div style="grid-column: 1 / -1; border-top: 2px solid var(--border-color); margin: 10px 0;">
                        </div>
                        <div class="input-group">
                            <label>Skill Coefficient (%) <span class="info-icon" role="img" aria-label="Info"
                                    title="This value can be found in the description of your Basic Attack.">?</span></label>
                            <input type="number" step="0.1" id="skill-coeff-base" value="89.9">
                        </div>
                        <div class="input-group" style="display: none;">
                            <label>Defense Penetration (%) <span class="info-icon" role="img" aria-label="Info"
                                    title="This value must be manually summed from your Artifact/item potential and Hero Ability.">?</span></label>
                            <input type="number" step="0.1" id="def-pen-base" value="0">
                        </div>
                        <div class="input-group">
                            <label>Skill Mastery Bonus (%) <span class="info-icon" role="img" aria-label="Info"
                                    title="This value must be manually summed from Mastery skills that enhance your Basic Attack damage">?</span></label>
                            <input type="number" step="0.1" id="skill-mastery-base" value="21">
                        </div>
                        <div class="input-group">
                            <label>Skill Mastery Bonus - Boss Only (%) <span class="info-icon" role="img"
                                    aria-label="Info"
                                    title="This value must be manually summed from Mastery skills that enhance your Basic Attack damage">?</span></label>
                            <input type="number" step="0.1" id="skill-mastery-boss-base" value="0">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Weapon Levels Tab -->
            <div id="setup-weapon-levels" class="tab-content">
                <div style="background: linear-gradient(135deg, rgba(0, 122, 255, 0.1), rgba(88, 86, 214, 0.05)); border: 1px solid var(--border-color); border-radius: 12px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 8px var(--shadow);">
                    <div style="color: var(--text-primary); font-size: 0.9em; line-height: 1.5;">
                        <strong style="color: var(--accent-primary);">Instructions:</strong> For each weapon, enter the <strong>Inventory Attack %</strong> shown in the weapon UI. For your currently equipped weapon, check the <strong>Equipped</strong> box and also enter the <strong>Equipped Attack %</strong> (both values are visible when viewing that weapon).
                    </div>
                </div>
                <div id="weapons-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-2">
                    <!-- Weapons will be generated by JavaScript -->
                </div>
                <div
                    style="margin-top: 20px; background: linear-gradient(135deg, rgba(52, 199, 89, 0.15), rgba(0, 122, 255, 0.1)); border: 1px solid var(--border-color); border-radius: 16px; padding: 20px; box-shadow: 0 4px 16px var(--shadow);">
                    <div
                        style="color: var(--text-secondary); font-size: 0.9em; text-align: center; margin-bottom: 15px; font-weight: 500;">
                        Applied to Attack row in Stat Damage Predictions below
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 text-center">
                        <div>
                            <div
                                style="color: var(--accent-success); font-size: 0.95em; font-weight: 600; margin-bottom: 5px;">
                                Total Inventory Attack %</div>
                            <div id="total-inventory-attack"
                                style="font-size: 1.6em; font-weight: 700; color: var(--text-primary);">0%</div>
                        </div>
                        <div>
                            <div
                                style="color: var(--accent-success); font-size: 0.95em; font-weight: 600; margin-bottom: 5px;">
                                Equipped Attack %</div>
                            <div id="equipped-weapon-attack-pct"
                                style="font-size: 1.6em; font-weight: 700; color: var(--text-primary);">0%</div>
                        </div>
                        <div>
                            <div
                                style="color: var(--accent-success); font-size: 0.95em; font-weight: 600; margin-bottom: 5px;">
                                Total Weapon Attack %</div>
                            <div id="total-weapon-attack"
                                style="font-size: 1.6em; font-weight: 700; color: var(--text-primary);">0%</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Hero Power Ability Tab -->
            <div id="setup-hero-power" class="tab-content">
                <div id="hero-power-presets-container">
                    <!-- Presets will be generated by JavaScript -->
                </div>
            </div>

            <!-- Equipment Slots Tab -->
            <div id="setup-equipment-slots" class="tab-content">
                <div style="background: linear-gradient(135deg, rgba(0, 122, 255, 0.1), rgba(88, 86, 214, 0.05)); border: 1px solid var(--border-color); border-radius: 12px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 8px var(--shadow);">
                    <div style="color: var(--text-primary); font-size: 0.9em; line-height: 1.5;">
                        <strong style="color: var(--accent-primary);">Equipment Slot Analysis:</strong> Track individual equipment slot values in isolation. Each slot's DPS gain is calculated by comparing damage WITH that slot's stats vs damage WITH zero stats from that slot.
                    </div>
                </div>
                <div id="equipment-slots-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Slot cards generated by JavaScript -->
                </div>
                <div style="margin-top: 20px; text-align: center;">
                    <button class="calculate-btn" onclick="calculateEquipmentSlotDPS()" style="max-width: 400px; margin: 0 auto;">Calculate Slot DPS</button>
                </div>
            </div>
        </div>

        <!-- Second Tabbed Area: Character Optimization -->
        <div class="bg-white/70 dark:bg-gray-800/70 backdrop-blur-sm border border-gray-200 dark:border-gray-700 rounded-2xl p-6 shadow-lg mb-5">
            <div class="text-2xl mb-5 text-center text-blue-600 dark:text-blue-400 font-semibold">Character Optimization</div>
            <div class="flex flex-wrap gap-2.5 mb-5 border-b-2 border-gray-200/50 dark:border-gray-700/50 pb-0">
                <button class="tab-button active px-6 py-3 text-base font-semibold cursor-pointer transition-all duration-300 border-b-[3px] border-transparent -mb-0.5 rounded-t-lg" onclick="switchTab('analysis', 'item-comparison')">Item Comparison</button>
                <button class="tab-button px-6 py-3 text-base font-semibold cursor-pointer transition-all duration-300 border-b-[3px] border-transparent -mb-0.5 rounded-t-lg" onclick="switchTab('analysis', 'inner-ability')">Inner Ability</button>
                <button class="tab-button px-6 py-3 text-base font-semibold cursor-pointer transition-all duration-300 border-b-[3px] border-transparent -mb-0.5 rounded-t-lg" onclick="switchTab('analysis', 'artifact-potential')">Artifact Potential</button>
                <button class="tab-button px-6 py-3 text-base font-semibold cursor-pointer transition-all duration-300 border-b-[3px] border-transparent -mb-0.5 rounded-t-lg" onclick="switchTab('analysis', 'scroll-optimizer')">Scrolling</button>
            </div>

            <!-- Item Comparison Tab -->
            <div id="analysis-item-comparison" class="tab-content active">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-5">
                    <!-- Equipped Item -->
                    <div>
                        <h3 style="color: var(--accent-success); margin-bottom: 8px; font-size: 1em; font-weight: 600;">
                            Currently Equipped</h3>
                        <div
                            style="background: linear-gradient(135deg, rgba(52, 199, 89, 0.1), rgba(0, 122, 255, 0.05)); border: 1px solid var(--accent-success); border-radius: 12px; padding: 15px; box-shadow: 0 4px 16px var(--shadow);">
                            <div
                                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <span
                                    style="color: var(--accent-success); font-weight: 600; font-size: 0.95em;">Equipped
                                    Item</span>
                                <span style="color: var(--text-secondary); font-size: 0.8em;">(stats in base
                                    setup)</span>
                            </div>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-2.5 mb-2.5">
                                <div class="input-group">
                                    <label>Name</label>
                                    <input type="text" id="equipped-name" value="Current Item" onchange="saveToLocalStorage()">
                                </div>
                                <div class="input-group">
                                    <label>Attack</label>
                                    <input type="number" id="equipped-attack" value="0" onchange="saveToLocalStorage()">
                                </div>
                            </div>
                            <div id="equipped-stats-container"></div>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 mt-2">
                                <button onclick="addEquippedStat()"
                                    class="bg-green-600 hover:bg-green-700 dark:bg-green-500 dark:hover:bg-green-600 text-white px-4 py-2.5 rounded-lg cursor-pointer font-semibold text-sm shadow-md hover:shadow-lg transition-all">+
                                    Add Stat</button>
                                <button onclick="unequipItem()"
                                    class="bg-orange-500 hover:bg-orange-600 dark:bg-orange-600 dark:hover:bg-orange-700 text-white px-4 py-2.5 rounded-lg cursor-pointer font-semibold text-sm shadow-md hover:shadow-lg transition-all">
                                    Unequip</button>
                            </div>
                        </div>
                    </div>

                    <!-- Comparison Items Column -->
                    <div>
                        <h3 style="color: var(--accent-primary); margin-bottom: 8px; font-size: 1em; font-weight: 600;">
                            Comparison Items</h3>
                        <div id="comparison-items-container"
                            style="max-height: 400px; overflow-y: auto; margin-bottom: 10px;"></div>
                        <button class="calculate-btn" onclick="addComparisonItem()">+
                            Add Item</button>
                    </div>
                </div>
                <button class="calculate-btn" onclick="calculate()" style="margin-bottom: 20px;">Calculate All</button>

                <!-- Results within the same tab -->
                <div style="border-top: 2px solid var(--border-color); padding-top: 20px;">
                    <h3
                        style="color: var(--accent-primary); margin-bottom: 15px; font-size: 1.3em; font-weight: 600; text-align: center;">
                        Comparison Results</h3>
                    <div id="results-container"
                        class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    </div>
                </div>
            </div>

            <!-- Inner Ability Analysis Tab -->
            <div id="analysis-inner-ability" class="tab-content">
                <div class="flex flex-wrap gap-2.5 mb-5 border-b-2 border-gray-200/50 dark:border-gray-700/50 pb-0">
                    <button class="tab-button active px-6 py-3 text-base font-semibold cursor-pointer transition-all duration-300 border-b-[3px] border-transparent -mb-0.5 rounded-t-lg" onclick="switchInnerAbilityTab('preset-comparison')">Preset
                        Comparison</button>
                    <button class="tab-button px-6 py-3 text-base font-semibold cursor-pointer transition-all duration-300 border-b-[3px] border-transparent -mb-0.5 rounded-t-lg" onclick="switchInnerAbilityTab('theoretical-best')">Theoretical
                        Best</button>
                </div>

                <!-- Preset Comparison Sub-Tab -->
                <div id="inner-ability-preset-comparison" class="inner-ability-subtab active">
                    <div id="preset-comparison-container">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Theoretical Best Sub-Tab -->
                <div id="inner-ability-theoretical-best" class="inner-ability-subtab">
                    <div id="theoretical-best-container">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Artifact Potential Tab -->
            <div id="analysis-artifact-potential" class="tab-content">
                <div id="artifact-potential-container">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>

            <!-- Scroll Optimizer Tab -->
            <div id="analysis-scroll-optimizer" class="tab-content">
                <div style="background: linear-gradient(135deg, rgba(0, 122, 255, 0.1), rgba(88, 86, 214, 0.05)); border: 1px solid var(--border-color); border-radius: 12px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 8px var(--shadow);">
                    <div style="color: var(--text-primary); font-size: 0.9em; line-height: 1.5;">
                        <strong style="color: var(--accent-primary);">Scroll Optimizer:</strong> Simulates different scrolling strategies using Level 65 scrolls to find the optimal approach. The damage gain shows how much your DPS will increase from the average scroll results.
                    </div>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
                    <div class="input-group">
                        <label>Spell Trace Budget</label>
                        <input type="number" id="scroll-spell-trace-budget" value="7000" min="500" max="50000" step="100">
                    </div>
                    <div class="input-group">
                        <label>Number of Simulations</label>
                        <input type="number" id="scroll-simulations" value="500" min="100" max="10000" step="100">
                    </div>
                </div>

                <div style="background: rgba(0, 122, 255, 0.05); border: 1px solid var(--border-color); border-radius: 8px; padding: 15px; margin-bottom: 15px;">
                    <label style="font-weight: 600; margin-bottom: 10px; display: block; color: var(--text-primary);">Scroll Level</label>
                    <div style="display: flex; gap: 20px;">
                        <label style="display: flex; align-items: center; cursor: pointer; font-size: 0.95em;">
                            <input type="radio" name="scroll-level" value="65" checked onchange="updateScrollLevelInfo()" style="margin-right: 8px; cursor: pointer;">
                            <span style="color: var(--text-primary);">Level 65 Scrolls</span>
                        </label>
                        <label style="display: flex; align-items: center; cursor: pointer; font-size: 0.95em;">
                            <input type="radio" name="scroll-level" value="85" onchange="updateScrollLevelInfo()" style="margin-right: 8px; cursor: pointer;">
                            <span style="color: var(--text-primary);">Level 85 Scrolls</span>
                        </label>
                    </div>
                    <div id="scroll-level-info" style="margin-top: 12px; padding: 10px; background: var(--background); border-radius: 6px; font-size: 0.85em; color: var(--text-secondary); line-height: 1.6;">
                        <!-- Info will be populated by JavaScript -->
                    </div>
                </div>

                <div style="background: rgba(0, 122, 255, 0.05); border: 1px solid var(--border-color); border-radius: 8px; padding: 15px; margin-bottom: 15px;">
                    <label style="display: flex; align-items: center; cursor: pointer; font-size: 0.95em;">
                        <input type="checkbox" id="scroll-enable-resets" checked style="margin-right: 8px; cursor: pointer;">
                        <span style="color: var(--text-primary); font-weight: 600;">Enable Resets</span>
                    </label>
                    <div style="margin-top: 8px; padding: 8px; background: var(--background); border-radius: 6px; font-size: 0.85em; color: var(--text-secondary); line-height: 1.6;">
                        When enabled, strategies will reset the item (costing 50 spell trace) if the result doesn't meet their criteria. When disabled, strategies will accept the first result regardless of outcome.
                    </div>
                </div>

                <button class="calculate-btn" onclick="runScrollSimulation()" id="scroll-run-btn">Run Simulation</button>

                <div id="scroll-progress-container" style="display: none; margin-top: 15px;">
                    <div style="width: 100%; height: 4px; background: var(--border-color); border-radius: 2px; overflow: hidden;">
                        <div id="scroll-progress-bar" style="height: 100%; background: var(--accent-primary); transition: width 0.3s; width: 0%;"></div>
                    </div>
                    <p id="scroll-progress-text" style="text-align: center; color: var(--text-secondary); margin-top: 8px;"></p>
                </div>

                <div id="scroll-results-container" style="margin-top: 20px;">
                    <!-- Results will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Stat Damage Predictions -->
        <div class="bg-white/70 dark:bg-gray-800/70 backdrop-blur-sm border border-gray-200 dark:border-gray-700 rounded-2xl p-6 shadow-lg mb-5">
            <div class="text-2xl mb-5 text-center text-blue-600 dark:text-blue-400 font-semibold">Stat Damage Predictions (DPS Gain) - Base Setup</div>
            <div id="stat-weights-base"></div>
        </div>
    </div>

    <script src="constants.js"></script>
    <script src="calculations.js"></script>
    <script src="storage.js"></script>
    <script src="ui.js"></script>
    <script src="inner-ability.js"></script>
    <script src="artifact-potential.js"></script>
    <script src="scroll-optimizer.js"></script>
    <script src="main.js"></script>
</body>

</html>
