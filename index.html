<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Damage Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            light: '#007aff',
                            dark: '#0a84ff'
                        },
                        secondary: {
                            light: '#5856d6',
                            dark: '#5e5ce6'
                        },
                        success: {
                            light: '#34c759',
                            dark: '#30d158'
                        },
                        warning: {
                            light: '#ff9500',
                            dark: '#ff9f0a'
                        }
                    }
                }
            }
        }
    </script>

    <!-- Load theme immediately to prevent flash -->
    <script>
        (function() {
            const savedTheme = localStorage.getItem('theme') || 'dark';
            if (savedTheme === 'dark') {
                document.documentElement.classList.add('dark');
            }
        })();
    </script>

    <link rel="stylesheet" href="styles.css">

	<script async src="https://www.googletagmanager.com/gtag/js?id=G-GKDLXCWZ9R"></script>
	<script>
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());

	gtag('config', 'G-GKDLXCWZ9R');
	</script>
</head>

<body class="bg-gray-50 dark:bg-black text-gray-900 dark:text-gray-100 min-h-screen p-5 transition-colors duration-300">
    <!-- Donation Message Notification -->
    <div id="donate-notification" class="donate-notification-theme" style="display: none; position: fixed; top: 80px; right: 20px; z-index: 1000; max-width: 400px; border-radius: 12px; padding: 16px 20px; box-shadow: 0 8px 24px rgba(0,0,0,0.2); animation: slideIn 0.4s ease-out;">
        <div style="display: flex; align-items: start; gap: 12px;">
            <div style="font-size: 24px;">üíù</div>
            <div style="flex: 1;">
                <div style="font-weight: 600; font-size: 0.95em; line-height: 1.5; margin-bottom: 4px;">
                    Please consider supporting my efforts towards the calculator, what might seem small for you may be big for me :)!
                </div>
            </div>
            <button onclick="dismissDonateNotification()" class="donate-notification-close" style="border: none; width: 24px; height: 24px; border-radius: 50%; cursor: pointer; font-size: 16px; line-height: 1; display: flex; align-items: center; justify-content: center; transition: all 0.2s;">√ó</button>
        </div>
    </div>

    <div class="fixed top-5 right-5 z-50 flex gap-2 items-center">
        <a href="https://paypal.me/freakehms" target="_blank" rel="noopener noreferrer" style="background: linear-gradient(135deg, #fbbf24, #f59e0b); color: white; font-weight: 700; letter-spacing: 0.5px; box-shadow: 0 4px 12px rgba(251, 191, 36, 0.4);" class="backdrop-blur-sm rounded-full px-6 py-2.5 text-sm hover:scale-105 hover:-translate-y-0.5 transition-all duration-300 hover:shadow-xl">
            üíù DONATE
        </a>
        <button onclick="toggleTheme()" id="theme-toggle" class="bg-white/70 dark:bg-gray-800/70 backdrop-blur-sm border border-gray-200 dark:border-gray-700 rounded-full px-5 py-2.5 text-xl hover:-translate-y-0.5 transition-all duration-300 shadow-lg hover:shadow-xl">üåô</button>
    </div>

    <!-- Left Navigation Sidebar (large screens only) -->
    <nav id="left-nav-sidebar" class="left-nav-sidebar">
        <div class="left-nav-item" onclick="scrollToSection('character-setup-card')">Character Setup</div>
        <div class="left-nav-item" onclick="scrollToSection('character-optimization-card')">Character Optimization</div>
        <div class="left-nav-item" onclick="scrollToSection('stat-damage-predictions-card')">Stat Damage Predictions</div>
    </nav>

    <div class="max-w-7xl mx-auto">
        <h1 class="text-center mb-8 text-5xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 dark:from-blue-400 dark:to-purple-400 bg-clip-text text-transparent">Damage Calculator</h1>
        <div class="flex flex-col sm:flex-row justify-end gap-2.5 mb-4">
            <button onclick="exportData()" class="bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold text-sm shadow-md hover:shadow-lg transition-all">üìã Copy Data</button>
            <button onclick="importData()" class="bg-purple-600 hover:bg-purple-700 dark:bg-purple-500 dark:hover:bg-purple-600 text-white px-4 py-2 rounded-lg font-semibold text-sm shadow-md hover:shadow-lg transition-all">üì• Paste Data</button>
        </div>

        <!-- First Tabbed Area: Character Setup -->
        <div id="character-setup-card" class="bg-white/70 dark:bg-gray-800/70 backdrop-blur-sm border border-gray-200 dark:border-gray-700 rounded-2xl p-6 shadow-lg mb-5" style="position: relative;">
            <div class="text-2xl mb-5 text-center text-blue-600 dark:text-blue-400 font-semibold">Character Setup</div>
            <div class="flex flex-wrap gap-2.5 mb-5 border-b-2 border-gray-200/50 dark:border-gray-700/50 pb-0">
                <button class="tab-button active px-6 py-3 text-base font-semibold cursor-pointer transition-all duration-300 border-b-[3px] border-transparent -mb-0.5 rounded-t-lg" onclick="switchTab('setup', 'base-stats')">Base Stats</button>
                <button class="tab-button px-6 py-3 text-base font-semibold cursor-pointer transition-all duration-300 border-b-[3px] border-transparent -mb-0.5 rounded-t-lg" onclick="switchTab('setup', 'weapon-levels')">Weapon Levels</button>
                <!-- <button class="tab-button px-6 py-3 text-base font-semibold cursor-pointer transition-all duration-300 border-b-[3px] border-transparent -mb-0.5 rounded-t-lg" onclick="switchTab('setup', 'artifacts')">Artifacts</button> -->
            </div>

            <!-- Base Stats Tab -->
            <div id="setup-base-stats" class="tab-content active">
                <div class="bg-transparent p-4">
                    <!-- Class Selector -->
                    <div style="margin-bottom: 16px; padding: 12px; background: var(--background); border: 1px solid var(--border-color); border-radius: 8px;">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 8px;">
                            <div onclick="selectClass('hero')" id="class-hero" class="class-selector" title="Hero">
                                <img src="media/classes/hero.png" alt="Hero" style="width: 48px; height: 48px; object-fit: contain;">
                                <span>Hero</span>
                            </div>
                            <div onclick="selectClass('dark-knight')" id="class-dark-knight" class="class-selector" title="Dark Knight">
                                <img src="media/classes/dk.png" alt="Dark Knight" style="width: 48px; height: 48px; object-fit: contain;">
                                <span>Dark Knight</span>
                            </div>
                            <div onclick="selectClass('bowmaster')" id="class-bowmaster" class="class-selector" title="Bowmaster">
                                <img src="media/classes/bowmaster.png" alt="Bowmaster" style="width: 48px; height: 48px; object-fit: contain;">
                                <span>Bowmaster</span>
                            </div>
                            <div onclick="selectClass('marksman')" id="class-marksman" class="class-selector" title="Marksman">
                                <img src="media/classes/marksman.png" alt="Marksman" style="width: 48px; height: 48px; object-fit: contain;">
                                <span>Marksman</span>
                            </div>
                            <div onclick="selectClass('night-lord')" id="class-night-lord" class="class-selector" title="Night Lord">
                                <img src="media/classes/nl.png" alt="Night Lord" style="width: 48px; height: 48px; object-fit: contain;">
                                <span>Night Lord</span>
                            </div>
                            <div onclick="selectClass('shadower')" id="class-shadower" class="class-selector" title="Shadower">
                                <img src="media/classes/shadower.png" alt="Shadower" style="width: 48px; height: 48px; object-fit: contain;">
                                <span>Shadower</span>
                            </div>
                            <div onclick="selectClass('arch-mage-il')" id="class-arch-mage-il" class="class-selector" title="Arch Mage (Ice/Lightning)">
                                <img src="media/classes/mage-il.png" alt="Arch Mage (I/L)" style="width: 48px; height: 48px; object-fit: contain;">
                                <span>Arch Mage (I/L)</span>
                            </div>
                            <div onclick="selectClass('arch-mage-fp')" id="class-arch-mage-fp" class="class-selector" title="Arch Mage (Fire/Poison)">
                                <img src="media/classes/mage-fp.png" alt="Arch Mage (F/P)" style="width: 48px; height: 48px; object-fit: contain;">
                                <span>Arch Mage (F/P)</span>
                            </div>
                        </div>
                    </div>

                    <!-- Character Level and Job Tier -->
                    <div style="margin-bottom: 16px; padding: 12px 0; background: var(--background); border: 1px solid var(--border-color); border-radius: 8px;">
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4" style="align-items: end;">
                            <div class="input-group">
                                <label>Character Level</label>
                                <input type="number" id="character-level" value="0" min="0" max="200" onchange="updateSkillCoefficient(); saveToLocalStorage()">
                            </div>
                            <div class="input-group">
                                <label>Job Tier</label>
                                <div style="display: flex; gap: 10px;">
                                    <button id="job-tier-3rd" class="job-tier-btn active" onclick="selectJobTier('3rd')">
                                        3rd Job
                                    </button>
                                    <button id="job-tier-4th" class="job-tier-btn" onclick="selectJobTier('4th')">
                                        4th Job
                                    </button>
                                </div>
                            </div>
                            <div class="input-group" style="display: none;">
                                <label>Skill Coefficient (%)</label>
                                <input type="text" id="skill-coefficient" value="0.00" readonly style="background: var(--background); cursor: not-allowed; opacity: 0.7;">
                            </div>
                        </div>
                    </div>

                    <!-- Sub-tabs for Stats and Skill Mastery -->
                    <div class="flex flex-wrap gap-2.5 mb-5 border-b-2 border-gray-200/50 dark:border-gray-700/50 pb-0">
                        <button class="tab-button active px-6 py-3 text-base font-semibold cursor-pointer transition-all duration-300 border-b-[3px] border-transparent -mb-0.5 rounded-t-lg" onclick="switchBaseStatsSubTab('character-stats')">Stats</button>
                        <button class="tab-button px-6 py-3 text-base font-semibold cursor-pointer transition-all duration-300 border-b-[3px] border-transparent -mb-0.5 rounded-t-lg" onclick="switchBaseStatsSubTab('skill-mastery')">Skill Mastery</button>
                        <button  class="tab-button px-6 py-3 text-base font-semibold cursor-pointer transition-all duration-300 border-b-[3px] border-transparent -mb-0.5 rounded-t-lg" onclick="switchBaseStatsSubTab('skill-details')">Skill Details</button>
                    </div>

                    <!-- Character Stats Sub-tab -->
                    <div id="base-stats-character-stats" class="base-stats-subtab active">
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-2.5">
                        <div class="input-group">
                            <label>Attack</label>
                            <input type="number" id="attack-base" value="500">
                        </div>
                        <div class="input-group">
                            <label>Critical Rate (%)</label>
                            <input type="number" step="0.1" id="crit-rate-base" value="15">
                        </div>
                        <div class="input-group">
                            <label>Critical Damage (%)</label>
                            <input type="number" step="0.1" id="crit-damage-base" value="15">
                        </div>
                        <div class="input-group">
                            <label>Attack Speed (%)</label>
                            <input type="number" step="0.1" id="attack-speed-base" value="0">
                        </div>
                        <div class="input-group" id="defense-input-group" style="display: none;">
                            <label>Defense <span class="info-icon" role="img" aria-label="Info"
                                    onclick="openHelpSidebar('defense')">?</span></label>
                            <input type="number" id="defense-base" value="0">
                        </div>
                        <div class="input-group">
                            <label>Primary Main Stat</label>
                            <input type="number" id="primary-main-stat-base" value="1000">
                        </div>
                        <div class="input-group">
                            <label>Secondary Main Stat</label>
                            <input type="number" id="secondary-main-stat-base" value="0">
                        </div>
                        <div class="input-group">
                            <label>Stat Prop. Damage (%)</label>
                            <input type="number" step="0.1" id="stat-damage-base" value="0">
                        </div>
                        <div class="input-group">
                            <label>Current Main Stat % <span class="info-icon" role="img" aria-label="Info"
                                    onclick="openHelpSidebar('main-stat-pct')">?</span></label>
                            <input type="number" step="0.1" id="main-stat-pct-base" value="0">
                        </div>
                        <div class="input-group">
                            <label>Damage (%)</label>
                            <input type="number" step="0.1" id="damage-base" value="10">
                        </div>
                        <div class="input-group">
                            <label>Damage Amplification (x)</label>
                            <input type="number" step="0.1" id="damage-amp-base" value="0">
                        </div>
                        <div class="input-group">
                            <label>Boss Monster Damage (%)</label>
                            <input type="number" step="0.1" id="boss-damage-base" value="10">
                        </div>
                        <div class="input-group">
                            <label>Normal Monster Damage (%)</label>
                            <input type="number" step="0.1" id="normal-damage-base" value="0">
                        </div>
                        <div class="input-group">
                            <label>Min Damage Multiplier (%)</label>
                            <input type="number" step="0.1" id="min-damage-base" value="50">
                        </div>
                        <div class="input-group">
                            <label>Max Damage Multiplier (%)</label>
                            <input type="number" step="0.1" id="max-damage-base" value="100">
                        </div>
                        <div class="input-group">
                            <label>Final Damage (%)</label>
                            <input type="number" step="0.1" id="final-damage-base" value="0">
                        </div>
                        <div style="grid-column: 1 / -1; border-top: 2px solid var(--border-color); margin: 0px 0;">
                        </div>
                        <div class="input-group">
                            <label>1st Job Skill Level</label>
                            <input type="number" id="skill-level-1st-base" value="0" min="0" onchange="updateSkillCoefficient(); saveToLocalStorage()">
                        </div>
                        <div class="input-group">
                            <label>2nd Job Skill Level</label>
                            <input type="number" id="skill-level-2nd-base" value="0" min="0" onchange="updateSkillCoefficient(); saveToLocalStorage()">
                        </div>
                        <div class="input-group">
                            <label>3rd Job Skill Level</label>
                            <input type="number" id="skill-level-3rd-base" value="0" min="0" onchange="updateSkillCoefficient(); saveToLocalStorage()">
                        </div>
                        <div class="input-group">
                            <label>4th Job Skill Level</label>
                            <input type="number" id="skill-level-4th-base" value="0" min="0" onchange="updateSkillCoefficient(); saveToLocalStorage()">
                        </div>
                        <div style="grid-column: 1 / -1; border-top: 2px solid var(--border-color); margin: 10px 0;">
                        </div>
                        <div class="input-group" style="display: none;">
                            <label>Skill Coefficient (%) <span class="info-icon" role="img" aria-label="Info"
                                    onclick="openHelpSidebar('skill-coeff')">?</span></label>
                            <input type="number" step="0.1" id="skill-coeff-base" readonly style="background: var(--background); cursor: not-allowed; opacity: 0.7;">
                        </div>
                        <div class="input-group">
                            <label>Defense Penetration (%) <span class="info-icon" role="img" aria-label="Info"
                                    onclick="openHelpSidebar('def-pen')">?</span></label>
                            <input type="number" step="0.1" id="def-pen-base" value="0">
                        </div>
                        <div style="grid-column: 1 / -1; border-top: 2px solid var(--border-color); margin: 10px 0;">
                        </div>
                        <div class="input-group" style="grid-column: 1 / -1;">
                            <label>Target Content Type <span class="info-icon" role="img" aria-label="Info"
                                    onclick="openHelpSidebar('target-stage')">?</span></label>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 8px; margin-bottom: 12px;">
                                <div onclick="selectContentType('none')" id="content-none" class="content-type-selector" title="Training Dummy">
                                    <span style="font-size: 24px;">üéØ</span>
                                    <span>None</span>
                                </div>
                                <div onclick="selectContentType('stageHunt')" id="content-stageHunt" class="content-type-selector" title="Stage Hunt">
                                    <span style="font-size: 24px;">üó∫Ô∏è</span>
                                    <span>Stage Hunt</span>
                                </div>
                                <div onclick="selectContentType('chapterBoss')" id="content-chapterBoss" class="content-type-selector" title="Chapter Boss">
                                    <span style="font-size: 24px;">üëë</span>
                                    <span>Chapter Boss</span>
                                </div>
                                <div onclick="selectContentType('worldBoss')" id="content-worldBoss" class="content-type-selector" title="World Boss">
                                    <span style="font-size: 24px;">üåç</span>
                                    <span>World Boss</span>
                                </div>
                                <div onclick="selectContentType('growthDungeon')" id="content-growthDungeon" class="content-type-selector" title="Growth Dungeon">
                                    <span style="font-size: 24px;">üìà</span>
                                    <span>Growth Dungeon</span>
                                </div>
                            </div>
                            <!-- Sub-category selector for Stage Hunts and Growth Dungeons -->
                            <select id="target-subcategory" onchange="updateStageDropdown()" style="display: none; margin-bottom: 12px;">
                                <!-- Populated by JavaScript based on content type -->
                            </select>
                            <!-- Final stage selection -->
                            <select id="target-stage-base" onchange="saveToLocalStorage(); updateAnalysisTabs();" style="display: none;">
                                <!-- Populated by JavaScript based on content type/subcategory selection -->
                            </select>
                        </div>
                    </div>
                    </div>
                    <!-- End Character Stats Sub-tab -->

                    <!-- Skill Mastery Sub-tab -->
                    <div id="base-stats-skill-mastery" class="base-stats-subtab" style="display: none;">
                        <div class="input-group" style="grid-column: 1 / -1;">
                            <label>Skill Mastery Bonus <span class="info-icon" role="img" aria-label="Info"
                                    onclick="openHelpSidebar('skill-mastery')">?</span></label>

                            <!-- 3rd Job Mastery Table -->
                            <div id="mastery-table-3rd" style="background: var(--background); border: 1px solid var(--border-color); border-radius: 8px; padding: 12px; margin-top: 8px;">
                                <table class="mastery-table">
                                    <thead>
                                        <tr>
                                            <th>Level</th>
                                            <th>All Monsters</th>
                                            <th>Boss Only</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>64</td>
                                            <td>
                                                <input type="checkbox" id="mastery-3rd-all-64" onchange="updateMasteryBonuses()">
                                                <label for="mastery-3rd-all-64">10%</label>
                                            </td>
                                            <td>‚Äî</td>
                                        </tr>
                                        <tr>
                                            <td>68</td>
                                            <td>
                                                <input type="checkbox" id="mastery-3rd-all-68" onchange="updateMasteryBonuses()">
                                                <label for="mastery-3rd-all-68">11%</label>
                                            </td>
                                            <td>‚Äî</td>
                                        </tr>
                                        <tr>
                                            <td>72</td>
                                            <td>‚Äî</td>
                                            <td>
                                                <input type="checkbox" id="mastery-3rd-boss-72" onchange="updateMasteryBonuses()">
                                                <label for="mastery-3rd-boss-72">10%</label>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>76</td>
                                            <td>
                                                <input type="checkbox" id="mastery-3rd-all-76" onchange="updateMasteryBonuses()">
                                                <label for="mastery-3rd-all-76">12%</label>
                                            </td>
                                            <td>‚Äî</td>
                                        </tr>
                                        <tr>
                                            <td>80</td>
                                            <td>
                                                <input type="checkbox" id="mastery-3rd-all-80" onchange="updateMasteryBonuses()">
                                                <label for="mastery-3rd-all-80">13%</label>
                                            </td>
                                            <td>‚Äî</td>
                                        </tr>
                                        <tr>
                                            <td>84</td>
                                            <td>‚Äî</td>
                                            <td>
                                                <input type="checkbox" id="mastery-3rd-boss-84" onchange="updateMasteryBonuses()">
                                                <label for="mastery-3rd-boss-84">10%</label>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>88</td>
                                            <td>
                                                <input type="checkbox" id="mastery-3rd-all-88" onchange="updateMasteryBonuses()">
                                                <label for="mastery-3rd-all-88">14%</label>
                                            </td>
                                            <td>‚Äî</td>
                                        </tr>
                                        <tr>
                                            <td>92</td>
                                            <td>
                                                <input type="checkbox" id="mastery-3rd-all-92" onchange="updateMasteryBonuses()">
                                                <label for="mastery-3rd-all-92">15%</label>
                                            </td>
                                            <td>‚Äî</td>
                                        </tr>
                                    </tbody>
                                </table>
                                <div class="mastery-totals-container">
                                    <div class="mastery-total-box">
                                        <div class="mastery-total-label">Total (All Monsters)</div>
                                        <div class="mastery-total-value all-monsters" id="mastery-3rd-all-total">0%</div>
                                    </div>
                                    <div class="mastery-total-box boss-total">
                                        <div class="mastery-total-label">Total (Boss Only)</div>
                                        <div class="mastery-total-value boss-only" id="mastery-3rd-boss-total">0%</div>
                                    </div>
                                </div>
                            </div>

                            <!-- 4th Job Mastery Table -->
                            <div id="mastery-table-4th" style="background: var(--background); border: 1px solid var(--border-color); border-radius: 8px; padding: 12px; margin-top: 8px; display: none;">
                                <table class="mastery-table">
                                    <thead>
                                        <tr>
                                            <th>Level</th>
                                            <th>All Monsters</th>
                                            <th>Boss Only</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>102</td>
                                            <td>
                                                <input type="checkbox" id="mastery-4th-all-102" onchange="updateMasteryBonuses()">
                                                <label for="mastery-4th-all-102">10%</label>
                                            </td>
                                            <td>‚Äî</td>
                                        </tr>
                                        <tr>
                                            <td>106</td>
                                            <td>
                                                <input type="checkbox" id="mastery-4th-all-106" onchange="updateMasteryBonuses()">
                                                <label for="mastery-4th-all-106">11%</label>
                                            </td>
                                            <td>‚Äî</td>
                                        </tr>
                                        <tr>
                                            <td>111</td>
                                            <td>‚Äî</td>
                                            <td>
                                                <input type="checkbox" id="mastery-4th-boss-111" onchange="updateMasteryBonuses()">
                                                <label for="mastery-4th-boss-111">10%</label>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>116</td>
                                            <td>
                                                <input type="checkbox" id="mastery-4th-all-116" onchange="updateMasteryBonuses()">
                                                <label for="mastery-4th-all-116">12%</label>
                                            </td>
                                            <td>‚Äî</td>
                                        </tr>
                                        <tr>
                                            <td>120</td>
                                            <td>
                                                <input type="checkbox" id="mastery-4th-all-120" onchange="updateMasteryBonuses()">
                                                <label for="mastery-4th-all-120">13%</label>
                                            </td>
                                            <td>‚Äî</td>
                                        </tr>
                                        <tr>
                                            <td>124</td>
                                            <td>‚Äî</td>
                                            <td>
                                                <input type="checkbox" id="mastery-4th-boss-124" onchange="updateMasteryBonuses()">
                                                <label for="mastery-4th-boss-124">10%</label>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>128</td>
                                            <td>
                                                <input type="checkbox" id="mastery-4th-all-128" onchange="updateMasteryBonuses()">
                                                <label for="mastery-4th-all-128">14%</label>
                                            </td>
                                            <td>‚Äî</td>
                                        </tr>
                                        <tr>
                                            <td>132</td>
                                            <td>
                                                <input type="checkbox" id="mastery-4th-all-132" onchange="updateMasteryBonuses()">
                                                <label for="mastery-4th-all-132">15%</label>
                                            </td>
                                            <td>‚Äî</td>
                                        </tr>
                                    </tbody>
                                </table>
                                <div class="mastery-totals-container">
                                    <div class="mastery-total-box">
                                        <div class="mastery-total-label">Total (All Monsters)</div>
                                        <div class="mastery-total-value all-monsters" id="mastery-4th-all-total">0%</div>
                                    </div>
                                    <div class="mastery-total-box boss-total">
                                        <div class="mastery-total-label">Total (Boss Only)</div>
                                        <div class="mastery-total-value boss-only" id="mastery-4th-boss-total">0%</div>
                                    </div>
                                </div>
                            </div>

                            <input type="hidden" id="skill-mastery-base" value="0">
                            <input type="hidden" id="skill-mastery-boss-base" value="0">
                        </div>
                    </div>
                    <!-- End Skill Mastery Sub-tab -->

                    <!-- Skill Details Sub-tab -->
                    <div id="base-stats-skill-details" class="base-stats-subtab" style="display: none;">
                        <div style="background: linear-gradient(135deg, rgba(0, 122, 255, 0.1), rgba(88, 86, 214, 0.05)); border: 1px solid var(--border-color); border-radius: 12px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 8px var(--shadow);">
                            <div style="color: var(--text-primary); font-size: 0.9em; line-height: 1.5;">
                                <strong style="color: var(--accent-primary);">Instructions:</strong> Click on a skill to view its description with calculated values based on your character level.
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: auto 1fr; gap: 20px;">
                            <!-- Left Panel: Compact Skill Icons -->
                            <div style="background: var(--background); border: 1px solid var(--border-color); border-radius: 12px; padding: 12px;">
                                <!-- Skills -->
                                <div style="margin-bottom: 15px;">
                                    <div style="color: var(--accent-primary); font-size: 0.85em; font-weight: 600; margin-bottom: 8px; text-align: center;">Skills</div>
                                    <div style="display: flex; flex-direction: column; gap: 8px;">
                                        <div style="display: flex; gap: 6px; flex-wrap: wrap; max-width: 300px;">
                                            <div id="skill-grid-skills-2nd" style="display: contents;"></div>
                                            <div id="skill-grid-skills-3rd" style="display: contents;"></div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Passives -->
                                <div>
                                    <div style="color: var(--accent-primary); font-size: 0.85em; font-weight: 600; margin-bottom: 8px; text-align: center;">Passives</div>
                                    <div style="display: flex; flex-direction: column; gap: 8px;">
                                        <div style="display: flex; gap: 6px; flex-wrap: wrap; max-width: 300px;">
                                            <div id="skill-grid-passives-2nd" style="display: contents;"></div>
                                            <div id="skill-grid-passives-3rd" style="display: contents;"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Right Panel: Skill Description -->
                            <div id="skill-description-panel" style="background: linear-gradient(135deg, rgba(0, 122, 255, 0.08), rgba(88, 86, 214, 0.05)); border: 2px solid var(--border-color); border-radius: 12px; padding: 20px; height: fit-content; position: sticky; top: 20px;">
                                <div style="text-align: center; color: var(--text-secondary); padding: 40px 20px;">
                                    Select a skill to view its details
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- End Skill Details Sub-tab -->

                </div>
            </div>

            <!-- Weapon Levels Tab -->
            <div id="setup-weapon-levels" class="tab-content">
                <div style="background: linear-gradient(135deg, rgba(0, 122, 255, 0.1), rgba(88, 86, 214, 0.05)); border: 1px solid var(--border-color); border-radius: 12px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 8px var(--shadow);">
                    <div style="color: var(--text-primary); font-size: 0.9em; line-height: 1.5;">
                        <strong style="color: var(--accent-primary);">Instructions:</strong> Click stars to set star rating, enter weapon level. Check the "E" button to equip a weapon. The given inventory attack gain % is how much you'd expect if you spent 10k shards on the given weapon.
                    </div>
                </div>

                <!-- No Weapon Equipped Indicator -->
                <div id="no-weapon-equipped-indicator" style="display: block; background: linear-gradient(135deg, rgba(255, 193, 7, 0.1), rgba(255, 152, 0, 0.05)); border: 2px solid rgba(255, 193, 7, 0.3); border-radius: 12px; padding: 12px; margin-bottom: 15px; text-align: center;">
                    <div style="color: var(--accent-warning); font-weight: 600; font-size: 0.9em;">
                        ‚ö†Ô∏è No Weapon Equipped - Check the "E" button on a weapon to equip it
                    </div>
                </div>

                <div id="weapons-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-2">
                    <!-- Weapons will be generated by JavaScript -->
                </div>

                <!-- Upgrade Priority Chain -->
                <div id="upgrade-priority-container"
                    style="margin-top: 20px; background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.05)); border: 1px solid var(--border-color); border-radius: 16px; padding: 20px; box-shadow: 0 4px 16px var(--shadow);">
                    <div
                        style="color: var(--text-secondary); font-size: 0.9em; text-align: center; margin-bottom: 12px; font-weight: 600;">
                        Next 100 Upgrades Priority (Best Inventory Attack Gain)
                    </div>
                    <div id="upgrade-priority-chain"
                        style="display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; align-items: center; font-size: 0.95em; line-height: 1.8;">
                        <!-- Priority chain will be generated by JavaScript -->
                    </div>

                    <!-- Currency Calculator -->
                    <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border-color);">
                        <div
                            style="color: var(--text-secondary); font-size: 0.9em; text-align: center; margin-bottom: 12px; font-weight: 600;">
                            Enter your current upgrade currency to see your optimal target weapon levels
                        </div>
                        <div style="display: flex; gap: 12px; align-items: center; justify-content: center; flex-wrap: wrap; margin-bottom: 15px;">
                            <label style="color: var(--text-secondary); font-weight: 600;">Upgrade Currency:</label>
                            <input type="number" id="upgrade-currency-input" placeholder="Enter amount"
                                style="width: 200px; padding: 8px 12px; border: 1px solid var(--border-color); border-radius: 8px; background: var(--background); color: var(--text-primary);"
                                oninput="calculateCurrencyUpgrades()">
                        </div>
                        <div id="currency-upgrade-results" style="display: none; background: rgba(79, 195, 247, 0.1); border-radius: 8px; padding: 15px;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 12px;">
                                <div style="text-align: center;">
                                    <div style="color: var(--text-secondary); font-size: 0.85em; margin-bottom: 4px;">Total Attack % Gain</div>
                                    <div style="color: var(--accent-primary); font-size: 1.3em; font-weight: 700;" id="currency-attack-gain">0%</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="color: var(--text-secondary); font-size: 0.85em; margin-bottom: 4px;">DPS Gain %</div>
                                    <div style="color: var(--accent-primary); font-size: 1.3em; font-weight: 700;" id="currency-dps-gain">0%</div>
                                </div>
                            </div>
                            <div style="color: var(--text-secondary); font-size: 0.85em; text-align: center; margin-bottom: 8px;">
                                Upgrade Path:
                            </div>
                            <div id="currency-upgrade-path" style="display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; font-size: 0.9em;">
                                <!-- Path will be generated -->
                            </div>
                            <div style="display: flex; justify-content: center; margin-top: 10px;">
                                <button id="apply-upgrade-path-btn"
                                    class="bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white px-4 py-2.5 rounded-lg cursor-pointer font-semibold text-sm shadow-md hover:shadow-lg transition-all">
                                    Apply Upgrade Path
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div
                    style="margin-top: 20px; background: linear-gradient(135deg, rgba(52, 199, 89, 0.15), rgba(0, 122, 255, 0.1)); border: 1px solid var(--border-color); border-radius: 16px; padding: 20px; box-shadow: 0 4px 16px var(--shadow);">
                    <div
                        style="color: var(--text-secondary); font-size: 0.9em; text-align: center; margin-bottom: 15px; font-weight: 500;">
                        Applied to Attack row in Stat Damage Predictions below
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 text-center">
                        <div>
                            <div
                                style="color: var(--accent-success); font-size: 0.95em; font-weight: 600; margin-bottom: 5px;">
                                Total Inventory Attack %</div>
                            <div id="total-inventory-attack"
                                style="font-size: 1.6em; font-weight: 700; color: var(--text-primary);">0%</div>
                        </div>
                        <div>
                            <div
                                style="color: var(--accent-success); font-size: 0.95em; font-weight: 600; margin-bottom: 5px;">
                                Equipped Attack %</div>
                            <div id="equipped-weapon-attack-pct"
                                style="font-size: 1.6em; font-weight: 700; color: var(--text-primary);">0%</div>
                        </div>
                        <div>
                            <div
                                style="color: var(--accent-success); font-size: 0.95em; font-weight: 600; margin-bottom: 5px;">
                                Total Weapon Attack %</div>
                            <div id="total-weapon-attack"
                                style="font-size: 1.6em; font-weight: 700; color: var(--text-primary);">0%</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Artifacts Tab -->
            <div id="setup-artifacts" class="tab-content">
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; min-height: 600px;">
                    <!-- Left Panel: Equipped Artifacts -->
                    <div id="artifacts-equipped-panel" style="background: var(--background); border: 1px solid var(--border-color); border-radius: 12px; padding: 20px; overflow-y: auto;">
                        <!-- Populated by JavaScript -->
                    </div>

                    <!-- Center Panel: Detail Editor -->
                    <div id="artifacts-detail-panel" style="background: var(--background); border: 1px solid var(--border-color); border-radius: 12px; padding: 20px; overflow-y: auto;">
                        <!-- Populated by JavaScript -->
                    </div>

                    <!-- Right Panel: Artifact Grid -->
                    <div id="artifacts-grid-panel" style="background: var(--background); border: 1px solid var(--border-color); border-radius: 12px; padding: 20px; overflow-y: auto;">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Help Sidebar Backdrop (for mobile) -->
            <div id="help-sidebar-backdrop" class="help-sidebar-backdrop" onclick="closeHelpSidebar()"></div>

            <!-- Help Sidebar -->
            <div id="help-sidebar" class="help-sidebar" style="display: none;">
                <div class="help-sidebar-header">
                    <h3 id="help-sidebar-title" class="help-sidebar-title">Help</h3>
                    <button id="help-sidebar-close" class="help-close-btn" onclick="closeHelpSidebar()">&times;</button>
                </div>
                <div class="help-sidebar-content" id="help-sidebar-content">
                    <!-- Dynamic help content goes here -->
                </div>
            </div>
        </div>

        <!-- Second Tabbed Area: Character Optimization -->
        <div id="character-optimization-card" class="bg-white/70 dark:bg-gray-800/70 backdrop-blur-sm border border-gray-200 dark:border-gray-700 rounded-2xl p-6 shadow-lg mb-5">
            <div class="text-2xl mb-5 text-center text-blue-600 dark:text-blue-400 font-semibold">Character Optimization</div>
            <div class="flex flex-wrap gap-2.5 mb-5 border-b-2 border-gray-200/50 dark:border-gray-700/50 pb-0">
                <button class="tab-button active px-6 py-3 text-base font-semibold cursor-pointer transition-all duration-300 border-b-[3px] border-transparent -mb-0.5 rounded-t-lg" onclick="switchTab('analysis', 'item-comparison')">Item Comparison</button>
                <button class="tab-button px-6 py-3 text-base font-semibold cursor-pointer transition-all duration-300 border-b-[3px] border-transparent -mb-0.5 rounded-t-lg" onclick="switchTab('analysis', 'inner-ability')">Inner Ability</button>
                <button class="tab-button px-6 py-3 text-base font-semibold cursor-pointer transition-all duration-300 border-b-[3px] border-transparent -mb-0.5 rounded-t-lg" onclick="switchTab('analysis', 'artifact-potential')">Artifact Potential</button>
                <button class="tab-button px-6 py-3 text-base font-semibold cursor-pointer transition-all duration-300 border-b-[3px] border-transparent -mb-0.5 rounded-t-lg" onclick="switchTab('analysis', 'scroll-optimizer')">Scrolling</button>
                <button class="tab-button px-6 py-3 text-base font-semibold cursor-pointer transition-all duration-300 border-b-[3px] border-transparent -mb-0.5 rounded-t-lg" onclick="switchTab('analysis', 'cube-potential')">Cube Potential</button>
            </div>

            <!-- Item Comparison Tab -->
            <div id="analysis-item-comparison" class="tab-content active">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-5">
                    <!-- Equipped Item -->
                    <div>
                        <h3 style="color: var(--accent-success); margin-bottom: 8px; font-size: 1em; font-weight: 600;">
                            Currently Equipped</h3>
                        <div
                            style="background: linear-gradient(135deg, rgba(52, 199, 89, 0.1), rgba(0, 122, 255, 0.05)); border: 1px solid var(--accent-success); border-radius: 12px; padding: 15px; box-shadow: 0 4px 16px var(--shadow);">
                            <div
                                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <span
                                    style="color: var(--accent-success); font-weight: 600; font-size: 0.95em;">Equipped
                                    Item</span>
                                <span style="color: var(--text-secondary); font-size: 0.8em;">(stats in base
                                    setup)</span>
                            </div>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-2.5 mb-2.5">
                                <div class="input-group">
                                    <label>Name</label>
                                    <input type="text" id="equipped-name" value="Current Item" onchange="saveToLocalStorage()">
                                </div>
                                <div class="input-group">
                                    <label>Attack</label>
                                    <input type="number" id="equipped-attack" value="0" onchange="saveToLocalStorage()">
                                </div>
                            </div>
                            <div id="equipped-stats-container"></div>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 mt-2">
                                <button onclick="addEquippedStat()"
                                    class="bg-green-600 hover:bg-green-700 dark:bg-green-500 dark:hover:bg-green-600 text-white px-4 py-2.5 rounded-lg cursor-pointer font-semibold text-sm shadow-md hover:shadow-lg transition-all">+
                                    Add Stat</button>
                                <button onclick="unequipItem()"
                                    class="bg-orange-500 hover:bg-orange-600 dark:bg-orange-600 dark:hover:bg-orange-700 text-white px-4 py-2.5 rounded-lg cursor-pointer font-semibold text-sm shadow-md hover:shadow-lg transition-all">
                                    Unequip</button>
                            </div>
                        </div>
                    </div>

                    <!-- Comparison Items Column -->
                    <div>
                        <h3 style="color: var(--accent-primary); margin-bottom: 8px; font-size: 1em; font-weight: 600;">
                            Comparison Items</h3>
                        <!-- Tab Navigation -->
                        <div id="comparison-tabs-container" class="flex flex-wrap gap-2.5 mb-3 border-b-2 border-gray-200/50 dark:border-gray-700/50 pb-0">
                            <button class="tab-button px-6 py-3 text-base font-semibold cursor-pointer transition-all duration-300 border-b-[3px] border-transparent -mb-0.5 rounded-t-lg" onclick="addComparisonItem()">+ Add Item</button>
                        </div>
                        <!-- Comparison Items Content -->
                        <div id="comparison-items-container" style="margin-bottom: 10px;"></div>
                    </div>
                </div>
                <button class="calculate-btn" onclick="calculate()" style="margin-bottom: 20px;">Calculate All</button>

                <!-- Results within the same tab -->
                <div style="border-top: 2px solid var(--border-color); padding-top: 20px;">
                    <h3
                        style="color: var(--accent-primary); margin-bottom: 15px; font-size: 1.3em; font-weight: 600; text-align: center;">
                        Comparison Results</h3>
                    <div id="results-container"
                        class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    </div>
                </div>
            </div>

            <!-- Inner Ability Analysis Tab -->
            <div id="analysis-inner-ability" class="tab-content">
                <div class="flex flex-wrap gap-2.5 mb-5 border-b-2 border-gray-200/50 dark:border-gray-700/50 pb-0">
                    <button class="tab-button active px-6 py-3 text-base font-semibold cursor-pointer transition-all duration-300 border-b-[3px] border-transparent -mb-0.5 rounded-t-lg" onclick="switchInnerAbilityTab('my-ability-pages')">My Ability Pages</button>
                    <button class="tab-button px-6 py-3 text-base font-semibold cursor-pointer transition-all duration-300 border-b-[3px] border-transparent -mb-0.5 rounded-t-lg" onclick="switchInnerAbilityTab('preset-comparison')">Preset
                        Comparison</button>
                    <button class="tab-button px-6 py-3 text-base font-semibold cursor-pointer transition-all duration-300 border-b-[3px] border-transparent -mb-0.5 rounded-t-lg" onclick="switchInnerAbilityTab('theoretical-best')">Theoretical
                        Best</button>
                </div>

                <!-- My Ability Pages Sub-Tab -->
                <div id="inner-ability-my-ability-pages" class="inner-ability-subtab active">
                    <div id="hero-power-presets-container">
                        <!-- Presets will be generated by JavaScript -->
                    </div>
                </div>

                <!-- Preset Comparison Sub-Tab -->
                <div id="inner-ability-preset-comparison" class="inner-ability-subtab" style="display: none;">
                    <div id="preset-comparison-container">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Theoretical Best Sub-Tab -->
                <div id="inner-ability-theoretical-best" class="inner-ability-subtab" style="display: none;">
                    <div id="theoretical-best-container">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Artifact Potential Tab -->
            <div id="analysis-artifact-potential" class="tab-content">
                <div id="artifact-potential-container">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>

            <!-- Scroll Optimizer Tab -->
            <div id="analysis-scroll-optimizer" class="tab-content">
                <!-- Sub-tabs for Scrolling -->
                <div class="flex flex-wrap gap-2.5 mb-5 border-b-2 border-gray-200/50 dark:border-gray-700/50 pb-0">
                    <button class="tab-button active px-6 py-3 text-base font-semibold cursor-pointer transition-all duration-300 border-b-[3px] border-transparent -mb-0.5 rounded-t-lg" onclick="switchScrollingSubTab('my-slot-performance')">My Slot Performance</button>
                    <button class="tab-button px-6 py-3 text-base font-semibold cursor-pointer transition-all duration-300 border-b-[3px] border-transparent -mb-0.5 rounded-t-lg" onclick="switchScrollingSubTab('simulation')">Simulation</button>
                </div>

                <!-- My Slot Performance Sub-Tab -->
                <div id="scrolling-my-slot-performance" class="scrolling-subtab active">
                    <div style="background: linear-gradient(135deg, rgba(0, 122, 255, 0.1), rgba(88, 86, 214, 0.05)); border: 1px solid var(--border-color); border-radius: 12px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 8px var(--shadow);">
                        <div style="color: var(--text-primary); font-size: 0.9em; line-height: 1.5;">
                            <strong style="color: var(--accent-primary);">Equipment Slot Analysis:</strong> Track individual equipment slot values in isolation. Each slot's DPS gain is calculated by comparing damage WITH that slot's stats vs damage WITH zero stats from that slot.
                        </div>
                    </div>
                    <div id="equipment-slots-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Slot cards generated by JavaScript -->
                    </div>
                    <div style="margin-top: 20px; text-align: center;">
                        <div style="background: linear-gradient(135deg, rgba(0, 122, 255, 0.15), rgba(88, 86, 214, 0.1)); border: 2px solid var(--accent-primary); border-radius: 12px; padding: 20px; max-width: 500px; margin: 0 auto 20px; box-shadow: 0 4px 16px var(--shadow);">
                            <div style="color: var(--text-secondary); font-size: 0.9em; margin-bottom: 8px; font-weight: 500;">Total DPS Gain from All Slots</div>
                            <div style="color: var(--accent-primary); font-size: 2em; font-weight: 700;">
                                <span id="total-slots-dps">0%</span>
                            </div>
                        </div>
                        <button class="calculate-btn" onclick="calculateEquipmentSlotDPS()" style="max-width: 400px; margin: 0 auto;">Calculate Slot DPS</button>
                    </div>
                </div>

                <!-- Simulation Sub-Tab -->
                <div id="scrolling-simulation" class="scrolling-subtab" style="display: none;">
                    <div style="background: linear-gradient(135deg, rgba(0, 122, 255, 0.1), rgba(88, 86, 214, 0.05)); border: 1px solid var(--border-color); border-radius: 12px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 8px var(--shadow);">
                        <div style="color: var(--text-primary); font-size: 0.9em; line-height: 1.5;">
                            <strong style="color: var(--accent-primary);">Scroll Optimizer:</strong> Simulates different scrolling strategies using Level 65 scrolls to find the optimal approach. The damage gain shows how much your DPS will increase from the average scroll results.
                        </div>
                    </div>

                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
                        <div class="input-group">
                            <label>Spell Trace Budget</label>
                            <input type="number" id="scroll-spell-trace-budget" value="7000" min="500" max="50000" step="100">
                        </div>
                        <div class="input-group">
                            <label>Number of Simulations</label>
                            <input type="number" id="scroll-simulations" value="500" min="100" max="10000" step="100">
                        </div>
                    </div>

                    <div style="background: rgba(0, 122, 255, 0.05); border: 1px solid var(--border-color); border-radius: 8px; padding: 15px; margin-bottom: 15px;">
                        <label style="font-weight: 600; margin-bottom: 10px; display: block; color: var(--text-primary);">Scroll Level</label>
                        <div style="display: flex; gap: 20px;">
                            <label style="display: flex; align-items: center; cursor: pointer; font-size: 0.95em;">
                                <input type="radio" name="scroll-level" value="65" checked onchange="updateScrollLevelInfo()" style="margin-right: 8px; cursor: pointer;">
                                <span style="color: var(--text-primary);">Level 65 Scrolls</span>
                            </label>
                            <label style="display: flex; align-items: center; cursor: pointer; font-size: 0.95em;">
                                <input type="radio" name="scroll-level" value="85" onchange="updateScrollLevelInfo()" style="margin-right: 8px; cursor: pointer;">
                                <span style="color: var(--text-primary);">Level 85 Scrolls</span>
                            </label>
                        </div>
                        <div id="scroll-level-info" style="margin-top: 12px; padding: 10px; background: var(--background); border-radius: 6px; font-size: 0.85em; color: var(--text-secondary); line-height: 1.6;">
                            <!-- Info will be populated by JavaScript -->
                        </div>
                    </div>

                    <button class="calculate-btn" onclick="runScrollSimulation()" id="scroll-run-btn">Run Simulation</button>

                    <div id="scroll-progress-container" style="display: none; margin-top: 15px;">
                        <div style="width: 100%; height: 4px; background: var(--border-color); border-radius: 2px; overflow: hidden;">
                            <div id="scroll-progress-bar" style="height: 100%; background: var(--accent-primary); transition: width 0.3s; width: 0%;"></div>
                        </div>
                        <p id="scroll-progress-text" style="text-align: center; color: var(--text-secondary); margin-top: 8px;"></p>
                    </div>

                    <div id="scroll-results-container" style="margin-top: 20px;">
                        <!-- Results will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Cube Potential Tab -->
            <div id="analysis-cube-potential" class="tab-content">
                <!-- Class Warning Banner -->
                <div id="cube-class-warning" style="display: none; background: linear-gradient(135deg, rgba(248, 113, 113, 0.15), rgba(239, 68, 68, 0.1)); border: 2px solid rgba(239, 68, 68, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 4px 16px rgba(239, 68, 68, 0.1);">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <span style="font-size: 2em;">‚ö†Ô∏è</span>
                        <div>
                            <div style="font-weight: 700; font-size: 1.1em; color: #ef4444; margin-bottom: 5px;">No Class Selected</div>
                            <div style="color: var(--text-secondary); font-size: 0.95em;">Please select your class in the Hero Power section above to use the Cube Potential calculator. Class selection is needed to properly calculate stat damage gains.</div>
                        </div>
                    </div>
                </div>

                <!-- Slot Selector -->
                <div style="background: linear-gradient(135deg, rgba(0, 122, 255, 0.08), rgba(88, 86, 214, 0.05)); border: 2px solid rgba(0, 122, 255, 0.2); border-radius: 16px; padding: 20px; margin-bottom: 25px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);">
                    <div style="margin-bottom: 15px;">
                        <label style="font-weight: 600; font-size: 1.05em; color: var(--accent-primary); display: block; margin-bottom: 10px;">Equipment Slot</label>
                        <div id="cube-slot-selector" style="display: flex; flex-wrap: wrap; gap: 10px; align-items: center;"></div>
                    </div>
                </div>

                <!-- Main Tab Navigation -->
                <div class="flex flex-wrap gap-2.5 mb-5 border-b-2 border-gray-200/50 dark:border-gray-700/50 pb-0">
                    <button id="cube-main-tab-selected" class="tab-button active px-6 py-3 text-base font-semibold cursor-pointer transition-all duration-300 border-b-[3px] border-transparent -mb-0.5 rounded-t-lg">Selected Slot</button>
                    <button id="cube-main-tab-summary" class="tab-button px-6 py-3 text-base font-semibold cursor-pointer transition-all duration-300 border-b-[3px] border-transparent -mb-0.5 rounded-t-lg">Summary</button>
                    <button id="cube-main-tab-simulation" class="tab-button px-6 py-3 text-base font-semibold cursor-pointer transition-all duration-300 border-b-[3px] border-transparent -mb-0.5 rounded-t-lg">Simulation</button>
                </div>

                <!-- Summary Main Tab Content -->
                <div id="cube-main-summary-content" style="display: none;">
                    <div style="margin-bottom: 20px;">
                        <h3 style="color: var(--accent-primary); margin-bottom: 10px; font-size: 1.2em; font-weight: 600;">
                            All Slots Potential Summary
                        </h3>
                        <p style="color: var(--text-secondary); font-size: 0.9em;">
                            Overview of Set A DPS gains for all equipment slots (Regular and Bonus Potential)
                        </p>
                    </div>

                    <!-- Loading Progress -->
                    <div id="cube-summary-progress" style="display: none; margin-bottom: 20px; padding: 15px; background: linear-gradient(135deg, rgba(0, 122, 255, 0.1), rgba(88, 86, 214, 0.05)); border: 2px solid rgba(0, 122, 255, 0.3); border-radius: 12px;">
                        <div style="font-size: 0.9em; color: var(--text-secondary); margin-bottom: 8px; text-align: center;">
                            <span id="cube-summary-progress-text">Loading rankings...</span>
                        </div>
                        <div style="background: var(--border-color); height: 8px; border-radius: 4px; overflow: hidden;">
                            <div id="cube-summary-progress-fill" style="background: linear-gradient(90deg, var(--accent-primary), var(--accent-success)); height: 100%; width: 0%; transition: width 0.3s;"></div>
                        </div>
                    </div>

                    <div id="cube-summary-results"></div>
                </div>

                <!-- Selected Slot Main Tab Content -->
                <div id="cube-main-selected-content" style="display: block;">
                <!-- Potential Type Toggle -->
                <div style="margin-bottom: 20px; background: linear-gradient(135deg, rgba(0, 122, 255, 0.08), rgba(88, 86, 214, 0.05)); border: 2px solid rgba(0, 122, 255, 0.3); border-radius: 12px; padding: 15px;">
                    <label style="font-weight: 600; font-size: 0.95em; color: var(--text-primary); display: block; margin-bottom: 10px;">Potential Type</label>
                    <div style="display: flex; gap: 10px;">
                        <button id="cube-regular-potential-btn" class="cube-potential-type-btn active" onclick="switchPotentialType('regular')" style="flex: 1; padding: 10px 20px; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s;">
                            Regular Potential
                        </button>
                        <button id="cube-bonus-potential-btn" class="cube-potential-type-btn" onclick="switchPotentialType('bonus')" style="flex: 1; padding: 10px 20px; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s;">
                            Bonus Potential
                        </button>
                    </div>
                </div>

                <!-- Rarity Selector -->
                <div style="margin-bottom: 20px;">
                    <label style="font-weight: 600; font-size: 0.95em; color: var(--text-primary); display: block; margin-bottom: 8px;">Slot Potential Rarity</label>
                    <select id="cube-rarity-selector" class="cube-rarity-select"></select>
                </div>

                <!-- Selected Slot Sub-Tab Navigation -->
                <div class="flex flex-wrap gap-2.5 mb-5 border-b-2 border-gray-200/50 dark:border-gray-700/50 pb-0">
                    <button id="cube-tab-comparison" class="tab-button active px-6 py-3 text-base font-semibold cursor-pointer transition-all duration-300 border-b-[3px] border-transparent -mb-0.5 rounded-t-lg">Comparison</button>
                    <button id="cube-tab-rankings" class="tab-button px-6 py-3 text-base font-semibold cursor-pointer transition-all duration-300 border-b-[3px] border-transparent -mb-0.5 rounded-t-lg">Slot Theoretical Best</button>
                </div>

                <!-- Comparison Tab Content -->
                <div id="cube-comparison-content" style="display: block;">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Set A (Current) - Styled like Equipped Item -->
                        <div style="background: linear-gradient(135deg, rgba(52, 199, 89, 0.1), rgba(0, 122, 255, 0.05)); border: 2px solid var(--accent-success); border-radius: 12px; padding: 20px; box-shadow: 0 4px 16px var(--shadow);">
                            <h3 style="color: var(--accent-success); margin-bottom: 15px; font-size: 1.1em; font-weight: 600;">Set A (Current)</h3>

                            <div style="margin-bottom: 15px;">
                                <label style="font-weight: 600; margin-bottom: 8px; display: block; color: var(--text-primary); font-size: 0.9em;">Line 1</label>
                                <select id="cube-setA-line1-stat" class="input-field" style="padding: 10px; font-size: 0.9em; width: 100%;"></select>
                            </div>

                            <div style="margin-bottom: 15px;">
                                <label style="font-weight: 600; margin-bottom: 8px; display: block; color: var(--text-primary); font-size: 0.9em;">Line 2</label>
                                <select id="cube-setA-line2-stat" class="input-field" style="padding: 10px; font-size: 0.9em; width: 100%;"></select>
                            </div>

                            <div style="margin-bottom: 0;">
                                <label style="font-weight: 600; margin-bottom: 8px; display: block; color: var(--text-primary); font-size: 0.9em;">Line 3</label>
                                <select id="cube-setA-line3-stat" class="input-field" style="padding: 10px; font-size: 0.9em; width: 100%;"></select>
                            </div>
                        </div>

                        <!-- Set B (Comparison) - Styled like Comparison Items -->
                        <div class="bg-gradient-to-br from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 border-2 border-blue-500 dark:border-blue-400 rounded-xl p-5 shadow-lg">
                            <h3 class="text-blue-600 dark:text-blue-400 mb-4 text-lg font-semibold">Set B (Comparison)</h3>

                            <div style="margin-bottom: 15px;">
                                <label style="font-weight: 600; margin-bottom: 8px; display: block; color: var(--text-primary); font-size: 0.9em;">Line 1</label>
                                <select id="cube-setB-line1-stat" class="input-field" style="padding: 10px; font-size: 0.9em; width: 100%;"></select>
                            </div>

                            <div style="margin-bottom: 15px;">
                                <label style="font-weight: 600; margin-bottom: 8px; display: block; color: var(--text-primary); font-size: 0.9em;">Line 2</label>
                                <select id="cube-setB-line2-stat" class="input-field" style="padding: 10px; font-size: 0.9em; width: 100%;"></select>
                            </div>

                            <div style="margin-bottom: 0;">
                                <label style="font-weight: 600; margin-bottom: 8px; display: block; color: var(--text-primary); font-size: 0.9em;">Line 3</label>
                                <select id="cube-setB-line3-stat" class="input-field" style="padding: 10px; font-size: 0.9em; width: 100%;"></select>
                            </div>
                        </div>
                    </div>

                    <!-- Comparison Results -->
                    <div id="cube-comparison-results"></div>
                </div>

                <!-- Rankings Tab Content -->
                <div id="cube-rankings-content" style="display: none;">
                    <!-- Progress Bar -->
                    <div id="cube-rankings-progress" style="display: none; margin-bottom: 25px;">
                        <div style="background: var(--border-color); height: 8px; border-radius: 4px; overflow: hidden; margin-bottom: 10px;">
                            <div id="cube-rankings-progress-fill" style="background: linear-gradient(90deg, var(--accent-primary), var(--accent-success)); height: 100%; width: 0%; transition: width 0.3s;"></div>
                        </div>
                        <p id="cube-rankings-progress-text" style="text-align: center; color: var(--text-secondary); font-weight: 600;"></p>
                    </div>

                    <!-- Rankings Results -->
                    <div id="cube-rankings-results"></div>
                </div>
                </div>

                <!-- Simulation Main Tab Content -->
                <div id="cube-main-simulation-content" style="display: none;">
                    <div style="margin-bottom: 20px;">
                        <h3 style="color: var(--accent-primary); margin-bottom: 10px; font-size: 1.2em; font-weight: 600;">
                            Cube Potential Optimization Simulator
                        </h3>
                        <p style="color: var(--text-secondary); font-size: 0.9em; line-height: 1.6;">
                            Simulates different cubing strategies to find the most efficient approach for maximizing damage across all equipment slots. Uses the current slots configured in the Cube Potential section.
                        </p>
                    </div>

                    <!-- Simulation Controls -->
                    <div style="background: linear-gradient(135deg, rgba(0, 122, 255, 0.08), rgba(88, 86, 214, 0.05)); border: 2px solid rgba(0, 122, 255, 0.2); border-radius: 16px; padding: 20px; margin-bottom: 20px;">
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
                            <div class="input-group">
                                <label style="font-weight: 600; color: var(--text-primary);">Cube Budget</label>
                                <input type="number" id="simulation-cube-budget" value="1000" min="100" max="50000" step="100" style="padding: 10px; border-radius: 8px;">
                            </div>
                            <div class="input-group">
                                <label style="font-weight: 600; color: var(--text-primary);">Number of Simulations</label>
                                <input type="number" id="simulation-count" value="1000" min="100" max="10000" step="100" style="padding: 10px; border-radius: 8px;">
                            </div>
                        </div>
                        <button class="calculate-btn" onclick="runCubeSimulation()" id="cube-simulation-run-btn">Run Simulation</button>
                    </div>

                    <!-- Progress Bar -->
                    <div id="cube-simulation-progress" style="display: none; margin-bottom: 20px;">
                        <div style="background: var(--border-color); height: 8px; border-radius: 4px; overflow: hidden; margin-bottom: 10px;">
                            <div id="cube-simulation-progress-fill" style="background: linear-gradient(90deg, var(--accent-primary), var(--accent-success)); height: 100%; width: 0%; transition: width 0.3s;"></div>
                        </div>
                        <p id="cube-simulation-progress-text" style="text-align: center; color: var(--text-secondary); font-weight: 600;"></p>
                    </div>

                    <!-- Results -->
                    <div id="cube-simulation-results"></div>
                </div>
            </div>
        </div>

        <!-- Stat Damage Predictions -->
        <div id="stat-damage-predictions-card" class="bg-white/70 dark:bg-gray-800/70 backdrop-blur-sm border border-gray-200 dark:border-gray-700 rounded-2xl p-6 shadow-lg mb-5">
            <div class="text-2xl mb-5 text-center text-blue-600 dark:text-blue-400 font-semibold">Stat Damage Predictions</div>

            <div class="flex flex-wrap gap-2.5 mb-5 border-b-2 border-gray-200/50 dark:border-gray-700/50 pb-0">
                <button class="tab-button active px-6 py-3 text-base font-semibold cursor-pointer transition-all duration-300 border-b-[3px] border-transparent -mb-0.5 rounded-t-lg" onclick="switchTab('predictions', 'stat-tables')">Stat Predictions</button>
                <button class="tab-button px-6 py-3 text-base font-semibold cursor-pointer transition-all duration-300 border-b-[3px] border-transparent -mb-0.5 rounded-t-lg" onclick="switchTab('predictions', 'equivalency')">Stat Equivalency</button>
            </div>

            <!-- Stat Predictions Tab -->
            <div id="predictions-stat-tables" class="tab-content active">
                <div id="stat-weights-base"></div>
            </div>

            <!-- Stat Equivalency Tab -->
            <div id="predictions-equivalency" class="tab-content">
                <div style="background: linear-gradient(135deg, rgba(138, 43, 226, 0.15), rgba(75, 0, 130, 0.1)); border: 2px solid rgba(138, 43, 226, 0.3); border-radius: 16px; padding: 20px; margin-bottom: 25px; box-shadow: 0 8px 32px rgba(138, 43, 226, 0.15);">
                    <div style="color: var(--accent-primary); font-weight: 700; font-size: 1.15em; margin-bottom: 15px; text-align: center;">
                        ‚ú® Stat Equivalency Calculator
                    </div>
                    <p style="color: var(--text-secondary); font-size: 0.95em; line-height: 1.6; text-align: center; margin-bottom: 20px;">
                        Enter a value for any stat below to see what that gain translates to for all other stats. Perfect for comparing upgrade paths and understanding relative stat values.
                    </p>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div class="input-group">
                            <label style="font-weight: 600; color: var(--accent-primary);">Attack</label>
                            <input type="number" id="equiv-attack" value="1000" min="0" step="100" oninput="calculateStatEquivalency('attack')">
                        </div>
                        <div class="input-group">
                            <label style="font-weight: 600; color: var(--accent-primary);">Main Stat</label>
                            <input type="number" id="equiv-main-stat" value="500" min="0" step="50" oninput="calculateStatEquivalency('main-stat')">
                        </div>
                        <div class="input-group">
                            <label style="font-weight: 600; color: var(--accent-primary);">3rd Job Skill +</label>
                            <input type="number" id="equiv-skill-level" value="5" min="0" step="1" oninput="calculateStatEquivalency('skill-level')">
                        </div>
                        <div class="input-group">
                            <label style="font-weight: 600; color: var(--accent-primary);">Critical Rate (%)</label>
                            <input type="number" id="equiv-crit-rate" value="10" min="0" step="1" oninput="calculateStatEquivalency('crit-rate')">
                        </div>
                        <div class="input-group">
                            <label style="font-weight: 600; color: var(--accent-primary);">Critical Damage (%)</label>
                            <input type="number" id="equiv-crit-damage" value="10" min="0" step="1" oninput="calculateStatEquivalency('crit-damage')">
                        </div>
                        <div class="input-group">
                            <label style="font-weight: 600; color: var(--accent-primary);">Attack Speed (%)</label>
                            <input type="number" id="equiv-attack-speed" value="10" min="0" step="1" oninput="calculateStatEquivalency('attack-speed')">
                        </div>
                        <div class="input-group">
                            <label style="font-weight: 600; color: var(--accent-primary);">Damage (%)</label>
                            <input type="number" id="equiv-damage" value="10" min="0" step="1" oninput="calculateStatEquivalency('damage')">
                        </div>
                        <div class="input-group">
                            <label style="font-weight: 600; color: var(--accent-primary);">Final Damage (%)</label>
                            <input type="number" id="equiv-final-damage" value="10" min="0" step="1" oninput="calculateStatEquivalency('final-damage')">
                        </div>
                        <div class="input-group">
                            <label style="font-weight: 600; color: var(--accent-primary);">Boss Damage (%)</label>
                            <input type="number" id="equiv-boss-damage" value="10" min="0" step="1" oninput="calculateStatEquivalency('boss-damage')">
                        </div>
                        <div class="input-group">
                            <label style="font-weight: 600; color: var(--accent-primary);">Damage Amplification (x)</label>
                            <input type="number" id="equiv-damage-amp" value="1" min="0" step="0.1" oninput="calculateStatEquivalency('damage-amp')">
                        </div>
                        <div class="input-group">
                            <label style="font-weight: 600; color: var(--accent-primary);">Min Damage Multiplier (%)</label>
                            <input type="number" id="equiv-min-damage" value="10" min="0" step="1" oninput="calculateStatEquivalency('min-damage')">
                        </div>
                        <div class="input-group">
                            <label style="font-weight: 600; color: var(--accent-primary);">Max Damage Multiplier (%)</label>
                            <input type="number" id="equiv-max-damage" value="10" min="0" step="1" oninput="calculateStatEquivalency('max-damage')">
                        </div>
                    </div>
                </div>

                <div id="equivalency-results" style="margin-top: 20px;">
                    <!-- Results will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="./src/core/main.js"></script>
</body>

</html>
