<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Damage Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js/dist/tesseract.min.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            light: '#007aff',
                            dark: '#0a84ff'
                        },
                        secondary: {
                            light: '#5856d6',
                            dark: '#5e5ce6'
                        },
                        success: {
                            light: '#34c759',
                            dark: '#30d158'
                        },
                        warning: {
                            light: '#ff9500',
                            dark: '#ff9f0a'
                        }
                    }
                }
            }
        }
    </script>

    <!-- Force dark mode - light theme disabled -->
    <script>
        (function() {
            document.documentElement.classList.add('dark');
            localStorage.setItem('theme', 'dark');
            })();
    </script>

    <link rel="stylesheet" href="styles/styles.css">

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-GKDLXCWZ9R"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-GKDLXCWZ9R');
    </script>
</head>

<body class="bg-gray-50 dark:bg-black text-gray-900 dark:text-gray-100 min-h-screen transition-colors duration-300">
    <!-- Donation Message Notification -->
    <div id="donate-notification" class="donate-notification-theme" style="display: none; position: fixed; top: 80px; right: 20px; z-index: 1000; max-width: 400px; border-radius: 12px; padding: 16px 20px; box-shadow: 0 8px 24px rgba(0,0,0,0.2); animation: slideIn 0.4s ease-out;">
        <div style="display: flex; align-items: start; gap: 12px;">
            <div style="font-size: 24px;">üíù</div>
            <div style="flex: 1;">
                <div style="font-weight: 600; font-size: 0.95em; line-height: 1.5; margin-bottom: 4px;">
                    Please consider supporting my efforts towards the calculator, what might seem small for you may be big for me :)!
                </div>
            </div>
            <button onclick="dismissDonateNotification()" class="donate-notification-close" style="border: none; width: 24px; height: 24px; border-radius: 50%; cursor: pointer; font-size: 16px; line-height: 1; display: flex; align-items: center; justify-content: center; transition: all 0.2s;">√ó</button>
        </div>
    </div>

    <!-- Sidebar Backdrop (for mobile) -->
    <div id="sidebar-backdrop" class="sidebar-backdrop" onclick="closeMobileMenu()"></div>

    <!-- Main Sidebar Navigation -->
    <aside id="app-sidebar" class="app-sidebar">
        <nav class="sidebar-nav">
            <!-- Loadout Section -->
            <button class="sidebar-nav-item" data-page="setup" onclick="toggleSubMenu('setup')">
                <span class="sidebar-icon">üéÆ</span>
                <span>Loadout</span>
                <span class="submenu-arrow">‚ñº</span>
            </button>
            <div class="sidebar-submenu" id="submenu-setup">
                <button class="sidebar-submenu-item" data-tab="base-stats" onclick="navigateToTab('setup', 'base-stats')">Base Stats</button>
                <button class="sidebar-submenu-item" data-tab="equipment" onclick="navigateToTab('setup', 'equipment')">Equipment</button>
                <button class="sidebar-submenu-item" data-tab="weapon-levels" onclick="navigateToTab('setup', 'weapon-levels')">Weapon Levels</button>
                <button class="sidebar-submenu-item" data-tab="companions" onclick="navigateToTab('setup', 'companions')">Companions</button>
            </div>

            <!-- Gear Lab Section -->
            <button class="sidebar-nav-item" data-page="optimization" onclick="toggleSubMenu('optimization')">
                <span class="sidebar-icon">üß™</span>
                <span>Gear Lab</span>
                <span class="submenu-arrow">‚ñº</span>
            </button>
            <div class="sidebar-submenu" id="submenu-optimization">
                <button class="sidebar-submenu-item" data-tab="item-comparison" onclick="navigateToTab('optimization', 'item-comparison')">Item Comparison</button>
                <button class="sidebar-submenu-item" data-tab="inner-ability" onclick="navigateToTab('optimization', 'inner-ability')">Inner Ability</button>
                <button class="sidebar-submenu-item" data-tab="artifact-potential" onclick="navigateToTab('optimization', 'artifact-potential')">Artifact Potential</button>
                <button class="sidebar-submenu-item" data-tab="scroll-optimizer" onclick="navigateToTab('optimization', 'scroll-optimizer')">Scrolling</button>
                <button class="sidebar-submenu-item" data-tab="cube-potential" onclick="navigateToTab('optimization', 'cube-potential')">Cube Potential</button>
                <button style="display: none;" class="sidebar-submenu-item" data-tab="stat-breakdown" onclick="navigateToTab('optimization', 'stat-breakdown')">Stat Breakdown</button>
            </div>

            <!-- StatHub Section -->
            <button class="sidebar-nav-item" data-page="predictions" onclick="toggleSubMenu('predictions')">
                <span class="sidebar-icon">üìä</span>
                <span >Stat Hub</span>
                <span class="submenu-arrow">‚ñº</span>
            </button>
            <div class="sidebar-submenu" id="submenu-predictions">
                <button class="sidebar-submenu-item" data-tab="stat-tables" onclick="navigateToTab('predictions', 'stat-tables')">Stat Predictions</button>
                <button class="sidebar-submenu-item" data-tab="equivalency" onclick="navigateToTab('predictions', 'equivalency')">Stat Equivalency</button>
            </div>
        </nav>

        <div class="sidebar-footer">
            <div class="sidebar-dps-summary">
                <span class="sidebar-dps-label">Current DPS</span>
                <span id="sidebar-dps-value" class="sidebar-dps-value">-</span>
            </div>
            <div class="sidebar-footer-actions">
                <button onclick="exportData()" class="sidebar-footer-btn">
                    <span>üìã</span>
                    <span>Copy</span>
                </button>
                <button onclick="importData()" class="sidebar-footer-btn">
                    <span>üì•</span>
                    <span>Paste</span>
                </button>
            </div>
            <button onclick="toggleTheme()" id="theme-toggle-sidebar" class="sidebar-footer-btn" style="display: none !important;">
                <span id="theme-icon-sidebar">üåô</span>
                <span>Toggle Theme</span>
            </button>
            <a href="https://paypal.me/freakehms" target="_blank" rel="noopener noreferrer" class="sidebar-footer-btn donate-btn">
                <span>üíù</span>
                <span>Support</span>
            </a>
        </div>
    </aside>

    <!-- Mobile Hamburger Button -->
    <button id="mobile-menu-btn" class="mobile-menu-btn" onclick="openMobileMenu()">
        <span></span>
        <span></span>
        <span></span>
    </button>

    <!-- Help Sidebar Backdrop (for mobile) -->
    <div id="help-sidebar-backdrop" class="help-sidebar-backdrop" onclick="closeHelpSidebar()"></div>

    <!-- Help Sidebar -->
    <aside id="help-sidebar" class="help-sidebar" style="display: none;">
        <div class="help-sidebar-header">
            <h3 id="help-sidebar-title" class="help-sidebar-title">Help</h3>
            <button id="help-sidebar-close" class="help-close-btn" onclick="closeHelpSidebar()">&times;</button>
        </div>
        <div class="help-sidebar-content" id="help-sidebar-content">
            <!-- Dynamic help content goes here -->
        </div>
    </aside>

    <!-- Main Content Area -->
    <div class="main-content">
        <!-- Page: Loadout -->
        <div id="page-setup" class="page-container">
        <!-- Loadout Content -->
        <div id="character-setup-card" class="bg-white/70 dark:bg-gray-800/70 backdrop-blur-sm border border-gray-200 dark:border-gray-700 rounded-2xl p-3 shadow-lg mb-3">
            <div class="optimization-page-header">
                <h1 class="optimization-page-title">Loadout</h1>
            </div>
            <div class="optimization-main-tabs">
                <button class="setup-tab-button optimization-tab-button active" data-tab="base-stats" onclick="switchTabAndUpdateURL('setup', 'base-stats', event)">Base Stats</button>
                <button class="setup-tab-button optimization-tab-button" data-tab="equipment" onclick="switchTabAndUpdateURL('setup', 'equipment', event)">Equipment</button>
                <button class="setup-tab-button optimization-tab-button" data-tab="weapon-levels" onclick="switchTabAndUpdateURL('setup', 'weapon-levels', event)">Weapon Levels</button>
                <button class="setup-tab-button optimization-tab-button" data-tab="companions" onclick="switchTabAndUpdateURL('setup', 'companions', event)">Companions</button>
                <button style="display: none;" class="setup-tab-button optimization-tab-button" data-tab="artifacts" onclick="switchTabAndUpdateURL('setup', 'artifacts', event)">Artifacts</button>
            </div>

            <!-- Base Stats Tab -->
            <div id="setup-base-stats" class="setup-tab-content optimization-tab-content active">
                <!-- Content populated by base-stats-ui.js -->
            </div>

            <!-- Equipment Tab -->
            <div id="setup-equipment" class="setup-tab-content optimization-tab-content">
                <!-- Summary Section -->
                <div id="equipment-summary" class="equipment-summary-wrapper">
                    <h3 class="equipment-summary-title">Total Equipment Stats</h3>
                    <div id="equipment-summary-content" class="equipment-summary-content">
                        <span class="equipment-summary-empty">No equipment configured</span>
                    </div>
                </div>

                <!-- Equipment Slots Grid -->
                <div id="equipment-slots-container" class="equipment-slots-grid">
                    <!-- Equipment slots populated by JavaScript -->
                </div>
            </div>

            <!-- Weapon Levels Tab -->
            <div id="setup-weapon-levels" class="setup-tab-content optimization-tab-content">
                <!-- Content populated by weapon-levels-ui.ts -->
            </div>

            <!-- Companions Tab -->
            <div id="setup-companions" class="setup-tab-content optimization-tab-content">
                <div style="background: linear-gradient(135deg, rgba(0, 122, 255, 0.1), rgba(88, 86, 214, 0.05)); border: 1px solid var(--border-color); border-radius: 12px; padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 8px var(--shadow);">
                    <div style="color: var(--text-primary); font-size: 0.9em; line-height: 1.5;">
                        <strong style="color: var(--accent-primary);">Instructions:</strong> Click on a companion to unlock/activate it. Enter the level for each companion. Unlocked companions provide inventory effects (always active), and you can equip companions for additional equip effects. Worth noting that the active abilities or passives that occur when a companion is summoned is not accounted for in any of the values below when providing % gains in DPS. 
                    </div>
                </div>

                <!-- Summary Section -->
                <div id="companions-summary" style="background: var(--background); border: 2px solid var(--accent-primary); border-radius: 12px; padding: 10px 15px; margin-bottom: 20px;">
                    <div style="display: flex; align-items: center; gap: 12px; flex-wrap: wrap;">
                        <h3 style="color: var(--accent-primary); margin: 0; font-size: 1em; font-weight: 700;">Total Inventory Effects:</h3>
                        <div id="companions-summary-content" style="display: flex; flex-wrap: wrap; gap: 6px 10px; font-size: 0.85em; align-items: center;">
                            <!-- Populated by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- Companions Grid -->
                <div id="companions-grid-container" class="companions-main-layout">
                    <!-- Icon Grid, Detail Panel, and Presets populated by JS -->
                </div>
            </div>

            <!-- Artifacts Tab -->
            <div id="setup-artifacts" class="setup-tab-content optimization-tab-content">
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; min-height: 600px;">
                    <!-- Left Panel: Equipped Artifacts -->
                    <div id="artifacts-equipped-panel" style="background: var(--background); border: 1px solid var(--border-color); border-radius: 12px; padding: 20px; overflow-y: auto;">
                        <!-- Populated by JavaScript -->
                    </div>

                    <!-- Center Panel: Detail Editor -->
                    <div id="artifacts-detail-panel" style="background: var(--background); border: 1px solid var(--border-color); border-radius: 12px; padding: 20px; overflow-y: auto;">
                        <!-- Populated by JavaScript -->
                    </div>

                    <!-- Right Panel: Artifact Grid -->
                    <div id="artifacts-grid-panel" style="background: var(--background); border: 1px solid var(--border-color); border-radius: 12px; padding: 20px; overflow-y: auto;">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
        </div>
        <!-- End Page: Character Setup -->

        <!-- Page: Gear Lab -->
        <div id="page-optimization" class="page-container" style="display: none;">
        <!-- Gear Lab Content -->
        <div id="character-optimization-card" class="bg-white/70 dark:bg-gray-800/70 backdrop-blur-sm border border-gray-200 dark:border-gray-700 rounded-2xl p-3 shadow-lg mb-3">
            <div class="optimization-page-header">
                <h1 class="optimization-page-title">Gear Lab</h1>
            </div>
            <div class="optimization-main-tabs">
                <button class="optimization-tab-button active" data-tab="item-comparison" onclick="switchTabAndUpdateURL('analysis', 'item-comparison', event); checkPendingSlotNavigation();">Item Comparison</button>
                <button class="optimization-tab-button" data-tab="inner-ability" onclick="switchTabAndUpdateURL('analysis', 'inner-ability', event)">Inner Ability</button>
                <button class="optimization-tab-button" data-tab="artifact-potential" onclick="switchTabAndUpdateURL('analysis', 'artifact-potential', event)">Artifact Potential</button>
                <button class="optimization-tab-button" data-tab="scroll-optimizer" onclick="switchTabAndUpdateURL('analysis', 'scroll-optimizer', event)">Scrolling</button>
                <button class="optimization-tab-button" data-tab="cube-potential" onclick="switchTabAndUpdateURL('analysis', 'cube-potential', event)">Cube Potential</button>
                <button style="display: none;" class="optimization-tab-button" data-tab="stat-breakdown" onclick="switchTabAndUpdateURL('analysis', 'stat-breakdown', event); updateStatBreakdown();">Stat Breakdown</button>
            </div>

            <!-- Item Comparison Tab - Enhanced UI/UX -->
            <div id="optimization-item-comparison" class="optimization-tab-content active">
                <!-- Slot Selector with Improved Visual Hierarchy -->
                <div class="comparison-slot-selector-wrapper">
                    <div class="comparison-slot-selector-inner">
                        <label for="comparison-slot-selector" class="comparison-slot-label">Equipment Slot</label>
                        <select id="comparison-slot-selector" onchange="switchComparisonSlot(this.value)" class="comparison-slot-select" aria-label="Select equipment slot to compare">
                            <option value="head">Head</option>
                            <option value="cape">Cape</option>
                            <option value="chest">Chest</option>
                            <option value="shoulders">Shoulders</option>
                            <option value="legs">Legs</option>
                            <option value="belt">Belt</option>
                            <option value="gloves">Gloves</option>
                            <option value="boots">Boots</option>
                            <option value="ring">Ring</option>
                            <option value="neck">Neck</option>
                            <option value="eye-accessory">Eye Accessory</option>
                        </select>
                    </div>
                </div>

                <!-- Two Column Layout with Improved Spacing -->
                <div class="comparison-columns-wrapper">
                    <!-- Equipped Item Card -->
                    <div class="comparison-column">
                        <h3 class="comparison-column-header comparison-column-header--equipped">Currently Equipped</h3>
                        <div class="equipped-item-card">
                            <div class="equipped-card-header">
                                <div class="equipped-card-title-row">
                                    <span class="equipped-card-title">Equipped Item</span>
                                    <span class="equipped-card-subtitle">(stats in base setup)</span>
                                </div>
                            </div>
                            <div class="equipped-inputs-row">
                                <div class="input-group equipped-input-group">
                                    <label for="equipped-name" class="equipped-label">Name</label>
                                    <input type="text" id="equipped-name" value="Current Item" onchange="saveToLocalStorage()" aria-label="Equipped item name" maxlength="50">
                                </div>
                                <div class="input-group equipped-input-group">
                                    <label for="equipped-attack" class="equipped-label">Attack</label>
                                    <input type="number" id="equipped-attack" value="0" onchange="saveToLocalStorage()" aria-label="Equipped item attack value">
                                </div>
                            </div>
                            <div id="equipped-stats-container" class="equipped-stats-container"></div>
                            <div class="equipped-actions-row">
                                <button onclick="addEquippedStat()" class="equipped-action-btn equipped-action-btn--add" aria-label="Add stat to equipped item">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
                                        <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                                    </svg>
                                    <span>Add Stat</span>
                                </button>
                                <button onclick="unequipItem()" class="equipped-action-btn equipped-action-btn--remove" aria-label="Unequip current item">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
                                        <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
                                    </svg>
                                    <span>Unequip</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Comparison Items Column -->
                    <div class="comparison-column">
                        <h3 class="comparison-column-header comparison-column-header--comparison">Comparison Items</h3>
                        <!-- Tab Navigation with Enhanced Accessibility -->
                        <div id="comparison-tabs-container" class="comparison-tabs-container" role="tablist" aria-label="Comparison item tabs">
                            <button class="comparison-add-tab-btn" data-type="add-button" onclick="addComparisonItem()" aria-label="Add new comparison item">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
                                    <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                                </svg>
                                <span>Add Item</span>
                            </button>
                        </div>
                        <!-- Comparison Items Content -->
                        <div id="comparison-items-container" class="comparison-items-container" role="presentation"></div>
                    </div>
                </div>

                <!-- Calculate Button with Enhanced Styling -->
                <button class="comparison-calculate-btn" onclick="calculate()" aria-label="Calculate damage for all comparison items">
                    <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
                        <path d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.267.267 0 0 1 .02-.022z"/>
                    </svg>
                    <span>Calculate All</span>
                </button>

                <!-- Results Section with Improved Visual Separation -->
                <div class="comparison-results-section">
                    <h3 class="comparison-results-title">Comparison Results</h3>
                    <div id="results-container" class="comparison-results-grid">
                        <!-- Results will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Inner Ability Analysis Tab -->
            <div id="optimization-inner-ability" class="optimization-tab-content">
                <!-- All inner HTML generated dynamically by TypeScript -->
            </div>

            <!-- Artifact Potential Tab -->
            <div id="optimization-artifact-potential" class="optimization-tab-content">
                <div id="artifact-potential-container">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>

            <!-- Scroll Optimizer Tab -->
            <div id="optimization-scroll-optimizer" class="optimization-tab-content">
                <!-- Sub-tabs for Scrolling -->
                <div class="tab-navigation">
                    <button id="scrolling-tab-button" class="tab-button active" onclick="switchScrollingSubTab('my-slot-performance')">My Slot Performance</button>
                    <button id="scrolling-tab-button" class="tab-button" onclick="switchScrollingSubTab('simulation')">Simulation</button>
                </div>

                <!-- My Slot Performance Sub-Tab -->
                <div id="scrolling-my-slot-performance" class="scrolling-subtab active">
                    <!-- Will be populated by JavaScript -->
                </div>

                <!-- Simulation Sub-Tab -->
                <div id="scrolling-simulation" class="scrolling-subtab" style="display: none;">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>

            <!-- Cube Potential Tab -->
            <div id="optimization-cube-potential" class="optimization-tab-content">
                <!-- Class Warning Banner -->
                <div id="cube-class-warning" class="optimization-info-banner optimization-info-banner--warning" style="display: none;">
                    <span class="optimization-info-banner-icon">‚ö†Ô∏è</span>
                    <div>
                        <div style="font-weight: 700; font-size: 1em; margin-bottom: 4px;">No Class Selected</div>
                        <div style="color: var(--text-secondary); font-size: 0.9em;">Please select your class in the Hero Power section above to use the Cube Potential calculator. Class selection is needed to properly calculate stat damage gains.</div>
                    </div>
                </div>

                <!-- Flattened Main Tab Navigation -->
                <div id="tab-container-main" class="cube-main-tabs">
                    <button id="cube-main-tab-comparison" class="tab-button active" data-tab="comparison">
                        <span class="cube-tab-label">Comparison</span>
                    </button>
                    <button id="cube-main-tab-rankings" class="tab-button" data-tab="rankings">
                        <span class="cube-tab-label">Best Potentials</span>
                    </button>
                    <button id="cube-main-tab-summary" class="tab-button" data-tab="summary">
                        <span class="cube-tab-label">All Slots Summary</span>
                    </button>
                    <button id="cube-main-tab-simulation" class="tab-button" data-tab="simulation">
                        <span class="cube-tab-label">Simulation</span>
                    </button>
                    <button id="cube-main-tab-optimal" class="tab-button" data-tab="optimal">
                        <span class="cube-tab-label">Optimal Strategy</span>
                    </button>
                </div>

                <!-- Comparison Tab Content -->
                <div id="cube-comparison-content" class="cube-tab-content active">
                    <!-- Equipment Slot Selector (inside Comparison tab) -->
                    <div class="cube-slot-selector-wrapper">
                        <label for="cube-slot-selector" class="cube-slot-label">Equipment Slot</label>
                        <div id="cube-slot-selector" class="cube-slot-buttons-container"></div>
                    </div>

                    <!-- Context Controls for Comparison Tab (Potential Type & Rarity) -->
                    <div id="cube-comparison-controls" class="cube-context-controls" style="display: block;">
                        <div class="cube-controls-grid">
                            <!-- Potential Type Toggle -->
                            <div class="cube-control-group">
                                <label class="cube-control-label">Potential Type</label>
                                <div class="cube-potential-type-buttons">
                                    <button id="cube-regular-potential-btn" class="cube-potential-type-btn active" onclick="switchPotentialType('regular')">
                                        <span class="cube-type-icon">‚ú¶</span>
                                        <span>Regular</span>
                                    </button>
                                    <button id="cube-bonus-potential-btn" class="cube-potential-type-btn" onclick="switchPotentialType('bonus')">
                                        <span class="cube-type-icon">‚úß</span>
                                        <span>Bonus</span>
                                    </button>
                                </div>
                            </div>

                            <!-- Rarity Selector -->
                            <div class="cube-rarity-row">
                                <div class="cube-control-group">
                                    <label for="cube-rarity-selector" class="cube-control-label">Slot Rarity</label>
                                    <select id="cube-rarity-selector" class="cube-rarity-select">
                                        <option value="normal">Normal</option>
                                        <option value="rare">Rare</option>
                                        <option value="epic">Epic</option>
                                        <option value="unique">Unique</option>
                                        <option value="legendary">Legendary</option>
                                        <option value="mystic">Mystic</option>
                                    </select>
                                </div>

                                <div class="cube-roll-count-container">
                                    <label for="cube-roll-count" style="font-size: 0.85em; color: var(--text-secondary);">
                                        Rolls at current rarity
                                    </label>
                                    <input type="number" id="cube-roll-count" min="0" max="999" value="0"
                                           style="width: 80px; padding: 8px 12px; border-radius: 8px;
                                                  border: 1px solid var(--border-color); background: var(--bg-secondary);
                                                  color: var(--text-primary); font-size: 0.95em;">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="cube-comparison-grid">
                        <!-- Set A (Current) Card -->
                        <div class="cube-set-card cube-set-card--a">
                            <div class="cube-set-card-header">
                                <h3 class="cube-set-card-title">Set A (Current)</h3>
                                <span class="cube-set-card-subtitle">Your configured potential</span>
                            </div>

                            <div class="cube-set-card-body">
                                <div class="cube-line-input-group">
                                    <label class="cube-line-label" for="cube-setA-line1-stat">Line 1</label>
                                    <select id="cube-setA-line1-stat" class="cube-line-select"></select>
                                </div>

                                <div class="cube-line-input-group">
                                    <label class="cube-line-label" for="cube-setA-line2-stat">Line 2</label>
                                    <select id="cube-setA-line2-stat" class="cube-line-select"></select>
                                </div>

                                <div class="cube-line-input-group">
                                    <label class="cube-line-label" for="cube-setA-line3-stat">Line 3</label>
                                    <select id="cube-setA-line3-stat" class="cube-line-select"></select>
                                </div>
                            </div>
                        </div>

                        <!-- Set B (Comparison) Card -->
                        <div class="cube-set-card cube-set-card--b">
                            <div class="cube-set-card-header">
                                <h3 class="cube-set-card-title">Set B (Comparison)</h3>
                                <span class="cube-set-card-subtitle">Test alternative potential</span>
                            </div>

                            <div class="cube-set-card-body">
                                <div class="cube-line-input-group">
                                    <label class="cube-line-label" for="cube-setB-line1-stat">Line 1</label>
                                    <select id="cube-setB-line1-stat" class="cube-line-select"></select>
                                </div>

                                <div class="cube-line-input-group">
                                    <label class="cube-line-label" for="cube-setB-line2-stat">Line 2</label>
                                    <select id="cube-setB-line2-stat" class="cube-line-select"></select>
                                </div>

                                <div class="cube-line-input-group">
                                    <label class="cube-line-label" for="cube-setB-line3-stat">Line 3</label>
                                    <select id="cube-setB-line3-stat" class="cube-line-select"></select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Comparison Results -->
                    <div id="cube-comparison-results" class="cube-results-section"></div>
                </div>

                <!-- Best Potentials Tab Content -->
                <div id="cube-rankings-content" class="cube-tab-content">
                    <!-- Controls for Rankings (Independent slot & rarity selectors) -->
                    <div id="cube-rankings-controls" class="cube-context-controls" style="display: block;">
                        <div class="cube-controls-grid">
                            <!-- Slot Selector -->
                            <div class="cube-control-group">
                                <label for="cube-rankings-slot-selector" class="cube-control-label">Equipment Slot</label>
                                <select id="cube-rankings-slot-selector" class="cube-rarity-select">
                                    <!-- Populated by JavaScript -->
                                </select>
                                <p style="font-size: 0.85em; color: var(--text-secondary); margin-top: var(--cube-space-sm);">
                                    Some slots have unique potential lines available only to them
                                </p>
                            </div>

                            <!-- Rarity Selector -->
                            <div class="cube-control-group">
                                <label for="cube-rankings-rarity-selector" class="cube-control-label">Rarity Tier</label>
                                <select id="cube-rankings-rarity-selector" class="cube-rarity-select">
                                    <option value="normal">Normal</option>
                                    <option value="rare">Rare</option>
                                    <option value="epic" selected>Epic</option>
                                    <option value="unique">Unique</option>
                                    <option value="legendary">Legendary</option>
                                    <option value="mystic">Mystic</option>
                                </select>
                                <p style="font-size: 0.85em; color: var(--text-secondary); margin-top: var(--cube-space-sm);">
                                    View best combinations for this rarity (independent of saved config)
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Progress Bar -->
                    <div id="cube-rankings-progress" class="cube-progress-bar" style="display: none;">
                        <div class="cube-progress-track">
                            <div id="cube-rankings-progress-fill" class="cube-progress-fill"></div>
                        </div>
                        <p id="cube-rankings-progress-text" class="cube-progress-text">Calculating best combinations...</p>
                    </div>

                    <!-- Rankings Results -->
                    <div id="cube-rankings-results" class="cube-rankings-results"></div>
                </div>

                <!-- All Slots Summary Tab Content -->
                <div id="cube-summary-content" class="cube-tab-content">
                    <div class="cube-summary-header">
                        <h3 class="cube-summary-title">All Slots Potential Summary</h3>
                        <p class="cube-summary-description">Overview of Set A DPS gains for all equipment slots (Regular and Bonus Potential)</p>
                    </div>

                    <!-- Loading Progress -->
                    <div id="cube-summary-progress" class="cube-progress-bar" style="display: none;">
                        <div class="cube-progress-track">
                            <div id="cube-summary-progress-fill" class="cube-progress-fill"></div>
                        </div>
                        <p id="cube-summary-progress-text" class="cube-progress-text">Loading rankings across all slots...</p>
                    </div>

                    <div id="cube-summary-results" class="cube-summary-results"></div>
                </div>

                <!-- Simulation Tab Content -->
                <div id="cube-simulation-content" class="cube-tab-content">
                    <div class="cube-simulation-header">
                        <h3 class="cube-simulation-title">Cube Potential Optimization Simulator</h3>
                        <p class="cube-simulation-description">Simulates different cubing strategies to find the most efficient approach for maximizing damage across all equipment slots. Uses fictional slots that are all set to normal with 0 tries attempted. This does not account for your current slots or their rarities!</p>
                    </div>

                    <!-- Simulation Controls -->
                    <div class="cube-simulation-controls">
                        <!-- Simulation Configuration -->
                        <div class="sim-config-row" style="display: flex; gap: 20px; margin-bottom: 15px; align-items: center; flex-wrap: wrap;">
                            <div class="sim-potential-type" style="display: flex; align-items: center; gap: 10px;">
                                <label style="color: var(--text-secondary);">Potential Type:</label>
                                <label style="display: flex; align-items: center; gap: 6px; cursor: pointer;">
                                    <input type="radio" name="sim-potential-type" value="regular" checked>
                                    <span>Regular</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; margin-left: 10px;">
                                    <input type="radio" name="sim-potential-type" value="bonus">
                                    <span>Bonus</span>
                                </label>
                            </div>
                            <div class="sim-use-data" style="display: flex; align-items: center; gap: 6px;">
                                <label style="display: flex; align-items: center; gap: 6px; cursor: pointer;">
                                    <input type="checkbox" id="sim-use-my-data">
                                    <span style="color: var(--text-secondary);">Use my current equipment data</span>
                                </label>
                            </div>
                        </div>

                        <div class="cube-simulation-inputs">
                            <div class="cube-sim-input-group">
                                <label for="simulation-cube-budget" class="cube-sim-label">Cube Budget</label>
                                <input type="number" id="simulation-cube-budget" value="1000" min="100" max="50000" step="100" class="cube-sim-input">
                            </div>
                            <div class="cube-sim-input-group">
                                <label for="simulation-count" class="cube-sim-label">Number of Simulations</label>
                                <input type="number" id="simulation-count" value="1000" min="100" max="10000" step="100" class="cube-sim-input">
                            </div>
                        </div>
                        <button class="cube-sim-run-btn" onclick="runCubeSimulation()" id="cube-simulation-run-btn">
                            <span class="cube-sim-btn-icon">‚ñ∂</span>
                            <span>Run Simulation</span>
                        </button>
                    </div>

                    <!-- Progress Bar -->
                    <div id="cube-simulation-progress" class="cube-progress-bar" style="display: none;">
                        <div class="cube-progress-track">
                            <div id="cube-simulation-progress-fill" class="cube-progress-fill"></div>
                        </div>
                        <p id="cube-simulation-progress-text" class="cube-progress-text">Running simulations...</p>
                    </div>

                    <!-- Results -->
                    <div id="cube-simulation-results" class="cube-simulation-results"></div>
                </div>

                <!-- Optimal Strategy Tab Content -->
                <div id="cube-optimal-content" class="cube-tab-content">
                    <div class="optimal-config" style="display: flex; gap: 20px; margin-bottom: 20px; align-items: center;">
                        <div>
                            <label style="color: var(--text-secondary);">Potential Type:</label>
                            <select id="optimal-potential-type" style="margin-left: 8px; padding: 6px 12px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--bg-secondary); color: var(--text-primary);">
                                <option value="regular">Regular</option>
                                <option value="bonus">Bonus</option>
                            </select>
                        </div>
                        <div>
                            <label style="color: var(--text-secondary);">Cube Budget:</label>
                            <input type="number" id="optimal-cube-budget" min="1" max="9999" value="100" style="margin-left: 8px; width: 100px; padding: 6px 12px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--bg-secondary); color: var(--text-primary);">
                        </div>
                    </div>

                    <div id="optimal-recommendation" class="optimal-recommendation-panel">
                        <!-- Populated dynamically -->
                    </div>

                    <div id="optimal-sequence" class="optimal-sequence-table">
                        <!-- Full optimal sequence table -->
                    </div>
                </div>
            </div>

            <!-- Stat Breakdown Tab -->
            <div id="optimization-stat-breakdown" class="optimization-tab-content">
                <div id="stat-breakdown-content">
                    <!-- Stat breakdown sections will be rendered here -->
                </div>
            </div>
        </div>
        </div>
        <!-- End Page: Character Optimization -->

        <!-- Page: Stat Hub -->
        <div id="page-predictions" class="page-container" style="display: none;">
        <!-- Stat Hub Content -->
        <div id="stat-damage-predictions-card" class="bg-white/70 dark:bg-gray-800/70 backdrop-blur-sm border border-gray-200 dark:border-gray-700 rounded-2xl p-3 shadow-lg mb-3">
            <div class="optimization-page-header">
                <h1 class="optimization-page-title">
                    Stat Hub
                </h1>
            </div>

            <div class="optimization-main-tabs">
                <button class="predictions-tab-button optimization-tab-button active" data-tab="stat-tables" onclick="switchTabAndUpdateURL('predictions', 'stat-tables', event)">Stat Predictions</button>
                <button class="predictions-tab-button optimization-tab-button" data-tab="equivalency" onclick="switchTabAndUpdateURL('predictions', 'equivalency', event)">Stat Equivalency</button>
            </div>

            <!-- Stat Predictions Tab -->
            <div id="predictions-stat-tables" class="predictions-tab-content optimization-tab-content active">
                <div id="stat-weights"></div>
            </div>

            <!-- Stat Equivalency Tab -->
            <div id="predictions-equivalency" class="predictions-tab-content optimization-tab-content">
                <div style="margin-bottom: 20px;">
                    <h3 style="color: var(--accent-primary); margin-bottom: 10px; font-size: 1.2em; font-weight: 600;">
                        ‚ú® Stat Equivalency Calculator
                    </h3>
                    <p style="color: var(--text-secondary); font-size: 0.9em; line-height: 1.6;">
                        Enter a value for any stat below to see what that gain translates to for all other stats. Perfect for comparing upgrade paths and understanding relative stat values.
                    </p>
                </div>
                <!-- Content will be dynamically generated by TypeScript -->
            </div>
        </div>
        </div>
        <!-- End Page: Stat Damage Predictions -->
    </div>
    <!-- End Main Content -->

    <!-- Import Map for cleaner imports -->
    <script type="importmap">
    {
        "imports": {
            "@core/": "./src/core/",
            "@ui/": "./src/ui/",
            "@utils/": "./src/ts/utils/",
            "@data/": "./src/ts/data/",
            "@services/" : "./src/ts/services/",
            "@page/": "./src/ts/page/",
            "@ts/": "./src/ts/",
            "@ts/types": "./src/ts/types/index.js"
        }
    }
    </script>

    <script type="module" src="./src/core/main.js"></script>
</body>

</html>
